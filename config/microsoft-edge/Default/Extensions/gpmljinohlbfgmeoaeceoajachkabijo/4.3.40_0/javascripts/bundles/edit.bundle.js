(()=>{"use strict";var e,t,n,r,i,a={99830:(e,t,n)=>{n(61348);var r=n(80923),i=(n(50904),n(38648)),a=(n(69754),n(55026)),s=n(67294),o=n(73935),l=(n(13234),n(64913)),c=(n(74128),n(12028)),d=(n(57539),n(9676)),u=(n(12496),n(31097)),h=n(85907),p=n(27484),f=n.n(p),m=n(9669),g=n.n(m),v=(n(40705),n(28374),n(85893));function y(e,t,n){function r(e){return e.charCodeAt(0)}t=t||"",n=n||1024;for(var i=atob(e),a=[],s=0;s<i.length;s+=n){var o=i.slice(s,s+n),l=Array.prototype.map.call(o,r),c=new Uint8Array(l);a.push(c)}return new Blob(a,{type:t})}function b(e){window.open(e)}function x(e){return"[object Array]"===Object.prototype.toString.call(e)}function j(e,t,n,r){var i={version:1,type:"doc",content:[]};if(e&&e.length&&i.content.push({type:"paragraph",content:[{type:"text",text:e}]}),i.content.push({type:"rule"}),t)for(var a in t){var s={type:"paragraph",content:[{type:"text",text:a+":",marks:[{type:"strong"}]},{type:"text",text:" "+t[a]}]};i.content.push(s)}return n&&(i.content.push({type:"paragraph",content:[{type:"text",text:"video"===r?"Click the link below to watch the video:":"Click the link below to see the image:"}]}),i.content.push({type:"paragraph",content:[{type:"text",text:n,marks:[{type:"link",attrs:{href:n,title:n}}]}]})),i}function w(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function S(e){var t=document.createElement("textarea");t.value=e,t.style.position="absolute",t.style.top="-999999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}function k(e,t,n){var r=[],i=document.createElement("img");i.onload=function(){for(var e=this.height,a=this.width,s=Math.ceil(e/t),o=e%t,l=0;l<s;l++){var c,d,u=document.createElement("canvas"),h=u.getContext("2d");u.width=a,c=d=u.height=l!==s-1?t:o,h.drawImage(i,0,t*l,a,c,0,0,a,d),r.push(u.toDataURL())}n(r)},i.src=e}function C(e){function t(e){return new Promise((function(t,n){var r=new Image;r.crossOrigin="Anonymous",r.onload=function(){t({ele:r,height:r.height,width:r.width})},r.onerror=r.onabort=function(){n(e)},r.src=e}))}for(var n=[],r=0;r<e.length;r++)n.push(t(e[r]));return Promise.all(n)}function N(e){return new Promise((function(e,t){chrome.permissions.request({permissions:["downloads"]},(function(t){t&&e()}))}))}function T(e){var t=e.filename;"true"===localStorage["save-as"]&&localStorage.download_directory&&(e.filename=localStorage.download_directory+"/"+e.filename),chrome.downloads.download(e,(function(n){(void 0===n||chrome.runtime.lastError)&&I(e.url,t)}))}function I(e,t){var n=document.createElement("a"),r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.setAttribute("href",e),n.setAttribute("download",t),n.rel="noopener",n.dispatchEvent(r)}function P(e){if(!e)return"local-image-"+f()().format("YYYY-MM-DD_h_mm");var t=new URL(e),n=t.pathname?t.pathname.split("/").splice(1).join("-")+"-":"";return"AwesomeScreenshot-"+t.hostname.replace(/^https?:\/\/(www\.)?/,"").replace(/^([^\/]+)\.com/,"$1").replace(/[^A-Za-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^[_\-]+/,"").replace(/[_\-]+$/,"")+"-"+n+f()().format("YYYY-MM-DD_h_mm")}function O(e){var t=e.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i),n=(t&&t[4]||"").trim(),r=t?(256|t[1]).toString(16).slice(1)+(256|t[2]).toString(16).slice(1)+(256|t[3]).toString(16).slice(1):e;return""!==n?n>1?1:n:1,"transparent"===e?"0000000":r}function D(e){return new Promise((function(t,n){var r=window.URL.createObjectURL(e),i=document.createElement("img"),a=document.createElement("canvas"),s=a.getContext("2d");i.onload=function(){a.width=i.width,a.height=i.height,s.drawImage(i,0,0),a.toBlob((function(e){t(e)}))},i.src=r}))}function A(e){return new Promise((function(t,n){var r=document.createElement("img"),i=document.createElement("canvas"),a=i.getContext("2d");r.onload=function(){i.width=r.width,i.height=r.height,a.drawImage(r,0,0),i.toBlob((function(e){t(e)}))},r.src=e}))}function U(e,t,n){navigator.clipboard.write([new ClipboardItem(Object.defineProperty({},e.type,{value:e,enumerable:!0}))]).then(t,n)}function R(e,t,n,r){var i=document.createElement("canvas"),a=i.getContext("2d"),s=t.height,o=t.width,l=0,c=0,d=0,u=null,h=t.border.borderType;t.border.paddingSize>0&&(l=t.border.paddingSize,u=t.border.paddingColor,c+=l,d+=l,s+=2*l,o+=2*l),i.width=o,h&&(s+=t.border.height,i.height=s,"url_bottom"!==h&&(d+=t.border.height)),i.height=s,u&&(a.save(),a.fillStyle=u,a.fillRect(0,0,i.width,i.height),a.restore(),l>0&&(a.shadowOffsetX=4*window.devicePixelRatio,a.shadowOffsetY=4*window.devicePixelRatio,a.shadowBlur=4*window.devicePixelRatio,a.shadowColor="rgba(0,0,0,.15)"));var p=URL.createObjectURL(e);if("mac"===h||"windows"===h)(function(e,t,n){return new Promise((function(r,i){if(e){var a,s=t.paddingSize?t.paddingSize:0,o="mac"===t.borderType?"mac":"win",l="web"==n?"/static/images/":"./images/",c=l+o+"-header-left.png",d=l+o+"-header-center.png",u=l+o+"-header-right.png",h=e.width;C([c,d,u]).then((function(n){var i=e.getContext("2d"),l=s;if(a=h-t.left-t.right-2*s,n.forEach((function(e,n){var o;1===n?o=a:0===n?o=t.left:2===n&&(o=t.right),i.drawImage(e.ele,0,0,e.width,e.height,l,s,o,t.height),l+=o,2===n&&r()})),t.url)if(i.font=13*window.devicePixelRatio+"px Arial",i.fillStyle="#000000",(d=i.measureText(t.url).width)>a){var c=Z(i,t.url,a);i.fillText(c,140*window.devicePixelRatio+s,("mac"===o?66:70)*window.devicePixelRatio+s)}else i.fillText(t.url,140*window.devicePixelRatio+s,("mac"===o?66:70)*window.devicePixelRatio+s);if(t.captureTime){i.font=12*window.devicePixelRatio+"px sans-serif",i.fillStyle="#000000";var d=i.measureText(t.captureTime).width,u=h-s-10*window.devicePixelRatio-d,p="mac"===o?34*window.devicePixelRatio+s:39*window.devicePixelRatio+s;i.fillText(t.captureTime,u,p)}}))}}))})(i,t.border,n).then((function(){var e=document.createElement("img");e.onload=function(){a.drawImage(e,c,d);var t="png"===localStorage.format?"image/png":"image/jpeg";i.toBlob((function(e){r(e)}),t,1)},e.src=p}));else{!function(e,t,n){if(!(Object.keys(t).indexOf("url")<0)){var r=e.getContext("2d"),i="url_top"==t.borderType?0:n,a=t.paddingSize?t.paddingSize:0,s=e.width-20-2*a,o="Captured at: "+t.captureTime+(t.url&&t.url.length?"  URL: "+t.url:""),l="single",c=40;if(r.font="bold 24px Arial",r.measureText(o).width>s){l="multiple";var d=E(r,"URL:"+t.url,s);c=40*(d.length+1)}if(r.fillStyle="#000000",r.fillRect(a,i+a,e.width-2*a,c),r.restore(),r.fillStyle="#ffffff",r.textBaseline="top",r.strokeStyle="#ffffff",r.font="bold 24px Arial","single"===l)r.fillText(o,12+a,8+i+a);else{r.fillText("Captured at:"+t.captureTime,12+a,8+i+a);for(var u=0;u<d.length;u++)r.fillText(d[u],12+a,8+40*(u+1)+i+a)}}}(i,t.border,t.height);var f=document.createElement("img");f.onload=function(){a.drawImage(f,c,d);var e="png"===localStorage.format?"image/png":"image/jpeg";i.toBlob((function(e){r(e)}),e,1)},f.src=p}}function _(e,t,n,r){var i=document.createElement("canvas"),a=i.getContext("2d"),s=n.length?"Captured at: "+f()().format("YYYY/MM/DD hh:mm")+"  URL: "+n:"Captured at: "+f()().format("YYYY/MM/DD hh:mm"),o="single",l=40,c="bold 24px Arial",d="bold 24px Arial";a.font=c;E(a,s,t.width);var u=a.measureText("Captured at: ").width,h=a.measureText("URL: ").width;if(a.font=d,u+h+a.measureText(n).width+a.measureText(f()().format("YYYY/MM/DD hh:mm")+" ").width>t.width){o="multiple";var p=E(a,"URL: "+n,t.width),m=p.length;l=40*(m+1)}i.width=t.width,i.height=t.height+l;var g=URL.createObjectURL(e),v=document.createElement("img");if(v.onload=function(){a.drawImage(v,0,l);var e="png"===localStorage.format?"image/png":"image/jpeg";i.toBlob((function(e){r(e)}),e,1)},v.src=g,a.fillStyle="#000000",a.fillRect(0,0,i.width,l),a.restore(),a.fillStyle="#ffffff",a.textBaseline="top",a.strokeStyle="#ffffff",a.font="bold 24px Arial","single"===o){a.fillText("Captured at: ",10,10),a.font=d,a.fillText(f()().format("YYYY/MM/DD hh:mm A")+" ",10+u,10);var y=a.measureText(f()().format("YYYY/MM/DD hh:mm A")+" ").width+20;n.length&&(a.font=c,a.fillText("URL: ",10+u+y,10),a.font=d,a.fillText(n,10+u+y+h,10))}else{a.fillText("Captured at: ",10,10),a.font=d,a.fillText(f()().format("MM/DD/YYYY, hh:mm A"),10+u,10);for(var b=0;b<p.length;b++)0===b?(a.font=c,a.fillText("URL: ",10,50),a.font=d,a.fillText(p[0].substring(5),10+h,50)):(a.font=d,a.fillText(p[b],10,10+40*(b+1)))}a.beginPath(),a.moveTo(0,l),a.stroke(),a.closePath()}function Z(e,t,n){for(var r=t.split(""),i=r[0],a=1;a<r.length;a++){var s=r[a];if(!(e.measureText(i+" "+s).width<n))break;i+=s}return i+"..."}function E(e,t,n){n-=10;for(var r=t.split(""),i=[],a=r[0],s=1;s<r.length;s++){var o=r[s];e.measureText(a+" "+o).width<n?a+=o:(i.push(a),a=o)}return i.push(a),i}var B=n(94184),F=n.n(B);function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e,t,n){return t&&Y(e.prototype,t),n&&Y(e,n),e}function V(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}function q(e,t){return q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},q(e,t)}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=X(e);if(t){var i=X(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return $(this,n)}}function $(e,t){if(t&&("object"===M(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return J(e)}function J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X(e){return X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},X(e)}var Q=["rgba(255, 0, 0,1)","rgba(255, 92, 0, 1)","rgba(250, 255, 0, 1)","rgba(36, 255, 0, 1)","rgba(0, 255, 240, 1)","rgba(0, 163, 255, 1)","rgba(144, 75, 255, 1)","rgba(255, 0, 229, 1)","rgba(255, 255, 255, 1)","rgba(0, 0, 0, 1)","rgba(244, 219, 121, 1)","rgba(248, 202, 65, 1)","rgba(246, 130, 61, 1)","rgba(226, 90, 59, 1)","rgba(242, 155, 126, 1)","rgba(217, 72, 70, 1)","rgba(160, 67, 72, 1)","rgba(228, 123, 135, 1)","rgba(198, 57, 69, 1)","rgba(198, 69, 101, 1)","rgba(165, 65, 90, 1)","rgba(151, 55, 143, 1)","rgba(112, 70, 140, 1)","rgba(79, 74, 142, 1)","rgba(94, 69, 128, 1)","rgba(67, 84, 104, 1)","rgba(34, 126, 169, 1)","rgba(59, 77, 105, 1)","rgba(47, 86, 165, 1)","rgba(25, 104, 173, 1)","rgba(72, 86, 145, 1)","rgba(11, 123, 185, 1)","rgba(74, 176, 209, 1)","rgba(22, 140, 152, 1)","rgba(22, 161, 134, 1)","rgba(33, 143, 106, 1)","rgba(45, 98, 90, 1)","rgba(80, 111, 80, 1)","rgba(93, 150, 73, 1)","rgba(120, 120, 71, 1)","transparent"],ee=["Times New Roman","Arial","Craft Girls","OpenSans","Roboto","Montserrat","Limelight","Lobster","Anton","Chewy","Frijole","Spirax","Dancing Script","Changa One","Griffy"],te=[2,4,6,8,16],ne=[6,8,16,32,48],re=function(e){V(n,e);var t=K(n);function n(e){return W(this,n),t.call(this,e)}return G(n,[{key:"shouldComponentUpdate",value:function(e){return e.disabled!==this.props.disabled||this.props.allowAdvancedTool!==e.allowAdvancedTool}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.action,r=e.title,i=e.handleClick,a=F()("tool-btn single-btn",{disabled:t}),s=F()(this.props.allowAdvancedTool?"":"pro");return(0,v.jsx)(u.Z,{title:r,children:(0,v.jsx)("div",{className:a,"data-action":n,onClick:i.bind(this,"action",{actionType:n}),children:(0,v.jsx)("b",{className:s})})})}}]),n}(s.Component),ie=function(e){V(n,e);var t=K(n);function n(e){var r;return W(this,n),(r=t.call(this,e)).state={haveClickShape:!1},r.clickShape=r.clickShape.bind(J(r)),r.visibleChange=r.visibleChange.bind(J(r)),r}return G(n,[{key:"shouldComponentUpdate",value:function(e,t){return e.current!==this.props.current||this.props.allowAdvancedTool!==e.allowAdvancedTool||this.props.selectShape!==e.selectShape||this.state.haveClickShape!==t.haveClickShape}},{key:"clickShape",value:function(){this.setState({haveClickShape:!1}),this.props.handleClick("shape",{shape:this.props.shape,shapeKey:this.props.shapeGroup})}},{key:"visibleChange",value:function(e){this.setState({haveClickShape:e})}},{key:"render",value:function(){var e=this.props,t=e.current,n=e.shape,r=e.title,i=e.active,a=e.selectShape,s=(e.onToolBar,!1);a?a===n&&(s=!0):s=n===t||i;var o=F()("tool-btn single-btn "+n,{active:s}),l=F()(this.props.allowAdvancedTool?"":"pro");return(0,v.jsx)(u.Z,{title:r,placement:"bottom",visible:this.state.haveClickShape,mouseEnterDelay:0,mouseLeaveDelay:0,onVisibleChange:this.visibleChange,children:(0,v.jsx)("div",{className:o,"data-shape":n,onClick:this.clickShape,children:(0,v.jsx)("b",{className:l})})})}}]),n}(s.Component);function ae(e){var t,n,r,i=e.current,a=e.defaultShape,o=e.handleClick,l=e.btns,c=e.allowAdvancedTool,d=e.selectShape,u=e.shapeGroup;(0,s.useEffect)((function(){}),[d]);return function(){var s;s=!1,l&&l.forEach((function(e){d?e.shape==d&&(s=!0,t=e.title,n=e.shape):(e.shape===i&&(s=!0),e.shape===a&&(t=e.title,n=e.shape))})),d&&!s&&l.forEach((function(e){e.shape===a&&(t=e.title,n=e.shape)})),r=s;var h=F()("menu",{active:r});return(0,v.jsxs)("div",{className:"subMenu",children:[(0,v.jsx)(ie,{title:t,shape:n,active:r,selectShape:d||"",current:i,shapeGroup:u,handleClick:o,onToolBar:!0,allowAdvancedTool:c}),(0,v.jsx)("div",{className:h,children:e.children()})]})}()}var se=s.memo(ae,(function(e,t){return t.currentShapeKey!==e.shapeGroup&&e.currentShapeKey!==e.shapeGroup&&e.allowAdvancedTool===t.allowAdvancedTool&&e.currentShape===t.currentShape&&e.defaultShape!==t.selectShape})),oe=s.memo(le,(function(e,t){return e.currentColor===t.currentColor}));function le(e){var t=this,n=e.recentColors,r=e.currentColor,i=e.stroke,a=e.handleColorClick,o=e.shapeKey,l=L((0,s.useState)(!0),2),c=l[0],d=l[1],p=L((0,s.useState)(r),2),f=p[0],m=p[1];function g(e){return"rgb(239, 239, 239)"===e||"rgb(243, 243, 243)"===e||"rgb(255, 255, 255)"===e||"rgb(252, 229, 205)"===e||"rgb(255, 242, 204)"===e?"#bdc1c6":"transparent"}function y(e,t){a(e,!!t),m(e)}return(0,s.useEffect)((function(){r!==f&&m(r)}),[r]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"color-header",children:[(0,v.jsxs)("div",{className:"color-values",children:[(0,v.jsx)("div",{className:"color-icon","data-color":f,style:{backgroundColor:f}}),(0,v.jsx)(h.ZE,{color:O(f),onChange:y,onClick:function(e){e.target.select()},alpha:!0,prefixed:!0})]}),(0,v.jsx)(u.Z,{title:"More Colors",placement:"right",children:(0,v.jsx)("div",{className:"change-action",style:{backgroundColor:c?"":"#26272D"},onClick:function(){d(!c)}.bind(this),children:(0,v.jsx)("b",{})})})]}),(0,v.jsx)("div",{className:"color-content",children:c?Q.map((function(e,n){return"transparent"!==e?(0,v.jsx)("div",{className:"color-item","data-color":e,title:e,style:{backgroundColor:e,borderColor:g(e)},onClick:y.bind(t,e,"item")},o+e+n):i?(0,v.jsx)("div",{className:"color-item transparent","data-color":"transparent",title:"transparent",style:{backgroundColor:"#666666",borderColor:g("transparent")},onClick:y.bind(t,"transparent","item")},"transparent"+o):void 0})):(0,v.jsx)(h.gW,{color:O(f),onChange:y})}),(0,v.jsxs)("div",{className:"color-foot",children:[(0,v.jsx)("span",{children:"Recent Colors"}),(0,v.jsx)("div",{className:"recent-colors",children:n.map((function(e,n){return(0,v.jsx)("div",{className:"color-item recent-item","data-color":e,title:e,style:{backgroundColor:e,borderColor:g(e)},onClick:y.bind(t,e,"item")},e+o+n)}))})]})]})}function ce(e){var t=this,n=e.style,r=e.selectShape,i=e.shapeKey,a=e.clickItem,o=L((0,s.useState)(!1),2),l=o[0],c=o[1],d=!1;if(n)var h=n.width;"highlight"!==i||n&&n.width||(h=16);var p="highlight"===i;r&&(h=r.penWidth,"highlight"===r.shapeName&&(p=!0));var f=h;function m(e){c((!e||!d)&&e)}return(0,v.jsx)(he,{className:"tool-pen-width multi-btn",children:function(e,n){var r=F()("panel",{active:e.isExpand});e.isExpand&&c(!1),d=e.isExpand;var s=function(e){n(),f=e,a("action",{actionType:"changePenWidth",value:e,shapeKey:i})};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.Z,{title:"Stroke width",placement:"bottom",visible:l,onVisibleChange:m,children:(0,v.jsxs)("div",{className:"current",id:"tool-current-width","data-width":f||h,children:[(0,v.jsxs)("div",{className:"tool-current-width "+(p?"highlight":""),children:[(0,v.jsx)("span",{children:f||h}),(0,v.jsx)("b",{})]}),(0,v.jsx)("div",{className:"multi-btn-arrow"})]})}),(0,v.jsx)("div",{className:r,children:p?ne.map((function(e,n){return(0,v.jsxs)("div",{className:"pen-width-item "+(e===f?"checked":""),"data-width":n+1,onClick:s.bind(t,e),children:[(0,v.jsx)("span",{children:e}),(0,v.jsx)("b",{})]},e)})):te.map((function(e,n){return(0,v.jsxs)("div",{className:"pen-width-item "+(e===f?"checked":""),"data-width":n+1,onClick:s.bind(t,e),children:[(0,v.jsx)("span",{children:e}),(0,v.jsx)("b",{})]},e)}))})]})}})}function de(e){var t=this,n=e.style,r=e.selectShape,i=e.shapeKey,a=e.clickItem,o=L((0,s.useState)(!1),2),l=o[0],c=o[1],d=!1,h=n.fontFamily;r&&r.fontName&&(h=r.fontName);var p=h;function f(e){c((!e||!d)&&e)}return(0,v.jsx)(he,{className:"tool-font-family multi-btn",children:function(e,n){var r=F()("panel",{active:e.isExpand});d=e.isExpand,e.isExpand&&c(!1);var s=function(e){n(),p=e,a("action",{actionType:"changeFontFamily",value:e,shapeKey:i})};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.Z,{title:"Font",placement:"bottom",visible:l,onVisibleChange:f,children:(0,v.jsxs)("div",{className:"tool-current-font-family btn-border current",id:"tool-current-font-family","data-ff":p||h,children:[(0,v.jsx)("span",{children:p||h}),(0,v.jsx)("div",{className:"btn-down-arrow"})]})}),(0,v.jsx)("div",{className:r,children:ee.map((function(e){return(0,v.jsx)("div",{className:"font-f-item "+(p===e?"checked":""),"data-ff":e,onClick:s.bind(t,e),children:e},e)}))})]})}})}var ue=function(e){V(n,e);var t=K(n);function n(e){var r;return W(this,n),(r=t.call(this,e)).state={isExpand:!1},r.toggle=r.toggle.bind(J(r)),r.clickView=r.clickView.bind(J(r)),r.elementContains=r.elementContains.bind(J(r)),r.el=(0,s.createRef)(),r}return G(n,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.clickView)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.clickView)}},{key:"elementContains",value:function(e,t){return e!==t&&e.contains(t)||e===t}},{key:"shouldComponentUpdate",value:function(e,t){return!(t.isExpand===this.state.isExpand&&e.allowAdvancedTool===this.props.allowAdvancedTool&&!t.isExpand&&e.color===this.props.color)}},{key:"clickView",value:function(e){var t=this.el.current.querySelector("."+this.props.checkView);this.elementContains(t,e.target)||(this.elementContains(this.el.current,e.target)?(this.toggle(),this.props.handleClick&&this.props.handleClick("action",{actionType:"ToolColorSelect"})):this.state.isExpand&&this.setState({isExpand:!this.state.isExpand}))}},{key:"toggle",value:function(){this.setState({isExpand:!this.state.isExpand})}},{key:"render",value:function(){var e=F()("tool-select "+(this.state.isExpand?"expand":""),this.props.className);return(0,v.jsx)("div",{className:e,tabIndex:"0",ref:this.el,children:this.props.children(this.state,this.toggle)})}}]),n}(s.Component),he=function(e){V(n,e);var t=K(n);function n(e){var r;return W(this,n),(r=t.call(this,e)).state={isExpand:!1},r.toggle=r.toggle.bind(J(r)),r.el=(0,s.createRef)(),r}return G(n,[{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"toggle",value:function(){var e=this;this.state.isExpand&&this.el.current.blur(),this.setState({isExpand:!this.state.isExpand},(function(){e.props.onPopupShown&&e.props.onPopupShown(e.state.isExpand)}))}},{key:"render",value:function(){var e=F()("tool-select "+(this.state.isExpand?"expand":""),this.props.className);return(0,v.jsx)("div",{className:e,tabIndex:"0",onFocus:this.toggle,onBlur:this.toggle,ref:this.el,children:this.props.children(this.state,this.toggle)})}}]),n}(s.Component),pe=n(6700);function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ge(e,t){return ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ge(e,t)}function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=xe(e);if(t){var i=xe(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ye(this,n)}}function ye(e,t){if(t&&("object"===fe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return be(e)}function be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(e){return xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xe(e)}var je=[20,30,40,68,98],we=[{title:"Top Left",value:"top_left"},{title:"Top Right",value:"top_right"},{title:"Center",value:"center"},{title:"Bottom Left",value:"bottom_left"},{title:"Bottom Right",value:"bottom_right"}],Se=[{title:"",value:"mac"},{title:"",value:"windows"},{title:"URL on top",value:"url_top"},{title:"URL on bottom",value:"url_bottom"}],ke=[{title:"Rectangle",shape:"rect"},{title:"Ellipse",shape:"ellipse"}],Ce=localStorage.rect?localStorage.rect:"rect",Ne=localStorage.line?localStorage.line:"big_head_arrow",Te=(localStorage.curve&&localStorage.curve,[{title:"Big head arrow",shape:"big_head_arrow"},{title:"Line arrow",shape:"line_arrow"},{title:"Bezier arrow",shape:"bezier_arrow"},{title:"Line",shape:"line"}]),Ie=["windows-cursor","cursor","cursor-hand","cursor-hand-black","cursor-click","smile","cry","tick-off","cross","forbidden","warning","q-mark","like","heart","star","chicken","dog","rain","sun","cloud","thunder","fish","fish2","tree1","tree2","building1","building2","package","tent","umbrella","car","basketball","beer"],Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(a,e);var t,n,r,i=ve(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).fontSizeInputRef=(0,s.createRef)(),t.inputCalloutRef=(0,s.createRef)(),t.inputFileRef=(0,s.createRef)(),t.colorFieldRef=(0,s.createRef)(),t.state={maskUrl:""},t.handleCropDemensionChange=t.handleCropDemensionChange.bind(be(t)),t.handleFileInputChange=t.handleFileInputChange.bind(be(t)),t}return t=a,n=[{key:"handleCropDemensionChange",value:function(e,t){""===t.target.value&&(t.target.value=0),this.props.handleToolBarBtnClick("action",{actionType:"crop-demension-"+e,value:t.target.value})}},{key:"handleFileInputChange",value:function(e){var t=e.target.files[0];if(t){var n=URL.createObjectURL(t);this.setState({maskUrl:n}),this.props.handleToolBarBtnClick("action",{actionType:"addMask",value:n})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.handleToolBarBtnClick,r=t.handleResizeInputChange,i=t.handleResizeProportionChange,a=t.getResizeInfo,s=t.currentTool,o=t.currentScale,p=t.isShowScaleTip,f=t.cropWidth,m=t.cropHeight,g=t.resizeWidth,y=t.resizeHeight,b=t.resizeProportional,x=t.canUndo,j=t.canRedo,w=t.canClear,S=t.canDeleteSelected,k=t.finishEdit,C=(t.isTextBackground,t.handleTextBgChange),N=t.handleResetList,T=t.selectShape,I=t.drawStyle,P=t.maskPosition,D=t.enableBrowser,A=t.enablePadding,U=t.enableMask,R=t.borderType,_=t.checkedUrl,Z=t.checkedCaptureTime,E=t.paddingColor,B=t.recentColors,z=t.paddingSize,M=t.maskSize,L=t.maskOpacity,H=t.currentToolGroup,W=100*o+"%",Y=(F()("zoom-tip",{active:p}),function(t,n){var r=I[t],i=24;r&&(i=r.fontSize),T&&T.fontName&&(i=T.penWidth,n.current&&(n.current.value=i));var a=i,s=function(r){var i=n.current.value;"add"===r?i<190?i++:i=190:i>11?i--:i=10,n.current.value=i,a=i,e.props.handleToolBarBtnClick("action",{actionType:"changeFontSize",value:i,shapeKey:t})};return(0,v.jsxs)("div",{className:"font-size-group",children:[(0,v.jsx)(u.Z,{title:"Decrease font size",placement:"bottom",children:(0,v.jsx)("div",{className:"action",onClick:s.bind(e,"plus"),children:"-"})}),(0,v.jsx)(ue,{checkView:"panel",className:"tool-font-size multi-btn",children:function(r,i){var s=F()("panel",{active:r.isExpand});!r.isExpand&&n.current&&n.current.blur();var o=function(r){i(),a=r,n.current.value=a,e.props.handleToolBarBtnClick("action",{actionType:"changeFontSize",value:r,shapeKey:t})};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.Z,{title:"Font size",placement:"bottom",children:(0,v.jsx)("div",{className:"tool-current-font-size current","data-fs":a,id:"tool-current-font-size",children:(0,v.jsx)("input",{type:"text",id:"change-size",maxLength:"4",className:"font-size",onClick:function(){n.current.setSelectionRange(0,n.current.value.length)},ref:n,defaultValue:a,onBlur:function(){n.current.value=a}.bind(e),onKeyDown:function(r){if(13===r.keyCode){var s=n.current.value;if(s.length>0)try{s=parseInt(s),isNaN(s)&&(s=a)}catch(r){s=a}s<10&&(s=10),s>190&&(s=190),a=s,n.current.value=a,i(),n.current.blur(),e.props.handleToolBarBtnClick("action",{actionType:"changeFontSize",value:a,shapeKey:t})}}.bind(e)})})}),(0,v.jsx)("div",{className:s,children:je.map((function(t){return(0,v.jsx)("div",{className:"font-s-item "+(a==t?"checked":""),"data-fs":t,onClick:o.bind(e,t),children:t},t)}))})]})}}),(0,v.jsx)(u.Z,{title:"Increase font size",placement:"bottom",children:(0,v.jsx)("div",{className:"action",onClick:s.bind(e,"add"),children:"+"})})]})}),G=function(e,t){var r=I[e];"highlight"!==e||r&&r.color||(r=I.curve);var i=!0,a=t?"Stroke color":"Color";if(r){var s=r.color;t&&(s=r.strokeColor)}else"padding_color"===e&&(s=E,i=!1);T&&"padding_color"!==e&&(s=t?T.strokeColor?T.strokeColor:s:T.color?T.color:s),"highlight"===e&&(s=function(e){if(e&&e.toLocaleLowerCase().startsWith("rgba")){var t=e.split("(")[1].split(")")[0].split(",");return"rgb("+t[0]+","+t[1]+","+t[2]+")"}return e}(s));var o=s,l="changeColor";t&&(l="changeStroke");var c="panel";return(0,v.jsx)(ue,{checkView:c,color:o,className:"tool-color-picker multi-btn",children:function(r,d){var h=F()(c,{active:r.isExpand});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.Z,{title:a,placement:"bottom",children:(0,v.jsxs)("div",{className:"current",id:"tool-current-color","data-color":o||s,children:[(0,v.jsx)("div",{className:"tool-current-color ",style:{backgroundColor:"transparent"!==o?o:""},children:"highlight"===e?(0,v.jsx)("b",{}):(0,v.jsx)(v.Fragment,{})}),i?(0,v.jsx)("div",{className:"multi-btn-arrow"}):(0,v.jsx)(v.Fragment,{})]})}),(0,v.jsx)("div",{className:h,children:(0,v.jsx)(oe,{handleColorClick:function(t,r){r&&d(),o=t,s=t,n("action",{actionType:l,value:t,shapeKey:e}),n("action",{actionType:"changeRecentColor",value:t,shapeKey:e})},actionType:l,stroke:t,shapeKey:e,recentColors:B,currentColor:o})})]})}})};return(0,v.jsx)("div",{className:"toolbar active",children:this.props.isInCropMode?(0,v.jsxs)("div",{className:"crop-area",children:[(0,v.jsx)("div",{className:"tool-action-btn primary-btn crop-item",id:"crop-btn",onClick:n.bind(e,"action",{actionType:"doCrop"}),children:"Crop"}),(0,v.jsx)("div",{className:"tool-action-btn border-btn crop-item",id:"crop-cancel-btn",onClick:n.bind(e,"action",{actionType:"leaveCrop"}),children:"Cancel"}),(0!==f||0!==m)&&(0,v.jsxs)("div",{id:"crop-dimension",children:[(0,v.jsxs)("div",{children:["Width:",(0,v.jsx)("input",{type:"text",id:"cd-width",className:"cd-input",onChange:e.handleCropDemensionChange.bind(null,"width"),value:f})]}),(0,v.jsxs)("div",{children:["Height:",(0,v.jsx)("input",{id:"cd-height",type:"text",className:"cd-input",onChange:e.handleCropDemensionChange.bind(null,"height"),value:m})]})]})]}):(0,v.jsxs)("div",{className:"tools",children:["ext"!==e.props.type&&(0,v.jsxs)("div",{className:"back-btn",onClick:e.props.handleBack,children:[(0,v.jsx)(pe.Z,{}),"Return"]}),(0,v.jsxs)("div",{className:"editer-content-field",children:[(0,v.jsx)(ue,{checkView:"panel",handleClick:n,className:"resize",children:function(e,t){var s=F()("panel",{active:e.isExpand}),o=F()("tool-btn resize-btn",{active:e.isExpand});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.Z,{title:"Resize",children:(0,v.jsx)("div",{className:o,id:"resize-btn",onClick:a,children:(0,v.jsx)("b",{})})}),(0,v.jsxs)("div",{className:s,children:[(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("span",{children:"Width:"}),(0,v.jsx)("input",{type:"number",id:"resize-width",min:"1",max:"5000",value:g,onChange:r.bind(null,"width")}),"px"]}),(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("span",{children:"Height:"}),(0,v.jsx)("input",{type:"number",id:"resize-height",min:"1",max:"5000",value:y,onChange:r.bind(null,"height")}),"px"]}),(0,v.jsx)("div",{className:"row",children:(0,v.jsx)("label",{htmlFor:"resize-proportional",children:(0,v.jsx)(d.Z,{checked:b,onChange:i,children:"Proportional"})})}),(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("div",{className:"do-resize-btn",id:"do-resize-btn",onClick:function(e){t(),"doResize"===e?n("action",{actionType:"doResize"}):"getSize"===e&&a()}.bind(null,"doResize"),children:"Resize"}),(0,v.jsx)("div",{className:"resize-cancel",id:"resize-cancel",onClick:t,children:"Cancel"})]})]})]})}}),(0,v.jsx)(re,{title:"Crop",action:"crop",handleClick:n}),(0,v.jsx)(se,{defaultShape:"curve",btns:[{title:"Pen",shape:"curve"}],current:s,shapeGroup:"curve",currentShapeKey:H,currentShape:T,selectShape:T?T.shapeName:"",handleClick:n,children:function(){return(0,v.jsxs)("div",{children:[G("curve"),(0,v.jsx)(ce,{selectShape:T,style:I.curve,shapeKey:"curve",clickItem:e.props.handleToolBarBtnClick})]})}}),(0,v.jsx)(se,{defaultShape:"highlight",btns:[{title:"Highlighter",shape:"highlight"}],current:s,shapeGroup:"highlight",currentShapeKey:H,currentShape:T,selectShape:T?T.shapeName:"",handleClick:n,children:function(){return(0,v.jsxs)("div",{children:[G("highlight"),(0,v.jsx)(ce,{selectShape:T,style:I.highlight,shapeKey:"highlight",clickItem:e.props.handleToolBarBtnClick})]})}}),(0,v.jsx)(se,{btns:ke,current:s,shapeGroup:"rect",currentShapeKey:H,defaultShape:Ce,currentShape:T,selectShape:T?T.shapeName:"",handleClick:n,children:function(){var t=function(e){Ce=e,n("shape",{shape:e,fromMenu:!0,shapeKey:"rect"})};return(0,v.jsxs)("div",{children:[ke.map((function(e){return(0,v.jsx)(ie,{title:e.title,shape:e.shape,shapeGroup:"rect",current:s,selectShape:T?T.shapeName:"",handleClick:t.bind(null,e.shape)},e.shape)})),(0,v.jsx)("div",{className:"tool-sep"}),G("rect"),(0,v.jsx)(ce,{selectShape:T,style:I.rect,shapeKey:"rect",clickItem:e.props.handleToolBarBtnClick})]})}}),(0,v.jsx)(se,{btns:Te,current:s,currentShape:T,selectShape:T?T.shapeName:"",defaultShape:Ne,shapeGroup:"line",currentShapeKey:H,title:"Line arrow",handleClick:n,children:function(){var t=function(e){Ne=e,n("shape",{shape:e,fromMenu:!0,shapeKey:"line"})};return(0,v.jsxs)("div",{children:[Te.map((function(e){return(0,v.jsx)(ie,{title:e.title,shape:e.shape,shapeGroup:"line",current:s,selectShape:T?T.shapeName:"",handleClick:t.bind(null,e.shape)},e.shape)})),(0,v.jsx)("div",{className:"tool-sep"}),G("line"),(0,v.jsx)(ce,{selectShape:T,style:I.line,shapeKey:"line",clickItem:e.props.handleToolBarBtnClick})]})}}),(0,v.jsx)(se,{btns:[{title:"Text",shape:"text"}],current:s,currentShape:T,selectShape:T?T.shapeName:"",defaultShape:"text",shapeGroup:"text",currentShapeKey:H,handleClick:n,children:function(){var t=I.text,n=!1,r=!1;t&&(n=t.isTextBg,r=t.showShadow),T&&"text"===T.shapeName&&(n=T.isTextBg,r=T.showShadow);var i=n?"bg":"",a=r?"bg":"",s=function(e){C(e)};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(de,{selectShape:T,style:I.text,shapeKey:"text",clickItem:e.props.handleToolBarBtnClick}),Y("text",e.fontSizeInputRef),G("text"),(0,v.jsx)("div",{className:"tool-sep"}),(0,v.jsx)(u.Z,{title:"Background",placement:"bottom",children:(0,v.jsx)("div",{className:"single-btn text-bg-option-btn ".concat(i),onClick:s.bind(null,"text-bg"),children:(0,v.jsx)("span",{children:"A"})})}),(0,v.jsx)(u.Z,{title:"Shadow",placement:"bottom",children:(0,v.jsx)("div",{className:"single-btn text-bg-option-btn text-shadow ".concat(a),onClick:s.bind(null,"text-shadow"),children:(0,v.jsx)("div",{})})}),G("text","stroke")]})}}),(0,v.jsx)(ie,{title:"Blur",shape:"rect_blur",shapeGroup:"rect_blur",current:s,selectShape:T?T.shapeName:"",handleClick:n}),(0,v.jsxs)("div",{className:"advanced-tool",children:[(0,v.jsx)(se,{btns:[{title:"Callout",shape:"callout"}],current:s,currentShape:T,selectShape:T?T.shapeName:"",defaultShape:"callout",shapeGroup:"callout",currentShapeKey:H,handleClick:n,allowAdvancedTool:e.props.allowAdvancedTool,children:function(){return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(de,{selectShape:T,style:I.callout,shapeKey:"callout",clickItem:e.props.handleToolBarBtnClick}),Y("callout",e.inputCalloutRef),G("callout")]})}}),(0,v.jsx)(se,{btns:[{title:"Step",shape:"list"}],current:s,currentShape:T,selectShape:T?T.shapeName:"",defaultShape:"list",shapeGroup:"list",currentShapeKey:H,handleClick:n,allowAdvancedTool:e.props.allowAdvancedTool,children:function(){return(0,v.jsxs)(v.Fragment,{children:[G("list"),(0,v.jsx)("div",{className:"tool-select tool-restart-sequence",children:(0,v.jsx)("div",{onClick:N,children:"Restart Sequence"})})]})}}),(0,v.jsx)(ue,{checkView:"panel",allowAdvancedTool:e.props.allowAdvancedTool,handleClick:n,className:"tool-image-picker",children:function(t,r){var i=F()("panel",{active:t.isExpand}),a=F()("image-btn",{active:t.isExpand}),s=function(e){r(),n("action",{actionType:"doInsertImage",value:e})},o=F()(e.props.allowAdvancedTool?"":"pro");return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.Z,{title:"Stickers",children:(0,v.jsxs)("div",{className:a,id:"image-btn",children:[(0,v.jsx)("b",{className:o}),(0,v.jsx)("div",{className:"image-btn-arrow"})]})}),(0,v.jsx)("div",{className:i,children:(0,v.jsx)("div",{className:"panel-container",children:Ie.map((function(t,n){if("web"===e.props.type)var r="/images/svg/"+t+".svg";else r="./images/svg/"+t+".svg";return(0,v.jsx)("div",{className:"image-item",onClick:s.bind(null,t),children:(0,v.jsx)("img",{src:r,alt:""})},t)}))})})]})}},"emoj"),(0,v.jsx)(re,{title:"Image",action:"insert-image",handleClick:n,allowAdvancedTool:e.props.allowAdvancedTool}),(0,v.jsx)(ue,{checkView:"menu",handleClick:n,className:"subMenu border-pickier",children:function(t,r){var i=F()("menu",{active:t.isExpand}),a=(F()(e.props.allowAdvancedTool?"":"pro"),"icon-position "+P.value),s=function(t,r){n("action",{actionType:"changeSwitchValue",value:r,type:t}),"watermask"!==t||r||e.setState({maskUrl:null})};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.Z,{title:"Watermark",children:(0,v.jsx)("div",{className:"single-btn watermask","data-shape":"watermask",children:(0,v.jsx)("b",{className:"beta"})})}),(0,v.jsx)("div",{className:i,children:(0,v.jsxs)("div",{className:"content",children:[(0,v.jsxs)("div",{className:"section-title",children:[(0,v.jsx)("span",{children:"Watermark"}),(0,v.jsx)(c.Z,{className:"switch",size:"small",onChange:s.bind(e,"watermask"),defaultChecked:U})]}),U?(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{className:"mask-preview",style:{backgroundImage:e.state.maskUrl?"url("+e.state.maskUrl+")":"none"},onClick:function(){e.inputFileRef.current.click()}.bind(e),children:[(0,v.jsx)("input",{type:"file",className:"file-input",ref:e.inputFileRef,accept:".jpg,.jpeg,.png",onChange:e.handleFileInputChange}),(0,v.jsx)("div",{className:"tips",children:e.state.maskUrl?(0,v.jsx)("div",{className:"change-mask",children:"Change Image"}):(0,v.jsx)("div",{className:"upload-mask",children:"Upload Image"})})]}),(0,v.jsxs)("div",{className:"mask-position-field",children:[(0,v.jsx)("div",{className:a}),(0,v.jsx)(he,{className:"select-position",children:function(t,r){var i=F()("panel",{active:t.isExpand}),a=function(e){r(),n("action",{actionType:"changeMaskPosition",value:e})};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:P.title}),(0,v.jsx)("div",{className:i,children:we.map((function(t){return(0,v.jsxs)("div",{className:"position-item",onClick:a.bind(e,t),children:[(0,v.jsx)("div",{className:"icon-position "+t.value}),t.title]},t.value)}))})]})}})]}),(0,v.jsxs)("div",{className:"mask_size_field",children:[(0,v.jsxs)("div",{className:"size_show_field",children:[(0,v.jsx)("span",{children:"Size"}),(0,v.jsx)("span",{className:"size_value",children:M+"%"})]}),(0,v.jsx)("div",{className:"size_action_field",children:(0,v.jsx)(l.Z,{className:"slider_opacity",defaultValue:M,value:M,disabled:!e.state.maskUrl,min:20,max:200,tipFormatter:"",onChange:s.bind(e,"mask_size")})})]}),(0,v.jsxs)("div",{className:"mask_opacity_field",children:[(0,v.jsxs)("div",{className:"size_show_field",children:[(0,v.jsx)("span",{children:"Opacity"}),(0,v.jsx)("span",{className:"size_value",children:L+"%"})]}),(0,v.jsx)("div",{className:"size_action_field",children:(0,v.jsx)(l.Z,{className:"slider_opacity",defaultValue:L,value:L,disabled:!e.state.maskUrl,tipFormatter:"",onChange:s.bind(e,"mask_opacity")})})]})]}):(0,v.jsx)(v.Fragment,{})]})})]})}}),(0,v.jsx)(ue,{checkView:"menu",handleClick:n,className:"subMenu border-pickier",children:function(t,r){var i=F()("menu",{active:t.isExpand}),a=function(e,t){"check_url"!==e&&"check_time"!==e||(t=t.target.checked),n("action",{actionType:"changeSwitchValue",value:t,type:e})},s=function(t){"click"===t?e.colorFieldRef.current.classList.contains("active")||e.colorFieldRef.current.classList.add("active"):e.colorFieldRef.current.classList.remove("active")},o=function(e){n("action",{actionType:"changeBowser",value:e})};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u.Z,{title:"Border",children:(0,v.jsx)("div",{className:"single-btn border","data-shape":"border",children:(0,v.jsx)("b",{className:"beta"})})}),(0,v.jsx)("div",{className:i,children:(0,v.jsxs)("div",{className:"content",children:[(0,v.jsxs)("div",{className:"section-title",children:[(0,v.jsx)("span",{children:"Browser"}),(0,v.jsx)(c.Z,{className:"switch",size:"small",onChange:a.bind(e,"browser"),checked:D})]}),(0,v.jsxs)("div",{className:"browser-content",style:{display:D?"block":"none"},children:[Se.map((function(e){return(0,v.jsx)("div",{className:"thum-border "+(R===e.value?" active":""),children:(0,v.jsx)("div",{className:"thum_browser "+e.value,onClick:o.bind(null,e.value),children:e.title})},e.value)})),(0,v.jsxs)("div",{className:"check_field check_url",style:{display:"mac"!==R&&"windows"!==R||!e.props.tabUrl?"none":"flex"},children:[(0,v.jsx)("span",{children:"Include URL"}),(0,v.jsx)(d.Z,{checked:_,onChange:a.bind(e,"check_url")})]}),(0,v.jsxs)("div",{className:"check_field check_time",style:{display:"mac"!==R&&"windows"!==R?"none":"flex"},children:[(0,v.jsx)("span",{children:"Include Date"}),(0,v.jsx)(d.Z,{checked:Z,onChange:a.bind(e,"check_time")})]})]}),(0,v.jsxs)("div",{className:"section-title",children:[(0,v.jsx)("span",{children:"Padding"}),(0,v.jsx)(c.Z,{className:"switch",size:"small",onChange:a.bind(e,"padding"),defaultChecked:A})]}),(0,v.jsxs)("div",{className:"padding-content",style:{display:A?"block":"none"},children:[(0,v.jsxs)("div",{className:"color_field",ref:e.colorFieldRef,children:[G("padding_color"),(0,v.jsx)("span",{children:"#"}),(0,v.jsx)(h.ZE,{color:O(E),onClick:s.bind(e,"click"),onBlur:s.bind(e,"focus"),onChange:function(e){n("action",{actionType:"changeColor",value:e,shapeKey:"padding_color"})}})]}),(0,v.jsxs)("div",{className:"size_field",children:[(0,v.jsxs)("div",{className:"size_show_field",children:[(0,v.jsx)("span",{children:"Size"}),(0,v.jsx)("span",{className:"size_value",children:z+"px"})]}),(0,v.jsx)("div",{className:"size_action_field",children:(0,v.jsx)(l.Z,{max:"200",className:"slider_opacity",value:z,tipFormatter:"",onChange:a.bind(e,"padding_size")})})]})]}),(0,v.jsx)("div",{className:"preload mac left"}),(0,v.jsx)("div",{className:"preload mac right"}),(0,v.jsx)("div",{className:"preload windows left"}),(0,v.jsx)("div",{className:"preload windows right"})]})})]})}})]})]}),(0,v.jsxs)("div",{className:"editer-action-field",children:[(0,v.jsx)(re,{title:"Undo",action:"undo",disabled:!x,handleClick:n}),(0,v.jsx)(re,{title:"Redo",action:"redo",disabled:!j,handleClick:n}),(0,v.jsx)(re,{title:"Clear",action:"clear",disabled:!w,handleClick:n}),(0,v.jsx)(re,{title:"Delete selected",action:"deleteSelected",disabled:!S,handleClick:n})]}),(0,v.jsx)("div",{className:"zoom-area",children:(0,v.jsx)(he,{className:"zoom-field",children:function(e,t){return F()("zoom-tip",{active:e.isExpand}),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(re,{title:"Zoom out",action:"zoom-out",handleClick:n}),(0,v.jsx)("span",{className:"zoom-level",children:W}),(0,v.jsx)(re,{title:"Zoom in",action:"zoom-in",handleClick:n})]})}})}),(0,v.jsxs)("div",{className:"right-field",children:["web"!==e.props.type&&!e.props.isReported&&("entire"===e.props.menuType||"selected"===e.props.menuType)&&(0,v.jsxs)("div",{className:"quick-issue",children:["Not properly captured?",(0,v.jsx)("a",{onClick:e.props.quickReport,children:" Report a problem."})]}),(0,v.jsx)("div",{className:"tool-action-btn border-btn",onClick:n.bind(e,"action",{actionType:"copy"}),children:"Copy"}),(0,v.jsx)("div",{className:"tool-action-btn primary-btn",id:"save-btn",onClick:k,children:"web"===e.props.type?"Save":"Done"})]})]})})}}],n&&me(t.prototype,n),r&&me(t,r),a}(s.PureComponent);const Oe=Pe;var De={slack:{displayName:"Slack",targetName:"Channel",placeHolder:"Choose a channel or user",panelTitle:"Send message",actionTypeStr:"Sending message",successMsg:"Slack message sent!",panelSubTitle:"Send screenshots to Slack",featureLists:["Send screenshots to Slack Channel","Send screenshots to Slack direct messages","Attach URL of the screenshot automatically"]},trello:{displayName:"Trello",targetName:"Board",placeHolder:"Choose a board",panelTitle:"Create card",actionTypeStr:"Creating card",successMsg:"Trello card created!",panelSubTitle:"Send screenshots as Trello cards",featureLists:["Create a trello card and attach the screenshot directly","Assign the card to members","Set due date and time","Include browser & OS info to help identify the issue"]},asana:{displayName:"Asana",targetName1:"Workspace",targetName2:"Project",placeHolder1:"Choose a workspace",placeHolder2:"Choose a project",panelTitle:"Create task",actionTypeStr:"Creating task",successMsg:"Asana task created!",panelSubTitle:"Send screenshots as Asana task",featureLists:["Send screenshots to Asana task","Create an Asana task and attach the screenshot directly","Assign the card to members","Choose Sections","Set due date and time","Include browser & OS info to help identify the issue"]},jira:{displayName:"Jira",targetName1:"Site",targetName2:"Project",placeHolder1:"Choose a site",placeHolder2:"Choose a project",panelTitle:"Create issue",actionTypeStr:"Creating issue",successMsg:"Jira issue created!",panelSubTitle:"Send screenshots as Jira issue",featureLists:["Create a Jira issue and attach the screenshot directly","Assign the card to members","Include browser & OS info to help identify the issue"]},googleDrive:{displayName:"Google Drive",targetName:"Folder",placeHolder:"Choose a folder",panelTitle:"Upload image",actionTypeStr:"Uploading image",successMsg:"Google Drive image uploaded!",panelSubTitle:"Save screenshots to Google Drive",featureLists:["Save screenshots to Google Drive folders directly"]},dropbox:{displayName:"Dropbox",targetName:"Folder",placeHolder:"Choose a folder",panelTitle:"Upload image",actionTypeStr:"Uploading image",successMsg:"Dropbox image uploaded!",panelSubTitle:"Save screenshots to Dropbox",featureLists:["Save screenshots to Dropbox folders directly"]},box:{displayName:"Box",targetName:"Folder",placeHolder:"Choose a folder",panelTitle:"Upload image",actionTypeStr:"Uploading image",successMsg:"Box image uploaded!",panelSubTitle:"Save screenshots to Box",featureLists:["Save screenshots to Box folders directly"]},github:{displayName:"Github",targetName:"Repository",placeHolder:"Choose a repository",panelTitle:"Create issue",actionTypeStr:"Creating issue",successMsg:"Github issue created!",panelSubTitle:"Send screenshots as Github issue",featureLists:["Send screenshots to Slack Channel","Send screenshots to Slack direct messages","Attach URL of the screenshot automatically"]}},Ae={channel:"#",repo:"",user:"@",board:"",project:"",folder:""},Ue=[{name:"slack",displayName:"Slack"},{name:"asana",displayName:"Asana"},{name:"trello",displayName:"Trello"},{name:"github",displayName:"Github"},{name:"jira",displayName:"Jira"}],Re=[{name:"googleDrive",displayName:"Google Drive"},{name:"dropbox",displayName:"Dropbox"},{name:"box",displayName:"Box"}],_e=["callout","list"],Ze=n(14133),Ee=n(16931);function Be(e){return Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Be(e)}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){Me(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function He(e,t){return He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},He(e,t)}function We(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ve(e);if(t){var i=Ve(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ye(this,n)}}function Ye(e,t){if(t&&("object"===Be(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ge(e)}function Ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e){return Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ve(e)}var qe=localStorage.draw_style?JSON.parse(localStorage.draw_style):{curve:{width:8,color:localStorage["pen-color"]||"rgb(255, 0, 0)",contains:["curve"]},highlight:{width:16,color:localStorage["pen-color"]||"rgb(255, 0, 0)",contains:["highlight"]},rect:{width:8,color:localStorage["pen-color"]||"rgb(255, 0, 0)",contains:["rect","ellipse"]},line:{width:8,color:localStorage["pen-color"]||"rgb(255, 0, 0)",contains:["line_arrow","bezier_arrow","big_head_arrow","line"]},text:{width:8,color:localStorage["pen-color"]||"rgb(255, 0, 0)",fontFamily:localStorage["font-family"]||"Arial",isTextBg:!1,showShadow:!1,strokeColor:"transparent",fontSize:localStorage["font-size"]?parseInt(localStorage["font-size"]):window.devicePixelRatio>1?36:24,contains:["text"]},callout:{width:8,color:localStorage["pen-color"]||"rgb(255, 0, 0)",fontFamily:localStorage["font-family"]||"Arial",fontSize:localStorage["font-size"]?parseInt(localStorage["font-size"]):window.devicePixelRatio>1?36:24,contains:["callout"]},list:{color:localStorage["pen-color"]||"rgb(255, 0, 0)",contains:["list"]}},Ke={mac:{left:255,right:105,height:79,top:48},windows:{left:214,right:146,height:86,top:54},url_top:{height:34},url_bottom:{height:34}},$e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}(o,e);var t,n,r,i=We(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,e)).outerContainer=(0,s.createRef)(),t.container=(0,s.createRef)(),t.doodleCanvas=(0,s.createRef)(),t.layerCanvas=(0,s.createRef)(),t.textareaOut=(0,s.createRef)(),t.textarea=(0,s.createRef)(),t.listDialog=(0,s.createRef)(),t.fileInput=(0,s.createRef)(),t.headerBorder=(0,s.createRef)(),t.headerCenter=(0,s.createRef)(),t.headerLeft=(0,s.createRef)(),t.headerRight=(0,s.createRef)(),t.timeRef=(0,s.createRef)(),t.urlFeld=(0,s.createRef)(),t.headerBar=(0,s.createRef)(),t.urlTopRef=(0,s.createRef)(),t.urlTopContent=(0,s.createRef)(),t.urlBottomContent=(0,s.createRef)(),t.urlBottomRef=(0,s.createRef)(),t.originHeight=0,t.originWidth=0,t.urlContentHeight=0,t.state={isInCropMode:!1,currentTool:"",currentToolGroup:"",currentColor:localStorage["pen-color"]||"rgb(255, 0, 0)",currentPenWidth:localStorage["pen-width"]?parseInt(localStorage["pen-width"]):window.devicePixelRatio>1?8:4,currentFontSize:localStorage["font-size"]?parseInt(localStorage["font-size"]):window.devicePixelRatio>1?36:24,currentFontFamily:localStorage["font-family"]||"Times New Roman",cropWidth:0,cropHeight:0,resizeWidth:0,resizeHeight:0,resizeProportional:!0,currentScale:1,canUndo:!1,canRedo:!1,canClear:!1,canDeleteSelected:!1,isShownUpgrade:!1,isReady:!1,upgradeType:"",isTextBackground:!1,selectShape:null,showTopBorder:!1,showBopttomBorder:!1,borderAction:!0,borderType:"mac",maskPosition:{title:"Top Left",value:"top_left"},maskSize:100,maskOpacity:100,enableBrowser:!1,enablePadding:!1,enableMask:!0,checkedUrl:!0,recentColors:localStorage.recent_clr?JSON.parse(localStorage.recent_clr):["#F8CA41","#E25A3B","#E47B87","#168C98","#218F6A"],paddingColor:"rgb(255, 153, 0)",paddingSize:30,checkedCaptureTime:!1,captureTime:f()().format("YYYY-MM-DD hh:mm A")},t.handleToolBarBtnClick=t.handleToolBarBtnClick.bind(Ge(t)),t.handleFileInputChange=t.handleFileInputChange.bind(Ge(t)),t.editor_style_callback=t.editor_style_callback.bind(Ge(t)),t.initEditor=t.initEditor.bind(Ge(t)),t.insertImage=t.insertImage.bind(Ge(t)),t.handleResizeInputChange=t.handleResizeInputChange.bind(Ge(t)),t.handleResizeProportionChange=t.handleResizeProportionChange.bind(Ge(t)),t.getResizeInfo=t.getResizeInfo.bind(Ge(t)),t.finishEdit=t.finishEdit.bind(Ge(t)),t.handleKeyDown=t.handleKeyDown.bind(Ge(t)),t.handleCloseUpgrade=t.handleCloseUpgrade.bind(Ge(t)),t.handleTextBgChange=t.handleTextBgChange.bind(Ge(t)),t.handleResetList=t.handleResetList.bind(Ge(t)),t.handleSelectShape=t.handleSelectShape.bind(Ge(t)),t.updateBorderShow=t.updateBorderShow.bind(Ge(t)),t.rePositionBorder=t.rePositionBorder.bind(Ge(t)),t.resetStatus=t.resetStatus.bind(Ge(t)),t.updateContainerTop=t.updateContainerTop.bind(Ge(t)),t.copyImageAction=t.copyImageAction.bind(Ge(t)),t}return t=o,n=[{key:"componentDidMount",value:function(){this.initEditor(this.props.imageUrl);var e=this;document.querySelector("#canvas2")&&document.querySelector("#canvas2").addEventListener("click",(function(){document.querySelectorAll(".tool-select").forEach((function(e){e.blur()}))}),!1),document.addEventListener("keydown",this.handleKeyDown),window.addEventListener("resize",(function(){e.state.enableBrowser&&e.updateBorderShow(e.state.borderType),e.state.enablePadding&&e.updateContainerTop(e.state.enableBrowser,e.state.enablePadding,e.state.paddingSize)}),!1)}},{key:"componentDidUpdate",value:function(e){e.imageUrl===this.props.imageUrl||""!==e.imageUrl&&void 0!==e.imageUrl||this.initEditor(this.props.imageUrl)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.editor=null}},{key:"handleKeyDown",value:function(e){var t=e.keyCode;if(-1!==this.props.className.indexOf("active"))if(90===t&&(e.ctrlKey||e.metaKey))e.shiftKey?this.editor.redo():this.editor.undo();else if((46===t||8===t)&&this.state.canDeleteSelected){if(e.target.classList.contains("editor-textarea")||e.target.classList.contains("editor-input")||e.target.classList.contains("font-size"))return;this.editor.deleteSelected()}}},{key:"finishEdit",value:function(e,t){var n=this,r={};if(this.state.enableBrowser||this.state.enablePadding){if(this.state.enableBrowser){var i=this.state.borderType;r.borderType=i,"mac"==i||"windows"==i?(this.state.checkedUrl&&(r.url=this.props.tabUrl,r.checkedUrl=this.state.checkedUrl),r.height=Ke[i].height*window.devicePixelRatio,r.left=Ke[i].left*window.devicePixelRatio,r.right=Ke[i].right*window.devicePixelRatio,this.state.checkedCaptureTime&&(r.captureTime=this.state.captureTime)):(r.url=this.props.tabUrl,r.checkedUrl=!0,r.height=this.urlContentHeight*window.devicePixelRatio,r.captureTime=this.state.captureTime)}this.state.enablePadding&&(r.paddingSize=this.state.paddingSize*window.devicePixelRatio,r.paddingColor=this.state.paddingColor)}this.editor.getImageDataBlob(this.props.contentType,(function(e){var i=window.URL.createObjectURL(e);if(t)n.props.handleFinishEditAndShare(i,e);else{var a=n.editor.bg_info;n.props.handleFinishEdit(i,e,{width:a.width,height:a.height,border:r})}}))}},{key:"copyImageAction",value:function(){var e=this,t={};if(this.state.enableBrowser||this.state.enablePadding){if(this.state.enableBrowser){var n=this.state.borderType;t.borderType=n,"mac"==n||"windows"==n?(this.state.checkedUrl&&(t.url=this.props.tabUrl,t.checkedUrl=this.state.checkedUrl),t.height=Ke[n].height*window.devicePixelRatio,t.left=Ke[n].left*window.devicePixelRatio,t.right=Ke[n].right*window.devicePixelRatio,this.state.checkedCaptureTime&&(t.captureTime=this.state.captureTime)):(t.url=this.props.tabUrl,t.checkedUrl=!0,t.height=this.urlContentHeight*window.devicePixelRatio,t.captureTime=this.state.captureTime)}this.state.enablePadding&&(t.paddingSize=this.state.paddingSize*window.devicePixelRatio,t.paddingColor=this.state.paddingColor)}this.editor.getImageDataBlob(this.props.contentType,(function(n){if(Object.keys(t).length>0){var r=e.editor.bg_info;R(n,{width:r.width,height:r.height,border:t},e.props.type,(function(e){e&&("image/jpeg"===e.type?D(e).then((function(e){U(e,(function(){a.ZP.success("Copied to clipboard!",1)}),(function(e){a.ZP.error("Copy failed.",1)}))})):U(e,(function(){a.ZP.success("Copied to clipboard!",1)}),(function(e){a.ZP.error("Copy failed.",1)})))}))}else n&&("image/jpeg"===n.type?D(n).then((function(e){U(e,(function(){a.ZP.success("Copied to clipboard!",1)}),(function(e){a.ZP.error("Copy failed.",1)}))})):U(n,(function(){a.ZP.success("Copied to clipboard!",1)}),(function(e){a.ZP.error("Copy failed.",1)})))}))}},{key:"handleResetList",value:function(){this.editor.resetList()}},{key:"handleTextBgChange",value:function(e){var t=qe.text,n=!1;if("text-bg"===e)if(this.state.selectShape){var r=this.state.selectShape,i=this.state.selectShape.isTextBg;r.isTextBg=!i,this.setState({selectShape:r}),t.isTextBg=!i,n=!0,this.editor.setTextBackground(!i)}else t.isTextBg=!t.isTextBg,n=!0,this.editor.setTextBackground(t.isTextBg);else this.state.selectShape?(r=this.state.selectShape,i=this.state.selectShape.showShadow,r.showShadow=!i,this.setState({selectShape:r}),t.showShadow=!i,n=!0,this.editor.setShowShadow(!i)):(t.showShadow=!t.showShadow,n=!0,this.editor.setShowShadow(t.showShadow));n&&(localStorage.draw_style=JSON.stringify(qe)),this.setState({isTextBackground:!this.state.isTextBackground})}},{key:"handleResizeProportionChange",value:function(e){this.setState({resizeProportional:e.target.checked})}},{key:"handleResizeInputChange",value:function(e,t){var n=this.editor.bg_info.width/this.editor.bg_info.height;"width"===e?!0===this.state.resizeProportional?this.setState({resizeWidth:parseInt(t.target.value),resizeHeight:parseInt(t.target.value)/n}):this.setState({resizeWidth:parseInt(t.target.value)}):!0===this.state.resizeProportional?this.setState({resizeWidth:parseInt(t.target.value)*n,resizeHeight:parseInt(t.target.value)}):this.setState({resizeHeight:parseInt(t.target.value)})}},{key:"getResizeInfo",value:function(){var e=this.editor.bg_info;this.setState({resizeHeight:parseInt(e.height),resizeWidth:parseInt(e.width)})}},{key:"handleFileInputChange",value:function(e){var t=e.target.files[0];if(t){var n=URL.createObjectURL(t);this.insertImage(n)}}},{key:"editor_style_callback",value:function(e,t){switch(e){case"crop":"done"!==t&&this.setState({cropWidth:t.width,cropHeight:t.height});break;case"undo":this.setState({canUndo:t}),this.state.enableBrowser&&this.updateBorderShow(this.state.borderType),this.state.enablePadding&&this.updateContainerTop(this.state.enableBrowser,this.state.enablePadding,this.state.paddingSize),this.editor.updateMaskPosition(this.state.maskPosition.value);break;case"redo":this.setState({canRedo:t});break;case"del":this.setState({canDeleteSelected:t});break;case"clear":this.setState({canClear:!t}),this.state.enableBrowser&&this.updateBorderShow(this.state.borderType);break;case"selected":this.handleSelectShape(t)}}},{key:"handleSelectShape",value:function(e){if(e){var t="";switch(e.shape){case 1:t="curve";break;case 3:t="rect";break;case 4:t="ellipse";break;case 7:t="callout";break;case 30:t="image";break;case 8:t="list";break;case 10:t="highlight";break;case 23:t="big_head_arrow";break;case 22:t="bezier_arrow";break;case 20:t="line_arrow";break;case 2:t="line";break;case 5:t="rect_blur";break;case 80:t="text"}e.shapeName=t,this.setState({selectShape:e})}else if(this.setState({selectShape:null}),this.state.currentToolGroup){var n=qe[this.state.currentToolGroup];n&&(n.width?this.editor.setPenWidth(n.width):"highlight"===this.state.currentTool&&(n.width=16,this.editor.setPenWidth(16)),n.fontFamily&&(this.editor.setFontName(n.fontFamily),this.editor.setTextBackground(!!n.isTextBg&&n.isTextBg),this.editor.setShowShadow(!!n.showShadow&&n.showShadow)),n.fontSize&&this.editor.setFontSize(n.fontSize),this.editor.setPenColor(n.color))}}},{key:"initEditor",value:function(e){if(e){var t=this,n=new Image;n.crossOrigin="Anonymous",this.editor=new Ee.Z({out_container:this.outerContainer.current,container:this.container.current,doodle_canvas:this.doodleCanvas.current,layer_canvas:this.layerCanvas.current,textarea:this.textarea.current,textarea_out:this.textareaOut.current,$list_dialog:this.listDialog.current,image:n},(function(e,n){t.editor_style_callback(e,n)})),n.src=e,n.onload=function(){t.originWidth=this.width,t.originHeight=this.height,t.editor.setBgImage(n,!1),t.editor.setPenColor(t.state.currentColor),t.editor.setFontSize(t.state.currentFontSize),t.editor.setPenWidth(t.state.currentPenWidth),t.editor.setFontName(t.state.currentFontFamily),t.editor.setBlurRadius(30),t.setState({isReady:!0})}}}},{key:"insertImage",value:function(e,t){var n=this,r=new Image;r.src=e;var i={image:r,width:0,height:0,choose_type:"full"};r.img_info=i,r.onload=function(){i.width=this.naturalWidth,i.height=this.naturalHeight,t?n.editor.insertMaskImage(i,n.state.maskPosition.value,n.state.maskSize/100,n.state.maskOpacity/100):n.editor.insertSvgImage(i)}}},{key:"handleCloseUpgrade",value:function(){this.setState({isShownUpgrade:!1})}},{key:"updateContainerTop",value:function(e,t,n){var r=parseInt(this.outerContainer.current.offsetHeight),i=parseInt(this.container.current.offsetHeight);this.container.current.style.top=e||t&&n>0?"0px":r-i>40?"40px":"0px"}},{key:"resetStatus",value:function(e){"browser"===e?(this.setState({enableBrowser:!1}),this.updateContainerTop(!1,this.state.enablePadding,this.state.paddingSize)):"padding"===e?this.setState({enablePadding:!1}):"watermask"===e&&(this.setState({enableMask:!1}),this.editor.removeMask())}},{key:"rePositionBorder",value:function(e,t){if(this.headerBorder.current){var n=Ke[t].height;this.container.current.style.top=0;var r=this.doodleCanvas.current.width/parseInt(this.doodleCanvas.current.style.width);"mac"!==t&&"windows"!==t&&(e*=window.devicePixelRatio/r);var i=parseInt(n*e),a=this.doodleCanvas.current.width/e,s=parseInt(a/r)*e;if(Ke[t].left){this.headerBorder.current.style.width=s+"px",this.headerBorder.current.style.height=i+"px",this.headerLeft.current.style.height=i+"px",this.headerRight.current.style.height=i+"px",this.headerCenter.current.style.height=i+"px";var o="matrix("+e+", 0, 0, "+e+","+120*(1-e)/2+","+(22-22*e)/2+")";this.timeRef.current.style.transform=o;var l=18*e,c=parseInt(a/r)-(Ke[t].left-50)-Ke[t].right,d="matrix("+(e*=window.devicePixelRatio/r)+", 0, 0, "+e+","+c*(e-1)/2+","+(l-18)/2+")";this.urlFeld.current.style.transform=d}else o="matrix("+e+", 0, 0, "+e+","+s/e*(e-1)/2+","+(this.urlContentHeight*e-this.urlContentHeight)/2+")","url_top"==t?(i=this.urlContentHeight*e,this.urlTopRef.current.style.width=s+"px",this.urlTopRef.current.style.height=i+"px",this.urlTopContent.current.style.transform=o):(i=this.urlContentHeight*e,this.urlBottomRef.current.style.height=i+"px",this.urlBottomRef.current.style.width=s+"px",this.urlBottomContent.current.style.transform=o)}}},{key:"updateBorderShow",value:function(e){var t=this;if("none"!==e){this.setState({showTopBorder:!0});var n=this.doodleCanvas.current.width/this.state.currentScale,r=this.doodleCanvas.current.width/parseInt(this.doodleCanvas.current.style.width),i=parseInt(n/r);if(parseInt(this.container.current.style.width),Ke[e].left){if(i<460)return this.setState({enableBrowser:!1}),void a.ZP.warning("The image size is too small to add a browser border.",1.2);var s,o=Ke[e].left/i,l=Ke[e].right/i;this.headerBorder.current.style.width=i+"px",this.headerLeft.current.style.width=100*o+"%",this.headerRight.current.style.width=100*l+"%",this.headerCenter.current.style.width=100*(1-o-l+1/i)+"%",this.container.current.style.marginBottom="-6px",this.container.current.style.top=0;var c=144/i,d=this.urlFeld.current,u=i-Ke[e].left-Ke[e].right;this.urlFeld.current.style.left=100*c+"%",this.urlFeld.current.style.top=58/86*100+"%",this.timeRef.current.style.bottom=38/86*100+"%",this.urlFeld.current.style.width=u+"px",this.urlFeld.current.style.height="18px",this.urlFeld.current.height=18*window.devicePixelRatio,this.urlFeld.current.width=u*window.devicePixelRatio,s=this.props.tabUrl?this.props.tabUrl:"";var h=d.getContext("2d");h.font=13*window.devicePixelRatio+"px Arial",h.fillStyle="#000000",h.measureText(s).width>u*window.devicePixelRatio&&(s=Z(h,s,u*window.devicePixelRatio)),h.fillText(s,0,13*window.devicePixelRatio)}else{var p=this.props.tabUrl?"URL:"+this.props.tabUrl:"";!function(e,t,n,r,i){var a=e.getContext("2d"),s=n&&n.length?t+" "+n:t,o="single",l=40,c="bold 24px Arial";if(a.font=c,a.measureText(s).width>r){o="multiple";var d=E(a,n,r);l=40*(d.length+1)}if(i(l),e.width=r,e.height=l,a.fillStyle="#000000",a.fillRect(0,0,e.width,l),a.restore(),a.fillStyle="#ffffff",a.textBaseline="top",a.strokeStyle="#ffffff",a.font=c,"single"===o)a.fillText(s,10,8);else{a.fillText(t,10,8);for(var u=0;u<d.length;u++)a.fillText(d[u],10,8+40*(u+1))}}((d="url_top"!==e?this.urlBottomContent:this.urlTopContent).current,"Captured at: "+this.state.captureTime,p,n,(function(e){d.current.style.height=e/window.devicePixelRatio+"px",d.current.style.width=n/window.devicePixelRatio+"px",t.urlContentHeight=e/window.devicePixelRatio}))}var f=this.state.currentScale;this.rePositionBorder(f,e)}else this.setState({showTopBorder:!1})}},{key:"handleToolBarBtnClick",value:function(e,t){var n=this,r=this.editor;if("shape"===e){var i=t.shapeKey,a=null;if(this.state.selectShape&&(a=this.state.selectShape.shapeName),this.setState({selectShape:null}),r.unSelectAll(),!(t.shape!==this.state.currentTool||t.fromMenu||a&&a!==t.shape))return r.setPenType(""),void this.setState({currentTool:"",currentToolGroup:""});if(-1!==_e.indexOf(t.shape)&&!this.props.permissions.allowAdvancedToolForImageEditor)return void this.setState({upgradeType:t.shape,isShownUpgrade:!0});if("border"===t.shape)this.setState({borderAction:!0});else if("highlight"==t.shape)(s=qe[i])||(qe.highlight=s={width:16,color:"rgb(255, 0, 0)",contains:["highlight"]}),r.unSelectAll(),r.setPenOpacity(.3),r.setPenWidth(s.width?s.width:16),r.setPenColor(s.color?s.color:"rgb(255, 0, 0)"),r.setPenType("highlight");else{if(r.unSelectAll(),r.setPenOpacity(1),i&&qe[i]){var s=qe[i];r.setPenWidth(s.width),r.setPenColor(s.color),s.fontFamily&&r.setFontName(s.fontFamily),s.fontSize&&r.setFontSize(s.fontSize),"text"===i&&r.setShowShadow(s.showShadow),r.setTextBackground(!!s.isTextBg&&s.isTextBg),r.setTextStrokeColor(s.strokeColor)}else r.setPenWidth(this.state.currentPenWidth);r.setPenType(t.shape)}t.shape&&i&&(localStorage[i]=t.shape),this.setState({selectShape:null,currentTool:t.shape,currentToolGroup:i})}else if("action"===e){i=t.shapeKey;var o=!1;switch(t.actionType){case"crop":this.setState({isInCropMode:!0}),r.cutImage();break;case"addMask":this.insertImage(t.value,!0);break;case"copy":this.copyImageAction();break;case"changeBowser":this.setState({borderType:t.value},(function(){"url_bottom"===t.value?n.outerContainer.current.scrollTop=n.outerContainer.current.scrollHeight:n.outerContainer.current.scrollTop=0})),this.updateBorderShow(t.value);break;case"ToolColorSelect":r.unactiveTextbox(),r.unSelectAll(),r.setPenType(""),this.setState({selectShape:null,currentTool:"",currentToolGroup:""});break;case"changeStroke":r.setTextStrokeColor(t.value),i&&((s=qe[i]).strokeColor=t.value,o=!0),this.state.selectShape&&this.state.selectShape.strokeColor&&((d=this.state.selectShape).strokeColor=t.value,this.setState({selectShape:d})),this.setState({isTextBackground:!this.state.isTextBackground});break;case"changeSwitchValue":"browser"==(e=t.type)?(this.setState({enableBrowser:t.value},(function(){t.value&&("url_bottom"===n.state.borderType?n.outerContainer.current.scrollTop=n.outerContainer.current.scrollHeight:n.outerContainer.current.scrollTop=0)})),t.value?this.updateBorderShow(this.state.borderType):this.resetStatus(e)):"padding"===e?(this.setState({enablePadding:t.value}),t.value||this.resetStatus(e),this.updateContainerTop(this.state.enableBrowser,t.value,this.state.paddingSize)):"watermask"===e?(this.setState({enableMask:t.value}),t.value||this.resetStatus(e)):"check_url"===e?this.setState({checkedUrl:t.value}):"check_time"===e?this.setState({checkedCaptureTime:t.value}):"padding_size"===e?(this.setState({paddingSize:t.value}),this.updateContainerTop(this.state.enableBrowser,this.state.enablePadding,t.value)):"mask_size"===e?(this.setState({maskSize:t.value}),this.editor.updateMaskScale(t.value/100)):"mask_opacity"===e&&(this.setState({maskOpacity:t.value}),this.editor.updateMaskOpacity(t.value/100));break;case"changeMaskPosition":this.setState({maskPosition:t.value});var l=t.value;this.editor.updateMaskPosition(l.value);break;case"changeColor":"padding_color"===i?this.setState({paddingColor:t.value}):(this.setState({currentColor:t.value}),r.setPenColor(t.value),localStorage["pen-color"]=t.value,i&&((s=qe[i])||(qe[i]=s={}),s.color=t.value,o=!0),this.state.selectShape&&this.state.selectShape.color&&((d=this.state.selectShape).color=t.value,this.setState({selectShape:d})));break;case"changeRecentColor":if("transparent"!==t.value){var c=this.state.recentColors;c.indexOf(t.value)<0?(c.unshift(t.value),c.pop()):(c.splice(c.indexOf(t.value),1),c.unshift(t.value)),localStorage.recent_clr=JSON.stringify(c),this.setState({recentColors:c})}break;case"changePenWidth":r.setPenWidth(parseInt(t.value)),i&&((s=qe[i])||(qe[i]=s={}),s.width=parseInt(t.value),o=!0),localStorage["pen-width"]=t.value;break;case"changeFontSize":r.setFontSize(parseInt(t.value)),i&&((s=qe[i]).width=parseInt(t.value),s.fontSize=parseInt(t.value),o=!0),localStorage["font-size"]=t.value;break;case"changeFontFamily":var d;r.setFontName(t.value),i&&((s=qe[i]).fontFamily=t.value,o=!0),this.state.selectShape&&this.state.selectShape.fontName&&((d=this.state.selectShape).fontName=t.value,this.setState({selectShape:d})),localStorage["font-family"]=t.value;break;case"zoom-in":if(2!==this.state.currentScale){var u=this.state.currentScale+.25;r.setScale(u),this.setState({currentScale:u,isShowScaleTip:!0}),this.rePositionBorder(u,this.state.borderType)}break;case"zoom-out":.25!==this.state.currentScale&&(u=this.state.currentScale-.25,r.setScale(u),this.setState({currentScale:u,isShowScaleTip:!0}),this.rePositionBorder(u,this.state.borderType));break;case"resetScale":r.setScale(1),this.setState({currentScale:1,isShowScaleTip:!1}),this.rePositionBorder(1,this.state.borderType);break;case"crop-demension-width":this.setState({cropWidth:parseInt(t.value)},(function(){r.setCropSize(this.state.cropWidth,this.state.cropHeight)}));break;case"crop-demension-height":this.setState({cropHeight:parseInt(t.value)},(function(){r.setCropSize(this.state.cropWidth,this.state.cropHeight)}));break;case"leaveCrop":this.setState({isInCropMode:!1,cropWidth:0,cropHeight:0}),r.finishCutImage(!1);break;case"doCrop":r.finishCutImage(!0),this.setState({isInCropMode:!1,cropWidth:0,cropHeight:0});break;case"insert-image":if(!this.props.permissions.allowAdvancedToolForImageEditor)return void this.setState({upgradeType:"insertImage",isShownUpgrade:!0});this.fileInput.current.click();break;case"doInsertImage":if(!this.props.permissions.allowAdvancedToolForImageEditor)return void this.setState({upgradeType:"image",isShownUpgrade:!0});if("web"===this.props.type)var h="/images/svg/"+t.value+".svg";else h="./images/svg/"+t.value+".svg";this.insertImage(h);break;case"doResize":r.setImageSize(this.state.resizeWidth,this.state.resizeHeight),this.updateContainerTop(this.state.enableBrowser,this.state.enablePadding,this.state.paddingSize);break;case"border":break;default:r[t.actionType]()}o&&(localStorage.draw_style=JSON.stringify(qe))}}},{key:"render",value:function(){var e=this.state,t=e.isShownUpgrade,n=e.isReady,r=e.borderType,i=e.checkedCaptureTime,a=e.checkedUrl,s=e.enableBrowser,o=e.borderAction,l=F()("editor",this.props.className),c=F()("loading-page",{active:!n});return(0,v.jsxs)("div",{className:l,tabIndex:"0",children:[(0,v.jsx)("div",{className:c,children:(0,v.jsxs)("div",{className:"center",children:[(0,v.jsx)("div",{className:"loading-spinner",children:(0,v.jsxs)("div",{className:"spinner",children:[(0,v.jsx)("div",{className:"rect1"}),(0,v.jsx)("div",{className:"rect2"}),(0,v.jsx)("div",{className:"rect3"}),(0,v.jsx)("div",{className:"rect4"}),(0,v.jsx)("div",{className:"rect5"})]})}),(0,v.jsxs)("div",{className:"brand",children:[(0,v.jsx)("div",{className:"logo"}),"AWESOME SCREENSHOT"]})]})}),(0,v.jsx)("input",{type:"file",className:"file-input",ref:this.fileInput,accept:".jpg,.jpeg,.png",onChange:this.handleFileInputChange}),(0,v.jsx)(Oe,Fe(Fe({},this.state),{},{handleToolBarBtnClick:this.handleToolBarBtnClick,handleResizeInputChange:this.handleResizeInputChange,handleResizeProportionChange:this.handleResizeProportionChange,handleResetList:this.handleResetList,getResizeInfo:this.getResizeInfo,finishEdit:this.finishEdit,handleTextBgChange:this.handleTextBgChange,handleBack:this.props.handleBack,type:this.props.type,quickReport:this.props.quickReport,isReported:this.props.isReported,menuType:this.props.menuType,drawStyle:qe,tabUrl:this.props.tabUrl,allowAdvancedTool:this.props.permissions.allowAdvancedToolForImageEditor})),(0,v.jsx)("div",{className:"editor-outer-container",tabIndex:"0",id:"editor-outer-container",ref:this.outerContainer,children:(0,v.jsxs)("div",{className:"border-container",style:{padding:(this.state.enablePadding?this.state.paddingSize:0)+"px",backgroundColor:this.state.enablePadding&&this.state.paddingSize>0?this.state.paddingColor:"transparent"},children:[(0,v.jsxs)("div",{className:s&&o&&("mac"===r||"windows"===r)?"header-container show":"header-container",ref:this.headerBorder,children:[(0,v.jsxs)("div",{className:"header-bar",ref:this.headerBar,children:[(0,v.jsx)("div",{className:"header-left "+r,ref:this.headerLeft}),(0,v.jsx)("div",{className:"header-center "+r,ref:this.headerCenter}),(0,v.jsx)("div",{className:"header-right "+r,ref:this.headerRight}),(0,v.jsx)("div",{className:"header-time "+(i?"show":""),ref:this.timeRef,children:this.state.captureTime})]}),(0,v.jsx)("canvas",{ref:this.urlFeld,style:{visibility:a?"visible":"hidden"}})]}),(0,v.jsx)("div",{className:"url-region",style:{display:s&&"url_top"==r?"block":"none"},ref:this.urlTopRef,children:(0,v.jsx)("canvas",{ref:this.urlTopContent})}),(0,v.jsxs)("div",{className:"editor-container",ref:this.container,children:[(0,v.jsx)("canvas",{className:"doodle-canvas",id:"canvas",ref:this.doodleCanvas}),(0,v.jsx)("canvas",{className:"layer-canvas",id:"canvas2",ref:this.layerCanvas}),(0,v.jsx)("div",{className:"editor-outer-textarea",ref:this.textareaOut,children:(0,v.jsx)("textarea",{className:"editor-textarea",ref:this.textarea})}),(0,v.jsxs)("div",{className:"editor-list-dialog",ref:this.listDialog,children:["Number:",(0,v.jsx)("input",{type:"number",className:"editor-input"})]})]}),(0,v.jsx)("div",{className:"url-region url_bottom",style:{display:s&&"url_bottom"==r?"block":"none"},ref:this.urlBottomRef,children:(0,v.jsx)("canvas",{ref:this.urlBottomContent})})]})}),(0,v.jsx)(Ze.Z,{visible:t,onCancel:this.handleCloseUpgrade,type:this.state.upgradeType})]})}}],n&&Le(t.prototype,n),r&&Le(t,r),o}(s.PureComponent);const Je=$e;n(72657);var Xe=n(81096),Qe=(n(89771),n(35635)),et=(n(45186),n(71577)),tt=n(91816),nt=n(63258),rt=n(88485),it=n(55035),at=n(24616),st=n(64302),ot=n(89366),lt=n(51816),ct=n(57254),dt=n(99165),ut="https://www.awesomescreenshot.com",ht="https://www.awesomescreenshot.com/api/v1",pt=["/premium/stripe/create_plan","/premium/stripe/change_plan","/folder/create","/folder/add_items","/folder/change_name","/trash/throw_into","/image/change_title","/video/update_title","/trash/restore","/trash/delete","/image/upload"],ft=g().create({baseURL:ht});function mt(){return(e=ut,t=["screenshot_personal_fullname","screenshot_personal_type","screenshot_personal_mail","screenshot_personal_premium_level"],new Promise((function(n,r){chrome.cookies.getAll({url:e},(function(e){if("string"==typeof t){var r=e.filter((function(e){return e.name===t}));n(r)}else if(Array.isArray(t)){var i=e.filter((function(e){return-1!==t.indexOf(e.name)}));n(i)}}))}))).then((function(e){if(e.length){var t={};return e.forEach((function(e){t[e.name]=e})),{username:decodeURI(t.screenshot_personal_fullname.value),type:t.screenshot_personal_type.value,mail:t.screenshot_personal_mail.value,premiumLevel:t.screenshot_personal_premium_level?t.screenshot_personal_premium_level.value:""}}return null}));var e,t}function gt(e){return ft({method:"GET",url:"/account/auth",params:{service:e,from:"extension"}})}function vt(e){return ft({method:"GET",url:"/account/load/resource",params:e})}function yt(e,t,n,r,i,a){return ft({method:"POST",url:"/destination/add",data:{accountID:e,resourceID:n,privacy:i,resourceName:r,resourceType:t,info:a}})}function bt(e){return ft({method:"GET",url:"/destination/image/upload_to_cloud_done",params:{Service:e}})}function xt(e){return ft({method:"POST",url:"/user/stuff",data:{type:e}})}ft.interceptors.request.use((function(e){return e}),(function(e){return a.ZP.error("Network error, Request timeout!"),Promise.reject()})),ft.interceptors.response.use((function(e){if(e&&e.data&&1===e.data.code)return Promise.resolve(e.data.data);if(e.data.code,e.data.msg){if(-1!==pt.indexOf(e.config.url))return Promise.reject(e.data.msg);if(a.ZP.error(e.data.msg),"/pricing"!==window.location.pathname)return Promise.reject(e.data.msg)}}),(function(e){if(e.response){var t=e.response.status;a.ZP.error("Network error! Error Code "+t)}return Promise.reject(e)}));var jt=n(59542),wt=(n(1378),n(99930)),St=(n(87687),n(27049)),kt=(n(84968),n(90071)),Ct=(n(53890),n(25779)),Nt=(n(91826),n(32074)),Tt=(n(61241),n(16317)),It=n(49101),Pt=n(59879);function Ot(e){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ot(e)}function Dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function At(e,t){return At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},At(e,t)}function Ut(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Zt(e);if(t){var i=Zt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Rt(this,n)}}function Rt(e,t){if(t&&("object"===Ot(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _t(e)}function _t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zt(e){return Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Zt(e)}Tt.Z.Option;var Et=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(s,e);var t,n,r,i=Ut(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=i.call(this,e)).state={isUploading:!1,isShownUpgrade:!1,percentage:0,isInCreate:!1,isCreateLoading:!1,premiumAlertType:"",isFolderCreated:!1,selectedFolder:"0-.-My Items"},t.handleUpload=t.handleUpload.bind(_t(t)),t.handleCreateProject=t.handleCreateProject.bind(_t(t)),t.enterCreate=t.enterCreate.bind(_t(t)),t.leaveCreate=t.leaveCreate.bind(_t(t)),t.onUploadProgress=t.onUploadProgress.bind(_t(t)),t.getCando=t.getCando.bind(_t(t)),t.handleCancelUpgrade=t.handleCancelUpgrade.bind(_t(t)),t.handleSelectFolder=t.handleSelectFolder.bind(_t(t)),t}return t=s,n=[{key:"componentDidMount",value:function(){}},{key:"handleUpload",value:function(e){var t=this,n=function(n){(function(e,t,n,r,i){var a=new FormData;return a.append("file",t),a.append("title",n),a.append("folderID",e),a.append("share",!0),a.append("actionType","ext"),a.append("version",r),a.append("client",/Edg/.test(navigator.userAgent)?"Edge extension":"chrome extension"),ft({method:"POST",url:"/image/upload",data:a,onUploadProgress:function(e){var t=Math.round(100*e.loaded/e.total);i(t)}})})(r,n,e.name,chrome.extension.getBackgroundPage().currentversion,t.onUploadProgress).then((function(e){var n;(n=e.image.shareURI,g()({method:"GET",url:"https://tinyurl.com/api-create.php?url="+n})).then((function(e){t.props.onUploadFinish({projectName:i,projectId:r,url:e.data})})).catch((function(){t.props.onUploadFinish({projectName:i,projectId:r,url:e.image.shareURI})}))})).catch((function(e){"Premium Plan Required!"===e&&t.setState({isShownUpgrade:!0,isUploading:!1,percentage:0,premiumAlertType:"uploadImage"})}))};try{(new ColorThief).getColor(this.props.img).join(",")}catch(e){}var r=this.state.selectedFolder.split("-.-")[0],i=this.state.selectedFolder.split("-.-")[1];this.setState({isUploading:!0});var a="image/png"===this.props.contentType?".png":".jpg";new File([this.props.imageBlob],e.name+a,{type:this.props.contentType}),this.props.imageBlob?n(this.props.imageBlob):A(this.props.imageUrl).then((function(e){n(e)}))}},{key:"handleCreateProject",value:function(e){var t=this;this.setState({isCreateLoading:!0}),function(e,t){return ft({method:"POST",url:"/folder/create",data:{name:e,parentID:t}})}(e.pName,"0").then((function(e){t.setState({isCreateLoading:!1,isInCreate:!1,selectedFolder:e.folder.folderID+"-.-"+e.folder.name}),t.props.onFolderCreated(e.folder)})).catch((function(e){a.ZP.error(e),t.setState({isCreateLoading:!1})}))}},{key:"getCando",value:function(e,t){return"project"===e?"free"!==this.props.currentPlan.PlanName||this.props.projects.length<1:"image"===e?"free"!==this.props.currentPlan.PlanName||this.props.projectsHash[t].ImgCount<30:void 0}},{key:"handleCancelUpgrade",value:function(){this.setState({isShownUpgrade:!1})}},{key:"enterCreate",value:function(){this.setState({isInCreate:!0})}},{key:"leaveCreate",value:function(){this.setState({isInCreate:!1})}},{key:"onUploadProgress",value:function(e){this.setState({percentage:e})}},{key:"handleSelectFolder",value:function(e){this.setState({selectedFolder:e})}},{key:"render",value:function(){var e=this,t=this.state,n=t.isUploading,r=t.percentage,i=t.isInCreate,a=t.isCreateLoading,s=t.premiumAlertType,o=t.isShownUpgrade,l=this.props,c=l.tabTitle,d=l.foldersTreeData;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"save-to-aws-panel",children:[(0,v.jsxs)("div",{className:"title",children:[(0,v.jsx)("div",{className:"logo",children:(0,v.jsx)("b",{})}),i?"Create a New Folder":"Awesome Screenshot"]}),(0,v.jsx)("div",{className:"box",children:n?(0,v.jsxs)("div",{className:"upload-progress",children:[(0,v.jsx)(Nt.Z,{type:"circle",percent:r}),(0,v.jsx)("div",{className:"upload-tip",children:r<100?"Uploading...":"Creating shareable link..."})]}):i?(0,v.jsxs)(kt.Z,{name:"createProject",onFinish:e.handleCreateProject,children:[(0,v.jsx)("div",{className:"label",children:"Folder name"}),(0,v.jsx)(kt.Z.Item,{name:"pName",rules:[{required:!0,message:"Please input a folder name!"}],children:(0,v.jsx)(Ct.Z,{size:"large"})}),(0,v.jsxs)(kt.Z.Item,{style:{textAlign:"right"},children:[(0,v.jsx)(et.Z,{size:"large",onClick:e.leaveCreate,style:{marginRight:8},children:"Cancel"}),(0,v.jsx)(et.Z,{size:"large",type:"primary",htmlType:"submit",loading:a,children:"Create"})]})]}):(0,v.jsxs)(kt.Z,{name:"uploadAwsForm",onFinish:e.handleUpload,children:[(0,v.jsx)("div",{className:"label",children:"Name"}),(0,v.jsx)(kt.Z.Item,{name:"name",rules:[{required:!0,message:"Please input a name!"}],initialValue:c,children:(0,v.jsx)(Ct.Z,{size:"large"})}),(0,v.jsx)("div",{className:"label",children:"Folder"}),(0,v.jsx)(wt.Z,{style:{width:"100%",marginBottom:"20px"},showSearch:!0,treeData:d,treeIcon:!0,loading:e.props.isfolderLoading,value:e.props.isfolderLoading?"":e.state.selectedFolder,onChange:e.handleSelectFolder,filterTreeNode:function(e,t){return-1!==t.title.indexOf(e)},dropdownRender:function(t){return(0,v.jsxs)("div",{children:[t,(0,v.jsx)(St.Z,{}),(0,v.jsxs)("div",{className:"select-action-btn",onClick:e.enterCreate,children:[(0,v.jsx)(It.Z,{}),"Create a New Folder"]}),(0,v.jsxs)("div",{className:"select-action-btn",onClick:e.props.onRefreshProjects,children:[(0,v.jsx)(Pt.Z,{}),"Refresh Folders"]})]})}}),(0,v.jsx)(kt.Z.Item,{children:(0,v.jsx)(et.Z,{size:"large",type:"primary",className:"save-btn",block:!0,htmlType:"submit",children:"Upload"})})]})})]}),(0,v.jsx)(Ze.Z,{visible:o,onCancel:this.handleCancelUpgrade,type:s})]})}}],n&&Dt(t.prototype,n),r&&Dt(t,r),s}(s.Component);const Bt=Et;function zt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zt(Object(n),!0).forEach((function(t){Mt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Lt=function(e){return(0,v.jsx)(r.Z,Ft(Ft({},e),{},{footer:null,maskClosable:!1,wrapClassName:"save-to-aws",destroyOnClose:!0,centered:!0,closeIcon:(0,v.jsx)(jt.Tw,{style:{fontSize:"12px"}}),children:(0,v.jsx)(Bt,Ft({},e))}))};var Ht=n(1168);function Wt(e){return new Promise((function(t,n){var r=null;C(e).then((function(n){n.forEach((function(n,i){var a=n.width,s=n.height;r?r.addPage([Math.ceil(a),Math.ceil(s)],a>s?"l":"p"):r=new Ht.ZP({orientation:a>s?"l":"p",unit:"pt",format:[Math.ceil(a),Math.ceil(s)],compress:!0});var o=document.createElement("canvas"),l=o.getContext("2d");o.width=a,o.height=s,l.drawImage(n.ele,0,0,a,s,0,0,a,s);var c=o.toDataURL("image/jpeg",1);r.addImage(c,"JPEG",0,0,Math.ceil(a),Math.ceil(s),"","FAST"),i===e.length-1&&t(r.output("bloburl"))}))}))}))}function Yt(e,t){return new Promise((function(t,n){var r=14400;C(e).then((function(e){var n=new Ht.ZP({orientation:e[0].width>e[0].height?"l":"p",unit:"pt",format:[Math.ceil(e[0].width),Math.ceil(r)],compress:!0}),i=r;e.forEach((function(e,t){for(var a=e.width,s=0,o=e.height;s<e.height;)if(i>0){var l=Math.min(o,i),c=document.createElement("canvas"),d=c.getContext("2d");c.width=a,c.height=l,d.drawImage(e.ele,0,s,a,l,0,0,a,l);var u=c.toDataURL("image/jpeg",1);n.addImage(u,"JPEG",0,r-i,Math.ceil(a),Math.ceil(l),"","FAST"),s+=l,o-=i,i-=l}else n.addPage({format:[a,r]}),i=r})),t(n.output("bloburl"))}))}))}var Gt=n(1646),Vt=n.n(Gt),qt=(n(75127),n(82530));function Kt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $t(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Jt=Tt.Z.Option,Xt=Tt.Z.OptGroup,Qt=qt.ZP.Group,en={};const tn=function(e){var t=e.currentAccount,n=Kt((0,s.useState)([]),2),r=n[0],i=n[1],a=Kt((0,s.useState)([]),2),o=a[0],l=a[1];(0,s.useEffect)((function(){Promise.all([vt({accountID:t.id,what:"channel"}),vt({accountID:t.id,what:"member"})]).then((function(e){var t=e[0].items.concat(e[1].items);i(t.filter((function(e){return e.added}))),l(t.filter((function(e){return!e.added}))),en={},t.forEach((function(e){en[e.id]=e}))}))}),[]);var c=De.slack;return(0,v.jsxs)(kt.Z,{onFinish:function(n){yt(t.id,en[n.channel].type,n.channel,en[n.channel].name,n.privacy,en[n.channel].info).then((function(t){e.handleDesCreated(t.destination)}))},children:[(0,v.jsx)("div",{className:"label",children:c.targetName}),(0,v.jsx)(kt.Z.Item,{name:"channel",rules:[{required:!0,message:"Please choose a channel or member"}],children:(0,v.jsxs)(Tt.Z,{size:"large",showSearch:!0,placeholder:c.placeHolder,loading:r.length+o.length===0,filterOption:function(e,t){if(t.name)return t.name.toLowerCase().indexOf(e.toLowerCase())>=0},children:[r.length&&(0,v.jsx)(Xt,{label:"Already Added",children:r.map((function(e){return(0,v.jsx)(Jt,{value:e.id,name:e.name,disabled:!0,children:Ae[e.type]+e.name},e.id)}))}),(0,v.jsx)(Xt,{label:"Available",children:o.map((function(e){return(0,v.jsx)(Jt,{value:e.id,name:e.name,children:Ae[e.type]+e.name},e.id)}))})]})}),(0,v.jsx)(kt.Z.Item,{className:"des-share-option",name:"privacy",initialValue:"private",children:(0,v.jsxs)(Qt,{children:[(0,v.jsx)(qt.ZP,{value:"private",children:"Private"}),(0,v.jsx)(qt.ZP,{value:"shared",children:"Shared"})]})}),(0,v.jsx)(et.Z,{type:"primary",className:"add-des-btn",size:"large",block:!0,htmlType:"submit",children:"Create Destination"})]})};function nn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var an=Tt.Z.Option,sn=Tt.Z.OptGroup,on=qt.ZP.Group,ln={};const cn=function(e){var t=e.currentAccount,n=nn((0,s.useState)([]),2),r=n[0],i=n[1],a=nn((0,s.useState)([]),2),o=a[0],l=a[1];(0,s.useEffect)((function(){vt({accountID:t.id,what:"board"}).then((function(e){var t=e.items;i(t.filter((function(e){return e.added}))),l(t.filter((function(e){return!e.added}))),ln={},t.forEach((function(e){ln[e.id]=e}))}))}),[]);var c=De.trello;return(0,v.jsxs)(kt.Z,{onFinish:function(n){yt(t.id,ln[n.channel].type,n.channel,ln[n.channel].name,n.privacy,ln[n.channel].info).then((function(t){e.handleDesCreated(t.destination)}))},children:[(0,v.jsx)("div",{className:"label",children:c.targetName}),(0,v.jsx)(kt.Z.Item,{name:"channel",rules:[{required:!0,message:"Please choose a board"}],children:(0,v.jsxs)(Tt.Z,{size:"large",showSearch:!0,placeholder:c.placeHolder,loading:r.length+o.length===0,filterOption:function(e,t){if(t.name)return t.name.toLowerCase().indexOf(e.toLowerCase())>=0},children:[r.length&&(0,v.jsx)(sn,{label:"Already Added",children:r.map((function(e){return(0,v.jsx)(an,{value:e.id,name:e.name,disabled:!0,children:Ae[e.type]+e.name},e.id)}))}),(0,v.jsx)(sn,{label:"Available",children:o.map((function(e){return(0,v.jsx)(an,{value:e.id,name:e.name,children:Ae[e.type]+e.name},e.id)}))})]})}),(0,v.jsx)(kt.Z.Item,{className:"des-share-option",name:"privacy",initialValue:"private",children:(0,v.jsxs)(on,{children:[(0,v.jsx)(qt.ZP,{value:"private",children:"Private"}),(0,v.jsx)(qt.ZP,{value:"shared",children:"Shared"})]})}),(0,v.jsx)(et.Z,{type:"primary",className:"add-des-btn",size:"large",block:!0,htmlType:"submit",children:"Create Destination"})]})};function dn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return un(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return un(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function un(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var hn=Tt.Z.Option,pn=Tt.Z.OptGroup,fn=qt.ZP.Group,mn={},gn={};const vn=function(e){var t=e.currentAccount,n=dn((0,s.useState)([]),2),r=n[0],i=n[1],a=dn((0,s.useState)([]),2),o=a[0],l=a[1],c=dn((0,s.useState)([]),2),d=c[0],u=c[1];(0,s.useEffect)((function(){vt({accountID:t.id,what:"workspace"}).then((function(e){var t=e.items;i(t),p(t[0].id),gn={},t.forEach((function(e){gn[e.id]=e}))}))}),[]);var h=De.asana;function p(e){l([]),u([]),vt({accountID:t.id,what:"project",workspaceID:e}).then((function(e){var t=e.items;l(t.filter((function(e){return e.added}))),u(t.filter((function(e){return!e.added}))),mn={},t.forEach((function(e){mn[e.id]=e}))}))}return(0,v.jsxs)(kt.Z,{onFinish:function(n){yt(t.id,"project",n.project,mn[n.project].name,n.privacy,mn[n.project].info).then((function(t){e.handleDesCreated(t.destination)}))},children:[(0,v.jsx)("div",{className:"label",children:h.targetName1}),(0,v.jsx)(kt.Z.Item,{name:"workspace",rules:[{required:!0,message:"Please choose a workspace"}],children:(0,v.jsx)(Tt.Z,{size:"large",placeholder:h.placeHolder1,loading:0===r.length,onChange:function(e){p(e)},children:r.map((function(e){return(0,v.jsx)(hn,{value:e.id,children:e.name},e.id)}))})}),(0,v.jsx)("div",{className:"label",children:h.targetName2}),(0,v.jsx)(kt.Z.Item,{name:"project",rules:[{required:!0,message:"Please choose a project"}],children:(0,v.jsxs)(Tt.Z,{size:"large",showSearch:!0,placeholder:h.placeHolder2,loading:o.length+d.length===0,filterOption:function(e,t){if(t.name)return t.name.toLowerCase().indexOf(e.toLowerCase())>=0},children:[o.length&&(0,v.jsx)(pn,{label:"Already Added",children:o.map((function(e){return(0,v.jsx)(hn,{value:e.id,name:e.name,disabled:!0,children:Ae[e.type]+e.name},e.id)}))}),(0,v.jsx)(pn,{label:"Available",children:d.map((function(e){return(0,v.jsx)(hn,{value:e.id,name:e.name,children:Ae[e.type]+e.name},e.id)}))})]})}),(0,v.jsx)(kt.Z.Item,{className:"des-share-option",name:"privacy",initialValue:"private",children:(0,v.jsxs)(fn,{children:[(0,v.jsx)(qt.ZP,{value:"private",children:"Private"}),(0,v.jsx)(qt.ZP,{value:"shared",children:"Shared"})]})}),(0,v.jsx)(et.Z,{type:"primary",className:"add-des-btn",size:"large",block:!0,htmlType:"submit",children:"Create Destination"})]})};function yn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var xn=Tt.Z.Option,jn=Tt.Z.OptGroup,wn=qt.ZP.Group,Sn={};const kn=function(e){var t=e.currentAccount,n=yn((0,s.useState)([]),2),r=n[0],i=n[1],a=yn((0,s.useState)([]),2),o=a[0],l=a[1],c=function(e){vt({accountID:t.id,what:"folder",query:e}).then((function(e){var t=e.items;i(t.filter((function(e){return e.added}))),l(t.filter((function(e){return!e.added}))),Sn={},t.forEach((function(e){Sn[e.id]=e}))}))};(0,s.useEffect)((function(){c()}),[]);var d=De.googleDrive;return(0,v.jsxs)(kt.Z,{onFinish:function(n){yt(t.id,Sn[n.folder].type,n.folder,Sn[n.folder].name,n.privacy,Sn[n.folder].info).then((function(t){e.handleDesCreated(t.destination)}))},children:[(0,v.jsx)("div",{className:"label",children:d.targetName}),(0,v.jsxs)(kt.Z.Item,{name:"folder",rules:[{required:!0,message:"choose a folder"}],children:[(0,v.jsxs)(Tt.Z,{size:"large",showSearch:!0,placeholder:d.placeHolder,loading:r.length+o.length===0,onSearch:function(e){c(e)},filterOption:!1,children:[r.length&&(0,v.jsx)(jn,{label:"Already Added",children:r.map((function(e){return(0,v.jsx)(xn,{value:e.id,disabled:!0,children:Ae[e.type]+e.name},e.id)}))}),(0,v.jsx)(jn,{label:"Available",children:o.map((function(e){return(0,v.jsx)(xn,{value:e.id,children:Ae[e.type]+e.name},e.id)}))})]}),(0,v.jsx)("div",{className:"tip",children:"Only 10 recent folders are listed. Type and search for other folders."})]}),(0,v.jsx)(kt.Z.Item,{className:"des-share-option",name:"privacy",initialValue:"private",children:(0,v.jsxs)(wn,{children:[(0,v.jsx)(qt.ZP,{value:"private",children:"Private"}),(0,v.jsx)(qt.ZP,{value:"shared",children:"Shared"})]})}),(0,v.jsx)(et.Z,{type:"primary",className:"add-des-btn",size:"large",block:!0,htmlType:"submit",children:"Create Destination"})]})};function Cn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Nn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Tn=Tt.Z.Option,In=Tt.Z.OptGroup,Pn=qt.ZP.Group,On={};const Dn=function(e){var t=e.currentAccount,n=Cn((0,s.useState)([]),2),r=n[0],i=n[1],a=Cn((0,s.useState)([]),2),o=a[0],l=a[1];(0,s.useEffect)((function(){vt({accountID:t.id,what:"repo"}).then((function(e){var t=e.items;i(t.filter((function(e){return e.added}))),l(t.filter((function(e){return!e.added}))),On={},t.forEach((function(e){On[e.id]=e}))}))}),[]);var c=De.github;return(0,v.jsxs)(kt.Z,{onFinish:function(n){yt(t.id,On[n.repo].type,n.repo,On[n.repo].name,n.privacy,On[n.repo].info).then((function(t){e.handleDesCreated(t.destination)}))},children:[(0,v.jsx)("div",{className:"label",children:c.targetName}),(0,v.jsx)(kt.Z.Item,{name:"repo",rules:[{required:!0,message:"Please choose a channel or member"}],children:(0,v.jsxs)(Tt.Z,{size:"large",placeholder:c.placeHolder,loading:r.length+o.length===0,showSearch:!0,onSearch:function(e){},filterOption:function(e,t){if(t.name)return t.name.toLowerCase().indexOf(e.toLowerCase())>=0},children:[r.length&&(0,v.jsx)(In,{label:"Already Added",children:r.map((function(e){return(0,v.jsx)(Tn,{value:e.id,name:e.info.owner+e.name,disabled:!0,children:Ae[e.type]+e.info.owner+"/"+e.name},e.id)}))}),(0,v.jsx)(In,{label:"Available",children:o.map((function(e){return(0,v.jsx)(Tn,{value:e.id,name:e.info.owner+e.name,children:Ae[e.type]+e.info.owner+"/"+e.name},e.id)}))})]})}),(0,v.jsx)(kt.Z.Item,{className:"des-share-option",name:"privacy",initialValue:"private",children:(0,v.jsxs)(Pn,{children:[(0,v.jsx)(qt.ZP,{value:"private",children:"Private"}),(0,v.jsx)(qt.ZP,{value:"shared",children:"Shared"})]})}),(0,v.jsx)(et.Z,{type:"primary",className:"add-des-btn",size:"large",block:!0,htmlType:"submit",children:"Create Destination"})]})};function An(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Un(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Un(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Un(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Rn=Tt.Z.Option,_n=Tt.Z.OptGroup,Zn=qt.ZP.Group,En={},Bn={};const zn=function(e){var t=e.currentAccount,n=An((0,s.useState)([]),2),r=n[0],i=n[1],a=An((0,s.useState)([]),2),o=a[0],l=a[1],c=An((0,s.useState)([]),2),d=c[0],u=c[1];(0,s.useEffect)((function(){vt({accountID:t.id,what:"cloud"}).then((function(e){var t=e.items;i(t),p(t[0].id,t[0].name),Bn={},t.forEach((function(e){Bn[e.id]=e}))}))}),[]);var h=De.jira;function p(e,n){l([]),u([]),vt({accountID:t.id,what:"project",cloudID:e,cloudName:n}).then((function(e){var t=e.items;l(t.filter((function(e){return e.added}))),u(t.filter((function(e){return!e.added}))),En={},t.forEach((function(e){En[e.id]=e}))}))}return(0,v.jsxs)(kt.Z,{onFinish:function(n){yt(t.id,"project",n.project,En[n.project].name,n.privacy,En[n.project].info).then((function(t){e.handleDesCreated(t.destination)}))},children:[(0,v.jsx)("div",{className:"label",children:h.targetName1}),(0,v.jsx)(kt.Z.Item,{name:"site",rules:[{required:!0,message:"Please choose a site"}],children:(0,v.jsx)(Tt.Z,{size:"large",placeholder:h.placeHolder1,loading:0===r.length,onChange:function(e){p(e,Bn[e].name)},children:r.map((function(e){return(0,v.jsx)(Rn,{value:e.id,children:e.name},e.id)}))})}),(0,v.jsx)("div",{className:"label",children:h.targetName2}),(0,v.jsx)(kt.Z.Item,{name:"project",rules:[{required:!0,message:"Please choose a project"}],children:(0,v.jsxs)(Tt.Z,{size:"large",showSearch:!0,placeholder:h.placeHolder2,loading:o.length+d.length===0,filterOption:function(e,t){if(t.name)return t.name.toLowerCase().indexOf(e.toLowerCase())>=0},children:[o.length&&(0,v.jsx)(_n,{label:"Already Added",children:o.map((function(e){return(0,v.jsx)(Rn,{value:e.id,name:e.name,disabled:!0,children:Ae[e.type]+e.name},e.id)}))}),(0,v.jsx)(_n,{label:"Available",children:d.map((function(e){return(0,v.jsx)(Rn,{value:e.id,name:e.name,children:Ae[e.type]+e.name},e.id)}))})]})}),(0,v.jsx)(kt.Z.Item,{className:"des-share-option",name:"privacy",initialValue:"private",children:(0,v.jsxs)(Zn,{children:[(0,v.jsx)(qt.ZP,{value:"private",children:"Private"}),(0,v.jsx)(qt.ZP,{value:"shared",children:"Shared"})]})}),(0,v.jsx)(et.Z,{type:"primary",className:"add-des-btn",size:"large",block:!0,htmlType:"submit",children:"Create Destination"})]})};function Fn(e){return Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fn(e)}function Mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ln(e,t){return Ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ln(e,t)}function Hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Wn(this,n)}}function Wn(e,t){if(t&&("object"===Fn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Yn(e)}function Yn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gn(e){return Gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Gn(e)}var Vn={},qn=Tt.Z.Option;Tt.Z.OptGroup;f().extend(Vt());var Kn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ln(e,t)}(a,e);var t,n,r,i=Hn(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={isInAuthMode:!1,isLoadList:!1,currentResources:[],createAccount:"",createPrivacy:"private",createResource:null,isCreating:!1,currentAccount:e.currentAccount||(e.accounts?e.accounts[0]:null)||null,isShownUpgrade:!1},t.chooseDes=t.chooseDes.bind(Yn(t)),t.back=t.back.bind(Yn(t)),t.handleAccountChange=t.handleAccountChange.bind(Yn(t)),t.handleConnect=t.handleConnect.bind(Yn(t)),t.handlePrivacyChange=t.handlePrivacyChange.bind(Yn(t)),t.handleResourceChange=t.handleResourceChange.bind(Yn(t)),t.updateCurrentResources=t.updateCurrentResources.bind(Yn(t)),t.handleMessage=t.handleMessage.bind(Yn(t)),t.onAccountConnected=t.onAccountConnected.bind(Yn(t)),t.handleUpgradeCancel=t.handleUpgradeCancel.bind(Yn(t)),t.getPermissionByName=t.getPermissionByName.bind(Yn(t)),t.getFreeTrialTip=t.getFreeTrialTip.bind(Yn(t)),t.getIsShowPro=t.getIsShowPro.bind(Yn(t)),t}return t=a,(n=[{key:"componentDidMount",value:function(){window.addEventListener("message",this.handleMessage)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.handleMessage)}},{key:"handleMessage",value:function(e){if("accountConnected"===e.data.name){var t=JSON.parse(e.data.data);this.setState({isInAuthMode:!1}),this.onAccountConnected(t)}}},{key:"handleUpgradeCancel",value:function(){this.setState({isShownUpgrade:!1})}},{key:"onAccountConnected",value:function(e){this.props.handleAccountConnected(e),this.setState({currentAccount:e})}},{key:"chooseDes",value:function(e){this.getPermissionByName(e)?this.setState({isInAuthMode:!0,createAccount:e}):this.setState({isShownUpgrade:!0})}},{key:"getPermissionByName",value:function(e){return"googleDrive"===e?this.props.permissions["allow".concat(w(e))]:this.props.permissions["allow".concat(w(e))]||"free"!==this.props.currentPlan.PlanName}},{key:"getFreeTrialTip",value:function(){var e=this.props.permissions;if(e.trailConnectedAccountExpireTimeSecond>0){if(e.trailConnectedAccountExpireTimeSecond>Date.now()/1e3){var t=1e3*e.trailConnectedAccountExpireTimeSecond-Date.now(),n=f().duration(t,"milliseconds").asDays();if(n<1)var r="less than a day";else r=Math.ceil(n)+" days";return(0,v.jsxs)(v.Fragment,{children:["Free trial for pro services ends in ",r,".",(0,v.jsxs)("a",{target:"_blank",href:"https://www.awesomescreenshot.com/pricing",children:[" ","Upgrade now"]})]})}return(0,v.jsxs)(v.Fragment,{children:["The 7-days free trial was expired.",(0,v.jsxs)("a",{target:"_blank",href:"https://www.awesomescreenshot.com/pricing",children:[" ","Upgrade now"]})]})}return-1===e.trailConnectedAccountExpireTimeSecond?"":0===e.trailConnectedAccountExpireTimeSecond?"7-days free trial for pro services":void 0}},{key:"handleConnect",value:function(){gt(this.state.createAccount).then((function(e){var t="width=800,height=700,top="+(window.screen.availHeight-30-700)/2+",left="+(window.screen.availWidth-10-800)/2;window.open(e.URI,"",t)}))}},{key:"handlePrivacyChange",value:function(e){this.setState({createPrivacy:e.target.value})}},{key:"handleResourceChange",value:function(e){this.setState({createResource:e})}},{key:"updateCurrentResources",value:function(e){Vn={},e.forEach((function(e){Vn[e.id]=e})),this.setState({currentResources:e,isLoadList:!1})}},{key:"handleAccountChange",value:function(e){this.setState({currentAccount:"add"===e?null:this.props.accountHash[e]})}},{key:"getIsShowPro",value:function(){return"free"===this.props.currentPlan.PlanName||"basic"===this.props.currentPlan.PlanName}},{key:"back",value:function(){this.setState({isInAuthMode:!1})}},{key:"render",value:function(){var e=this,t=this.props.accounts,n=this.state,r=n.currentResources,i=(n.isLoadList,n.createResource,n.createPrivacy,n.createAccount),a=(n.isCreating,n.currentAccount),s=n.isShownUpgrade;return r.filter((function(e){return e.added})),r.filter((function(e){return!e.added})),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"add-des-panel",children:this.state.isInAuthMode?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"top",children:(0,v.jsxs)("div",{className:"back-btn",onClick:this.back,children:[(0,v.jsx)(pe.Z,{}),"Choose another integration"]})}),(0,v.jsx)("div",{className:"connect-panel",children:(0,v.jsxs)("div",{className:"box",children:[(0,v.jsxs)("div",{className:"main-box",children:[(0,v.jsx)("div",{className:"pic",children:(0,v.jsx)("div",{className:"logo ".concat(i)})}),(0,v.jsxs)("div",{className:"content",children:[(0,v.jsx)("div",{className:"logo ".concat(i)}),(0,v.jsxs)("div",{className:"title",children:["Integrate ",De[i].displayName]}),(0,v.jsx)("div",{className:"sub-title",children:De[i].panelSubTitle}),(0,v.jsx)("ul",{children:De[i].featureLists.map((function(e,t){return(0,v.jsx)("li",{children:e},t)}))})]})]}),(0,v.jsxs)(et.Z,{type:"primary",size:"large",onClick:this.handleConnect,children:["Connect with ",De[i].displayName]})]})})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"title",children:a?"Create a new destination":"Connect a new account"}),(t&&t.length)>0&&(0,v.jsxs)("div",{className:"account-select",children:[(0,v.jsx)("div",{className:"label",children:"Connected account"}),(0,v.jsxs)(Tt.Z,{size:"large",value:a?a.id:"add",onChange:this.handleAccountChange,children:[t.map((function(e){var t=F()("account-logo",e.service);return(0,v.jsxs)(qn,{value:e.id,children:[(0,v.jsx)("div",{className:t}),De[e.service].displayName," (",e.userInfo.name,")"]},e.id)})),(0,v.jsxs)(qn,{value:"add",children:[(0,v.jsx)("div",{className:"account-logo add"}),"Connect to a new account"]})]})]}),function(){if(a)return(0,v.jsx)("div",{className:"des-select",children:(0,v.jsx)("div",{className:"account-des-select",children:"slack"===a.service?(0,v.jsx)(tn,{currentAccount:a,handleDesCreated:e.props.handleDesCreated}):"trello"===a.service?(0,v.jsx)(cn,{currentAccount:a,handleDesCreated:e.props.handleDesCreated}):"asana"===a.service?(0,v.jsx)(vn,{currentAccount:a,handleDesCreated:e.props.handleDesCreated}):"googleDrive"===a.service?(0,v.jsx)(kn,{currentAccount:a,handleDesCreated:e.props.handleDesCreated}):"github"===a.service?(0,v.jsx)(Dn,{currentAccount:a,handleDesCreated:e.props.handleDesCreated}):"jira"===a.service?(0,v.jsx)(zn,{currentAccount:a,handleDesCreated:e.props.handleDesCreated}):void 0})});var t="saveElsewhere"===e.props.servicesType?Re:Ue;return(0,v.jsxs)("div",{className:"service-container",children:["saveElsewhere"!==e.props.servicesType&&(0,v.jsx)("div",{className:"trial-tip",children:e.getFreeTrialTip()}),(0,v.jsx)("div",{className:"label",children:"Services"}),(0,v.jsx)("div",{className:"account-container",children:t.map((function(t){var n=F()("account-item",t.name,{pro:e.getIsShowPro()});return(0,v.jsx)("div",{className:n,"data-des":t.name,onClick:e.chooseDes.bind(null,t.name),children:(0,v.jsx)("b",{})},t.name)}))})]})}()]})}),(0,v.jsx)(Ze.Z,{visible:s,onCancel:this.handleUpgradeCancel,type:"destination"})]})}}])&&Mn(t.prototype,n),r&&Mn(t,r),a}(s.Component);const $n=Kn;var Jn=n(7085);const Xn=function(e){return(0,v.jsx)("div",{className:"slack-form",children:(0,v.jsxs)(kt.Z,{onFinish:function(t){e.handleSend(t)},children:[(0,v.jsx)("div",{className:"label",children:"Message"}),(0,v.jsx)(kt.Z.Item,{name:"description",children:(0,v.jsx)(Ct.Z.TextArea,{size:"large",autoSize:{minRows:4},onChange:e.handleSlackMsgChange})}),(0,v.jsx)(kt.Z.Item,{children:(0,v.jsx)(et.Z,{className:"send-btn",size:"large",type:"primary",block:!0,htmlType:"submit",children:"Send message"})})]})})};n(29053);var Qn=n(68351),er=(n(22261),n(94168)),tr=n(58491);function nr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ir=Tt.Z.Option;const ar=function(e){var t=nr((0,s.useState)(!1),2),n=t[0],r=t[1],i=nr((0,s.useState)([]),2),a=i[0],o=i[1],l=nr((0,s.useState)([]),2),c=l[0],d=l[1],u=nr((0,s.useState)([]),2),h=u[0],p=u[1],m=e.resourceID,g=e.currentDes;return(0,s.useEffect)((function(){vt({accountID:g.accountID,what:"list",boardID:m}).then((function(e){o(e.items)})),vt({accountID:g.accountID,what:"member",boardID:m}).then((function(e){d(e.items)})),vt({accountID:g.accountID,what:"label",boardID:m}).then((function(e){p(e.items)}))}),[m]),(0,v.jsx)("div",{className:"trello-form",children:(0,v.jsxs)(kt.Z,{onFinish:function(t){var n={};t.description&&(n.description=void 0===t.description?"":t.description),n.listID=t.list,t.title&&(n.title=t.title),t.members&&(n.membersID=t.members.join(",")),t.labels&&(n.labelsID=t.labels.join(",")),t.dueDate&&!t.dueTime?n.date=t.dueDate.format("YYYY-MM-DD"):t.dueDate&&t.dueTime&&(n.datetime=f().utc(t.dueDate.format("YYYY-MM-DD")+"T"+t.dueTime.format().replace(/(.*)T/,""))),e.handleSend(n)},children:[(0,v.jsx)("div",{className:"label",children:"List"}),(0,v.jsx)(kt.Z.Item,{name:"list",rules:[{required:!0,message:"Please choose a list"}],initialValue:a.length?a[0].id:void 0,children:(0,v.jsx)(Tt.Z,{size:"large",placeholder:"Please choose a list",showSearch:!0,filterOption:function(e,t){return t.name.toLowerCase().indexOf(e.toLowerCase())>=0},children:a.map((function(e){return(0,v.jsx)(ir,{value:e.id,name:e.name,children:e.name},e.id)}))})}),(0,v.jsx)("div",{className:"label",children:"Card title"}),(0,v.jsx)(kt.Z.Item,{name:"title",initialValue:e.tabTitle,children:(0,v.jsx)(Ct.Z,{size:"large",autoComplete:"off"})}),n&&(0,v.jsxs)("div",{className:"ad-fields",children:[(0,v.jsx)("div",{className:"label",children:"Description"}),(0,v.jsx)(kt.Z.Item,{name:"description",children:(0,v.jsx)(Ct.Z.TextArea,{size:"large",autoSize:{minRows:3}})}),(0,v.jsx)("div",{className:"label",children:"Members"}),(0,v.jsx)(kt.Z.Item,{name:"members",children:(0,v.jsx)(Tt.Z,{size:"large",mode:"multiple",style:{width:"100%"},placeholder:"Select members",showSearch:!0,filterOption:function(e,t){return t.name.toLowerCase().indexOf(e.toLowerCase())>=0},children:c.map((function(e){return(0,v.jsx)(ir,{value:e.id,name:e.name,children:e.name},e.id)}))})}),(0,v.jsx)("div",{className:"label",children:"Labels"}),(0,v.jsx)(kt.Z.Item,{name:"labels",children:(0,v.jsx)(Tt.Z,{size:"large",mode:"multiple",style:{width:"100%"},placeholder:"Select a label",className:"label-select trello-member-select",showSearch:!0,filterOption:function(e,t){return t.name.toLowerCase().indexOf(e.toLowerCase())>=0},dropdownClassName:"trello-label-dropdown",children:h.map((function(e){return(0,v.jsx)(ir,{value:e.id,name:e.name,children:(0,v.jsx)("div",{className:"trello-label-item "+e.info.color,children:e.name})},e.id)}))})}),(0,v.jsxs)("div",{className:"half-form",children:[(0,v.jsxs)("div",{className:"half",children:[(0,v.jsx)("div",{className:"label",children:"Due Date"}),(0,v.jsx)(kt.Z.Item,{name:"dueDate",children:(0,v.jsx)(er.Z,{size:"large"})})]}),(0,v.jsxs)("div",{className:"half",children:[(0,v.jsx)("div",{className:"label",children:"Due Time"}),(0,v.jsx)(kt.Z.Item,{name:"dueTime",children:(0,v.jsx)(Qn.Z,{size:"large",use12Hours:!0,format:"h:mm A",className:"due-time-picker"})})]})]})]}),(0,v.jsx)("div",{className:"toggle-field",children:(0,v.jsx)("a",{className:"toggle-fields-btn",onClick:function(){r(!n)},children:n?(0,v.jsxs)(v.Fragment,{children:["Collapse all fields ",(0,v.jsx)(tr.Z,{})]}):(0,v.jsxs)(v.Fragment,{children:["Show all fields ",(0,v.jsx)(ct.Z,{})]})})}),(0,v.jsx)("div",{children:(0,v.jsx)(et.Z,{className:"send-btn",size:"large",type:"primary",block:!0,htmlType:"submit",children:"Create card"})})]})})};function sr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return or(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return or(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function or(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var lr=Tt.Z.Option;const cr=function(e){var t=sr((0,s.useState)(!1),2),n=t[0],r=t[1],i=sr((0,s.useState)([]),2),a=i[0],o=i[1],l=sr((0,s.useState)([]),2),c=l[0],d=l[1],u=sr((0,s.useState)([]),2),h=u[0],p=u[1],m=e.currentDes,g=m.info.workspaceID,y=m.resourceID;return(0,s.useEffect)((function(){vt({accountID:m.accountID,what:"section",projectID:y}).then((function(e){o(e.items)})),vt({accountID:m.accountID,what:"member",projectID:y}).then((function(e){d(e.items)})),vt({accountID:m.accountID,what:"tag",workspaceID:g}).then((function(e){p(e.items)}))}),[y]),(0,v.jsx)("div",{className:"trello-form",children:(0,v.jsxs)(kt.Z,{onFinish:function(t){var n={};t.description&&(n.description=t.description),t.section&&"-1"!==t.section&&(n.sectionID=t.section),t.title&&(n.title=t.title),t.tags&&(n.tagsID=t.tags.join(",")),t.assignee&&(n.assigneeID=t.assignee),t.dueDate&&!t.dueTime?n.date=t.dueDate.format("YYYY-MM-DD"):t.dueDate&&t.dueTime&&(n.datetime=f().utc(t.dueDate.format("YYYY-MM-DD")+"T"+t.dueTime.format().replace(/(.*)T/,""))),e.handleSend(n)},children:[(0,v.jsx)("div",{className:"label",children:"list"===m.info.layout?"Section":"Column"}),(0,v.jsx)(kt.Z.Item,{name:"section",initialValue:"list"!==m.info.layout?a.length?a[0].id:null:"-1",children:(0,v.jsxs)(Tt.Z,{size:"large",children:["list"===m.info.layout&&(0,v.jsx)(lr,{value:"-1",children:"No section"}),a.map((function(e){return(0,v.jsx)(lr,{value:e.id,children:e.name},e.id)}))]})}),(0,v.jsx)("div",{className:"label",children:"Task name"}),(0,v.jsx)(kt.Z.Item,{name:"title",initialValue:e.tabTitle,children:(0,v.jsx)(Ct.Z,{size:"large",autoComplete:"false"})}),n&&(0,v.jsxs)("div",{className:"ad-fields",children:[(0,v.jsx)("div",{className:"label",children:"Description"}),(0,v.jsx)(kt.Z.Item,{name:"description",children:(0,v.jsx)(Ct.Z.TextArea,{size:"large",autoSize:{minRows:3}})}),(0,v.jsx)("div",{className:"label",children:"Assignee"}),(0,v.jsx)(kt.Z.Item,{name:"assignee",children:(0,v.jsx)(Tt.Z,{size:"large",style:{width:"100%"},placeholder:"Please select assignee",children:c.map((function(e){return(0,v.jsx)(lr,{value:e.id,children:e.name},e.id)}))})}),(0,v.jsx)("div",{className:"label",children:"Tags"}),(0,v.jsx)(kt.Z.Item,{name:"tags",children:(0,v.jsx)(Tt.Z,{size:"large",mode:"multiple",style:{width:"100%"},placeholder:"Please select",children:h.map((function(e){return(0,v.jsx)(lr,{value:e.id,children:e.name},e.id)}))})}),(0,v.jsxs)("div",{className:"half-form",children:[(0,v.jsxs)("div",{className:"half",children:[(0,v.jsx)("div",{className:"label",children:"Due Date"}),(0,v.jsx)(kt.Z.Item,{name:"dueDate",children:(0,v.jsx)(er.Z,{size:"large"})})]}),(0,v.jsxs)("div",{className:"half",children:[(0,v.jsx)("div",{className:"label",children:"Due Time"}),(0,v.jsx)(kt.Z.Item,{name:"dueTime",children:(0,v.jsx)(Qn.Z,{size:"large",use12Hours:!0,format:"h:mm A",className:"due-time-picker"})})]})]})]}),(0,v.jsx)("div",{className:"toggle-field",children:(0,v.jsx)("a",{className:"toggle-fields-btn",onClick:function(){r(!n)},children:n?(0,v.jsxs)(v.Fragment,{children:["Collapse all fields ",(0,v.jsx)(tr.Z,{})]}):(0,v.jsxs)(v.Fragment,{children:["Show all fields ",(0,v.jsx)(ct.Z,{})]})})}),(0,v.jsx)("div",{children:(0,v.jsx)(et.Z,{className:"send-btn",size:"large",type:"primary",block:!0,htmlType:"submit",children:"Create task"})})]})})};const dr=function(e){var t=e.tabTitle;return(0,v.jsx)("div",{className:"slack-form",children:(0,v.jsxs)(kt.Z,{onFinish:function(t){e.handleSend(values)},children:[(0,v.jsx)("div",{className:"label",children:"Name"}),(0,v.jsx)(kt.Z.Item,{name:"title",initialValue:t,children:(0,v.jsx)(Ct.Z,{onChange:e.handleSlackMsgChange})}),(0,v.jsx)("div",{children:(0,v.jsx)(et.Z,{className:"send-btn",size:"large",type:"primary",block:!0,htmlType:"submit",children:"Upload image"})})]})})};function ur(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var fr=Tt.Z.Option;const mr=function(e){var t,n=hr((0,s.useState)(!1),2),r=n[0],i=n[1],a=hr((0,s.useState)([]),2),o=a[0],l=a[1],c=hr((0,s.useState)([]),2),d=c[0],u=c[1],h=e.resourceID,p=e.currentDes;return(0,s.useEffect)((function(){vt({accountID:p.accountID,what:"assignee",repo:p.resourceName,owner:p.info.owner}).then((function(e){l(e.items)})),vt({accountID:p.accountID,what:"label",repo:p.resourceName,owner:p.info.owner}).then((function(e){u(e.items)}))}),[h]),(0,v.jsx)("div",{className:"github-form",children:(0,v.jsxs)(kt.Z,{onFinish:function(t){var n={};t.description&&(n.description=void 0===t.description?"":t.description),n.listID=t.list,t.title&&(n.title=t.title),t.assignees&&(n.assignees=t.assignees.join(",")),t.labels&&(n.labels=t.labels.join(",")),e.handleSend(n)},children:[(0,v.jsx)("div",{className:"label",children:"Issue title"}),(0,v.jsx)(kt.Z.Item,{name:"title",initialValue:e.tabTitle,children:(0,v.jsx)(Ct.Z,{size:"large",autoComplete:"off"})}),r&&(0,v.jsxs)("div",{className:"ad-fields",children:[(0,v.jsx)("div",{className:"label",children:"Description"}),(0,v.jsx)(kt.Z.Item,{name:"description",children:(0,v.jsx)(Ct.Z.TextArea,{size:"large",autoSize:{minRows:3}})}),(0,v.jsx)("div",{className:"label",children:"Assignee"}),(0,v.jsx)(kt.Z.Item,{name:"assignees",children:(0,v.jsx)(Tt.Z,{size:"large",mode:"multiple",style:{width:"100%"},placeholder:"Assign a member",children:o.map((function(e){return(0,v.jsx)(fr,{value:e.name,children:e.name},e.id)}))})}),(0,v.jsx)("div",{className:"label",children:"Labels"}),(0,v.jsx)(kt.Z.Item,{name:"labels",children:(0,v.jsx)(Tt.Z,(t={size:"large",mode:"multiple",style:{width:"100%"},placeholder:"Select a label",className:"label-select"},ur(t,"className","trello-member-select"),ur(t,"dropdownClassName","trello-label-dropdown"),ur(t,"children",d.map((function(e){var t={backgroundColor:"#"+e.info.color};return"ffffff"===e.info.color&&(t.color="black",t.border="1px solid #eee"),(0,v.jsx)(fr,{value:e.name,children:(0,v.jsx)("div",{style:t,className:"trello-label-item",children:e.name})},e.id)}))),t))})]}),(0,v.jsx)("div",{className:"toggle-field",children:(0,v.jsx)("a",{className:"toggle-fields-btn",onClick:function(){i(!r)},children:r?(0,v.jsxs)(v.Fragment,{children:["Collapse all fields ",(0,v.jsx)(tr.Z,{})]}):(0,v.jsxs)(v.Fragment,{children:["Show all fields ",(0,v.jsx)(ct.Z,{})]})})}),(0,v.jsx)("div",{children:(0,v.jsx)(et.Z,{className:"send-btn",size:"large",type:"primary",block:!0,htmlType:"submit",children:"Create issue"})})]})})};n(74611);var gr=n(11382),vr=(n(5827),n(51368)),yr=Tt.Z.Option;function br(e){var t=e.field,n=t.allowedValues,r=t.defaultValue,i=-1!==t.operations.indexOf("add")?"multiple":void 0,a=function(e){var t=null;return n.forEach((function(n){n.id===e&&(t=n)})),t};return(0,v.jsx)(Tt.Z,{showSearch:!0,filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0},size:"large",defaultValue:r?r.id:void 0,mode:i,onChange:function(n){var r=n;"customfield_10021"===t.key&&(r=n.map((function(e){return a(e)}))),"com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"===t.schema.custom&&(r=n.map((function(e){return a(e)}))),"com.atlassian.jira.plugin.system.customfieldtypes:select"===t.schema.custom&&(r={id:n}),e.handleChange(t.key,r)},children:n.map((function(e){return(0,v.jsx)(yr,{value:e.id,children:e.name||e.value},e.id)}))})}function xr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return jr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var wr=Tt.Z.Option;function Sr(e){var t=xr((0,s.useState)([]),2),n=t[0],r=t[1],i=e.field,a=e.currentDes;(0,s.useEffect)((function(){vt({accountID:a.accountID,what:"autoComplete",fieldName:i.key,cloudID:a.info.cloudID,projectID:a.info.projectID}).then((function(e){r(e.items?e.items:[])}))}),[]);var o=-1!==i.operations.indexOf("add")?"multiple":void 0;return(0,v.jsx)(Tt.Z,{showSearch:!0,size:"large",mode:o,onChange:function(t){e.handleChange(i.key,t)},filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0},children:n.map((function(e){return function(e){return"assignee"===i.key?(0,v.jsx)(wr,{value:e.info.user.accountId,children:e.info.user.displayName},e.info.user.accountId):"reporter"===i.key?(0,v.jsx)(wr,{value:e.id,children:e.info.field.displayName},e.id):"labels"===i.key?(0,v.jsx)(wr,{value:e.info.field.value,children:e.info.field.displayName},e.info.field.value):(0,v.jsx)(wr,{})}(e)}))})}var kr=n(23279),Cr=n.n(kr),Nr=n(93695);function Tr(e){return function(e){if(Array.isArray(e))return Or(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Pr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ir(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||Pr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pr(e,t){if(e){if("string"==typeof e)return Or(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Or(e,t):void 0}}function Or(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Dr=Tt.Z.Option;function Ar(e){var t=Ir((0,s.useState)([{id:Date.now(),linkType:"",issues:[]}]),2),n=t[0],r=t[1],i=Ir((0,s.useState)([]),2),a=i[0],o=i[1],l=Ir((0,s.useState)([]),2),c=l[0],d=l[1],h=(e.field,e.currentDes);(0,s.useEffect)((function(){vt({accountID:h.accountID,what:"issueLinkType",cloudID:h.info.cloudID,projectID:h.info.projectID}).then((function(e){var t=[];e.items.forEach((function(e){"Relates"===e.name?t.push({value:e.name+"+in",displayName:e.info.inward}):(t.push({value:e.name+"+in",displayName:e.info.inward}),t.push({value:e.name+"+out",displayName:e.info.outward}))})),o(t)}))}),[]),(0,s.useEffect)((function(){e.handleChange("issuelinks",n)}),[n]);var p=function(e,t){vt({accountID:h.accountID,what:"issue",cloudID:h.info.cloudID,query:t}).then((function(e){e.items[0].info.issues.length>0&&d(e.items[0].info.issues)}))};return(0,v.jsxs)("div",{className:"issue-link",children:[(0,v.jsxs)("div",{className:"label",children:["Linked issues",(0,v.jsx)("div",{className:"add-btn",onClick:function(){r([].concat(Tr(n),[{id:Date.now(),linkType:"",issues:[]}]))},children:(0,v.jsx)(u.Z,{title:"Add",children:(0,v.jsx)(It.Z,{})})})]}),(0,v.jsx)("div",{className:"issue-link-container",children:n.map((function(e,t){return(0,v.jsxs)("div",{className:"issue-link-item",children:[(0,v.jsx)(Tt.Z,{size:"large",className:"issue-link-type-select",placeholder:"Link type",onChange:function(t){!function(e,t){var i=n.filter((function(t){return t.id===e}));i[0].linkType=t;var a=n.map((function(t){return t.id===e?i[0]:t}));r(a)}(e.id,t)},children:a.map((function(e){return(0,v.jsx)(Dr,{value:e.value,children:e.displayName},e.value)}))}),(0,v.jsx)(Tt.Z,{size:"large",className:"issue-link-select",placeholder:"Select issues",mode:"multiple",onSearch:Cr()((function(t){return p(e.id,t)}),800),onDropdownVisibleChange:function(t){t&&p(e.id,"")},onChange:function(t){return function(e,t){var i=n.filter((function(t){return t.id===e}));i[0].issues=t;var a=n.map((function(t){return t.id===e?i[0]:t}));r(a)}(e.id,t)},children:c.map((function(e){return(0,v.jsx)(Dr,{value:e.key,children:e.key},e.key)}))}),(0,v.jsx)("div",{className:"issue-link-remove",onClick:function(){var t;t=e.id,r(n.filter((function(e){return e.id!==t})))},children:(0,v.jsx)(u.Z,{title:"Remove",children:(0,v.jsx)(Nr.Z,{})})})]},e.id)}))})]})}function Ur(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Rr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _r=Tt.Z.Option;function Zr(e){var t=Ur((0,s.useState)([]),2),n=t[0],r=t[1],i=e.field,a=e.currentDes;(0,s.useEffect)((function(){}),[]);var o=function(e){var t;vt({accountID:a.accountID,what:(t=i.key,"customfield_10014"===t?"epic":"customfield_10021"==t?"sprint":void 0),cloudName:a.info.cloudName,query:e,cloudID:a.info.cloudID,projectID:a.info.projectID}).then((function(e){r(e.items?e.items:[])}))},l=-1!==i.operations.indexOf("add")?"multiple":void 0;return(0,v.jsx)(Tt.Z,{size:"large",showSearch:!0,mode:l,filterOption:!1,onChange:function(t){e.handleChange(i.key,t)},onSearch:Cr()(o,800),onDropdownVisibleChange:function(e){e&&o("")},children:n.map((function(e){return function(e){return"customfield_10021"===i.key?(0,v.jsxs)(_r,{value:e.id,children:[e.name,"(",e.info.data.stateKey,")"]},e.id):"customfield_10014"===i.key?(0,v.jsxs)(_r,{value:e.id,children:[e.name,"-(",e.id,")"]},e.id):(0,v.jsx)(_r,{})}(e)}))})}function Er(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Br(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Br(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Br(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const zr=function(e){var t=Er((0,s.useState)(!1),2),n=t[0],r=t[1],i=e.currentDes;return(0,v.jsxs)("div",{className:"jira-api-token-panel",children:[(0,v.jsxs)("div",{className:"info",children:["Go to your Atlassian"," ",(0,v.jsx)("a",{href:"https://id.atlassian.com/manage/api-tokens",target:"_blank",children:"API tokens page"})," ","and create a new API token. Copy the token and paste it into the box below."]}),(0,v.jsxs)(kt.Z,{onSubmit:function(t){var n,a;r(!0),(n=i.account.id,a=t.token,ft({method:"POST",url:"/account/jira_basic_token",data:{accountID:n,token:a}})).then((function(){r(!1),e.handleApiTokenSubmitted()})).catch((function(){r(!1)}))},children:[(0,v.jsx)("div",{className:"label",children:"API TOKEN"}),(0,v.jsx)(kt.Z.Item,{name:"token",rules:[{required:!0}],children:(0,v.jsx)(Ct.Z,{})}),(0,v.jsx)(kt.Z.Item,{children:(0,v.jsx)(et.Z,{type:"primary",block:!0,loading:n,htmlType:"submit",children:"Submit"})})]})]})};function Fr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fr(Object(n),!0).forEach((function(t){Lr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Lr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hr(e){return(0,v.jsx)(r.Z,Mr(Mr({},e),{},{footer:null,maskClosable:!1,wrapClassName:"jira-api-token",destroyOnClose:!0,centered:!0,title:"Submit Jira API token",children:(0,v.jsx)(zr,Mr({},e))}))}function Wr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wr(Object(n),!0).forEach((function(t){Gr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return qr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Kr=Tt.Z.Option,$r={};const Jr=function(e){var t=Vr((0,s.useState)(!1),2),n=t[0],r=t[1],i=Vr((0,s.useState)({}),2),a=i[0],o=i[1],l=Vr((0,s.useState)([]),2),c=l[0],u=l[1],h=Vr((0,s.useState)(null),2),p=h[0],f=h[1],m=Vr((0,s.useState)(!1),2),g=m[0],y=m[1],b=e.currentDes;(0,s.useEffect)((function(){c.length&&u([]),vt({accountID:b.accountID,what:"createMeta",cloudID:b.info.cloudID,projectID:b.info.projectID}).then((function(e){f(e.items[0]),u(e.items),e.items.forEach((function(e){$r[e.id]=e}))}))}),[e.currentDes]),(0,s.useEffect)((function(){}));var x,j=function(e,t){o(Yr(Yr({},a),{},Gr({},e,t)))},w=function(e){var t={fields:{}},n={};for(var r in n.project={id:b.info.projectID},e)"issuetype"===r||"priority"===r||"assignee"===r?n[r]={id:e[r]}:"summary"===r||"description"===r||"environment"===r||"customfield_10014"===r||"customfield_10016"===r||"labels"===r||"customfield_10037"===r||"customfield_10038"===r||"customfield_10039"===r||"customfield_10029"===r||"customfield_10034"===r||"customfield_10035"===r||"customfield_10036"===r||"customfield_10031"===r||"customfield_10032"===r||"customfield_10033"===r||"customfield_10021"===r||p.info.fields[r]&&"com.atlassian.jira.plugin.system.customfieldtypes:select"===p.info.fields[r].schema.custom||p.info.fields[r]&&"com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"===p.info.fields[r].schema.custom||p.info.fields[r]&&"com.atlassian.jira.plugin.system.customfieldtypes:float"===p.info.fields[r].schema.custom||p.info.fields[r]&&"com.atlassian.jira.plugin.system.customfieldtypes:textarea"===p.info.fields[r].schema.custom||p.info.fields[r]&&"com.atlassian.jira.plugin.system.customfieldtypes:textfield"===p.info.fields[r].schema.custom?p.info.fields[r]&&"com.atlassian.jira.plugin.system.customfieldtypes:textarea"===p.info.fields[r].schema.custom?e[r]&&(n[r]={version:1,type:"doc",content:[{type:"paragraph",content:[{type:"text",text:e[r]}]}]}):e[r]&&(n[r]=e[r]):"components"===r?n[r]=e[r].map((function(e){return{id:e}})):"customfield_10026"===r?e[r]&&(n[r]=[{id:p.info.fields.customfield_10026.allowedValues[0].id}]):"fixVersions"===r?n[r]=e[r].map((function(e){return{id:e}})):"reporter"===r?e[r]&&(n[r]={id:e[r]}):"parent"===r?e[r]&&(n[r]={key:e[r]}):("duedate"===r||"customfield_10015"===r||"customfield_10030"===r||p.info.fields[r]&&"com.atlassian.jira.plugin.system.customfieldtypes:datetime"===p.info.fields[r].schema.custom||p.info.fields[r]&&"com.atlassian.jira.plugin.system.customfieldtypes:datepicker"===p.info.fields[r].schema.custom)&&e[r]&&(n[r]=e[r].format());return(e["timetracking-o"]||e["timetracking-r"])&&(n.timetracking={}),e["timetracking-o"]&&(n.timetracking.originalEstimate=e["timetracking-o"]),e["timetracking-r"]&&(n.timetracking.remainingEstimate=e["timetracking-r"]),t.fields=n,e.issuelinks&&e.issuelinks.length&&(t.issueLinks=[],e.issuelinks.forEach((function(e){if(e.linkType&&e.issues.length){var n=e.linkType.split("+"),r=n[0],i=n[1];e.issues.forEach((function(e){var n=Gr({type:r},"".concat(i,"wardIssue"),e);t.issueLinks.push(n)}))}}))),t},S=function(e){return"timetracking"===e.key?"(eg. 3w 4d 12h)":""},k=function(){y(!0)},C=function(e){return void 0!==e.allowedValues?(0,v.jsx)(br,{handleChange:j,field:e}):void 0!==e.autoCompleteUrl?(0,v.jsx)(Sr,{handleChange:j,currentDes:b,field:e}):"description"===e.key||"environment"===e.key||"com.atlassian.jira.plugin.system.customfieldtypes:textarea"===e.schema.custom?(0,v.jsx)(kt.Z.Item,{name:e.key,children:(0,v.jsx)(Ct.Z.TextArea,{size:"large",autoSize:{minRows:3}})}):"customfield_10014"===e.key?(0,v.jsx)(Zr,{handleChange:j,currentDes:b,field:e}):"customfield_10021"===e.key?p.info.apiToken?(0,v.jsx)(Zr,{handleChange:j,currentDes:b,field:e}):(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("i",{className:"jira-sprint-tip",children:["To use Sprint, you need to provide an API token."," ",(0,v.jsx)("a",{onClick:k,children:"Submit API token"})]})}):(0,v.jsx)(kt.Z.Item,{name:e.key,children:(0,v.jsx)(Ct.Z,{size:"large",placeholder:S(e)})})};return(0,v.jsxs)("div",{className:"jira-form",children:[0===c.length?(0,v.jsx)("div",{className:"loading",children:(0,v.jsx)(gr.Z,{indicator:(0,v.jsx)(Jn.Z,{spin:!0})})}):(0,v.jsxs)(kt.Z,{onFinish:function(t){var n=Yr(Yr({},t),a),r=w(n),i=p.info.fields;i.environment&&!r.fields.environment&&(r.fields.environment=""),i.description&&!r.fields.description&&(r.fields.description=""),e.handleSend(r)},children:[(0,v.jsx)("div",{className:"label",children:"Issue Type"}),(0,v.jsx)(kt.Z.Item,{name:"issuetype",initialValue:c[0].id,children:(0,v.jsx)(Tt.Z,{size:"large",onChange:function(e,t){f($r[e])},children:c.map((function(e){if("Subtask"!==e.name)return(0,v.jsx)(Kr,{value:e.id,children:e.name},e.id)}))})}),(0,v.jsx)("div",{className:"label",children:"Summary"}),(0,v.jsx)(kt.Z.Item,{name:"summary",rules:[{required:!0,message:"You must specify a summary of the issue."}],children:(0,v.jsx)(Ct.Z,{size:"large"})}),n&&(x=p.info.fields,(0,v.jsx)(v.Fragment,{children:Object.keys(x).map((function(e){return"issuetype"===e||"project"===e||"summary"===e||"attachment"===e?void 0:"timetracking"===e?(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"label",children:"Original Estimate"}),(0,v.jsx)(kt.Z.Item,{name:"timetracking-o",children:(0,v.jsx)(Ct.Z,{size:"large",placeholder:"(eg. 3w 4d 12h)"})})]},"oe"),(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"label",children:"Remaining Estimate"}),(0,v.jsx)(kt.Z.Item,{name:"timetracking-r",children:(0,v.jsx)(Ct.Z,{size:"large",placeholder:"(eg. 3w 4d 12h)"})})]},"re")]},x[e].key):"issuelinks"===e?(0,v.jsx)("div",{children:(0,v.jsx)(Ar,{handleChange:j,currentDes:b,field:x})},x[e].key):"duedate"===e||"customfield_10030"===e||"customfield_10015"===e||"com.atlassian.jira.plugin.system.customfieldtypes:datetime"===x[e].schema.custom||"com.atlassian.jira.plugin.system.customfieldtypes:datepicker"===x[e].schema.custom?(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"label",children:x[e].name}),(0,v.jsx)(kt.Z.Item,{name:e,children:(0,v.jsx)(er.Z,{size:"large",style:{width:"100%"}})})]},x[e].key):"customfield_10022"===e||"customfield_10017"===e||"parent"===e?"":"customfield_10016"===e||"com.atlassian.jira.plugin.system.customfieldtypes:float"===x[e].schema.custom?(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"label",children:x[e].name}),(0,v.jsx)(kt.Z.Item,{name:e,children:(0,v.jsx)(vr.Z,{size:"large",style:{width:"100%"}})})]},x[e].key):"customfield_10026"===e?(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"label",children:x[e].name}),(0,v.jsx)(kt.Z.Item,{name:e,children:(0,v.jsx)(d.Z,{children:x[e].allowedValues[0].value})})]},x[e].key):(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"label",children:x[e].name}),C(x[e])]},x[e].key)}))})),(0,v.jsx)("div",{className:"toggle-field",children:(0,v.jsx)("a",{className:"toggle-fields-btn",onClick:function(){r(!n)},children:n?(0,v.jsxs)(v.Fragment,{children:["Collapse all fields ",(0,v.jsx)(tr.Z,{})]}):(0,v.jsxs)(v.Fragment,{children:["Show all fields ",(0,v.jsx)(ct.Z,{})]})})}),(0,v.jsx)("div",{children:(0,v.jsx)(et.Z,{className:"send-btn",size:"large",type:"primary",block:!0,htmlType:"submit",children:"Create issue"})})]}),(0,v.jsx)(Hr,{visible:g,onCancel:function(){y(!1)},currentDes:b,handleApiTokenSubmitted:function(){y(!1),c.length&&u([]),vt({accountID:b.accountID,what:"createMeta",cloudID:b.info.cloudID,projectID:b.info.projectID}).then((function(e){f(e.items[0]),u(e.items),e.items.forEach((function(e){$r[e.id]=e}))}))}})]})};function Xr(e){return Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xr(e)}function Qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ei(e,t){return ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ei(e,t)}function ti(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ii(e);if(t){var i=ii(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ni(this,n)}}function ni(e,t){if(t&&("object"===Xr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ri(e)}function ri(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ii(e){return ii=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ii(e)}var ai=Tt.Z.Option;const si=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ei(e,t)}(o,e);var t,n,r,s=ti(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e)).state={currentDesId:t.props.currentDes.id,slackMsg:"",isUploading:!1,percentage:0},t.handleDesChange=t.handleDesChange.bind(ri(t)),t.handleSend=t.handleSend.bind(ri(t)),t.handleSlackMsgChange=t.handleSlackMsgChange.bind(ri(t)),t.onUploadProgress=t.onUploadProgress.bind(ri(t)),t}return t=o,(n=[{key:"handleDesChange",value:function(e){"add"!==e?this.setState({currentDesId:e}):this.props.goToAddDes()}},{key:"onUploadProgress",value:function(e){this.setState({percentage:e})}},{key:"handleSend",value:function(e){var t=this,n=this.props.destinations,r=this.state.currentDesId,s={};n.forEach((function(e){s[e.id]=e}));var o=s[r];e.service=o.service,e.destinationID=r+"";var l,c=e.description;if(this.props.tabUrl&&(e.sourceLink=this.props.tabUrl),"trello"===e.service?e.extraString=function(e){if(!e)return"";var t="";for(var n in e)t+="**"+n+"**: "+e[n]+" \n";return t}(this.props.imageInfo):"asana"===e.service?e.extraString=function(e){if(!e)return"";var t="";return t+"Captured in "+e.Browser+", "+e["Viewport Size"]+" viewport, "+e["Pixel Ratio"]+" pixel ratio, "+e["Zoom Level"]+" zoom, "+e.OS}(this.props.imageInfo):"github"===e.service?e.extraString=function(e){if(!e)return"";var t="<table>";for(var n in e)t+="<tr><td><strong>"+n+"</strong></td><td>"+e[n]+"</td></tr>";return t+"</table> \n"}(this.props.imageInfo):"jira"===e.service&&(void 0!==e.fields.environment?(e.fields.environment=j(e.fields.environment,this.props.imageInfo,this.props.itemUrl,this.props.type),void 0!==e.fields.description&&(e.fields.description={version:1,type:"doc",content:[{type:"paragraph",content:[{type:"text",text:e.fields.description}]}]})):void 0!==e.fields.description&&(e.fields.description=j(e.fields.description,this.props.imageInfo,this.props.itemUrl,this.props.type))),this.props.itemId)"video"===this.props.type?e.videoID=this.props.itemId:e.imageID=this.props.itemId,this.setState({isUploading:!0}),(l=e,ft({method:"POST",url:"/account/share_item",data:l})).then((function(n){i.Z.success({message:De[e.service].successMsg,description:(0,v.jsxs)("a",{href:n.itemUrl,target:"_blank",children:["Click to see it in your ",De[e.service].displayName]})}),t.props.handleSendSuccess()}),(function(e){throw new Error(De[o.service].actionTypeStr+" failed! ("+e+")")})).catch((function(e){e&&a.ZP.error(e.toString()+" Please try again!"),t.setState({isUploading:!1,percentage:0})}));else{if(this.props.imageBlob)var d=this.props.contentType;else{var u=this.props.imageUrl.split(",")[1];d=this.props.imageUrl.split(",")[0].split(":")[1].split(";")[0]}this.setState({isUploading:!0}),function(e){return ft({method:"POST",url:"/destination/image/create",data:e})}({Title:e.title||"",Description:c,DestID:this.state.currentDesId+"",ContentType:d}).then((function(n){var r=t.props.imageBlob?t.props.imageBlob:y(u,d),a=new File([r],"test.png"),s=n.Image.S3Key;return e.destinationImageID=n.Image.ImageID+"",e.imageURL=ht+"/destination/image/show?ImageKey="+s,e.imageName=t.props.tabTitle+"."+d.replace("image/",""),function(e,t,n){var r=new FormData;for(var i in e)r.append(i,e[i]);var a=n||"https://awesomescreenshot.s3.amazonaws.com/";return g()({method:"POST",crossdomain:!0,url:a,data:r,onUploadProgress:function(e){var n=Math.round(100*e.loaded/e.total);t(n)}})}({AWSAccessKeyId:"AKIAJSCJQ2NM3XLFPVKA",acl:"private",key:n.Image.S3Key,"Content-Type":d,policy:n.Policy,signature:n.Signature,file:a},t.onUploadProgress).then((function(n){return function(e){return ft({method:"GET",url:"/destination/image/upload_done",params:{key:e}})}(s).then((function(n){return function(e){return ft({method:"POST",url:"/account/share_screenshot",data:e})}(e).then((function(n){i.Z.success({message:De[e.service].successMsg,description:(0,v.jsxs)("a",{href:n.itemUrl,target:"_blank",children:["Click to see it in your"," ",De[e.service].displayName]})}),t.props.handleSendSuccess()}),(function(e){throw new Error(De[o.service].actionTypeStr+" failed! ("+e+")")}))}))}),(function(e){throw new Error("Upload image failed!")}))}),(function(e){throw new Error("Create image error!("+e+")")})).catch((function(e){e&&a.ZP.error(e.toString()+" Please try again!"),t.setState({isUploading:!1,percentage:0})}))}}},{key:"handleSlackMsgChange",value:function(e){this.setState({slackMsg:e.currentTarget.value})}},{key:"render",value:function(){var e=this,t=this.props,n=t.destinations,r=t.itemUrl,i=this.state,a=i.currentDesId,s=i.isUploading,o=i.percentage,l={};n.forEach((function(e){l[e.id]=e}));var c=l[a],d=F()("upload-progress",{active:s}),u=F()("destination-area",{active:!s});return(0,v.jsxs)("div",{className:"des-panel",children:[(0,v.jsxs)("div",{className:d,children:[r?(0,v.jsx)(Jn.Z,{className:"loading"}):(0,v.jsx)(Nt.Z,{type:"circle",status:"active",percent:o}),(0,v.jsx)("div",{className:"upload-tip",children:o<100&&!r?"Uploading image...":De[c.service].actionTypeStr+"..."})]}),(0,v.jsxs)("div",{className:u,children:[(0,v.jsx)("div",{className:"destination-select",children:(0,v.jsxs)(Tt.Z,{size:"large",value:a,onChange:this.handleDesChange,children:[n.map((function(e){var t=F()("des-logo",e.service);return(0,v.jsxs)(ai,{value:e.id,children:[(0,v.jsx)("div",{className:t}),Ae[e.resourceType]+e.resourceName]},e.id)})),(0,v.jsxs)(ai,{value:"add",children:[(0,v.jsx)("div",{className:"des-logo add"}),"Create a new destination"]},"add")]})}),(0,v.jsx)(St.Z,{plain:!0,children:De[c.service].panelTitle}),(0,v.jsx)("div",{className:"des-form",children:"slack"===c.service?(0,v.jsx)(Xn,{currentDes:c,tabTitle:e.props.tabTitle,handleSend:e.handleSend,handleSlackMsgChange:e.handleSlackMsgChange}):"trello"===c.service?(0,v.jsx)(ar,{currentDes:c,tabTitle:e.props.tabTitle,resourceID:c.resourceID,handleSend:e.handleSend}):"asana"===c.service?(0,v.jsx)(cr,{tabTitle:e.props.tabTitle,currentDes:c,handleSend:e.handleSend}):"googleDrive"===c.service?(0,v.jsx)(dr,{tabTitle:e.props.tabTitle,currentDes:c,handleSend:e.handleSend}):"github"===c.service?(0,v.jsx)(mr,{tabTitle:e.props.tabTitle,currentDes:c,handleSend:e.handleSend}):"jira"===c.service?(0,v.jsx)(Jr,{tabTitle:e.props.tabTitle,currentDes:c,handleSend:e.handleSend}):void 0})]})]})}}])&&Qr(t.prototype,n),r&&Qr(t,r),o}(s.Component);function oi(e){return oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oi(e)}function li(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ci(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?li(Object(n),!0).forEach((function(t){di(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):li(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function di(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ui(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function hi(e,t){return hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},hi(e,t)}function pi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mi(e);if(t){var i=mi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return fi(this,n)}}function fi(e,t){if(t&&("object"===oi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function mi(e){return mi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},mi(e)}var gi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hi(e,t)}(s,e);var t,n,i,a=pi(s);function s(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.call(this,e)}return t=s,(n=[{key:"render",value:function(){var e=this,t=this.props.currentPanel;return(0,v.jsx)(r.Z,ci(ci({},this.props),{},{footer:null,maskClosable:!1,wrapClassName:"des-modal",destroyOnClose:!0,centered:!0,closeIcon:(0,v.jsx)(jt.Tw,{style:{fontSize:"12px"}}),children:"add"===t?(0,v.jsx)($n,ci(ci({},e.props),{},{currentAccount:e.props.defaultCurrentAccount})):"des"===t?(0,v.jsx)(si,{currentDes:e.props.currentDes,destinations:e.props.destinations,goToAddDes:e.props.goToAddDes,tabTitle:e.props.tabTitle,tabUrl:e.props.tabUrl,imageUrl:e.props.imageUrl,imageBlob:e.props.imageBlob,imageInfo:e.props.imageInfo||null,handleSendSuccess:e.props.onCancel,contentType:e.props.contentType,type:e.props.type,itemId:e.props.itemId,itemUrl:e.props.itemUrl}):void 0}))}}])&&ui(t.prototype,n),i&&ui(t,i),s}(s.Component);const vi=gi;function yi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yi(Object(n),!0).forEach((function(t){xi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ji(e){return(0,v.jsx)(r.Z,bi(bi({},e),{},{footer:null,maskClosable:!1,wrapClassName:"what-des",destroyOnClose:!0,children:"what is a destination?"}))}function wi(e){var t=e.destinations,n=F()("des-container",{small:e.small});return(0,v.jsx)("div",{className:"render-des",children:t&&t.length?(0,v.jsxs)("div",{className:n,children:[t.map((function(t,n){var r=F()("des-item",t.service);return(0,v.jsxs)("div",{className:r,onClick:e.handleDesClick.bind(null,t),title:De[t.service].displayName+" ("+Ae[t.resourceType]+t.resourceName+")",children:[(0,v.jsx)("div",{className:"icon"}),(0,v.jsx)("div",{className:"name",children:Ae[t.resourceType]+t.resourceName})]},n)})),(0,v.jsx)("div",{className:"des-item add",onClick:e.handleDesClick.bind(null,"add"),children:(0,v.jsx)("div",{className:"icon",children:"+"})})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(et.Z,{type:"primary",className:"feedback-btn",block:!0,onClick:e.handleAddDesClick,children:"Connect with other services"}),(0,v.jsxs)("div",{className:"support-s",children:[(0,v.jsx)("div",{children:"Support:"}),(0,v.jsx)("div",{className:"s-container",children:Ue.map((function(e){return(0,v.jsx)(u.Z,{title:e.displayName,children:(0,v.jsx)("div",{className:"s-item ".concat(e.name)})},e.name)}))})]})]})})}var Si=n(85483);function ki(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ci(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ci(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ci(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ni=Tt.Z.Option;const Ti=function(e){var t=e.accounts,n=e.currentDriveAccount,r=n?n.service:"googleDrive",o=De[r],l=ki((0,s.useState)((function(){return t?t[0]:null})),2),c=(l[0],l[1]),u=ki((0,s.useState)(""),2),h=u[0],p=u[1],f=ki((0,s.useState)(!0),2),m=f[0],b=f[1],x=ki((0,s.useState)([]),2),j=x[0],k=x[1],C=ki((0,s.useState)(!1),2),N=C[0],T=C[1],I=ki((0,s.useState)((function(){return null===e.currentDriveAccount})),2),P=(I[0],I[1],ki((0,s.useState)(!1),2)),O=P[0],D=P[1],A=ki((0,s.useState)(0),2),U=A[0],R=A[1],_=ki((0,s.useState)(!1),2),Z=_[0],E=_[1],B=ki((0,s.useState)(""),2),z=B[0],M=B[1],L=ki((0,s.useState)(""),2),H=L[0],W=L[1],Y=ki((0,s.useState)(!1),2),G=Y[0],V=Y[1],q=ki((0,s.useState)(!1),2),K=q[0],$=q[1];(0,s.useEffect)((function(){c(t[0])}),[t.length]),(0,s.useEffect)((function(){return e.currentDriveAccount&&X(),window.addEventListener("message",J),function(){window.removeEventListener("message",J)}}),[e.currentDriveAccount]);var J=function(t){if("accountConnected"===t.data.name){var n=JSON.parse(t.data.data);e.handleDriveAccountConnected(n)}},X=function(t){k([]),T(!0),vt({accountID:e.currentDriveAccount.id,what:"folder",query:t}).then((function(e){var t=e.items?e.items:[];k(t),T(!1)}))},Q=function(e,t,r,i){if("googleDrive"===n.service){var a=new File([e],r.name,{type:t}),s=t.split("/")[1];"jpeg"==s&&(s="jpg");var o={name:r.name+"."+s};"-1"!==r.folder&&(o.parents=[r.folder]),ee(i,a,o,r.googleDriveSharable)}else if("dropbox"===n.service){var l=("-1"!==r.folder?j.filter((function(e){return e.id===r.folder}))[0].info.path||j.filter((function(e){return e.id===r.folder}))[0].info.path_lower:"")+"/"+r.name+"."+t.split("/")[1];te(i,l,e)}else if("box"===n.service){var c=r.name+"."+t.split("/")[1],d=r.folder;a=new File([e],r.name,{type:t});ne(i,a,c,d)}},ee=function(t,n,s,o){(function(e,t,n,r,i){var a=new FormData;return a.append("metadata",new Blob([JSON.stringify(n)],{type:"application/json"})),a.append("file",t),g()({url:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id",method:"POST",headers:{Authorization:"Bearer "+e},data:a,onUploadProgress:function(e){if("video"===i)var t=50+Math.round(Math.round(100*e.loaded/e.total)/2);else t=Math.round(100*e.loaded/e.total);r(t)}})})(t,n,s,R,e.type).then((function(n){if(o){var a=n.data.id;$(!0),function(e,t){return g()({url:"https://www.googleapis.com/drive/v3/files/"+t+"/permissions",method:"POST",headers:{Authorization:"Bearer "+e},data:{role:"reader",type:"anyone"}})}(t,a).then((function(e){W("https://drive.google.com/file/d/".concat(a,"/view?usp=sharing")),V(!0),$(!1)})).catch((function(){W("https://drive.google.com/file/d/".concat(a,"/view?usp=sharing")),V(!0),$(!1)}))}else i.Z.success({message:De[r].successMsg,description:(0,v.jsxs)("a",{target:"_blank",href:"https://drive.google.com/file/d/".concat(n.data.id,"/view"),children:["Click to see it in your ",De[r].displayName]})}),e.onCancel();bt("googleDrive")})).catch((function(e){a.ZP.error(e.response.data.msg),D(!1),R(0)}))},te=function(t,n,s){(function(e,t,n,r,i){return g()({url:"https://content.dropboxapi.com/2/files/upload",method:"POST",headers:{Authorization:"Bearer "+e,"Dropbox-API-Arg":(a={path:t,mode:"add",autorename:!0,mute:!1,strict_conflict:!1},JSON.stringify(a).replace(/[\u007f-\uffff]/g,(function(e){return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)}))),"Content-Type":"application/octet-stream"},data:n,onUploadProgress:function(e){if("video"===i)var t=50+Math.round(Math.round(100*e.loaded/e.total)/2);else t=Math.round(100*e.loaded/e.total);r(t)}});var a})(t,n,s,R,e.type).then((function(t){i.Z.success({message:De[r].successMsg,description:(0,v.jsxs)("a",{target:"_blank",href:"https://www.dropbox.com/home".concat(t.data.path_display),children:["Click to see it in your ",De[r].displayName]})}),e.onCancel(),bt("dropbox")})).catch((function(e){e.response&&"insufficient_space"===e.response.data.error.reason[".tag"]?a.ZP.error("Your dropbox account is full. The screenshot can’t be sent to it"):a.ZP.error(e.response.data.error_summary),D(!1),R(0)}))},ne=function(t,n,s,o){(function(e,t,n,r,i,a){var s=new FormData,o={name:n};return o.parent="-1"!==r?{id:r}:{id:"0"},s.append("attributes",JSON.stringify(o)),s.append("file",t),g()({method:"POST",url:"https://upload.box.com/api/2.0/files/content",headers:{Authorization:"Bearer "+e,"Access-Control-Expose-Headers":"WWW-Authenticate"},data:s,onUploadProgress:function(e){if("video"===a)var t=50+Math.round(Math.round(100*e.loaded/e.total)/2);else t=Math.round(100*e.loaded/e.total);i(t)}})})(t,n,s,o,R,e.type).then((function(t){i.Z.success({message:De[r].successMsg,description:(0,v.jsxs)("a",{target:"_blank",href:"https://app.box.com/file/".concat(t.data.entries[0].id),children:["Click to see it in your ",De[r].displayName]})}),e.onCancel(),bt("box")})).catch((function(e){if(e.response.data&&e.response.data.message)var t=e.response.data.message;else t=e.response.statusText;a.ZP.error(t),D(!1),R(0)}))},re=function(t){return e.permissions["allow".concat(w(t))]},ie=F()("upload-progress",{active:O}),ae=F()("drive-wrapper",{active:!O}),se="video"===e.type?"video":"image";return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"drive-panel",children:[(0,v.jsx)("div",{className:"title",children:null===n?m?"Choose your cloud storage":"":(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"icon ".concat(n.service)}),"Save to ",o.displayName]})}),(0,v.jsx)("div",{className:ie,children:G?(0,v.jsxs)("div",{className:"sharable-link-area",children:[(0,v.jsx)("div",{className:"label",children:"Shareable Link"}),(0,v.jsx)(Ct.Z,{value:H,style:{width:"320px"},size:"large"}),(0,v.jsx)(et.Z,{type:"primary",size:"large",onClick:function(){S(H),a.ZP.success("Copied!")},children:"Copy"})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Nt.Z,{type:"circle",status:"active",percent:U}),(0,v.jsx)("div",{className:"upload-tip",children:U<100?"Uploading ".concat(se,"..."):K?"Creating shareable link...":De[r].actionTypeStr+"..."})]})}),t.length&&n?(0,v.jsx)("div",{className:ae,children:(0,v.jsx)("div",{className:"container",children:(0,v.jsxs)(kt.Z,{onFinish:function(t){var r;D(!0),(r=n.id,ft({method:"GET",url:"/account/token",params:{accountID:r}})).then((function(n){var r,i,a=n.token;if(e.itemUrl)(r=e.itemUrl,i=function(e){R(Math.round(e/2))},g()({method:"GET",url:r,responseType:"blob",onDownloadProgress:function(e){var t=Math.round(100*e.loaded/e.total);i&&i(t)}})).then((function(e){Q(e.data,"image/png",t,a)}));else{if(e.imageBlob)var s=e.contentType,o=e.imageBlob;else o=y(e.imageUrl.split(",")[1]),s=e.imageUrl.split(",")[0].split(":")[1].split(";")[0];Q(o,s,t,a)}})).catch((function(e){a.ZP.error("Something went wrong!"),D(!1)}))},children:[(0,v.jsx)("div",{className:"account-select"}),(0,v.jsx)("div",{className:"label",children:"Name"}),(0,v.jsx)(kt.Z.Item,{name:"name",rules:[{required:!0,message:"Please input a name"}],initialValue:e.tabTitle,children:(0,v.jsx)(Ct.Z,{})}),(0,v.jsx)("div",{className:"label",children:o.targetName}),(0,v.jsx)(kt.Z.Item,{name:"folder",rules:[{required:!0,message:"choose a folder"}],initialValue:"-1",children:(0,v.jsxs)(Tt.Z,{showSearch:!0,placeholder:o.placeHolder,loading:N,onSearch:Cr()((function(e){X(e)}),800),filterOption:!1,children:[(0,v.jsxs)(Ni,{value:"-1",children:[(0,v.jsx)(Si.Z,{className:"folder-option ".concat(n.service)}),"/"]}),j.map((function(e){return(0,v.jsxs)(Ni,{value:e.id,children:[(0,v.jsx)(Si.Z,{className:"folder-option ".concat(n.service)}),"dropbox"===n.service?e.info.path||e.info.path_lower:e.name]},e.id)}))]})}),(0,v.jsx)("div",{className:"tip",children:"googleDrive"===n.service?"Only root folder and Awesome Screenshot folder are available for the moment.":"Only 10 recent folders are listed. Type and search for other folders."}),"googleDrive"===n.service&&(0,v.jsx)(kt.Z.Item,{name:"googleDriveSharable",valuePropName:"checked",initialValue:"true"===localStorage["is-google-drive-share"],children:(0,v.jsx)(d.Z,{children:"Get shareable link (Anyone with the link can view)"})}),(0,v.jsx)(kt.Z.Item,{children:(0,v.jsx)(et.Z,{type:"primary",className:"upload-btn",size:"large",block:!0,htmlType:"submit",children:"Upload"})})]})})}):(0,v.jsx)(v.Fragment,{children:m?(0,v.jsx)("div",{className:"service-container",children:(0,v.jsx)("div",{className:"account-container",children:Re.map((function(e){var t=F()("account-item",e.name,{pro:!re(e.name)});return(0,v.jsx)("div",{className:t,"data-des":e.name,onClick:function(){return function(e){re(e)?(p(e),b(!1)):(M(e),E(!0))}(e.name)},children:(0,v.jsx)("b",{})},e.name)}))})}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"top",children:(0,v.jsxs)("div",{className:"back-btn",onClick:function(){b(!0)},children:[(0,v.jsx)(pe.Z,{}),"Choose another cloud storage"]})}),(0,v.jsx)("div",{className:"connect-panel",children:(0,v.jsxs)("div",{className:"box",children:[(0,v.jsxs)("div",{className:"main-box",children:[(0,v.jsx)("div",{className:"pic",children:(0,v.jsx)("div",{className:"logo ".concat(h)})}),(0,v.jsxs)("div",{className:"content",children:[(0,v.jsx)("div",{className:"logo ".concat(h)}),(0,v.jsxs)("div",{className:"title",children:["Integrate ",De[h].displayName]}),(0,v.jsx)("div",{className:"sub-title",children:De[h].panelSubTitle}),(0,v.jsx)("ul",{children:De[h].featureLists.map((function(e,t){return(0,v.jsx)("li",{children:e},t)}))})]})]}),(0,v.jsxs)(et.Z,{type:"primary",size:"large",onClick:function(){gt(h).then((function(e){var t="width=800,height=700,top="+(window.screen.availHeight-30-700)/2+",left="+(window.screen.availWidth-10-800)/2;window.open(e.URI,"",t)}))},children:["Connect with ",De[h].displayName]})]})})]})})]}),(0,v.jsx)(Ze.Z,{visible:Z,onCancel:function(){return E(!1)},type:z})]})};function Ii(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ii(Object(n),!0).forEach((function(t){Oi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ii(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Oi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Di(e){return(0,v.jsx)(r.Z,Pi(Pi({},e),{},{footer:null,maskClosable:!1,wrapClassName:"des-modal",destroyOnClose:!0,centered:!0,closeIcon:(0,v.jsx)(jt.Tw,{style:{fontSize:"12px"}}),children:(0,v.jsx)(Ti,Pi({},e))}))}function Ai(e){var t=e.accounts;return(0,v.jsx)("div",{className:"render-drive-accounts",children:t&&t.length?(0,v.jsx)("div",{className:"save-to-drive",children:t.map((function(t){return(0,v.jsxs)("div",{className:"save-item ".concat(t.service),onClick:e.handleDriveItemClick.bind(null,t),children:[(0,v.jsx)("div",{className:"icon"}),(0,v.jsx)("span",{children:(0,v.jsx)("span",{className:"user-email",title:t.userInfo.email,children:t.userInfo.email})})]},t.id)}))}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(et.Z,{type:"primary",className:"connect-btn",block:!0,onClick:e.handleAddDriveClick,children:"Connect with cloud storage"}),(0,v.jsxs)("div",{className:"support-s",children:[(0,v.jsx)("div",{children:"Support:"}),(0,v.jsx)("div",{className:"s-container",children:Re.map((function(e){return(0,v.jsx)(u.Z,{title:e.displayName,children:(0,v.jsx)("div",{className:"s-item ".concat(e.name)})},e.name)}))})]})]})})}function Ui(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ri(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ui(Object(n),!0).forEach((function(t){_i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ui(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Zi=function(e){var t,n;return(0,v.jsx)(r.Z,Ri(Ri({},e),{},{footer:null,maskClosable:!1,wrapClassName:"sign-in",destroyOnClose:!0,centered:!0,children:(0,v.jsxs)("div",{className:"signin-alert-modal",children:[(0,v.jsx)("div",{className:"tip",children:(n=e.type,"aws"===n?(t="ext_loc_upload_image","You need to sign in to an Awesome Screenshot account in order to upload images."):"drive"===n?(t="ext_loc_drive","You need to sign in to an Awesome Screenshot account in order to connect with cloud services."):"des"===n?(t="ext_loc_destination","You need to sign in to an Awesome Screenshot account in order to connect with other services."):"uploadVideo"===n?(t="ext_loc_upload_video","You need to sign in to an Awesome Screenshot account in order to upload videos."):"")}),(0,v.jsx)(et.Z,{type:"primary",size:"large",block:!0,onClick:function(){var e="https://www.awesomescreenshot.com/signin";t&&(e+="?from="+t),window.open(e)},children:"Sign In"})]})}))};function Ei(e){return Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ei(e)}function Bi(e){return function(e){if(Array.isArray(e))return zi(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return zi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zi(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fi(Object(n),!0).forEach((function(t){qi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Li(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Hi(e,t){return Hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Hi(e,t)}function Wi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Vi(e);if(t){var i=Vi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yi(this,n)}}function Yi(e,t){if(t&&("object"===Ei(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Gi(e)}function Gi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vi(e){return Vi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Vi(e)}function qi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ki=[{name:"save",displayName:"Download as image"},{name:"pdf",displayName:"Download as PDF"},{name:"print",displayName:"Print"},{name:"copy",displayName:"Copy"}],$i={},Ji=chrome.extension.getBackgroundPage(),Xi=function e(t,n){t.forEach((function(t,r){n[t.folderID]&&"0"!==t.folderID&&(t.children=n[t.folderID].map((function(e,t){return{title:e.name,value:e.folderID+"-.-"+e.name,folderID:e.folderID,icon:function(e){return e.expanded?(0,v.jsx)(tt.Z,{}):(0,v.jsx)(nt.Z,{})}}})),e(t.children,n))}))},Qi=function(e){var t=[],n=e;return n[0]&&n[0].forEach((function(e,n){t.push({title:e.name,value:e.folderID+"-.-"+e.name,folderID:e.folderID,icon:function(e){return e.expanded?(0,v.jsx)(tt.Z,{}):(0,v.jsx)(nt.Z,{})}})})),t.unshift({title:"My Items",folderID:"0",value:"0-.-My Items",icon:function(e){return e.expanded?(0,v.jsx)(tt.Z,{}):(0,v.jsx)(nt.Z,{})}}),Xi(t,e),t},ea=function(){chrome.storage.sync.get(["clickNo"],(function(e){e.clickNo?chrome.storage.sync.set({neverShow:!0}):chrome.storage.sync.set({clickNo:!0})})),mt().then((function(e){e&&xt("chromeFiveStarCancel")})),i.Z.destroy()},ta=function(e,t){i.Z.open({key:"questionnaire",className:"questionnaire",placement:"bottomRight",duration:0,style:{width:418,marginLeft:-63,padding:"20px 30px"},message:e,description:t,onClose:ea})},na=function(){b("https://chrome.google.com/webstore/detail/awesome-screenshot-screen/nlipoenfbbikpbjkfpfillcgkoblgpmj/reviews"),chrome.storage.sync.set({neverShow:!0}),mt().then((function(e){e&&xt("chromeFiveStarClick")})),i.Z.destroy()},ra=function(){b("/feedback.html"),chrome.storage.sync.set({captureCount:0,clickNo:!1,neverShow:!1}),mt().then((function(e){e&&xt("chromeFiveStarFeedback")})),i.Z.destroy()},ia=function(){var e;ta((0,v.jsxs)("div",{className:"noti_title",children:[(0,v.jsx)("img",{src:"images/star.png"})," User Satisfaction Survey"]}),(0,v.jsxs)("div",{className:"noti_des",children:[(0,v.jsx)("div",{className:"content",children:"Your review means a lot to us. Would you mind taking a moment to rate the extension in the Web Store?"}),(0,v.jsx)(et.Z,(e={style:{width:"98px",height:"34px"},type:"primary",onClick:ea},qi(e,"type","primary"),qi(e,"ghost",!0),qi(e,"children","No, thanks"),e)),(0,v.jsx)(et.Z,{style:{width:"246px",height:"34px",marginLeft:"14px"},type:"primary",onClick:na,children:"Sure, take me to the Web Store"})]}))},aa=function(){var e;ta((0,v.jsxs)("div",{className:"noti_title",children:[(0,v.jsx)("img",{src:"images/star.png"})," User Satisfaction Survey"]}),(0,v.jsxs)("div",{className:"noti_des",children:[(0,v.jsx)("div",{className:"content",children:"Would you like to report any issues you're experiencing or give us some suggestions so that we can make the extension better for you?"}),(0,v.jsx)(et.Z,(e={style:{width:"98px"},type:"primary",onClick:ea},qi(e,"type","primary"),qi(e,"ghost",!0),qi(e,"children","No, thanks"),e)),(0,v.jsx)(et.Z,{style:{width:"246px",marginLeft:"14px"},type:"primary",onClick:ra,children:"Yes, take me to the feedback form"})]}))};const sa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hi(e,t)}(o,e);var t,n,r,i=Wi(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,e)).printIframe=(0,s.createRef)(),t.copyDiv=(0,s.createRef)(),t.img=(0,s.createRef)(),t.state={isShownSignin:!1,isShownSaveToAws:!1,isShownWhatDes:!1,isShownDrive:!1,isShownUpgrade:!1,signInLoading:!1,uploadImagePercentage:0,awsShareUrls:[],projects:[],folders:{},foldersTreeData:[],isfolderLoading:!1,destinations:[],accounts:[],isShownDes:!1,desCurrentPanel:"add",currentDes:null,driveService:"",currentDriveAccount:null,upgradeType:"",zoomImageIndex:"",haveUndate:!1,temImageBlob:null,isShowAds:!1,promotionUrl:"https://www.vidline.com/promotion-card.html",promotionHeight:0},t.handleLocalSave=t.handleLocalSave.bind(Gi(t)),t.handleSaveToAws=t.handleSaveToAws.bind(Gi(t)),t.showModal=t.showModal.bind(Gi(t)),t.handleModalCancel=t.handleModalCancel.bind(Gi(t)),t.handleSignInFinish=t.handleSignInFinish.bind(Gi(t)),t.handleUploadFinish=t.handleUploadFinish.bind(Gi(t)),t.refreshUserData=t.refreshUserData.bind(Gi(t)),t.handleFolderCreated=t.handleFolderCreated.bind(Gi(t)),t.openDesModal=t.openDesModal.bind(Gi(t)),t.handleDesClick=t.handleDesClick.bind(Gi(t)),t.goToAddDes=t.goToAddDes.bind(Gi(t)),t.handleDesCreated=t.handleDesCreated.bind(Gi(t)),t.handleAccountConnected=t.handleAccountConnected.bind(Gi(t)),t.handleAddDriveClick=t.handleAddDriveClick.bind(Gi(t)),t.handleAddDesClick=t.handleAddDesClick.bind(Gi(t)),t.openDriveModal=t.openDriveModal.bind(Gi(t)),t.openSetting=t.openSetting.bind(Gi(t)),t.handleDriveAccountConnected=t.handleDriveAccountConnected.bind(Gi(t)),t.showUpgradeModal=t.showUpgradeModal.bind(Gi(t)),t.getPermissionByName=t.getPermissionByName.bind(Gi(t)),t.copyUrl=t.copyUrl.bind(Gi(t)),t.openFeedback=t.openFeedback.bind(Gi(t)),t.openOptionPage=t.openOptionPage.bind(Gi(t)),t.downloadMultiple=t.downloadMultiple.bind(Gi(t)),t.downloadMultiplePDF=t.downloadMultiplePDF.bind(Gi(t)),t.handleSignIn=t.handleSignIn.bind(Gi(t)),t.zoomImage=t.zoomImage.bind(Gi(t)),t.loadPromotionUrl=t.loadPromotionUrl.bind(Gi(t)),t}return t=o,(n=[{key:"componentDidMount",value:function(){var e=this;this.props.user.username&&0===this.state.projects.length&&this.refreshUserData(),chrome.runtime.onMessage.addListener((function(t,n,r){var i=t.name;"awsLoginByGoogle"===i?(e.props.refreshUser(),e.setState({isShownSignin:!1})):"stop"===i&&r()})),this.props.imageUrl&&!this.props.imageBlob&&"[object Array]"!==Object.prototype.toString.call(this.props.imageUrl)&&A(this.props.imageUrl).then((function(t){e.setState({temImageBlob:t})})),window.addEventListener("message",(function(t){var n=t.data;n&&("show"===n.type?e.setState({isShowAds:!0,promotionHeight:n.height?parseInt(n.height):0}):"close"===t.data.type&&e.setState({isShowAds:!1}))}))}},{key:"componentWillUpdate",value:function(e,t){"save"===e.step&&"save"!==this.props.step&&this.setState({isShowAds:!1,promotionHeight:0})}},{key:"componentDidUpdate",value:function(e,t){e.user.username!==this.props.user.username&&(this.props.user.username?this.refreshUserData():this.setState({awsShareUrls:[],projects:[],destinations:[],accounts:[]}));var n=null!=this.props.permissions.empty||null!=this.props.permissions.allowUploadImage;if("save"===this.props.step&&!this.state.haveUndate&&n){this.setState({haveUndate:!0});var r=this.props.permissions.showChromeFiveStarNever,i=this.props.user?this.props.user.username:"";chrome.storage.sync.get(["captureCount","clickNo","neverShow"],(function(e){if(!e.neverShow&&!r){if(e.clickNo)var t=200;else t=100;e.captureCount&&e.captureCount>t&&(n=i,s="Are you enjoying Awesome Screenshot?",ta((0,v.jsxs)("div",{className:"noti_title",children:[(0,v.jsx)("img",{src:"images/star.png"})," User Satisfaction Survey"]}),(0,v.jsxs)("div",{className:"noti_des",children:[n?(0,v.jsxs)("div",{className:"content",children:["Hi ",(0,v.jsxs)("p",{className:"user_name",children:[" ",n]})," , ",s]}):(0,v.jsx)("div",{className:"content",children:s}),(0,v.jsx)(et.Z,(a={style:{width:"172px"},type:"primary",onClick:aa},qi(a,"type","primary"),qi(a,"ghost",!0),qi(a,"children","Not really"),a)),(0,v.jsx)(et.Z,{style:{width:"172px",marginLeft:"14px"},type:"primary",onClick:ia,children:"Yes"})]})))}var n,a,s}))}}},{key:"loadPromotionUrl",value:function(){var e=new URLSearchParams(window.location.search);return e.get("promotion_test")?this.state.promotionUrl+e.get("promotion_test")+"?theme=dark&place=extension":this.state.promotionUrl+"?theme=dark&place=extension"}},{key:"copyUrl",value:function(e){S(e)}},{key:"downloadMultiple",value:function(){var e=this.props,t=e.imageUrl,n=(e.tabTitle,e.tabUrl),r=this.props.contentType.split("/")[1];"jpeg"===r&&(r="jpg");var i=P(n);"true"===localStorage["save-as"]?N().then((function(){t.forEach((function(e,t){T({url:e,filename:i+"_part"+(t+1)+"."+r})}))})):t.forEach((function(e,t){I(e,i+"_part"+(t+1)+"."+r)}))}},{key:"downloadMultiplePDF",value:function(){var e=this.props.imageUrl,t=P(this.props.tabUrl);"true"===localStorage["save-as"]?N().then((function(){Yt(e).then((function(e){T({url:e,filename:t+".pdf"})}))})):Yt(e).then((function(e){I(e,t+".pdf")}))}},{key:"handleLocalSave",value:function(e){var t=function(e){e&&("image/jpeg"===e.type?D(e).then((function(e){U(e,(function(){a.ZP.success("Copied to clipboard!",1)}),(function(e){a.ZP.error("Copy failed.",1)}))})):U(e,(function(){a.ZP.success("Copied to clipboard!",1)}),(function(e){a.ZP.error("Copy failed.",1)})))},n=this,r=this.props,i=r.imageUrl,s=r.tabTitle;if(r.tabUrl,"save"===e){var o=n.props.contentType.split("/")[1];"jpeg"==o&&(o="jpg");var l=(s?s.replace(/(\.|\:)/g," "):"untitled").replace(/[#$~\-!@%^&*();'"?><\[\]{}\|,:\/=+]/g," ")+"."+o;if(l=l.replace(/\s+/g,"-"),"true"===localStorage["save-as"]){var c={url:n.props.imageBlob?window.URL.createObjectURL(n.props.imageBlob):n.props.imageUrl,filename:l,saveAs:!0};N().then((function(){T(c)}))}else I(n.props.imageBlob?window.URL.createObjectURL(n.props.imageBlob):i,l)}else if("print"===e){var d=this.printIframe.current,u='<div style="margin:0 auto;text-align:center"><img style="width:100%;" src="'.concat(i,'"></div>'),h=d.contentWindow.document;h.write(u);var p=d.contentWindow;p.close(),p.focus(),p.print(),h.body.innerHTML=""}else if("copy"===e)try{var f=n.props.imageBlob?n.props.imageBlob:n.state.temImageBlob;f?t(f):n.props.imageUrl&&A(n.props.imageUrl).then((function(e){t(e)}))}catch(e){a.ZP.error("Sorry,your system doesn't support this function. Please right click on this image to save.")}else if("pdf"===e){this.props.info.width;var m=this.props.info.height,g=this.props.imageUrl,v=(this.props.tabTitle,this.props.tabUrl,14400),y=s.replace(/(\.|\:)/g," ").replace(/[#$~!@%^&*();'"?><\[\]{}\|,:\/=+-]/g," ")+".pdf";"true"===localStorage["save-as"]?N().then((function(){m>v?k(g,v,(function(e){Wt(e).then((function(e){T({url:e,filename:y,saveAs:!0})}))})):Wt([g]).then((function(e){T({url:e,filename:y,saveAs:!0})}))})):m>v?k(g,v,(function(e){Wt(e).then((function(e){I(e,y)}))})):Wt([g]).then((function(e){I(e,y)}))}Ji.googleEvent(e+" image","local")}},{key:"handleSaveToAws",value:function(){this.props.user.username?this.showModal("SaveToAws"):this.setState({signInType:"aws",isShownSignin:!0})}},{key:"openFeedback",value:function(){var e=Mi({},this.props.imageInfo);localStorage.last_info=JSON.stringify(e),chrome.tabs.create({url:"/feedback.html"})}},{key:"openOptionPage",value:function(){chrome.tabs.create({url:"/option-react.html"})}},{key:"handleSignInFinish",value:function(){this.handleModalCancel("Signin"),this.props.refreshUser()}},{key:"handleUploadFinish",value:function(e){this.setState({isShownSaveToAws:!1,awsShareUrls:[].concat(Bi(this.state.awsShareUrls),[e])})}},{key:"showModal",value:function(e){var t="isShown".concat(e);this.setState(qi({},t,!0))}},{key:"openSetting",value:function(e){chrome.tabs.create({url:"https://www.awesomescreenshot.com/settings/"+e})}},{key:"handleModalCancel",value:function(e){var t,n="isShown".concat(e);this.setState((qi(t={},n,!1),qi(t,"signInType",""),t))}},{key:"goToAddDes",value:function(){this.setState({desCurrentPanel:"add"})}},{key:"handleDesCreated",value:function(e){this.setState({destinations:[].concat(Bi(this.state.destinations),[e]),desCurrentPanel:"des",currentDes:e})}},{key:"openDesModal",value:function(e){var t=this;this.setState({desCurrentPanel:e},(function(){t.showModal("Des")}))}},{key:"getPermissionByName",value:function(e){return this.props.permissions["allow".concat(w(e))]}},{key:"goToRate",value:function(){b("https://chrome.google.com/webstore/detail/awesome-screenshot-screen/nlipoenfbbikpbjkfpfillcgkoblgpmj/reviews")}},{key:"handleDesClick",value:function(e){var t=this;"add"===e?this.openDesModal("add"):this.getPermissionByName(e.service)?this.setState({currentDes:e},(function(){t.openDesModal("des")})):this.setState({upgradeType:"des",isShownUpgrade:!0})}},{key:"handleSignOut",value:function(){b("https://www.awesomescreenshot.com/web/user/logout")}},{key:"handleFolderCreated",value:function(e){var t={};t=this.state.folders[0]?Mi(Mi({},this.state.folders),{},{0:[e].concat(Bi(this.state.folders[0]))}):{0:[e]};var n=Qi(t);this.setState({folders:t,foldersTreeData:n})}},{key:"openDriveModal",value:function(e){var t=this;this.props.user.username?this.props.permissions["allow".concat(w(e.service))]?this.setState({currentDriveAccount:e},(function(){t.showModal("Drive")})):this.setState({upgradeType:e.service},(function(){t.showModal("Upgrade")})):this.setState({signInType:"drive",isShownSignin:!0})}},{key:"refreshUserData",value:function(){var e,t=this;this.setState({projects:[],destinations:[],isShownSignin:!1,isfolderLoading:!0}),ft({method:"GET",url:"/folder/load_user_folders",params:{count:20,page:e}}).then((function(e){var n=e.folders,r=Qi(n);t.setState({folders:n,foldersTreeData:r,isfolderLoading:!1})})),Promise.all([ft({method:"GET",url:"/account/load"}),ft({method:"GET",url:"/destination/load"})]).then((function(e){t.setState({accounts:e[0].accounts?e[0].accounts:[],destinations:e[1].destinations?e[1].destinations:[]}),e[0].accounts&&($i={},e[0].accounts.forEach((function(e){$i[e.id]=e})))})).catch((function(e){}))}},{key:"handleAccountConnected",value:function(e){this.setState({accounts:[].concat(Bi(this.state.accounts),[e]),currentAccount:e},(function(){$i[e.id]=e}))}},{key:"handleDriveAccountConnected",value:function(e){this.setState({accounts:[e].concat(Bi(this.state.accounts)),currentDriveAccount:e})}},{key:"handleAddDesClick",value:function(){this.props.user.username?this.showModal("Des"):this.setState({signInType:"des",isShownSignin:!0})}},{key:"handleAddDriveClick",value:function(){var e=this;this.props.user.username?this.setState({currentDriveAccount:null},(function(){e.showModal("Drive")})):this.setState({signInType:"drive",isShownSignin:!0})}},{key:"showUpgradeModal",value:function(e){this.setState({isShownUpgrade:!0,driveService:e})}},{key:"zoomImage",value:function(e){this.setState({zoomImageIndex:e})}},{key:"handleSignIn",value:function(){window.open("https://www.awesomescreenshot.com/signin?from=ext_loc_normal")}},{key:"render",value:function(){var e=this,t=x(this.props.imageUrl),n=this.state,r=n.awsShareUrls,i=n.destinations,a=this.props.user,s=this.state.accounts.filter((function(e){return"googleDrive"===e.service||"dropbox"===e.service||"box"===e.service})),o=this.state.accounts.filter((function(e){return"googleDrive"!==e.service&&"dropbox"!==e.service&&"box"!==e.service})),l=F()("save-panel",this.props.className),c=(0,v.jsxs)(Qe.Z,{children:["free"===this.props.currentPlan.PlanName&&(0,v.jsx)(Qe.Z.Item,{children:(0,v.jsxs)("a",{href:"https://www.awesomescreenshot.com/pricing?from=local_dropdown",target:"_blank",rel:"noopener noreferrer",children:[(0,v.jsx)(rt.Z,{style:{marginRight:"5px"},title:"Premium user"}),"Upgrade"]})}),(0,v.jsx)(Qe.Z.Item,{onClick:this.handleSignOut,children:(0,v.jsxs)("a",{children:[(0,v.jsx)(it.Z,{style:{marginRight:"5px"}}),"Sign out"]})})]}),d=function(e,t,n){return(0,v.jsxs)("div",{className:"section",children:[e&&(0,v.jsxs)("div",{className:"section-title",children:[t&&(0,v.jsx)("div",{className:"icon "+t}),e]}),(0,v.jsx)("div",{className:"section-content",children:n})]})};return(0,v.jsxs)("div",{className:l,children:[(0,v.jsx)("iframe",{className:"print-iframe",ref:this.printIframe,frameBorder:"0"}),(0,v.jsx)("div",{className:"copy-div",contentEditable:"true",ref:this.copyDiv}),(0,v.jsx)("div",{className:"top-bar",children:(0,v.jsxs)("div",{className:"inner-container",children:[(0,v.jsxs)("div",{className:"logo-area",children:[(0,v.jsx)("div",{className:"logo"}),(0,v.jsx)("a",qi({target:"_blank",href:"https://www.awesomescreenshot.com"},"target","_blank"))]}),(0,v.jsxs)("div",{className:"user-area",children:[this.props.isReported||"entire"!==this.props.menuType&&"selected"!==this.props.menuType?(0,v.jsx)("div",{}):(0,v.jsxs)("div",{className:"quick-issue",children:["Not properly captured?",(0,v.jsx)("a",{onClick:this.props.quickReport,children:" Report a problem."})]}),(0,v.jsxs)("a",{className:"user-link email-us",target:"_blank",onClick:this.openOptionPage,children:[(0,v.jsx)(at.Z,{}),"Options"]}),(0,v.jsxs)("a",{className:"user-link email-us",target:"_blank",onClick:this.openFeedback,children:[(0,v.jsx)(st.Z,{}),"Send Feedback"]}),a.username?(0,v.jsx)(Xe.Z,{overlay:c,trigger:["click"],placement:"bottomRight",children:(0,v.jsxs)("div",{className:"user-link",children:["free"!==this.props.currentPlan.PlanName&&this.props.currentPlan.PlanName?(0,v.jsx)(lt.Z,{style:{color:"#faad14"}}):(0,v.jsx)(ot.Z,{}),a.username,(0,v.jsx)(ct.Z,{})]})}):(0,v.jsxs)("div",{className:"user-link",onClick:this.handleSignIn,children:[(0,v.jsx)(ot.Z,{}),"Sign in"]})]})]})}),(0,v.jsx)("div",{className:"panel",children:(0,v.jsxs)("div",{className:"inner-container",children:[(0,v.jsxs)("div",{className:"left",children:[!t&&(0,v.jsx)(u.Z,{mouseEnterDelay:.3,title:"Back and Re-edit this screenshot",children:(0,v.jsx)("div",{className:"back-btn",onClick:this.props.backToEdit,children:(0,v.jsx)("b",{})})}),(0,v.jsx)("div",{className:"image-container",children:x(e.props.imageUrl)?e.props.imageUrl.map((function(t,n){var r=e.state.zoomImageIndex===n,i=r?"zoom-in":"";return(0,v.jsx)("img",{className:"multiple ".concat(i),src:t,ref:e.img,alt:"",onClick:function(){e.zoomImage(r?"":n)}},n)})):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"helper"}),(0,v.jsx)("img",{src:e.props.imageUrl,ref:e.img,alt:""})]})})]}),(0,v.jsxs)("div",{className:"right",children:[(0,v.jsxs)("div",{className:"panel-logo-area",children:[(0,v.jsx)("div",{className:"logo"}),"AwesomeScreenshot"]}),(0,v.jsx)("div",{className:"right-container",children:t?(0,v.jsx)("div",{className:"multiple-image-panel sub-panel",children:(0,v.jsxs)("div",{className:"section",children:[(0,v.jsxs)("div",{className:"tip",children:["Note: there's no way for Chrome to capture this web page as a single image because it is too large, and editing toolbar is not available in this situation. The screenshot was automatically split into"," ",this.props.imageUrl.length," images. You can download all images or save images as a single PDF with one click."]}),(0,v.jsxs)("div",{className:"btn-area",children:[(0,v.jsx)(et.Z,{block:!0,className:"multiple-download-btn",onClick:this.downloadMultiple,children:"Download all ".concat(this.props.imageUrl.length," images")}),(0,v.jsx)(et.Z,{block:!0,className:"multiple-download-btn",onClick:this.downloadMultiplePDF,children:"Download as PDF"})]})]})}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{className:"local-panel",children:(0,v.jsx)("div",{className:"local-save-container",children:Ki.map((function(t){var n=F()("local-save-item",t.name);return(0,v.jsx)(u.Z,{mouseEnterDelay:.3,title:t.displayName,children:(0,v.jsx)("div",{className:n,onClick:e.handleLocalSave.bind(null,t.name),children:(0,v.jsx)("b",{})})},t.name)}))})}),(0,v.jsx)("div",{className:"sub-panel",children:d("Save to Awesome Screenshot","",(0,v.jsx)(v.Fragment,{children:r.length?(0,v.jsxs)("div",{className:"aws-share-area",children:[r.map((function(t){return(0,v.jsxs)("div",{className:"aws-share-item",children:[(0,v.jsxs)("div",{className:"title",children:["Saved in"," ",(0,v.jsx)("span",{title:t.projectName,children:t.projectName})]}),(0,v.jsxs)("div",{className:"input-area",children:[(0,v.jsx)("input",{type:"text",value:t.url,readOnly:!0}),(0,v.jsx)(u.Z,{title:"copied!",trigger:"click",children:(0,v.jsx)("div",{className:"aws-share-action-btn",onClick:e.copyUrl.bind(null,t.url),children:(0,v.jsx)(dt.Z,{})})})]})]},t.projectId)})),(0,v.jsx)("div",{className:"save-another",onClick:this.handleSaveToAws,children:"Save to another folder"})]}):(0,v.jsx)(et.Z,{className:"save-aws-btn",onClick:this.handleSaveToAws,block:!0,children:"Upload to get shareable link"})}))}),(0,v.jsx)("div",{className:"sub-panel",children:d((0,v.jsxs)(v.Fragment,{children:["Collaborate with Teammates",0!==i.length&&(0,v.jsx)("div",{className:"actions",children:(0,v.jsx)(u.Z,{title:"Manage destinations",children:(0,v.jsx)("div",{className:"action-btn option",onClick:this.openSetting.bind(null,"destinations")})})})]}),"",(0,v.jsx)(wi,{destinations:i,handleDesClick:this.handleDesClick,handleAddDesClick:this.handleAddDesClick,small:!0}))}),(0,v.jsx)("div",{className:"sub-panel promo "+(this.state.isShowAds?"":"hidden"),children:a.premiumLevel&&parseInt(a.premiumLevel)>1||this.props.currentPlan.PlanName&&"free"!==this.props.currentPlan.PlanName||"save"!==this.props.step?(0,v.jsx)(v.Fragment,{}):(0,v.jsx)("iframe",{className:"show-iframe "+(this.state.isShowAds?"":"hidden"),style:this.state.isShowAds?{height:(this.state.promotionHeight>0?this.state.promotionHeight:0)+"px"}:{},src:this.loadPromotionUrl()})}),(0,v.jsx)("div",{className:"sub-panel",children:d((0,v.jsxs)(v.Fragment,{children:["Save to Cloud",0!==s.length&&(0,v.jsxs)("div",{className:"actions",children:[(0,v.jsx)(u.Z,{title:"Connect a new account",children:(0,v.jsx)("div",{className:"action-btn add",onClick:this.handleAddDriveClick})}),(0,v.jsx)(u.Z,{title:"Manage accounts",children:(0,v.jsx)("div",{className:"action-btn option",onClick:this.openSetting.bind(null,"connectedAccounts")})})]})]}),"",(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{className:"save-to-drive",children:(0,v.jsx)(Ai,{accounts:s,handleAddDriveClick:this.handleAddDriveClick,handleDriveItemClick:this.openDriveModal})})}))})]})})]})]})}),(0,v.jsx)("div",{className:"footer",children:(0,v.jsx)("div",{className:"inner-container",children:(0,v.jsx)("div",{className:"social-media"})})}),(0,v.jsx)(Zi,{visible:this.state.isShownSignin,onCancel:this.handleModalCancel.bind(null,"Signin"),type:this.state.signInType}),(0,v.jsx)(Lt,{visible:this.state.isShownSaveToAws,onCancel:this.handleModalCancel.bind(null,"SaveToAws"),tabTitle:this.props.tabTitle,imageUrl:this.props.imageUrl,imageBlob:this.props.imageBlob?this.props.imageBlob:this.state.temImageBlob,contentType:this.props.contentType,img:this.img.current,folders:this.state.folders,foldersTreeData:this.state.foldersTreeData,onUploadFinish:this.handleUploadFinish,onRefreshProjects:this.refreshUserData,onFolderCreated:this.handleFolderCreated,currentPlan:this.props.currentPlan,counts:this.props.counts,isfolderLoading:this.state.isfolderLoading}),(0,v.jsx)(vi,{visible:this.state.isShownDes,onCancel:this.handleModalCancel.bind(null,"Des"),currentPanel:this.state.desCurrentPanel,currentDes:this.state.currentDes,accountHash:$i,destinations:this.state.destinations,accounts:o,tabTitle:this.props.tabTitle,tabUrl:this.props.tabUrl,imageUrl:this.props.imageUrl,imageBlob:this.props.imageBlob?this.props.imageBlob:this.state.temImageBlob,goToAddDes:this.goToAddDes,handleDesCreated:this.handleDesCreated,handleAccountConnected:this.handleAccountConnected,imageInfo:this.props.imageInfo,permissions:this.props.permissions,currentPlan:this.props.currentPlan,contentType:this.props.contentType}),(0,v.jsx)(Di,{visible:this.state.isShownDrive,onCancel:this.handleModalCancel.bind(null,"Drive"),tabTitle:this.props.tabTitle,imageUrl:this.props.imageUrl,imageBlob:this.props.imageBlob?this.props.imageBlob:this.state.temImageBlob,service:this.state.driveService,permissions:this.props.permissions,currentPlan:this.props.currentPlan,accounts:s,currentDriveAccount:this.state.currentDriveAccount,handleDriveAccountConnected:this.handleDriveAccountConnected,contentType:this.props.contentType,showUpgradeModal:this.showUpgradeModal}),(0,v.jsx)(Ze.Z,{visible:this.state.isShownUpgrade,onCancel:this.handleModalCancel.bind(null,"Upgrade"),type:this.state.upgradeType}),(0,v.jsx)(ji,{visible:this.state.isShownWhatDes,onCancel:this.handleModalCancel.bind(null,"WhatDes")})]})}}])&&Li(t.prototype,n),r&&Li(t,r),o}(s.Component);var oa=3e4;function la(e,t,n,r,i,a,s,o,l){var c=l||oa,d=!1,u=e[0].width/n,h=e[0].height/n;s&&s.height>e[0].height&&(d=!0);var p,f=Math.ceil(h*t),m=null,g=null;if(a&&a.forEach((function(t){t&&t.fill.width>0&&t.fill.height>0&&(0==t.fill.x?m=ca(e[0],t.sample):t.fill.x>0&&(g=ca(e[0],t.sample)))})),r){var v=r.height;d&&(v=h),p=(f=v*t)?((d?h:s.height)+(e.length>2?(e.length-2)*v:0)+f)/n:((d?h:s.height)+(e.length-1)*v)/n,i&&i.height>0&&(p+=i.height/n)}else p=f?(e.length-1)*h+f:e.length*h;for(var y=Math.ceil(p/c),b=p%c,x=0,j=0,w=[],S=0,k=0;k<y;k++){var C=document.createElement("canvas"),N=C.getContext("2d");C.id="c_"+k,C.width=u,C.height=k===y-1?b:c;for(var T=x;T<e.length;T++){var I=0,P=0,O=u*n,D=h*n,A=0,U=u,R=h;if(r){v=r.height;if(d&&(v=h),0===T?(D=d?h:s.height,R=(d?h:s.height)/n):T===e.length-1&&k===y-1?(I=r.x,A=r.x/n,S?(P=(h-Math.min(S,f))*n,R=Math.min(S,f)):(P=(h-f)*n,R=f/n),D=R*n):(I=r.x,A=r.x/n,S?(P=(h-S)*n,I=r.x,A=r.x/n,D=(R=S)*n):(P=r.y,I=r.x,A=r.x/n,R=v/n,U=r.width/n,D=v,O=r.width),T===e.length-1&&k!==y-1&&(P=(h-f)*n)),N.drawImage(e[T],I,P,O,D,A,j,U,R),0!==T&&(r.x>0&&m&&(N.beginPath(),N.rect(0,j-1,r.x/n,R+1),N.fillStyle=m,N.fill()),r.x+r.width<u&&g&&(N.beginPath(),N.rect((r.x+r.width)/n,j-1,(u-(r.x+r.width))/n,R+1),N.fillStyle=g,N.fill()),T===e.length-1&&k===y-1&&i&&i.height>0&&N.drawImage(e[T],0,i.y,u*n,i.height,0,j+R,u,i.height/n)),j+R>c){x=T,S=T===e.length-1&&k+1===y-1?j+f-c:j+r.height/n-c,j=0;break}j=S?j+S:j+R,S=0}else{if(T===e.length-1&&k===y-1?P=S?(h-Math.min(S,f))*n:(h-f)*n:(S&&(P=(h-S)*n,D=(R=S)*n),T===e.length-1&&k!==y-1&&(P=(h-f)*n)),N.drawImage(e[T],I,P,O,D,A,j,U,R),j+R>c){x=T,S=T===e.length-1&&k+1===y-1?j+f-c:j+h-c,j=0;break}j=S?j+S:j+R,S=0}}!function(e){C.toBlob((function(t){if(w.push({blob:t,index:e}),w.length===y){w.sort((function(e,t){return e.index-t.index}));o(w.map((function(e){return e.blob})))}}))}(k)}}function ca(e,t){if(t.height>0&&t.width>0){var n=new Map,r=document.createElement("canvas");r.width=t.width,r.height=t.height;var i=r.getContext("2d");i.drawImage(e,t.x,t.y,t.width,t.height,0,0,t.width,t.height);var a=null;try{a=i.getImageData(0,0,t.width,t.height)}catch(d){}if(a){!function(e,t){function n(e,t,n){return(e<<16)+(t<<8)+n}t=t||new Map;for(var r=0,i=e.length;r<i;r+=4)if(255===e[r+3]){var a=n(e[r],e[r+1],e[r+2]);t.set(a,(t.get(a)||0)+1)}}(a.data,n);var s=0,o=0,l=!1;return n.forEach((function(e,t){e>s&&(s=e,o=t,l=!0)})),l?"rgb("+(c=o,d=255&c,u=255&(c>>=8),[255&(c>>=8),u,d]).join(", ")+")":"rgb(212,212,212)"}return null}var c,d,u}function da(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var r=e.offsetWidth;return n==r&&(r=t.clientWidth),document.body.removeChild(t),n-r}window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;var ua=null;function ha(e){var t="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:t="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:t="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:t="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:t="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:t="INVALID_STATE_ERR";break;default:t="Unknown Error"}return t}const pa={fs:null,getFs:function(){return new Promise((function(e,t){window.requestFileSystem(window.PERSISTENT,52428800,(function(t){e(t)}),(function(e){t(e)}))}))},save:function(e,t){var n=this;return this.getFs().then((function(r){return n.do_save(r,e,t)}),ha)},append:function(e,t){ua?ua.write(e):this.getFs().then((function(n){n.root.getFile(t,{create:!1},(function(t){t.createWriter((function(t){t.onwriteend=function(e){},t.onerror=function(e){},t.write(e),ua=t}),(function(e){}))}),(function(e){}))}))},do_save:function(e,t,n){return new Promise((function(r,i){e.root.getFile(n,{create:!0},(function(e){e.createWriter((function(n){n.onwriteend=function(t){r(e.toURL())},n.onerror=function(e){i(e.toString())},n.write(t),ua=n}),(function(e){i(e)}))}),(function(e){i(e)}))}))},getFile:function(e){var t=this;return new Promise((function(n,r){t.getFs().then((function(t){t.root.getFile(e,{},(function(e){e.file((function(e){n(e)}),r)}),r)}))}))}};var fa=n(31795),ma=n.n(fa);function ga(e){return ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ga(e)}function va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ya(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?va(Object(n),!0).forEach((function(t){ba(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):va(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ba(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ja(e,t){return ja=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ja(e,t)}function wa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ca(e);if(t){var i=Ca(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Sa(this,n)}}function Sa(e,t){if(t&&("object"===ga(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ka(e)}function ka(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ca(e){return Ca=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ca(e)}var Na=chrome.extension.getBackgroundPage(),Ta={Browser:ma().name+" "+ma().version,OS:ma().os.toString(),"Screen Size":window.screen.width+"x"+window.screen.height,"Viewport Size":window.innerWidth+"x"+window.innerHeight,"Pixel Ratio":"@"+window.devicePixelRatio+"x","Zoom Level":100*Na.zoomLevel+"%"},Ia=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ja(e,t)}(l,e);var t,n,s,o=wa(l);function l(e){var t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e)).state={tabTitle:Na.tabtitle,tabUrl:Na.taburl,annotateImageUrl:"",saveImageUrl:"",imageBlob:null,info:{},contentType:(n=localStorage.format,"jpg"===n?"image/jpeg":"image/png"),user:{username:"",userType:0,userEmail:"",premiumLevel:""},permissions:{},currentPlan:{},counts:{},step:"edit",isAddDateAndURL:!1,isReported:!1,menuType:Na.menuType},t.enterSave=t.enterSave.bind(ka(t)),t.backToEdit=t.backToEdit.bind(ka(t)),t.refreshUser=t.refreshUser.bind(ka(t)),t.quickReportIssueUrl=t.quickReportIssueUrl.bind(ka(t)),t.reportIssueUrl=t.reportIssueUrl.bind(ka(t)),t}return t=l,n=[{key:"componentDidMount",value:function(){var e=this,t=this.Bg=chrome.extension.getBackgroundPage(),n=localStorage.fileUrls?JSON.parse(localStorage.fileUrls):null,r=t.menuType,i=t.type,a=t.dataURL,s=void 0!==localStorage["after-capture-action"]?localStorage["after-capture-action"]:"true"===localStorage["skip-annotate"]?"skipEntireCapture":"annotate";if(this.state.tabUrl){var o="desktop"===this.state.menuType||"upload"===this.state.menuType?"":this.state.tabUrl;localStorage.tab_url=o,this.setState({tabUrl:o})}else"desktop"!==this.state.menuType&&"upload"!==this.state.menuType&&(o=localStorage.tab_url,this.setState({tabUrl:o}));if(a.length){var l="true"===localStorage["resize-for-retina"];!function(e,t,n,r,i,a,s,o,l,c,d,u,h,p,f,m,g,v){var y,b,x,j,w,S,k,C,N=1,T=document.createElement("canvas"),I=T.getContext("2d"),P=h?da():0,O=!1,D=1,A=0,U=0;function R(){T.width=O?x-2:x,T.height=j}if(u&&window.devicePixelRatio>1&&(N=window.devicePixelRatio),y=c[0].width/N,b=c[0].height/N,k=c[0].width,C=c[0].height,g&&parseInt(g.height)>C+10){O=!0;var _=g.width/k;D=Math.ceil(_),(g=Z(_,g)).height>C&&(g.height=C,g.width=k),p&&(p=Z(_,p)).y+p.height>C&&(p.height=C-p.y),f&&(f=Z(_,f)),"selected"===e&&(i/=_,a/=_,n/=_,r/=_)}function Z(e,t){return t.x=t.x/e,t.y=Math.ceil(t.y/e),t.height=parseInt(t.height/e),t.width=t.width/e+2,t}switch(window.innerWidth*window.devicePixelRatio-16>k&&(P=0),t){case"visible":"selected"===e?(x=i/N,j=a/N,q=n,J=r,C=a,k=i):"desktop"===e||"upload"===e?(x=y,j=b,q=0,J=0):(x=y-P*window.devicePixelRatio,j=b,q=0,J=0,k-=P*window.devicePixelRatio),R(),I.drawImage(c[0],q,J,k,C,0,0,x,j),"jpg"===d?T.toBlob((function(e){v(e,{width:T.width,height:T.height})}),"image/jpeg",1):T.toBlob((function(e){v(e,{width:T.width,height:T.height})}));break;case"entire":var E=U=A=0,B=c.length,z=s,F=Math.round(B/z),M=null,L=null;m&&m.forEach((function(e){e&&e.fill.width>0&&e.fill.height>0&&(0==e.fill.x?M=ca(c[0],e.sample):e.fill.x>0&&(L=ca(c[0],e.sample)))}));var H=function e(t,n,r,i,a,s,o,l,u){if(t){if(p){var h=p.height;0===E?I.drawImage(t,0,0,i,g.height,0,0,i/N,g.height/N):(o=(g.height-D+(E-1)*(h-D))/N,r=p.y,u=h/N,a=h,E===F-1&&(r=p.y+h-w,u=w/N,a=w),I.drawImage(t,p.x,r,p.width,a,p.x/N,o,p.width/N,u),p.x>0&&M&&(I.beginPath(),I.rect(0,o-1,p.x/N,u+1),I.fillStyle=M,I.fill()),p.x+p.width<i&&L&&(I.beginPath(),I.rect((p.x+p.width)/N,o-1,(i-(p.x+p.width))/N,u+1),I.fillStyle=L,I.fill()),E===F-1&&f&&f.height>0&&I.drawImage(c[0],0,f.y,i,f.height,0,o+u,i/N,f.height/N)),E++}else o=E*b,E==F-1&&(r=(b-w)*N,a=(u=w)*N),I.drawImage(t,n,r,i,a,s,o,l,u),++E>F-1&&Y();e(c[++A],n,r,i,a,s,o,l,u)}else"jpg"===d?T.toBlob((function(e){v(e,{width:T.width,height:T.height})}),"image/jpeg",1):T.toBlob((function(e){v(e,{width:T.width,height:T.height})}))},W=function e(t,n,r,i,a,s,o,l,d,u){s=U*y,U==z-1&&(n=y-S,l=S),I.drawImage(t,n,r,i,a,s,o,l,d),U<z-1&&e(c[++U],n,r,i,a,s,o,l,d)},Y=function(){++U>z-1||(U==z-1?(q=y-S,K=x-U*y,$=U*y):(q=0,K=y,$=U*y),J=0,X=b,Q=0,H(c[A=(E=0)+U*F],q,J,k,C,$,Q,K,X))};if(!l.x&&l.y){if(F=B,w=b*o.y,x="selected"==e?i/N:y,p){w=p.height*o.y;var G=p.height,V=g.height;j=w?1===F?V/N:(V+(F>2?(F-2)*G:0)+w)/N:(V+(F-1)*G)/N,f&&f.height>0&&(j+=f.height/N)}else j=w?b*(F-1)+w:b*F;if(j>oa)return void la(c,o.y,N,p,f,m,g,v);R();var q=0,K=y,$=0,J=0,X=b,Q=0;"selected"==e&&n&&(q=n),H(c[A],q,J,k,C,$,Q,K,X)}l.x&&!l.y&&(z=B,S=y*o.x,j="selected"==e?request.centerH:b,x=S?y*(z-1)+S:y*z,R(),q=0,K=y,$=0,J=0,X=b,Q=0,W(c[A],q,J,k,C,$,Q,K,X)),l.x&&l.y&&(S=y*o.x,w=b*o.y,"selected"==e?(x=request.centerW,j=request.centerH):(x=S?y*(z-1)+S:y*z,j=w?b*(F-1)+w:b*F),R(),q=0,K=y,$=0,J=0,X=b,Q=0,H(c[A],q,J,k,C,$,Q,K,X))}}(r,i,t.centerOffX,t.centerOffY,t.centerW,t.centerH,t.counter,t.ratio,t.scrollBar,a,localStorage.format,l,t.contentCanScroll,t.contentClip,t.bottomClip,t.bgRegions,t.topCapturePostion,(function(n,i){if(x(n))var a=n.map((function(e){return URL.createObjectURL(e)}));else a=URL.createObjectURL(n);var o="skipAnnotate"===s||("skipEntireCapture"===s||"true"===localStorage["skip-annotate"])&&"entire"===r||x(n);if(o)if("true"!==localStorage["add-url"]||x(n)){var l={saveImageUrl:a,imageBlob:n,step:o?"save":"edit"};x(n)||setTimeout((function(){var t=new FileReader;t.readAsDataURL(n),t.onloadend=function(){var n=t.result;e.setState({saveImageUrl:n},(function(){t=null}))}}),1200)}else a="desktop"===t.menuType?"":e.state.tabUrl,_(n,i,a,(function(t){var n=t,r=URL.createObjectURL(n);e.setState({imageBlob:n,saveImageUrl:r,info:i,isAddDateAndURL:!0,step:"save"}),setTimeout((function(){var e=new FileReader;e.readAsDataURL(n),e.onloadend=function(){var t=e.result;that.setState({saveImageUrl:t},(function(){e=null}))}}),1200)}));else l={annotateImageUrl:a};e.setState(l),setTimeout((function(){var e=x(n)?n:[n],t=[];e.forEach((function(n,r){pa.save(n,"currentScreenshot"+r+".png").then((function(n){t.push({url:n,index:r}),t.length===e.length&&(t.sort((function(e,t){return e.index-t.index})),localStorage.fileUrls=JSON.stringify(t.map((function(e){return e.url}))),chrome.runtime.sendMessage({action:"clearDataURL"}))}))}))}),1e3)}))}else if(n&&!a.length){if("skipAnnotate"===s||("skipEntireCapture"===s||"true"===localStorage["skip-annotate"])&&"entire"===i||n.length>1)var c={saveImageUrl:n.length>1?n:n[0],step:"save"};else c={annotateImageUrl:n[0]};this.setState(c)}e.refreshUser(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&e.refreshUser()})),chrome.storage.sync.get(["captureCount"],(function(e){e.captureCount?chrome.storage.sync.set({captureCount:(isNaN(parseInt(e.captureCount))?0:parseInt(e.captureCount))+1}):chrome.storage.sync.set({captureCount:1})}))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&z.refreshUser()}))}},{key:"reportIssueUrl",value:function(){var e=this;if(this.state.isReported)a.ZP.warning("You have reported a problem with this page successfully.");else{var t={};t["Extension Version"]=chrome.runtime.getManifest().version,localStorage.last_info&&(t=ya(ya({},t),JSON.parse(localStorage.last_info))),t.Browser||(t.Browser=ma().name+" "+ma().version),t.OS||(t.OS=ma().os.toString()),t["Screen Size"]||(t["Screen Size"]=window.screen.width+"x"+window.screen.height);var n={name:this.state.user.username?this.state.user.username:"user",subject:"Full Page capture Issue",content:function(e,t){var n="";for(var r in n+=e+"<br/><br/><br/><hr>",t)n+="<b>"+r+"</b>: "+t[r]+"<br/>";return n}(this.state.tabTitle+" "+this.state.tabUrl+"\nmenuType: "+Na.menuType,t)};this.state.user.userEmail&&!/privaterelay.appleid.com/.test(this.state.user.userEmail)?n.email=this.state.user.userEmail:n.email="report_fullpage@aws.cn",function(e){return ft({method:"POST",url:"/common/contact_us",data:e})}(n).then((function(t){e.setState({isReported:!0}),i.Z.open({message:"Thank you :)",description:"Your report has been sent successfully. We will look into this and find a solution as soon as possible.",duration:2})})).catch((function(e){a.ZP.warning("Submission failed. Please retry or copy the page's url to send an email to care@awesomescreenshot.com.")}))}}},{key:"quickReportIssueUrl",value:function(){var e=this;r.Z.confirm({title:"Not properly captured?",onOk:function(){e.reportIssueUrl()},okText:"Report",okType:"primary"})}},{key:"refreshUser",value:function(){var e=this;mt().then((function(t){t?t.username===e.state.user.username&&t.type===e.state.user.userType&&t.mail===e.state.user.userEmail&&t.premiumLevel===e.state.user.premiumLevel||(e.setState({user:{username:t.username,userType:t.type,userEmail:t.mail,premiumLevel:t.premiumLevel}}),ft({method:"GET",url:"/user/info"}).then((function(t){e.setState({permissions:t.permissions,currentPlan:t.premium.currentPlan,counts:t.counts})}))):e.setState({user:{username:"",userType:0,userEmail:"",premiumLevel:""},currentPlan:{},permissions:{empty:!0}})}))}},{key:"enterSave",value:function(e,t,n){var r=this;if(window.location.href.match(/gmail=(.*)/)){var i=parseInt(window.location.href.match(/gmail=(.*)/)[1]),a=new FileReader;return a.readAsDataURL(t),void(a.onloadend=function(){var e=a.result;chrome.tabs.sendMessage(i,{action:"insertImage",dataURL:e}),setTimeout((function(){window.close()}),0)})}Object.keys(n.border).length>0?R(t,n,"extension",(function(e){var t=e,i=URL.createObjectURL(t);r.setState({imageBlob:t,saveImageUrl:i,info:n,step:"save"}),setTimeout((function(){var e=new FileReader;e.readAsDataURL(t),e.onloadend=function(){var t=e.result;r.setState({saveImageUrl:t},(function(){e=null}))}}),1200)})):"true"!==localStorage["add-url"]||r.state.isAddDateAndURL?(r.setState({imageBlob:t,saveImageUrl:e,info:n,step:"save"}),setTimeout((function(){var e=new FileReader;e.readAsDataURL(t),e.onloadend=function(){var t=e.result;r.setState({saveImageUrl:t},(function(){e=null}))}}),1200)):(e="desktop"===Na.menuType?"":this.state.tabUrl,_(t,n,e,(function(e){var t=e,i=URL.createObjectURL(t);r.setState({imageBlob:t,saveImageUrl:i,info:n,step:"save"}),setTimeout((function(){var e=new FileReader;e.readAsDataURL(t),e.onloadend=function(){var t=e.result;r.setState({saveImageUrl:t},(function(){e=null}))}}),1200)})))}},{key:"backToEdit",value:function(){var e={step:"edit"};this.state.annotateImageUrl||(e.annotateImageUrl=this.state.saveImageUrl),this.setState(e)}},{key:"render",value:function(){var e=F()("sub-page",{active:"edit"===this.state.step}),t=F()("sub-page",{active:"save"===this.state.step});return chrome.extension.getBackgroundPage(),this.state.saveImageUrl||this.state.annotateImageUrl?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Je,{imageUrl:this.state.annotateImageUrl,handleFinishEdit:this.enterSave,permissions:this.state.permissions,className:e,type:"ext",contentType:this.state.contentType,isReported:this.state.isReported,menuType:this.state.menuType,tabUrl:this.state.tabUrl,quickReport:this.quickReportIssueUrl}),(0,v.jsx)(sa,{user:this.state.user,backToEdit:this.backToEdit,imageUrl:this.state.saveImageUrl,imageBlob:this.state.imageBlob,tabTitle:this.state.tabTitle,tabUrl:this.state.tabUrl,info:this.state.info,imageInfo:Ta,refreshUser:this.refreshUser,step:this.state.step,className:t,permissions:this.state.permissions,currentPlan:this.state.currentPlan,contentType:this.state.contentType,isReported:this.state.isReported,menuType:this.state.menuType,quickReport:this.quickReportIssueUrl,counts:this.state.counts})]}):(0,v.jsx)("div",{className:"loading-page",children:(0,v.jsxs)("div",{className:"center",children:[(0,v.jsx)("div",{className:"loading-spinner",children:(0,v.jsxs)("div",{className:"spinner",children:[(0,v.jsx)("div",{className:"rect1"}),(0,v.jsx)("div",{className:"rect2"}),(0,v.jsx)("div",{className:"rect3"}),(0,v.jsx)("div",{className:"rect4"}),(0,v.jsx)("div",{className:"rect5"})]})}),(0,v.jsxs)("div",{className:"brand",children:[(0,v.jsx)("div",{className:"logo"}),"AWESOME SCREENSHOT"]})]})})}}],n&&xa(t.prototype,n),s&&xa(t,s),l}(s.Component);o.render((0,v.jsx)(Ia,{}),document.getElementById("edit-page"))}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={id:e,loaded:!1,exports:{}};return a[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=a,e=[],o.O=(t,n,r,i)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,r,i]=e[d],s=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(s=!1,i<a&&(a=i));if(s){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,r,i]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var i=Object.create(null);o.r(i);var a={};t=t||[null,n({}),n([]),n(n)];for(var s=2&r&&e;"object"==typeof s&&!~t.indexOf(s);s=n(s))Object.getOwnPropertyNames(s).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,o.d(i,a),i},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,n)=>(o.f[n](e,t),t)),[])),o.u=e=>"javascripts/bundles/"+e+".bundle.js",o.miniCssF=e=>"stylesheets/bundles/"+(922===e?"edit":e)+".bundle.css",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},i="awesomescreenshot-front:",o.l=(e,t,n,a)=>{if(r[e])r[e].push(t);else{var s,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==i+n){s=u;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.setAttribute("data-webpack",i+n),s.src=e),r[e]=[t];var h=(t,n)=>{s.onerror=s.onload=null,clearTimeout(p);var i=r[e];if(delete r[e],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(n))),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),l&&document.head.appendChild(s)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e+"../../"})(),(()=>{var e={922:0};o.f.j=(t,n)=>{var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=i);var a=o.p+o.u(t),s=new Error;o.l(a,(n=>{if(o.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",s.name="ChunkLoadError",s.type=i,s.request=a,r[1](s)}}),"chunk-"+t,t)}},o.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[a,s,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(l)var d=l(o)}for(t&&t(n);c<a.length;c++)i=a[c],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(d)},n=self.webpackChunkawesomescreenshot_front=self.webpackChunkawesomescreenshot_front||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),o.O(void 0,[831,377,100,760,618,247,509,163,808,672,384,795,140,15,441,0],(()=>o(33505)));var l=o.O(void 0,[831,377,100,760,618,247,509,163,808,672,384,795,140,15,441,0],(()=>o(99830)));l=o.O(l)})();