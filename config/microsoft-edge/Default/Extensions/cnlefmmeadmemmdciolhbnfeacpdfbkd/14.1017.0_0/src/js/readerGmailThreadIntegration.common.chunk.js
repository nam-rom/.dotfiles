(self.webpackChunk=self.webpackChunk||[]).push([[9561],{64078:(e,t,n)=>{n.d(t,{X:()=>S});var i,a=n(59312),o=n(27378),s=n(57050),r=n(19962),l=n(5114),d=n(44060),c=n(67424),m=n(89894),u=n(32096),p=n(40327),h=n(5739),g=n(98403),f=n(49708),v=n(85985),b=n(41398),y=n(24209),_=n(17343),I=n(38194),w=n(598),x=n(50628),E=n(25781),k=n(83078),U=n(18625);!function(e){var t="scrollaction";e.emit=function(e){return self.dispatchEvent(new CustomEvent(t,{detail:e}))},e.observe=U.P((function(){return f.R(self,t)}))}(i||(i={}));var N=n(42103),C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subs=[],t._outOfTarget=function(e){return function(t){return!r.UL.hasPoint(t.getBoundingClientRect(),e)}},t}return(0,a.ZT)(t,e),t.prototype.componentDidMount=function(){this._listenTooltipAppearance()},t.prototype.componentWillUnmount=function(){this._subs.forEach((function(e){return e.unsubscribe()})),this._subs=[],this.context.hide()},t.prototype.render=function(){return o.createElement(h.F.div,{"data-role":"tooltip"},this.context.state.view(this.props.children))},t.prototype._listenTooltipAppearance=function(){var e=this,t=f.R(document,"keydown").pipe(v.h((function(e){return e.keyCode===E.R.ESC_CODE}))),n=f.R(document,"mousedown").pipe(b.M(this.context.state),v.h((function(t){var n=t[0],i=t[1];return(0,p.pipe)(i,l.map((function(e){return e.target})),l.filter((function(){return r.pK(n.target)})),k.wo(e._outOfTarget({x:n.clientX,y:n.clientY})))}))),a=y.T(t,n,f.R(document,"scroll"),i.observe.pipe(v.h((function(e){return"show"===e.detail})))).pipe(_.h(g.PU),I.B());this._subs=[this.context.hasContent.pipe(v.h(Boolean),w.c(a.pipe(x.P()))).subscribe(this.context.hide),this.context.hasContent.pipe(v.h(Boolean),w.c(y.T(g.gw(!0,500),a.pipe(_.h(!1))).pipe(x.P())),v.h(Boolean)).subscribe(this.context.show)]},t.contextType=N.G.Context,t}(o.Component),S=function(){return o.createElement(C,null,(0,s.ls)(l.map((function(e){return o.createElement(c.t.ByAbsoluteRect,(0,a.pi)({rect:r.UL.fromEl(e.target),className:M.container},c.t.Alignment.toSelector(e.alignment),{withPin:!0}),o.createElement("div",{className:M.content},e.content))})),l.toNullable))},G={position:"fixed",zIndex:u.DY,pointerEvents:"none",$nest:{"@media print":{visibility:"hidden"}}},z={padding:"".concat(m.ux.rem(.25)," ").concat(m.ux.rem(1)),borderRadius:m.ux.rem(u.fx),background:d.Il.BackgroundTooltip,color:d.Il.CoreNeutral1,textAlign:"center",whiteSpace:"nowrap",letterSpacing:m.ux.px(.25),fontSize:m.ux.rem(.75),lineHeight:m.ux.rem(1)},M=m.ux.stylesheet({container:[G],content:[z]})},32182:(e,t,n)=>{n.r(t),n.d(t,{createReaderGmailThreadIntegration:()=>go});var i,a=n(17771),o=n(57050),s=n(64015),r=n(48044),l=n(45614),d=n(29511),c=n(34379),m=n(91625),u=n(70631),p=n(8125),h=n(5114);!function(e){e.overview="overview",e.coreUserJourney="coreUserJourney",e.pinning="pinning"}(i||(i={}));const g=[i.overview,i.coreUserJourney,i.pinning];function f(e){return"messageView"===e.kind}function v(e){return"pinnedView"===e.kind}function b(e){return"onboardingView"===e.kind}function y(e){return"messageView"===e.kind&&u.d6(e.message)&&(0,o.zG)(e.summary,h.map((0,p.Kg)(u.d6,u.VZ,u.IR)),h.getOrElse(o.W8))&&(0,o.zG)(e.questions,h.map((0,p.Kg)(u.d6,u.VZ,u.IR)),h.getOrElse(o.W8))&&(0,o.zG)(e.peopleAndLinks,h.map((0,p.Kg)(u.d6,u.VZ,u.IR)),h.getOrElse(o.W8))}function _(e){return"expanded"===e.kind}var I=n(77176),w=n(16027),x=n(27378),E=n(76974),k=n(23556),U=n(90845),N=n(22232),C=n(5739);const S={onboarding:{optInButton:"Try it out",optOutButton:"No, thanks",badge:"NEW",stepOfN:e=>`${e} OF 3`,overview:{phase0:{title:"Introducing email recaps",body:"Now Grammarly can automatically summarize key points to help you reply faster."},phase1:{title:"Introducing email recaps",body:"Now Grammarly can automatically summarize key points and follow-up actions."},phase2:{title:"Introducing email recaps",body:"Now Grammarly can automatically recap key points and help you decide whether you need to reply."},videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-overview.gif"},coreUserJourney:{title:"Reply faster",body:"Everything you need at your fingertips. Focus on writing, not hunting for details.",videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-core-user-journey.gif"},pinning:{title:"Choose what's important",body:"Pin key points and things to follow up on while you're reading.",videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-pinning.gif"}},expandedPanel:{viewButton:{thread:"Messages",pins:"Pinned"},goLeftIconTooltip:"Previous message",goRightIconTooltip:"Next message",jumpFirstIconTooltip:"Jump to first message",jumpLastIconTooltip:"Jump to last message",copyIconTooltip:"Copy",pinIconTooltip:"Add pin",unpinIconTooltip:"Remove pin",dismissIconTooltip:"Dismiss",threadView:{summary:{title:"Summary",emptyTitle:"No items found",errorTitle:"No items found"},needsResponse:{title:"Follow-ups",emptyTitle:"No follow-ups found",errorTitle:"No follow-ups found"},peopleAndLinks:{title:"Mentions",emptyTitle:"No mentions found",errorTitle:"No mentions found"}},pinnedView:{summary:{title:"Summary",emptyTitle:"Nothing pinned yet",emptyBody:"Pin important summary items to find them more easily.",emptyCTA:"Return to Messages tab"},needsResponse:{title:"Follow-ups",emptyTitle:"Nothing pinned yet",emptyBody:"Pin follow-ups to find them more easily.",emptyCTA:"Return to Messages tab"},peopleAndLinks:{title:"Mentions",emptyTitle:"Nothing pinned yet",emptyBody:"Pin mentioned items to find them more easily.",emptyCTA:"Return to Messages tab"}}},collapseIconTooltip:"Hide email recap",expandIconTooltip:"Open email recap",recapExpandTooltip:"Open email recap",recapCollapseTooltip:"Hide email recap"};var G=n(64908),z=n(22667),M=n(86705),T=n(53112),A=n(64757),F=n(58120);const P=({onClick:e,title:t,browser:n})=>x.createElement(A.zx.Flat,{className:F.recapButton,onClick:e,name:"recap-button",title:t},x.createElement(z.K,{size:22.4,className:F.logo}),x.createElement(O,null),x.createElement(M.v,{browser:n})),O=({color:e=T.Z.neutral70})=>x.createElement("svg",{width:"44",height:"10",viewBox:"0 0 44 10",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":"Recap",className:F.recap},x.createElement("path",{d:"M0 9.54578V0.454902H3.92401C4.53474 0.441273 5.14052 0.567287 5.69515 0.823335C6.18417 1.05365 6.59476 1.42255 6.8759 1.88423C7.168 2.38768 7.31401 2.96257 7.29756 3.54439C7.31546 4.10697 7.17223 4.66295 6.88473 5.14684C6.61248 5.58484 6.21939 5.93477 5.75281 6.15448L7.5994 9.54578H4.9183L3.32033 6.5451H2.46806V9.54578H0ZM2.46804 4.62749H3.33804C3.69403 4.64717 4.04783 4.56065 4.35456 4.37891C4.48182 4.28258 4.58244 4.1554 4.6469 4.00939C4.71137 3.86337 4.73756 3.70334 4.723 3.54439C4.73683 3.38295 4.71041 3.22059 4.64612 3.07185C4.58182 2.92312 4.48164 2.79264 4.35456 2.69212C4.05216 2.49864 3.69646 2.40545 3.33804 2.42578H2.46804V4.62749Z",fill:e}),x.createElement("path",{d:"M8.85059 9.5458V0.454918H15.4024V2.44356H11.3187V4.00606H15.0651V5.99469H11.3187V7.55719H15.3847V9.5458H8.85059Z",fill:e}),x.createElement("path",{d:"M25.1719 3.86399H22.6684C22.6488 3.48459 22.4872 3.12646 22.2156 2.8608C22.0648 2.72733 21.8892 2.6249 21.6988 2.5594C21.5084 2.49389 21.3069 2.46658 21.1059 2.47905C20.8315 2.46406 20.5576 2.51745 20.3089 2.63444C20.0602 2.75143 19.8445 2.92836 19.681 3.14933C19.3227 3.69763 19.15 4.34649 19.1883 5.00036C19.1409 5.66688 19.3157 6.33031 19.6854 6.8869C19.8521 7.09645 20.0662 7.26331 20.3101 7.37369C20.5541 7.48407 20.8208 7.53479 21.0882 7.52167C21.4779 7.542 21.862 7.42235 22.1713 7.18431C22.4451 6.94828 22.6221 6.61948 22.6684 6.26097L25.1719 6.27873C25.1359 6.68719 25.0261 7.08574 24.8479 7.45505C24.4293 8.33025 23.6927 9.01287 22.7883 9.36375C22.1411 9.60001 21.4525 9.70142 20.7647 9.66174C20.0769 9.62206 19.4045 9.44212 18.7888 9.133C18.1238 8.76993 17.5792 8.22072 17.2218 7.5527C16.8183 6.76399 16.6213 5.88584 16.6493 5.00033C16.62 4.11171 16.8219 3.23071 17.2352 2.44351C17.5977 1.77593 18.1468 1.22837 18.8154 0.867676C19.4982 0.504684 20.2616 0.319939 21.0348 0.330567C21.7374 0.318011 22.4343 0.458893 23.0768 0.743384C23.6602 1.00422 24.1608 1.42034 24.5238 1.94633C24.906 2.51684 25.1296 3.17864 25.1719 3.86399Z",fill:e}),x.createElement("path",{d:"M28.3137 9.5458H25.6504L28.6511 0.454918H32.0246L35.0254 9.5458H32.3621L31.8382 7.8058H28.8375L28.3137 9.5458ZM29.3968 5.95918H31.2789L30.3734 2.95847H30.3024L29.3968 5.95918Z",fill:e}),x.createElement("path",{d:"M36.2773 9.54575V0.454869H40.2013C40.8155 0.440928 41.4237 0.578119 41.9724 0.854376C42.4653 1.10813 42.8751 1.49788 43.1532 1.97742C43.4429 2.49314 43.5886 3.07729 43.5749 3.66865C43.5901 4.26188 43.4394 4.84758 43.1399 5.35988C42.852 5.83714 42.4307 6.21979 41.9281 6.46071C41.3612 6.72892 40.7395 6.86116 40.1125 6.8469H38.7453V9.54573L36.2773 9.54575ZM38.7453 4.9293H39.6153C39.9848 4.95083 40.3486 4.83012 40.6319 4.59194C40.7558 4.47337 40.8528 4.32958 40.9164 4.1703C40.9799 4.01102 41.0086 3.83995 41.0003 3.66865C41.0097 3.49854 40.9816 3.32845 40.9179 3.17043C40.8542 3.0124 40.7566 2.87032 40.6319 2.75423C40.3461 2.52145 39.9833 2.40425 39.6153 2.42575H38.7453V4.9293Z",fill:e})),V=({onShow:e,children:t})=>(U.P.useEffectOnDidMount(e),x.createElement("div",{className:G.panelGrid},t)),R=w.UI.Grid.make((({state:e,slots:t,notify:n})=>x.createElement(V,{onShow:n("panelMounted")},x.createElement(C.F.Fragment,null,x.createElement(C.F.div,{className:G.header},x.createElement(C.F.Fragment,null,e.pipe(I.U((({expanded:e,browser:t})=>x.createElement(P,{onClick:n(e?"collapse":"expand"),title:e?S.recapCollapseTooltip:S.recapExpandTooltip,browser:t}))))),t.header,t.toolbar),t.content))));function B(e){return w.Z.fromSideEffect((t=>{switch(t){case"collapse":e.recapCollapseButtonClick();break;case"expand":e.recapExpandButtonClick();break;case"panelMounted":e.panelShow();break;default:(0,N.vE)(t)}}),e.state.pipe(I.U((t=>({expanded:_(t),browser:e.browser})))))}var H=n(61922),D=n(64051);const j=w.UI.Node.make((({state:e,notify:t})=>x.createElement(C.F.div,{className:D.alignRight},e.pipe(I.U((e=>x.createElement(A.zx.Ghost,{onClick:t(e?"collapse":"expand"),name:"toggle-panel-button",title:e?S.collapseIconTooltip:S.expandIconTooltip},x.createElement(H.JO.Arrow,{direction:e?H.n4.up:H.n4.down}))))))));function L(e){return w.Z.fromSideEffect((t=>{switch(t){case"expand":e.expandButtonClick();break;case"collapse":e.collapseButtonClick();break;default:(0,N.vE)(t)}}),e.state.pipe(I.U(_)))}const Z=w.UI.Knot.make(R,{header:w.UI.Node.make((()=>x.createElement("div",{className:k.header}))),toolbar:j,content:w.UI.Node.empty});function q(e){return w.Z.composeKnot({root:B(e),header:()=>E.of(null),toolbar:L(e),content:()=>E.of(null)})}var Q=n(85985),K=n(12187),$=n(83771);const J=(0,K.xb)((({children:e})=>x.createElement("h6",{className:$.sectionTitle},e))),W=e=>w.UI.Grid.make((({slots:t})=>x.createElement(C.F.div,{className:$.column,style:{flex:e}},x.createElement(J,null,t.title),t.content))),Y=w.UI.Grid.make((({slots:e})=>x.createElement("div",{className:$.layout},e.summary,e.questions,e.peopleAndLinks))),X=350,ee=307,te=266,ne=150,ie=150,ae=500;var oe=n(26328),se=n(47397);const re=({title:e,children:t})=>x.createElement("div",{className:se.empty},x.createElement("div",{className:se.title},e),x.createElement("div",{className:se.body},t));var le=n(31846);const de=({src:e,name:t})=>{const[n,i]=x.useState(!1);return e&&!n?x.createElement("img",{src:e,className:le.image,onError:()=>i(!0)}):x.createElement("div",{className:le.avatar,style:{backgroundColor:T.Z.neutral40}},t?function(e){return(e.split(/\s+/)[0][0]||"").toUpperCase()}(t):"?")};var ce=n(50243);const me=({children:e})=>x.createElement("ul",{className:ce.list},e);var ue=n(3179),pe=n(20855),he=n(18813),ge=n(60550);function fe(){return w.UI.Grid.make((({state:e,slots:t,notify:n})=>x.createElement(C.F.li,{...(0,K.Sh)(ge.item,e.pipe(I.U((e=>e.item.pinned)),I.U((0,p.RN)(ge.pinned,void 0)))),tabIndex:-1},x.createElement(he.L,{name:"dropdown",appearanceBehavior:"mouseHover",vAlign:"top",align:"right",showDelay:ne,closeDelay:ie,label:x.createElement(C.F.Fragment,null,t.title,t.item),theme:{dropdownList:ge.dropdownList,dropdownContainer:ge.dropdownContainer}},x.createElement(C.F.Fragment,null,e.pipe(I.U((({item:e,clipboardSupported:t})=>x.createElement(x.Fragment,null,x.createElement(ve,{title:S.expandedPanel.copyIconTooltip},x.createElement(A.zx.Flat,{name:"copy-button",className:ge.button,onClick:n({kind:"copy",item:e}),disabled:!t},x.createElement(H.JO.Copy,null))),x.createElement(ve,{title:e.pinned?S.expandedPanel.unpinIconTooltip:S.expandedPanel.pinIconTooltip},x.createElement(A.zx.Flat,{name:"star-button",className:ge.button,onClick:n({kind:"pin",item:e,pinned:!e.pinned}),active:e.pinned},x.createElement(H.JO.Pin,null))),x.createElement(ve,{title:S.expandedPanel.dismissIconTooltip},x.createElement(A.zx.Flat,{name:"remove-button",className:ge.button,onClick:n({kind:"dismiss",item:e})},x.createElement(H.JO.Ignore,null))))))))))))}const ve=({children:e,title:t})=>x.createElement(pe.u,{message:t,showDelay:ae},x.createElement("div",null,e));var be=n(69566);const ye=({title:e})=>x.createElement(C.F.div,{className:be.title},e),_e=w.UI.Node.make((({state:e})=>x.createElement(C.F.Fragment,null,e.pipe(I.U((({name:e,email:t,avatarUrl:n})=>x.createElement("div",{className:ue.personAndAvatar},x.createElement(de,{name:e,src:h.toUndefined(n)}),x.createElement("span",{className:ue.nameOrEmail},null!=e?e:t)))))))),Ie=w.UI.Knot.make(fe(),{item:_e,title:w.UI.Union.asOption(w.UI.Node.make((({state:e})=>x.createElement(ye,{title:e}))))}),we=w.UI.List.make(s.Bk,Ie),xe=w.UI.Grid.make((({slots:e})=>x.createElement(me,null,x.createElement(C.F.Fragment,null,e.people,e.links)))),Ee=w.UI.Knot.make(xe,{people:we,links:w.UI.Node.empty});function ke(e,t,n){return w.Z.composeKnot({people:w.Z.fromSideEffect((t=>{const n=t.action.action;switch(n.kind){case"copy":e.copyPersonItem(n.item);break;case"dismiss":e.dismissPersonItem(n.item);break;case"pin":e.pinPersonItem(n.item,n.pinned);break;default:(0,N.vE)(n)}}),t.pipe(I.U((t=>t.map((t=>({item:t,title:n(t),root:{item:t,clipboardSupported:e.isClipboardSupported}}))))))),links:()=>E.of(null)})}var Ue=n(45587);const Ne={lineAndAvatar:Ue.lineAndAvatar,lineAndCheckbox:Ue.lineAndCheckbox,lineOnly:Ue.lineOnly},Ce=({lineCount:e,type:t,className:n})=>x.createElement("div",{className:n},[...Array(e).keys()].map((e=>x.createElement("div",{...(0,K.Sh)(Ue.itemLoading,Ne[t]),key:e},x.createElement("div",{className:Ue.rect}),x.createElement("div",{className:Ue.line}))))),Se=w.UI.Union.make("_tag",{None:w.UI.Node.make((()=>x.createElement(re,{title:S.expandedPanel.threadView.peopleAndLinks.emptyTitle}))),Some:Ee}),Ge=w.UI.Node.make((()=>x.createElement(Ce,{type:"lineAndAvatar",lineCount:2}))),ze=w.UI.Node.make((()=>x.createElement(re,{title:S.expandedPanel.threadView.peopleAndLinks.errorTitle}))),Me=w.UI.Union.make("type",{InProgress:Ge,Fatal:ze,Error:ze,Success:Se});function Te(e){const t=e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(f),I.U((e=>e.peopleAndLinks)),Q.h(h.isSome),I.U((e=>e.value))),n=t.pipe(Q.h(u.d6),I.U((e=>e.value.people)));return w.Z.composeUnion({InProgress:()=>E.of(null),Error:()=>E.of(null),Fatal:()=>E.of(null),Success:w.Z.composeUnion({None:()=>E.of(null),Some:ke(e,n,(()=>h.none))},(()=>(0,o.zG)(n,I.U(oe.nI))))},(()=>t))}var Ae=n(31944),Fe=n(11071);const Pe=w.UI.Node.make((({state:e,notify:t})=>x.createElement(C.F.Fragment,null,e.pipe(I.U((e=>x.createElement(Ae.J,{checked:e.checked,labelId:`question-item-${e.itemId}`,className:Fe.checkboxWrapper,checkboxClassName:Fe.checkbox,labelClassName:Fe.label,onChange:n=>t({checked:n,item:e})()},x.createElement("div",{className:e.checked?Fe.textChecked:void 0},e.text)))))))),Oe=w.UI.Knot.make(fe(),{item:Pe,title:w.UI.Union.asOption(w.UI.Node.make((({state:e})=>x.createElement(ye,{title:e}))))}),Ve=w.UI.List.make(s.Bk,Oe),Re=w.UI.Group.make({value:w.UI.Composite.make(w.UI.Grid.make((({slots:e})=>x.createElement(me,null,x.createElement(C.F.Fragment,null,e.questions)))),Ve)});function Be(e,t,n){return w.Z.composeKnot({value:w.Z.fromSideEffect((t=>{const n=t.action;if("item"===n.key)e.checkQuestionItem(n.action.item,n.action.checked);else if("root"===n.key){const t=n.action;switch(t.kind){case"copy":e.copyQuestionItem(t.item);break;case"dismiss":e.dismissQuestionItem(t.item);break;case"pin":e.pinQuestionItem(t.item,t.pinned);break;default:(0,N.vE)(t)}}else(0,N.vE)(n)}),t.pipe(I.U((t=>t.map((t=>({item:t,title:n(t),root:{item:t,clipboardSupported:e.isClipboardSupported}})))))))})}const He=w.UI.Union.make("_tag",{None:w.UI.Node.make((()=>x.createElement(re,{title:S.expandedPanel.threadView.needsResponse.emptyTitle}))),Some:Re}),De=w.UI.Node.make((()=>x.createElement(Ce,{type:"lineAndCheckbox",lineCount:2}))),je=w.UI.Node.make((()=>x.createElement(re,{title:S.expandedPanel.threadView.needsResponse.errorTitle}))),Le=w.UI.Union.make("type",{InProgress:De,Error:je,Fatal:je,Success:He});function Ze(e){const t=e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(f),I.U((e=>e.questions)),Q.h(h.isSome),I.U((e=>e.value))),n=t.pipe(Q.h(u.d6),I.U((e=>e.value)));return w.Z.composeUnion({InProgress:()=>E.of(null),Error:()=>E.of(null),Fatal:()=>E.of(null),Success:w.Z.composeUnion({None:()=>E.of(null),Some:Be(e,n,(()=>h.none))},(()=>(0,o.zG)(n,I.U(oe.nI))))},(()=>t))}const qe=w.UI.Knot.make(fe(),{item:w.UI.Node.make((({state:e})=>x.createElement(C.F.div,null,e))),title:w.UI.Union.asOption(w.UI.Node.make((({state:e})=>x.createElement(ye,{title:e}))))}),Qe=w.UI.List.make(s.Bk,qe),Ke=w.UI.Group.make({value:w.UI.Composite.make(w.UI.Grid.make((({slots:e})=>x.createElement(me,null,x.createElement(C.F.Fragment,null,e.summaries)))),Qe)});function $e(e,t,n){return w.Z.composeKnot({value:w.Z.fromSideEffect((t=>{const n=t.action.action;switch(n.kind){case"copy":e.copySummaryItem(n.item);break;case"dismiss":e.dismissSummaryItem(n.item);break;case"pin":e.pinSummaryItem(n.item,n.pinned);break;default:(0,N.vE)(n)}}),t.pipe(I.U((t=>t.map((t=>({item:t.text,title:n(t),root:{item:t,clipboardSupported:e.isClipboardSupported}})))))))})}var Je=n(48789);const We=w.UI.Union.make("_tag",{None:w.UI.Node.make((()=>x.createElement(re,{title:S.expandedPanel.threadView.summary.emptyTitle}))),Some:Ke}),Ye=w.UI.Node.make((()=>x.createElement(re,{title:S.expandedPanel.threadView.summary.errorTitle}))),Xe=w.UI.Node.make((()=>x.createElement(Ce,{className:Je.loader,type:"lineOnly",lineCount:2}))),et=w.UI.Union.make("type",{InProgress:Xe,Error:Ye,Fatal:Ye,Success:We});function tt(e){const t=e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(f),I.U((e=>e.summary)),Q.h(h.isSome),I.U((e=>e.value))),n=t.pipe(Q.h(u.d6),I.U((e=>e.value)));return w.Z.composeUnion({InProgress:()=>E.of(null),Error:()=>E.of(null),Fatal:()=>E.of(null),Success:w.Z.composeUnion({None:()=>E.of(null),Some:$e(e,n,(()=>h.none))},(()=>(0,o.zG)(n,I.U(oe.nI))))},(()=>t))}const nt=w.UI.Knot.make(W(X),{content:et,title:w.UI.Node.make((()=>x.createElement("span",null,S.expandedPanel.threadView.summary.title)))}),it=w.UI.Knot.make(W(ee),{content:Le,title:w.UI.Node.make((()=>x.createElement("span",null,S.expandedPanel.threadView.needsResponse.title)))}),at=w.UI.Knot.make(W(te),{content:Me,title:w.UI.Node.make((()=>x.createElement("span",null,S.expandedPanel.threadView.peopleAndLinks.title)))}),ot=w.UI.Union.asOption(nt),st=w.UI.Union.asOption(it),rt=w.UI.Union.asOption(at),lt=w.UI.Knot.make(Y,{summary:ot,questions:st,peopleAndLinks:rt});function dt(e){const t=e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(f));return w.Z.composeKnot({summary:w.Z.composeUnion({Some:w.Z.composeKnot({value:w.Z.composeKnot({content:tt(e),title:()=>E.of(null)})}),None:()=>E.of(null)},(()=>t.pipe(I.U((e=>e.summary))))),questions:w.Z.composeUnion({Some:w.Z.composeKnot({value:w.Z.composeKnot({content:Ze(e),title:()=>E.of(null)})}),None:()=>E.of(null)},(()=>t.pipe(I.U((e=>e.questions))))),peopleAndLinks:w.Z.composeUnion({Some:w.Z.composeKnot({value:w.Z.composeKnot({content:Te(e),title:()=>E.of(null)})}),None:()=>E.of(null)},(()=>t.pipe(I.U((e=>e.peopleAndLinks)))))})}var ct=n(37896);function mt(e){if("parsedDate"===e.kind){const t=new Date(e.timestamp);return`${ct.Rb[t.getMonth()]} ${t.getDate()}`}return e.date}var ut=n(79579);const pt=w.UI.Union.make("_tag",{None:w.UI.Node.make((({notify:e})=>x.createElement(re,{title:S.expandedPanel.pinnedView.peopleAndLinks.emptyTitle},S.expandedPanel.pinnedView.peopleAndLinks.emptyBody,x.createElement(A.zx.Ghost,{onClick:e("showMessages"),name:"pinned-mentions-empty-cta",className:ut.emptyCTAButton},S.expandedPanel.pinnedView.peopleAndLinks.emptyCTA)))),Some:Ee});function ht(e){const t=e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(v),I.U((e=>e.peopleAndLinks)),Q.h(h.isSome),I.U((e=>e.value))).pipe(I.U((e=>e.people)));return w.Z.composeUnion({None:w.Z.fromSideEffect((t=>{switch(t){case"showMessages":e.openMessageView("emptyPinnedMentions");break;default:(0,N.vE)(t)}}),null),Some:ke(e,t,(e=>(0,o.zG)(e.messagePinnedFrom,h.map((e=>{var t;return`From ${null!==(t=e.author.name)&&void 0!==t?t:e.author.email}, ${mt(e.date)}`})))))},(()=>(0,o.zG)(t,I.U(oe.nI))))}const gt=w.UI.Union.make("_tag",{None:w.UI.Node.make((({notify:e})=>x.createElement(re,{title:S.expandedPanel.pinnedView.needsResponse.emptyTitle},S.expandedPanel.pinnedView.needsResponse.emptyBody,x.createElement(A.zx.Ghost,{onClick:e("showMessages"),name:"pinned-follow-ups-empty-cta",className:ut.emptyCTAButton},S.expandedPanel.pinnedView.needsResponse.emptyCTA)))),Some:Re});function ft(e){const t=e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(v),I.U((e=>e.questions)),Q.h(h.isSome),I.U((e=>e.value)));return w.Z.composeUnion({None:w.Z.fromSideEffect((t=>{switch(t){case"showMessages":e.openMessageView("emptyPinnedFollowUps");break;default:(0,N.vE)(t)}}),null),Some:Be(e,t,(e=>{var t;return h.some(`From ${null!==(t=e.message.author.name)&&void 0!==t?t:e.message.author.email}, ${mt(e.message.date)}`)}))},(()=>(0,o.zG)(t,I.U(oe.nI))))}const vt=w.UI.Union.make("_tag",{None:w.UI.Node.make((({notify:e})=>x.createElement(re,{title:S.expandedPanel.pinnedView.summary.emptyTitle},S.expandedPanel.pinnedView.summary.emptyBody,x.createElement(A.zx.Ghost,{onClick:e("showMessages"),name:"pinned-summary-empty-cta",className:ut.emptyCTAButton},S.expandedPanel.pinnedView.summary.emptyCTA)))),Some:Ke});function bt(e){const t=e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(v),I.U((e=>e.summaryItems)),Q.h(h.isSome),I.U((e=>e.value)));return w.Z.composeUnion({None:w.Z.fromSideEffect((t=>{switch(t){case"showMessages":e.openMessageView("emptyPinnedSummaries");break;default:(0,N.vE)(t)}}),null),Some:$e(e,t,(e=>{var t;return h.some(`From ${null!==(t=e.message.author.name)&&void 0!==t?t:e.message.author.email}, ${mt(e.message.date)}`)}))},(()=>(0,o.zG)(t,I.U(oe.nI))))}const yt=w.UI.Knot.make(W(X),{content:vt,title:w.UI.Node.make((()=>x.createElement("span",null,S.expandedPanel.pinnedView.summary.title)))}),_t=w.UI.Knot.make(W(ee),{content:gt,title:w.UI.Node.make((()=>x.createElement("span",null,S.expandedPanel.pinnedView.needsResponse.title)))}),It=w.UI.Knot.make(W(te),{content:pt,title:w.UI.Node.make((()=>x.createElement("span",null,S.expandedPanel.pinnedView.peopleAndLinks.title)))}),wt=w.UI.Union.asOption(yt),xt=w.UI.Union.asOption(_t),Et=w.UI.Union.asOption(It),kt=w.UI.Knot.make(Y,{summary:wt,questions:xt,peopleAndLinks:Et});function Ut(e){const t=e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(v));return w.Z.composeKnot({summary:w.Z.composeUnion({Some:w.Z.composeKnot({value:w.Z.composeKnot({content:bt(e),title:()=>E.of(null)})}),None:()=>E.of(null)},(()=>t.pipe(I.U((e=>e.summaryItems))))),questions:w.Z.composeUnion({Some:w.Z.composeKnot({value:w.Z.composeKnot({content:ft(e),title:()=>E.of(null)})}),None:()=>E.of(null)},(()=>t.pipe(I.U((e=>e.questions))))),peopleAndLinks:w.Z.composeUnion({Some:w.Z.composeKnot({value:w.Z.composeKnot({content:ht(e),title:()=>E.of(null)})}),None:()=>E.of(null)},(()=>t.pipe(I.U((e=>e.peopleAndLinks)))))})}const Nt=w.UI.Union.make("kind",{messageView:lt,pinnedView:kt});function Ct(e){return w.Z.composeUnion({messageView:dt(e),pinnedView:Ut(e)},(()=>e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h((0,p.Kg)(v,f)))))}var St=n(37903),Gt=n(89739);const zt=w.UI.Node.make((({view:e})=>x.createElement("div",{className:Gt.activeMailInfo},x.createElement(C.F.span,{className:Gt.date},e("date").pipe(I.U(mt))),x.createElement(C.F.span,{className:Gt.author},e("author").pipe(I.U((e=>{var t;return null!==(t=e.name)&&void 0!==t?t:e.email}))))))),Mt=w.UI.Node.make((()=>x.createElement("div",{className:Gt.activeMailInfo},"Loading..."))),Tt=w.UI.Union.make("type",{InProgress:Mt,Success:zt,Fatal:w.UI.Node.make((()=>x.createElement("div",{className:Gt.activeMailInfo}))),Error:w.UI.Node.make((()=>x.createElement("div",{className:Gt.activeMailInfo})))});function At(e){return w.Z.composeUnion({InProgress:()=>E.of(null),Success:()=>e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(f),I.U((e=>e.header)),Q.h(u.d6),I.U((e=>e.value))),Fatal:()=>E.of(null),Error:()=>E.of(null)},(()=>e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(f),I.U((e=>e.header)))))}var Ft=n(14692);const Pt=w.UI.Knot.make(w.UI.Grid.make((({slots:e,state:t,notify:n})=>x.createElement(C.F.div,{className:Ft.navigationFrame},x.createElement(C.F.div,{className:Ft.buttonGroup},t.pipe(I.U((e=>x.createElement(x.Fragment,null,x.createElement(A.zx.Ghost,{onClick:n("first"),name:"navigate-first",disabled:!e.canGoBack,title:e.canGoBack?S.expandedPanel.jumpFirstIconTooltip:void 0},x.createElement(H.JO.Exit,{...(0,K.Sh)(Ft.iconJump,Ft.iconGoFirst)})),x.createElement(A.zx.Ghost,{onClick:n("left"),name:"navigate-left",disabled:!e.canGoBack,title:e.canGoBack?S.expandedPanel.goLeftIconTooltip:void 0},x.createElement(H.JO.Arrow,{direction:H.n4.left,className:Ft.icon}))))))),e.mailInfo,x.createElement(C.F.div,{className:Ft.buttonGroup},t.pipe(I.U((e=>x.createElement(x.Fragment,null,x.createElement(A.zx.Ghost,{onClick:n("right"),name:"navigate-right",disabled:!e.canGoForward,title:e.canGoForward?S.expandedPanel.goRightIconTooltip:void 0},x.createElement(H.JO.Arrow,{direction:H.n4.right,className:Ft.icon})),x.createElement(A.zx.Ghost,{onClick:n("last"),name:"navigate-last",disabled:!e.canGoForward,title:e.canGoForward?S.expandedPanel.jumpLastIconTooltip:void 0},x.createElement(H.JO.Exit,{className:Ft.iconJump})))))))))),{mailInfo:Tt});function Ot(e){return w.Z.composeKnot({root:w.Z.fromSideEffect((t=>e.threadViewNavigate(t)),e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(f),I.U((e=>e.navigation)))),mailInfo:At(e)})}var Vt=n(16204);const Rt=w.UI.Node.make((({state:e,notify:t})=>x.createElement(C.F.Fragment,null,e.pipe(I.U((e=>x.createElement(A.zx.Group,{sticky:!0,className:Vt.buttonGroup},x.createElement(A.zx.White,{name:"thread-view",onClick:t("messageView"),active:"messageView"===e,className:Vt.button},S.expandedPanel.viewButton.thread),x.createElement(A.zx.White,{name:"pinned-view",onClick:t("pinnedView"),active:"pinnedView"===e,className:Vt.button},S.expandedPanel.viewButton.pins))))))));function Bt(e){return w.Z.fromSideEffect((t=>{switch(t){case"pinnedView":e.openPinnedView();break;case"messageView":e.openMessageView("messagesButton");break;default:(0,N.vE)(t)}}),e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h((0,p.Kg)(f,v)),I.U((e=>e.kind))))}const Ht=w.UI.Grid.make((({slots:e})=>x.createElement(C.F.div,{className:St.header},e.viewButtons,e.frame))),Dt=w.UI.Union.asOption(Pt),jt=w.UI.Union.asOption(Rt),Lt=w.UI.Knot.make(Ht,{viewButtons:jt,frame:Dt});function Zt(e){return w.Z.composeKnot({viewButtons:w.Z.composeUnion({None:()=>E.of(null),Some:w.Z.composeKnot({value:Bt(e)})},(()=>e.state.pipe(I.U((e=>_(e)&&(0,p.Kg)(f,v)(e.activeView)?h.some(e):h.none))))),frame:w.Z.composeUnion({None:()=>E.of(null),Some:w.Z.composeKnot({value:Ot(e)})},(()=>e.state.pipe(I.U((e=>_(e)&&f(e.activeView)?h.some(e):h.none)))))})}const qt=w.UI.Knot.make(R,{header:Lt,toolbar:j,content:Nt});function Qt(e){return w.Z.composeKnot({root:B(e),header:Zt(e),toolbar:L(e),content:Ct(e)})}var Kt=n(40349);const $t=w.UI.Node.make((({state:e,notify:t})=>x.createElement("div",{className:Kt.controls},x.createElement("div",{className:Kt.onboardingButtonGroup},x.createElement(A.zx.Primary,{name:"try-it-out-button",onClick:t("optIn"),className:Kt.optInButton},S.onboarding.optInButton),x.createElement(A.zx.Flat,{name:"no-thanks-button",onClick:t("optOut"),className:Kt.optOutButton},S.onboarding.optOutButton)),x.createElement(C.F.div,{className:Kt.navigation},e.pipe(I.U((e=>x.createElement(x.Fragment,null,x.createElement(A.zx.Flat,{name:"left-button",onClick:t("left"),disabled:g[0]===e,className:Kt.leftButton},x.createElement(H.JO.Arrow,{direction:H.n4.left,width:12})),x.createElement(A.zx.Flat,{name:"right-button",onClick:t("right"),disabled:g[g.length-1]===e,className:Kt.rightButton},x.createElement(H.JO.Arrow,{direction:H.n4.right,width:12,className:Kt.arrowRight})),x.createElement("div",{className:Kt.stepOfN},S.onboarding.stepOfN(g.indexOf(e)+1))))))))));var Jt=n(57391);const Wt=w.UI.Node.make((({state:e})=>x.createElement(x.Fragment,null,x.createElement("link",{rel:"preload",as:"image",href:S.onboarding.overview.videoSrc}),x.createElement("link",{rel:"preload",as:"image",href:S.onboarding.coreUserJourney.videoSrc}),x.createElement("link",{rel:"preload",as:"image",href:S.onboarding.pinning.videoSrc}),x.createElement(C.F.Fragment,null,e.pipe(I.U((e=>x.createElement("img",{src:S.onboarding[e].videoSrc,key:e,className:Jt.illustration}))))))));var Yt=n(51869),Xt=n(19230);const en=({title:e,children:t})=>x.createElement(x.Fragment,null,x.createElement("div",{className:Xt.title},e),x.createElement("div",{className:Xt.body},t)),tn=({features:e,browser:t})=>{const n=e=>x.createElement(x.Fragment,null,e,x.createElement(M.v,{browser:t}));return e.has("needsResponse")&&e.has("peopleAndLinks")?x.createElement(en,{title:n(S.onboarding.overview.phase2.title)},S.onboarding.overview.phase2.body):e.has("needsResponse")?x.createElement(en,{title:n(S.onboarding.overview.phase1.title)},S.onboarding.overview.phase1.body):x.createElement(en,{title:n(S.onboarding.overview.phase0.title)},S.onboarding.overview.phase0.body)},nn=()=>x.createElement(en,{title:S.onboarding.coreUserJourney.title},S.onboarding.coreUserJourney.body),an=()=>x.createElement(en,{title:S.onboarding.pinning.title},S.onboarding.pinning.body),on=w.UI.Node.make((({state:e})=>x.createElement(C.F.Fragment,null,e.pipe(I.U((e=>{switch(e.step){case i.overview:return x.createElement(tn,{key:"step-overview",features:e.features,browser:e.browser});case i.coreUserJourney:return x.createElement(nn,{key:"step-core-user-journey"});case i.pinning:return x.createElement(an,{key:"step-pinning"});default:(0,N.vE)(e.step)}})))))),sn=({onShow:e,children:t})=>(U.P.useEffectOnDidMount(e),x.createElement("div",{className:Yt.onboarding},t)),rn=w.UI.Grid.make((({slots:e,notify:t})=>x.createElement(sn,{onShow:t("panelMounted")},x.createElement(C.F.div,null,e.illustrations),x.createElement(z.K,{size:22.4,className:Yt.logo}),x.createElement("div",{className:Yt.content},x.createElement("div",{className:Yt.badge},S.onboarding.badge),x.createElement(C.F.div,{className:Yt.steps},e.steps),x.createElement(C.F.div,null,e.controls))))),ln=w.UI.Knot.make(rn,{steps:on,illustrations:Wt,controls:$t});function dn(e){return w.Z.fromSideEffect((t=>{const n=t.action;switch(n){case"optIn":e.optIn();break;case"optOut":e.optOut();break;case"left":case"right":e.onboardingViewNavigate(n);break;case"panelMounted":e.onboardingShow();break;default:(0,N.vE)(n)}}),e.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(b),I.U((t=>({steps:{step:g[t.step],features:t.features,browser:e.browser},illustrations:g[t.step],controls:g[t.step]})))))}var cn=n(35300);const mn=w.UI.Grid.make((({slots:e})=>x.createElement("div",{className:cn.onboarding},x.createElement(C.F.Fragment,null,e.content),x.createElement(C.F.div,{className:cn.toolbar},e.toolbar)))),un=w.UI.Knot.make(mn,{content:ln,toolbar:j});function pn(e){return w.Z.composeKnot({toolbar:L(e),content:dn(e)})}const hn=w.UI.Union.make("kind",{collapsed:Z,expanded:qt,onboarding:un});var gn,fn,vn=n(17889),bn=n(34011),yn=n(29567),_n=n(98403),In=n(14601),wn=n(2844),xn=n(93508),En=n(12126),kn=n(28043),Un=n(83078),Nn=n(95195),Cn=n(38983),Sn=n(65219),Gn=n(81999),zn=n(55822);function Mn(e,t=self){return t.navigator&&t.navigator.clipboard&&t.navigator.clipboard.writeText?t.navigator.clipboard.writeText(e):Promise.reject("The Clipboard API is not available.")}!function(e){e.empty=(e,t)=>({activeMessageIndex:h.none,onboardingStep:(null==e?void 0:e.seenOnboarding)?h.none:h.some(0),panelState:"expanded",activeView:(null==e?void 0:e.seenOnboarding)?"messageView":"onboardingView",annotations:(0,o.zG)(t,h.chain((t=>{var n,i;return h.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.annotations)})),h.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,o.zG)(m.T.decode(n),Nn.g_((()=>t),(n=>t.set(e,n)))))))),summaryItems:(0,o.zG)(t,h.chain((t=>{var n,i;return h.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.summaries)})),h.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,o.zG)(Sn.P.decode(n),Nn.g_((()=>t),(n=>t.set(e,n)))))))),people:(0,o.zG)(t,h.chain((t=>{var n,i;return h.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.persons)})),h.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,o.zG)(Gn.m2.decode(n),Nn.g_((()=>t),(n=>t.set(e,n)))))))),links:new Map})}(gn||(gn={}));class Tn{constructor(e,t,n,i,s,l,d,c,g){this._threadContext=e,this.browser=i,this._gnar=s,this._sessionUuid=l,this._features=d,this._readerCSState=c,this._actions=g,this._subscriptions=new In.w,this._threadInfo=Cn.h.create(h.none),this.isClipboardSupported=function(e=self){return!!(e.navigator&&e.navigator.clipboard&&e.navigator.clipboard.writeText)}(),this._state=Cn.h.create(gn.empty(this._readerCSState,(0,o.zG)(this._threadContext.get().threadId,h.fromEither))),this._panelInjected=!1,this._onboardingPanelShown=!1,this._userNavigatedInPanel=!1,this.state=Cn.h.combine(this._threadInfo,this._state,((e,{panelState:t,activeMessageIndex:n,activeView:i,annotations:s,summaryItems:l,people:d,onboardingStep:c})=>{if("collapsed"===t)return{kind:"collapsed"};const g=(0,o.zG)(n,h.alt((()=>(0,o.zG)(e,h.map((e=>e.messageCount-1)))))),f=(0,o.zG)(a.Y(h.option)({threadInfo:e,activeIndex:g}),h.chain((({threadInfo:e,activeIndex:t})=>h.fromNullable(e.messages.get(t)))));return{kind:"expanded",activeView:"onboardingView"===i?{kind:"onboardingView",step:(0,o.zG)(c,h.getOrElse((()=>0))),features:this._features}:"pinnedView"===i?{kind:"pinnedView",summaryItems:(0,o.zG)(l,r.hX((e=>!e.dismissed&&e.pinned)),r.VO(Sn.h.ord),An(this._features,"summaries")),questions:(0,o.zG)(s,r.hX((e=>!e.dismissed&&e.pinned)),r.VO(m.p.ord),An(this._features,"needsResponse")),peopleAndLinks:(0,o.zG)(d,r.hX((0,p.W9)((e=>!e.dismissed),Gn.ln)),r.VO(Gn.e3.ord),(e=>({people:e,links:[]})),An(this._features,"peopleAndLinks"))}:"messageView"===i?{kind:"messageView",header:(0,o.zG)(f,h.fold((()=>u.x5),(e=>(0,o.zG)(e.message,u.UI((e=>({author:e.author,date:e.date}))))))),navigation:{canGoBack:(0,o.zG)(g,h.exists((e=>e>0))),canGoForward:(0,o.zG)(a.Y(h.option)({activeIndex:g,threadInfo:e}),h.exists((({activeIndex:e,threadInfo:t})=>e<t.messageCount-1)))},message:(0,o.zG)(f,h.fold((()=>u.x5),(e=>(0,o.zG)(e.message,u.UI((e=>({id:e.id,date:e.date,wordCount:e.wordCount}))))))),summary:(0,o.zG)(Fn(f,l),An(this._features,"summaries")),questions:(0,o.zG)(Pn(f,s),An(this._features,"needsResponse")),peopleAndLinks:(0,o.zG)(On(f,d,(0,o.zG)(e,h.map((e=>e.avatars)))),An(this._features,"peopleAndLinks"))}:(0,N.vE)(i)}})),this._maybeThreadId=(0,o.zG)(this._threadContext.get().threadId,h.fromEither,h.toUndefined),this._subscriptions.add(wn.aj([this._threadContext,n.pipe(xn.O(null)),t.pipe(xn.O(null))]).pipe(I.U((([e,t,n])=>h.some({messageCount:e.messageCount,avatars:e.avatars,messages:(0,o.zG)(e.expandedMessages,r.Su(((e,i)=>({message:(0,o.zG)(i,u.UI((e=>({id:e.id,index:e.index,author:e.context.author,audience:e.context.audience,wordCount:e.textMap.getPlainText().trim().split(/\s+/).length,date:e.context.date})))),summary:(null==n?void 0:n.get(e))||(u.VZ(i)||u.IR(i)?u.kH(i.error):u.x5),annotations:(null==t?void 0:t.get(e))||(u.VZ(i)||u.IR(i)?u.kH(i.error):u.x5)}))),(t=>(0,o.zG)(e.messageIndexToIdMap,r.UI((e=>t.get(e))))))})))).subscribe(_n.wW(this._threadInfo))),this._subscriptions.add(this._threadContext.view("messageCount").subscribe((e=>this._state.modify((t=>({...t,activeMessageIndex:(0,o.zG)(t.activeMessageIndex,h.map((t=>Math.max(0,Math.min(t,e-1)))))})))))),this._subscriptions.add(this._trackMessageShow())}panelShow(){this._panelInjected||"onboardingView"===this._state.get().activeView||(this._gnar.readerMailPanelShow(this._sessionUuid,this._maybeThreadId),this._panelInjected=!0)}onboardingShow(){this._onboardingPanelShown||(this._gnar.readerMailOnboardingPanelShow(this._sessionUuid,this._maybeThreadId),this._onboardingPanelShown=!0)}recapExpandButtonClick(){this._state.modify((e=>({...e,panelState:"expanded"}))),this._gnar.readerMailRecapExpandButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId)}recapCollapseButtonClick(){this._state.modify((e=>({...e,panelState:"collapsed"}))),this._gnar.readerMailRecapCollapseButtonClick(this._sessionUuid,this._maybeThreadId)}collapseButtonClick(){this._gnar.readerMailPanelCollapseButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId),this._state.modify((e=>({...e,panelState:"collapsed"})))}expandButtonClick(){this._state.modify((e=>({...e,panelState:"expanded"}))),this._gnar.readerMailPanelExpandButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId)}optIn(){this._state.modify((e=>({...e,activeView:"messageView",onboardingStep:h.none}))),this._actions.onboardingFinished("opt-in"),this._gnar.readerMailOnboardingPanelOptInButtonClick(this._sessionUuid,this._maybeThreadId)}optOut(){this._state.modify((e=>({...e,panelState:"collapsed",onboardingStep:h.none}))),this._actions.onboardingFinished("opt-out"),this._gnar.readerMailOnboardingPanelOptOutButtonClick(this._sessionUuid,this._maybeThreadId)}onboardingViewNavigate(e){const t=(0,o.zG)(this._state.get().onboardingStep,h.getOrElse((()=>0)),(t=>{switch(e){case"left":return Math.max(t-1,0);case"right":return Math.min(t+1,2);default:(0,N.vE)(e)}}));this._state.modify((e=>({...e,onboardingStep:h.some(t)}))),this._gnar.readerMailOnboardingPanelNavigationButtonClick(this._sessionUuid,g[t],this._maybeThreadId)}threadViewNavigate(e){this._userNavigatedInPanel=!0,(0,o.zG)(a.Y(h.option)({info:this._threadInfo.get(),activeIdx:(0,o.zG)(this._state.get().activeMessageIndex,h.alt((()=>(0,o.zG)(this._threadInfo.get(),h.map((e=>e.messageCount-1))))))}),Un.bw((({info:t,activeIdx:n})=>{(0,o.zG)(function(e,t,n){if("left"===e&&t>0)return h.some(t-1);if("right"===e&&t<n-1)return h.some(t+1);if("first"===e&&t>0)return h.some(0);if("last"===e&&t<n-1)return h.some(n-1);return h.none}(e,n,t.messageCount),Un.bw((t=>{this._state.modify((e=>({...e,activeMessageIndex:h.some(t)}))),this._actions.navigate(t,e),this._gnar.readerMailPanelNavigationButtonClick(e,this._sessionUuid,this._maybeThreadId)})))})))}openPinnedView(){this._state.modify((e=>({...e,activeView:"pinnedView"}))),this._gnar.readerMailPanelPinnedButtonClick(this._sessionUuid,this._maybeThreadId)}openMessageView(e){switch(this._state.modify((e=>({...e,activeView:"messageView"}))),e){case"messagesButton":this._gnar.readerMailPanelMessagesButtonClick(this._sessionUuid,this._maybeThreadId);break;case"emptyPinnedSummaries":case"emptyPinnedFollowUps":case"emptyPinnedMentions":this._gnar.readerMailPanelReturnToMessagesButtonClick(this._sessionUuid,e,this._maybeThreadId);break;default:(0,N.vE)(e)}}checkQuestionItem(e,t){this._state.modify((n=>({...n,annotations:(0,o.zG)(n.annotations,r.cq(m.p.Id.eq)(e.itemId,(e=>({...e,checked:t}))),h.getOrElse((()=>(0,o.zG)(n.annotations,r.ZQ(m.p.Id.eq)(e.itemId,{...e,checked:t})))))}))),this._actions.updateAnnotationItem({...e,checked:t}),this._gnar.readerMailPanelQuestionItemCheck(e.message.id,this._state.get().activeView,this._sessionUuid,t,this._maybeThreadId)}pinQuestionItem(e,t){this._state.modify((n=>({...n,annotations:(0,o.zG)(n.annotations,r.cq(m.p.Id.eq)(e.itemId,(e=>({...e,pinned:t}))),h.getOrElse((()=>(0,o.zG)(n.annotations,r.ZQ(m.p.Id.eq)(e.itemId,{...e,pinned:t})))))}))),this._actions.updateAnnotationItem({...e,pinned:t}),this._gnar.readerMailPanelQuestionItemPin(e.message.id,this._sessionUuid,t,this._maybeThreadId)}pinSummaryItem(e,t){this._state.modify((n=>({...n,summaryItems:(0,o.zG)(n.summaryItems,r.cq(Sn.h.Id.eq)(e.itemId,(e=>({...e,pinned:t}))),h.getOrElse((()=>(0,o.zG)(n.summaryItems,r.ZQ(Sn.h.Id.eq)(e.itemId,{...e,pinned:t})))))}))),this._actions.updateSummaryItem({...e,pinned:t}),this._gnar.readerMailPanelSummaryItemPin(e.message.id,this._sessionUuid,t,this._maybeThreadId)}pinPersonItem(e,t){this._state.modify((n=>({...n,people:(0,o.zG)(n.people,r.cq(yn.G.eq)(e.email,(n=>({...n,messagePinnedFrom:t?h.some(e.message):h.none,pinned:t}))),h.getOrElse((()=>(0,o.zG)(n.people,r.ZQ(yn.G.eq)(e.email,{...e,messagePinnedFrom:t?h.some(e.message):h.none,pinned:t})))))}))),this._actions.updatePersonItem({...e,pinned:t,messagePinnedFrom:t?h.some(e.message):h.none}),this._gnar.readerMailPanelPersonItemPin(e.message.id,this._sessionUuid,t,this._maybeThreadId)}copyQuestionItem(e){this._subscriptions.add(En.D(Mn(e.text)).subscribe()),this._gnar.readerMailPanelQuestionItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId)}copySummaryItem(e){this._subscriptions.add(En.D(Mn(e.text)).subscribe()),this._gnar.readerMailPanelSummaryItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId)}copyPersonItem(e){this._subscriptions.add(En.D(Mn(e.email)).subscribe()),this._gnar.readerMailPanelPersonItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId)}dismissQuestionItem(e){this._state.modify((t=>({...t,annotations:(0,o.zG)(t.annotations,r.cq(m.p.Id.eq)(e.itemId,(e=>({...e,dismissed:!0}))),h.getOrElse((()=>(0,o.zG)(t.annotations,r.ZQ(m.p.Id.eq)(e.itemId,{...e,dismissed:!0})))))}))),this._actions.updateAnnotationItem({...e,dismissed:!0}),this._gnar.readerMailPanelQuestionItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId)}dismissSummaryItem(e){this._state.modify((t=>({...t,summaryItems:(0,o.zG)(t.summaryItems,r.cq(Sn.h.Id.eq)(e.itemId,(e=>({...e,dismissed:!0}))),h.getOrElse((()=>(0,o.zG)(t.summaryItems,r.ZQ(Sn.h.Id.eq)(e.itemId,{...e,dismissed:!0})))))}))),this._actions.updateSummaryItem({...e,dismissed:!0}),this._gnar.readerMailPanelSummaryItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId)}dismissPersonItem(e){this._state.modify((t=>({...t,people:(0,o.zG)(t.people,r.cq(yn.G.eq)(e.email,(e=>({...e,dismissed:!0}))),h.getOrElse((()=>(0,o.zG)(t.people,r.ZQ(yn.G.eq)(e.email,{...e,dismissed:!0})))))}))),this._actions.updatePersonItem({...e,dismissed:!0}),this._gnar.readerMailPanelPersonItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId)}dispose(){this._subscriptions.unsubscribe()}_trackMessageShow(){return this.state.pipe(Q.h(_),I.U((e=>e.activeView)),Q.h(y),kn.x(((e,t)=>bn.Rb.eq.equals(e.message.value,t.message.value)))).subscribe((e=>{const t=(0,o.zG)(e.summary,h.filter(u.d6),h.fold((()=>0),(e=>e.value.length))),n=(0,o.zG)(e.questions,h.filter(u.d6),h.fold((()=>0),(e=>e.value.length))),i=(0,o.zG)(e.peopleAndLinks,h.filter(u.d6),h.fold((()=>0),(e=>e.value.people.length)));this._gnar.readerMailPanelMessageShow(Array.from(this._features),e.message.value.id,i,n,this._sessionUuid,this._userNavigatedInPanel?"navigation":"firstLoad",t,e.message.value.wordCount,"parsedDate"===e.message.value.date.kind?e.message.value.date.timestamp:void 0,this._maybeThreadId)}))}}function An(e,t){return e.has(t)?h.some:(0,o.a9)(h.none)}function Fn(e,t){return(0,o.zG)(e,h.fold((()=>u.x5),(e=>(0,o.zG)(a.Y(u.$w)({summary:e.summary,message:e.message}),u.UI((({summary:e,message:n})=>(0,o.zG)(e,h.fold((()=>[]),(e=>(0,o.zG)(e.summary,s.UI((i=>{var a,o;const s=Sn.h.Id.create(e.messageId,i.text),r=t.get(s);return{message:{id:n.id,author:n.author,date:n.date,index:n.index},itemId:s,text:i.text,pinned:null!==(a=null==r?void 0:r.pinned)&&void 0!==a&&a,dismissed:null!==(o=null==r?void 0:r.dismissed)&&void 0!==o&&o}})),s.hX((e=>!e.dismissed))))))))))))}function Pn(e,t){return(0,o.zG)(e,h.fold((()=>u.x5),(e=>(0,o.zG)(a.Y(u.$w)({annotations:e.annotations,message:e.message}),u.UI((({annotations:e,message:n})=>(0,o.zG)(e,s.UI((e=>{var i,a,o;const s=m.p.Id.create(e.messageId,e.span),r=t.get(s);return{message:{id:n.id,author:n.author,date:n.date,index:n.index},itemId:s,text:e.text,type:e.type,pinned:null!==(i=null==r?void 0:r.pinned)&&void 0!==i&&i,checked:null!==(a=null==r?void 0:r.checked)&&void 0!==a&&a,dismissed:null!==(o=null==r?void 0:r.dismissed)&&void 0!==o&&o}})),s.hX((e=>!e.dismissed)),s.hX((e=>"question"===e.type||"action_item"===e.type)))))))))}function On(e,t,n){return(0,o.zG)(e,h.fold((()=>u.x5),(e=>(0,o.zG)(e.message,u.tS((e=>(0,o.zG)(e.audience,vn.c2,h.fold((()=>u.kH(new zn.ZS("No audience"))),(i=>u.Vp({people:(0,o.zG)(i,s.UI((i=>{var a,s,r;const l=t.get(i.email);return{message:{id:e.id,author:e.author,date:e.date,index:e.index},messagePinnedFrom:null!==(a=null==l?void 0:l.messagePinnedFrom)&&void 0!==a?a:h.none,name:(0,o.zG)(Vn(i,n),h.toUndefined),email:i.email,avatarUrl:(0,o.zG)(n,h.chain((e=>h.fromNullable(e.get(i.email)))),h.chain((e=>h.fromNullable(e.avatarUrl)))),pinned:null!==(s=null==l?void 0:l.pinned)&&void 0!==s&&s,dismissed:null!==(r=null==l?void 0:l.dismissed)&&void 0!==r&&r}})),s.hX((e=>!e.dismissed))),links:[]}))))))))))}function Vn(e,t){return(0,o.zG)(t,h.chain((t=>h.fromNullable(t.get(e.email)))),h.chain((e=>h.fromNullable(e.name))),Un.vx(h.fromNullable(e.name)))}!function(e){e.Mock=class{constructor(e){this.state=e,this.collapseButtonClick=o.Q1,this.expandButtonClick=o.Q1,this.optIn=o.Q1,this.optOut=o.Q1,this.onboardingShow=o.Q1,this.onboardingViewNavigate=o.Q1,this.threadViewNavigate=o.Q1,this.openPinnedView=o.Q1,this.openMessageView=o.Q1,this.checkQuestionItem=o.Q1,this.pinQuestionItem=o.Q1,this.pinSummaryItem=o.Q1,this.pinPersonItem=o.Q1,this.copyQuestionItem=o.Q1,this.copySummaryItem=o.Q1,this.copyPersonItem=o.Q1,this.dismissQuestionItem=o.Q1,this.dismissSummaryItem=o.Q1,this.dismissPersonItem=o.Q1,this.recapExpandButtonClick=o.Q1,this.recapCollapseButtonClick=o.Q1,this.panelShow=o.Q1,this.browser="chrome",this.isClipboardSupported=!0}}}(fn||(fn={}));var Rn,Bn=n(90361),Hn=n(74850),Dn=n(60797),jn=n(19751),Ln=n(41398),Zn=n(32952),qn=n(66310),Qn=n(2834),Kn=n(23063),$n=n(24209),Jn=n(17343),Wn=n(16118),Yn=n(78674),Xn=n(71032),ei=n(85321),ti=n(67434),ni=n(73975);!function(e){let t;!function(e){e.create=function(e,t){return`${e}|${t}`}}(t=e.Id||(e.Id={}))}(Rn||(Rn={}));var ii=n(25691);class ai{constructor(e=Hn.Y.create("Reader-Card-Controller")){this._logger=e,this._hovered=new Zn.xQ,this._dismissed=new Zn.xQ,this.cardHovered=this._hovered.pipe((0,xn.O)(!1),(0,kn.x)()),this.cardDismissed=this._dismissed.pipe((0,kn.x)()),this._activeCardModel=Cn.h.create(null),this.view=(0,wn.aj)([this._activeCardModel]).pipe((0,I.U)((([e])=>(null==e?void 0:e.annotation)?x.createElement(ii.W,{anchorRect:e.highlightRect},x.createElement("div",{style:{background:"white",borderRadius:10,padding:10,fontSize:"12px",fontFamily:"sans-serif",boxShadow:"0px 2px 10px rgba(0, 0, 0, 0.6)"}},x.createElement("b",null,"Annotation"),x.createElement("pre",{style:{maxWidth:400,whiteSpace:"pre-wrap"}},JSON.stringify(e.annotation,null,4)))):null))),this._logger.debug("Created")}show(e){this._activeCardModel.set(e)}hide(){this._activeCardModel.set(null),this._hovered.next(!1)}dispose(){this.hide()}}var oi=n(34311);class si{constructor(e){this._annotationsStateService=e}getHoveredStateBehavior(e){return this._annotationsStateService.getHighlightedAnnotation().pipe((0,I.U)((t=>t&&t.highlightIds.includes(e)?oi.pc.hovered:oi.pc.none)))}}var ri,li=n(50628),di=n(24755),ci=n(95300),mi=n(95343),ui=n(11407),pi=n(62337),hi=n(28728),gi=n(15555),fi=n(13718),vi=n(49708);!function(e){e.eq=ni.f7(((e,t)=>e&&t?e.annotationId===t.annotationId:e===t))}(ri||(ri={}));class bi{constructor(e,t=Hn.Y.create(bi.name)){this._options=e,this._log=t,this._rawHighlightedAnnotation=()=>this._options.mouseData.pipe(fi.U(ui.S.hz30),jn.skipBy(hi.Z.eq),I.U((({client:e,offset:t})=>{if(e&&t&&function(e,t){var n;let i=t.ownerDocument.elementFromPoint(e.left,e.top);(null===(n=null==i?void 0:i.shadowRoot)||void 0===n?void 0:n.elementFromPoint)&&(i=i.shadowRoot.elementFromPoint(e.left,e.top));return t.contains(i)}(e,this._options.textNode)){const e=this._options.highlightGeometry.geometry.get();return Array.from(e.keys()).reduce(((n,i)=>{const a=e.get(i);if(a){const e=a.rects&&(null===a.meta.highlightDisplayFormat||gi.jk.isInteractable(a.meta.highlightDisplayFormat))&&a.rects.find((e=>pi.UL.contains(t,e)));if(e)return{annotationId:a.meta.annotationId,activeHighlightId:a.meta.highlightId,activeHighlightRect:e,highlightIds:[]}}return n}),null)}return null})),jn.skipBy(ri.eq),I.U((e=>{if(!e)return null;const t=this._options.highlightGeometry.geometry.get(),n=[];return t.forEach(((t,i)=>{t.meta.annotationId===e.annotationId&&n.push(i)})),{...e,highlightIds:n}}))),this._offByUpdatedGeometry=e=>this._options.highlightGeometry.geometry.pipe(I.U((t=>e&&t.has(e.activeHighlightId)?e:null)),Q.h((e=>null===e)),Jn.h(null),Qn.b((e=>this._log.trace("OffByUpdatedGeometry",e)))),this._offByTextPositionChange=()=>$n.T(this._options.textNodeLayout.rect.changes.pipe(Qn.b((()=>this._log.trace("Text field position, size has been changed")))),this._options.textNodeLayout.scroll.changes.pipe(Qn.b((()=>this._log.trace("Text field scroll has been changed")))),vi.R(self,"scroll").pipe(Qn.b((()=>this._log.trace("Window scroll detected"))))).pipe(li.P(),Jn.h(null))}getActiveAnnotation(){throw new Error("Not implemented")}getHighlightedAnnotation(){throw new Error("Not implemented")}}class yi extends bi{constructor(e,t=Hn.Y.create(yi.name)){super(e,t)}getActiveAnnotation(){return this.getHighlightedAnnotation().pipe(jn.skipBy(ri.eq))}getHighlightedAnnotation(){return this._rawHighlightedAnnotation().pipe(jn.skipBy(ri.eq),qn.w((e=>e?$n.T(this._offByUpdatedGeometry(e),this._offByTextPositionChange()).pipe(Qn.b((()=>this._log.trace("Active state was overriden by text or geometry change"))),li.P(),xn.O(e)):E.of(null))),jn.skipBy(ri.eq),di.O(new ci.X(null)),mi.x())}}var _i=n(93356),Ii=n(76331),wi=n(40327),xi=n(10166),Ei=n(71249),ki=n(4432);class Ui{constructor(){}create(e,t){return{getRects:()=>{var n;const i=[];let a,o=e.start,s=!1;do{const r=t.getFragmentAtOrBeforeOffset(o);if(r&&a!==o){a=o;if(null===(n=r.node.textContent)||void 0===n?void 0:n.replace(/\s/g,"")){const n=ki.M.createRange(t,o,Math.min(r.endOffset,e.end));n&&i.push(...Array.from(n.getClientRects()))}o=r.endOffset===o?r.endOffset+1:r.endOffset}else s=!0}while(o<e.end&&!s);return(0,wi.pipe)(i,xi.e,xi.y,Ei.UI(pi.Pf.create))}}}getClientRects(e){return e.getRects()}getIsInvalid(e){return!1}getIsConsistent(e,t,n){return!0}dispose(e){}}var Ni=n(13116),Ci=n(28094),Si=n(95981),Gi=n(63919),zi=n(25924),Mi=n(18505),Ti=n(2780),Ai=n(68383),Fi=n(92783),Pi=n(57356),Oi=n(51655),Vi=n(70718),Ri=n(13822);function Bi(e,t,n,i=!1){const a=(0,Oi.Me)(e).body,o=(0,Oi.Jj)(e);let s={left:"0px",top:"0px"};if(t.fieldPaintingPositioning===Pi.Q.nonPositioned&&t.positionedAncestor===a){const e=o.getComputedStyle(a);s={left:e.marginLeft||"0px",top:e.marginRight||"0px"}}else if(t.positionedAncestor!==a){const e=o.getComputedStyle(t.positionedAncestor);s={left:e.borderLeftWidth&&`-${e.borderLeftWidth}`||"0px",top:e.borderTopWidth&&`-${e.borderTopWidth}`||"0px"}}return a=>{a.style.position="absolute",a.style.top=s.top,a.style.left=i?"auto":s.left,a.style.right=i?s.left:"auto",a.style.pointerEvents="none",function({subjectElement:e,isPositioned:t,subjectElementStyle:n,integrationRoot:i,positionedAncestor:a}){t?(i.style.zIndex=n.zIndex,e.insertAdjacentElement("afterend",i)):a.insertAdjacentElement("afterbegin",i)}({subjectElement:e,isPositioned:t.fieldPaintingPositioning===Pi.Q.positioned,subjectElementStyle:n,integrationRoot:a,positionedAncestor:t.positionedAncestor})}}function Hi(e){return pi.Pf.create({...e.client,...e.size})}class Di{constructor(e){this._highlightsSubject=e,this.getFieldPositionRelativeToViewport=()=>{const e=this._highlightsSubject.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height}},this._prepareHighlights=(e,t=(0,Oi.is)(e))=>{const n=(0,Oi.o)(e),i=(0,Vi.fL)(e,!1,n,t);return{layout:i,rootInjector:Bi(e,i,n),enableHighlightsBlendingOnRoot:(0,Ci.$)(e,n)}},this._prepareInnerElements=(e,t=(0,Oi.is)(e),n)=>{const i=(0,Oi.o)(e),a=n||(0,Vi.fL)(e,!1,i,t);return{layout:a,rootInjector:Bi(e,a,i,!0)}},this._highlights=this._prepareHighlights(this._highlightsSubject),this._innerElements=this._prepareInnerElements(this._highlightsSubject,void 0,this._highlights.layout),this._win=(0,Oi.Jj)(this._highlightsSubject),this._createTextNodeRect=e=>({page:Gi.Cv.fromClient(e.client,{top:this._win.scrollY,left:this._win.scrollX}),offset:e.offset,client:e.client,size:e.size,padding:e.padding}),this.textNode={rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),visibleRect:this._highlights.layout.textField.visibleRect.map(this._createTextNodeRect),scroll:this._highlights.layout.textField.scroll,scrollSize:this._highlights.layout.textField.scrollSize,scroller:(0,c.iX)(this._highlightsSubject,{rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),scrollSize:this._highlights.layout.textField.scrollSize})},this.highlightHeightOffset=0,this.mouse=(0,wn.aj)([this._highlights.layout.textField.paddingRect.behavior,this._highlights.layout.textField.scroll.behavior]).pipe((0,I.U)((([e,t])=>({rect:Hi(e),scroll:t}))),(0,qn.w)((({rect:e,scroll:t})=>(0,Fi.Am)()?(0,zi.q7)(this._win,e,t):(0,zi.B0)(this._win,e,t))),(0,kn.x)(Bn.fS))}createGeometryLayout(){return new Si.D((()=>Hi(this._highlights.layout.textField.paddingRect.getCurrent())),(()=>this._highlights.layout.textField.scroll.getCurrent()),(()=>Hi(this._highlights.layout.textField.paddingRect.getApproximate())),(()=>this._highlights.layout.textField.scroll.getApproximate()))}render(e,t){const n={position:"absolute",top:0,left:0},i={position:"absolute",top:0,right:0},a=()=>e.innerElements?x.createElement(e.innerElements,null):null,o=(0,Oi.Me)(this._highlightsSubject),s=Mi.VB.get({monitorAs:"highlights"}).inject(Ti.EM.fromDocument(o,"grammarly-extension"),(e=>{t.highlightsBlendingEnabled&&this._highlights.enableHighlightsBlendingOnRoot(e),this._highlights.rootInjector(e)}),Ai.G7.showWhenLoaded(x.createElement((()=>x.createElement(x.Fragment,null,e.highlights&&x.createElement("div",{"data-grammarly-part":"highlights",style:n},x.createElement(Ri.V,{layout:this._highlights.layout},x.createElement("div",{style:n},x.createElement(e.highlights,null)))))),null))),r=Mi.VB.get({monitorAs:"inner-elements"}).inject(Ti.EM.fromDocument(o,"grammarly-extension"),this._innerElements.rootInjector,Ai.G7.showWhenLoaded(x.createElement((()=>e.innerElements?x.createElement("div",{"data-grammarly-part":"inner-elements",style:i},x.createElement(a,null)):null),null))),l=e.outerElements&&Mi.VB.get({monitorAs:"outer-elements"}).inject(Ti.EM.fromDocument(o,"grammarly-popups"),Ti.zs.appendChild(o.documentElement),Ai.G7.showWhenLoaded(x.createElement(e.outerElements,null)),{eventPropagationHandler:t.eventPropagationHandler});return{dispose:()=>{s&&s.dispose(),l&&l.dispose(),r&&r.dispose()}}}}var ji,Li=n(95093),Zi=n(43675),qi=n(92843),Qi=n(37881),Ki=n(22679),$i=n(87965),Ji=n(50663),Wi=n(48189),Yi=n(49468);class Xi{constructor(e,t,n,i){this._layout=e,this._highlights=t,this._annotationCards=n,this._getHoveredStateBehavior=i,this._highlightHoverStateBehavior=e=>this._getHoveredStateBehavior(e),this._getHighlightsContainer=e=>x.createElement(C.F.div,{style:this._layout.textNode.scrollSize.behavior.pipe((0,I.U)((e=>({height:e.height,width:e.width}))))},e),this.highlights=()=>this._getHighlightsContainer(x.createElement(x.Fragment,null,x.createElement(Qi.$v,{key:"aqua-highlights",highlightHeightOffset:0,highlights:this._highlights.geometry.view((e=>Array.from(e.values()))),getHoverState:this._highlightHoverStateBehavior}))),this.outerElements=()=>{const e=this._annotationCards;return x.createElement(Yi.o,{style:{zIndex:Ki.op,position:"absolute",top:0,left:0,width:"100%"}},x.createElement($i.p,null,x.createElement("div",{style:{position:"fixed",visibility:"hidden"}}),x.createElement(C.F.Fragment,null,e),x.createElement(Ji.G,null),x.createElement(Wi.p,{regular:!0,bold:!0})))}}}!function(e){e.eqByAnnotations=ni.Uz((e=>e.annotations))(Ei.Eh(bn.be.eq))}(ji||(ji={}));class ea{constructor(e,t,n=Hn.Y.create("Reader-Gmail-Annotations")){this._annotatedMessages=e,this._logger=n,this._subscriptions=new In.w,this._currentAnnotations=new Map,this._geometryProvider=new Ui,this._state=new Map,this._bodyNodeToMessageId=new WeakMap,this._annotationIdsForMessageId=new Map,this._hiddenMessages=new WeakMap;const i=new Zn.xQ,a=this._annotatedMessages.pipe(xn.O(new Map),Wn.G(),I.U((([e,t])=>(0,o.zG)(Zi.yi(ji.eqByAnnotations)(e,t),qi.v.reduce([],((e,{messageId:t})=>e.concat({kind:"remove",messageId:t})),((e,t,n)=>e.concat({kind:"update",prevAnnotations:t.annotations,...n})),((e,t)=>e.concat({kind:"add",...t})))))),ei.zg(o.yR),Li.T(i));this._intersectionObserver=new IntersectionObserver((e=>{e.map((e=>{e.isIntersecting?(0,o.zG)(h.fromNullable(this._hiddenMessages.get(e.target)),Un.bw((t=>{this._hiddenMessages.delete(e.target),i.next({kind:"add",...t})}))):(0,o.zG)(h.fromNullable(this._bodyNodeToMessageId.get(e.target)),h.chain((e=>h.fromNullable(this._state.get(e)))),Un.bw((({message:t})=>{const{messageId:n,bodyNode:a}=t;i.next({kind:"remove",messageId:n}),this._hiddenMessages.set(e.target,t),this._intersectionObserver.observe(a)})))}))}),{root:t}),this._subscriptions.add(a.subscribe((e=>{const t=this._state.get(e.messageId);if(t&&("update"===e.kind?e.prevAnnotations.forEach((t=>{const n=Rn.Id.create(e.messageId,function(e){return`${e.span.s}-${e.span.e}-${e.type}`}(t));this._currentAnnotations.delete(n),(0,o.zG)(h.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),Un.bw((e=>{e.delete(n)})))})):"remove"===e.kind&&((0,o.zG)(h.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),Un.bw((e=>{for(const t of e.values())this._currentAnnotations.delete(t)}))),this._annotationIdsForMessageId.delete(e.messageId),this._bodyNodeToMessageId.delete(t.message.bodyNode),this._state.delete(e.messageId)),t.disposables.forEach((e=>e.dispose())),this._logger.trace(`Annotations for ${e.messageId} cleared`)),"add"===e.kind||"update"===e.kind){const t=new ai,n=new Di(e.bodyNode),i=new Ii.C(this._geometryProvider,n.createGeometryLayout(),(()=>e.textMap),(0,_i.u)(),(0,oi.WF)(n.textNode)),a=new yi({textNode:e.bodyNode,textNodeLayout:n.textNode,mouseData:n.mouse,highlightGeometry:i}),s=new si(a),r=a.getActiveAnnotation().subscribe((e=>{if(e){const i=this._currentAnnotations.get(e.annotationId);i&&t.show({highlightRect:(0,Ni.Z)(e.activeHighlightRect,n.textNode.rect.getApproximate().client,n.textNode.scroll.getApproximate()),annotation:i})}else t.hide()})),l=new Xi(n,i,t.view,(e=>s.getHoveredStateBehavior(e)));this._intersectionObserver.observe(e.bodyNode),this._state.set(e.messageId,{message:e,disposables:[{dispose:()=>r.unsubscribe()},i,n.render(l,{}),t,{dispose:()=>this._intersectionObserver.unobserve(e.bodyNode)}]}),this._bodyNodeToMessageId.set(e.bodyNode,e.messageId);const d=(0,o.zG)(h.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),h.getOrElse((()=>{const t=new Set;return this._annotationIdsForMessageId.set(e.messageId,t),t})));e.annotations.forEach((e=>{const t=`${e.span.s}-${e.span.e}-${e.type}`,n=oi.y$.Id.create(e.messageId,t),a=Rn.Id.create(e.messageId,t);this._logger.trace("Adding annotation highlight",n),this._currentAnnotations.set(a,e),d.add(a),i.addHighlight(n,{start:e.span.s,end:e.span.e},{highlightId:n,annotationId:a,highlightColor:gi.hE.Preset.create(gi.al.gray),highlightDisplayFormat:gi.jk.underlineAndBackground})}))}})))}dispose(){this._subscriptions.unsubscribe();for(const{disposables:e}of this._state.values())e.forEach((e=>e.dispose()));this._currentAnnotations.clear(),this._state.clear(),this._annotationIdsForMessageId.clear(),this._intersectionObserver.disconnect()}}var ta=n(85089),na=n(89068),ia=n(91224),aa=n(73572),oa=n(18347),sa=n(44586),ra=n(17733),la=n(79582);function da(e,t){return new sa.y((function(n){var i=e.length;if(0!==i)for(var a=new Array(i),o=0,s=0,r=function(r){var l=(0,En.D)(e[r]),d=!1;n.add(l.subscribe({next:function(e){d||(d=!0,s++),a[r]=e},error:function(e){return n.error(e)},complete:function(){++o!==i&&d||(s===i&&n.next(t?t.reduce((function(e,t,n){return e[t]=a[n],e}),{}):a),n.complete())}}))},l=0;l<i;l++)r(l);else n.complete()}))}var ca=n(16169),ma=n(44923),ua=n(84603),pa=n(66319),ha=n(75420),ga=n(66081),fa=n(24713),va=n(40151),ba=n(38062),ya=n(80900),_a=n(78146),Ia=n(44212);function wa(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function xa(e){const t=e.match(/(?<name>.*?)\s*<(?<email>.*?)>/);if(null==t?void 0:t.groups){const e=t.groups.email,n=t.groups.name;return(0,o.zG)(yn.G.create(e),Nn.Yo((()=>"No email address found")),Nn.UI((e=>({email:e,name:(0,o.zG)(n,wa,(e=>""===e?void 0:e))}))))}return(0,o.zG)(yn.G.create(e.trim()),h.map((e=>({name:void 0,email:e}))),Nn.Yo((()=>`Malformed user [${e}]`)))}function Ea(e){const t=e.includes("<")&&e.includes(">");return(0,o.zG)(t?e.split(/>\s*,\s*/):e.split(/\s*,\s*/),(e=>e.length>1&&t?e.map((e=>e+">")):e),Ei.hX((e=>!e.match(/^undisclosed/))),Ei.UI(xa),Ei.IX.sequence(Nn.wE))}function ka(e){try{const t=e.split(/\n{2,}/)[0];return t?(0,o.zG)(function(e){const t=e.split(/\n+/),n=[];for(const e of t)if(/^\s+/.test(e))n.length>0&&(n[n.length-1].value+=e.trimStart());else{const t=e.match(/(.*?):\s*(.*)/);t&&t.length>=3&&n.push({header:String(t[1]).toLowerCase(),value:t[2]})}return n.reduce(((e,{header:t,value:n})=>({...e,[t]:n})),{})}(t),(e=>{var t,n,i,s;return a.Y(Nn.wE)({id:(0,o.zG)(null===(n=null===(t=e["message-id"])||void 0===t?void 0:t.match(/<(.*?)>/))||void 0===n?void 0:n[1],Nn.ij("No Message-ID header")),inReplyTo:Nn.F2(null===(s=null===(i=e["in-reply-to"])||void 0===i?void 0:i.match(/<(.*?)>/))||void 0===s?void 0:s[1]),date:(0,o.zG)(e.date,Nn.ij("No Date header"),Nn.UI((e=>new Date(e)))),from:(0,o.zG)(e.from,Nn.ij("No From header"),Nn.tS(xa)),to:(0,o.zG)(e.to,Nn.ij("No To header"),Nn.tS(Ea)),cc:(0,o.zG)(e.cc,(e=>e?Ea(e):Nn.F2(void 0))),bcc:(0,o.zG)(e.bcc,(e=>e?Ea(e):Nn.F2(void 0))),subject:(0,o.zG)(e.subject,Nn.ij("No Subject header")),deliveredTo:(0,o.zG)(e["delivered-to"],Nn.F2),replyTo:(0,o.zG)(e["reply-to"],(e=>e?Ea(e):Nn.F2(void 0))),headers:Nn.F2(e)})})):Nn.t$("Expected headers")}catch(e){return Nn.t$(String(e))}}var Ua,Na=n(30625);async function Ca(e,t,n){const i=await async function(e,t,n){var i,a,o,s;const r=(null===(a=null===(i=/^(?<url>.*?)\/?[#\?]/.exec(e))||void 0===i?void 0:i.groups)||void 0===a?void 0:a.url)||"https://mail.google.com/mail/u/0";try{const e=await fetch(`${r}/?ik=${encodeURIComponent(t)}&view=om&permmsgid=${encodeURIComponent(n)}`),i=await e.text(),a=null===(s=null===(o=/<pre[\s\S]*?id="raw_message_text"[\s\S]*?>(?<orig_msg>[\s\S]*?)<\/pre>/m.exec(i))||void 0===o?void 0:o.groups)||void 0===s?void 0:s.orig_msg;return a?Nn.ij({message:"Could not decode message"})((0,Na.l_)(a.trim())):Nn.t$({message:"Could not extract message from response",mimeMessageNotFound:!0})}catch(e){return Nn.t$({message:String(e)})}}(n,t,e);return(0,o.zG)(i,Nn.tS((e=>(0,o.zG)(ka(e),Nn.Vn((e=>({message:e})))))))}function Sa(e){return!!e.messageNode&&!!e.id&&void 0!==e.index}class Ga{constructor(e,t,n,i,s=Hn.Y.create("Reader-Gmail-Thread-Context")){this._doc=e,this._messageList=t,this._telemetry=i,this._logger=s,this._subscriptions=new In.w,this._state=Cn.h.create((0,o.zG)(function(e){const t=Nn.ij(new zn.DH("Cannot find thread subject container"))(e.querySelector(aa.Av));return{threadId:(0,o.zG)(t,Nn.tS((e=>Nn.ij(new zn.DH("Cannot find thread ID"))(e.getAttribute("data-thread-perm-id"))))),subject:(0,o.zG)(t,Nn.tS((e=>Nn.ij(new zn.DH("Cannot find thread Subject"))(e.textContent)))),loggedUser:(0,o.zG)(Nn.ij(new zn.DH("Cannot extract user from avatar"))(ua.x.getAuthor()),Nn.tS((t=>(0,o.zG)(yn.G.create(t.email),h.map((n=>({name:t.name?t.name:void 0,email:n,avatarUrl:(0,o.zG)(h.fromNullable(e.querySelector(aa.Dy)),h.chain(za),h.toUndefined)}))),Nn.Yo((()=>new zn.DH("No email address found in avatar")))))))}}(this._doc),(e=>({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser,avatars:(0,o.zG)(e.loggedUser,Nn.g_((()=>new Map),(e=>new Map([[e.email,e]])))),messageCount:Pa(this._messageList).length,expandedMessages:new Map,messageIndexToIdMap:new Map,messageNodeToIdMap:new Map})))),this.threadContext=this._state.view(),(0,o.zG)(this._state.get(),(e=>a.Y(Nn.wE)({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser})),Nn.Vn((e=>{this._telemetry.readerGmail.warning("threadInfoExtraction",e.message),this._logger.warn("Static thread info extraction error",e)})));const l=pa.x.create(this._messageList,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-expanded","tabindex"]}).pipe(ga.e(50),xn.O(null),jn.shareReplay({bufferSize:1,refCount:!0}));this._subscriptions.add(l.pipe(qn.w((()=>{return e=this._doc,t=this._state.get().avatars,En.D(e.querySelectorAll(aa.Q$)).pipe(Q.h((e=>e instanceof HTMLImageElement)),I.U((e=>(0,o.zG)(yn.G.create(e.getAttribute(aa.zv)||void 0),h.map((t=>({email:t,name:e.getAttribute(aa.AE)||void 0,img:e})))))),ei.zg(h.fold((()=>va.E),(({email:e,name:t,img:n})=>{return(i=n,E.of(za(i)).pipe(qn.w(h.fold((()=>ba.S3(vi.R(i,"onload"),ya.H(1e3)).pipe(I.U((()=>za(i))))),(e=>E.of(h.some(e))))))).pipe(I.U(h.map((n=>({email:e,name:t,avatarUrl:n})))));var i}))),Dn.oA,ti.R(((e,t)=>new Map(e).set(t.email,t)),new Map(t)));var e,t})),Qn.b((e=>{this._state.modify((t=>({...t,avatars:e})))}))).subscribe());const d=l.pipe(I.U((e=>{const t=Pa(this._messageList);return{nodes:t,expandedCount:t.filter(Va).length}})),kn.x(((e,t)=>e.nodes.length===t.nodes.length&&e.expandedCount===t.expandedCount)),fa.j("nodes"));this._subscriptions.add(d.pipe(Qn.b((e=>{this._state.modify((t=>({...t,messageCount:e.length})))})),(0,o.ls)(I.U((e=>{const t=e.map(((e,t)=>({messageNode:e,index:t}))),n=t.filter((({messageNode:e})=>Va(e))).map((({messageNode:e,index:t})=>{var n,i;return{id:null===(i=null===(n=e.querySelector(aa.k2))||void 0===n?void 0:n.getAttribute(aa.bq))||void 0===i?void 0:i.slice(1),messageNode:e,index:t}})).filter(Sa).reduce(((e,t)=>e.set(t.id,[t.messageNode,t.index])),new Map);return{allNodes:t.reduce(((e,t)=>e.set(t.messageNode,[t.messageNode,t.index])),new Map),expandedNodes:n}})),xn.O({allNodes:new Map,expandedNodes:new Map}),Wn.G(),I.U((([e,t])=>{const n=new Set(e.expandedNodes.keys()),i=new Set(t.expandedNodes.keys()),a=Array.from(oa.e5(ni.yv)(n)(i)),o=new Set(e.allNodes.keys()),s=new Set(t.allNodes.keys()),r=Array.from(oa.e5(ni.w4)(s)(o));return{expanded:a.map((e=>{const n=t.expandedNodes.get(e);return{id:e,messageNode:null==n?void 0:n[0],index:null==n?void 0:n[1]}})).filter(Sa),removed:r.reduce(((e,t)=>(e.add(t),e)),new Set),all:t.allNodes}})),Q.h((e=>e.expanded.length>0||e.removed.size>0))),Qn.b((e=>{const{expanded:t,removed:n,all:i}=e;t.length&&(this._logger.debug(`New message(s) expanded [${t.map((e=>e.id))}]`),this._state.modify((e=>{const n=(0,o.zG)(e.expandedMessages,r.UI(u.UI((e=>{var t,n;return{...e,index:null!==(n=null===(t=i.get(e.messageNode))||void 0===t?void 0:t[1])&&void 0!==n?n:e.index}})))),a=t.reduce(((e,t)=>(e.set(t.id,u.x5),e)),new Map(n)),s=t.reduce(((e,t)=>(e.set(t.messageNode,t.id),e)),new Map(e.messageNodeToIdMap)),l=Array.from(i.values()).reduce(((e,[t,n])=>(s.has(t)&&e.set(n,s.get(t)),e)),new Map);return{...e,expandedMessages:a,messageIndexToIdMap:l,messageNodeToIdMap:s}}))),n.size&&(this._logger.debug(`Message(s) removed [${Array.from(n.values())}]`),this._state.modify((e=>{const t=(0,o.zG)(e.expandedMessages,r.UI(u.UI((e=>{var t,n;return{...e,index:null!==(n=null===(t=i.get(e.messageNode))||void 0===t?void 0:t[1])&&void 0!==n?n:e.index}}))),r.hX((e=>!(u.d6(e)&&n.has(e.value.messageNode))))),a=Array.from(n.values()).reduce(((e,t)=>(e.delete(t),e)),new Map(e.messageNodeToIdMap)),s=Array.from(i.values()).reduce(((e,[t,n])=>a.has(t)?e.set(n,a.get(t)):e),new Map);return{...e,expandedMessages:t,messageIndexToIdMap:s,messageNodeToIdMap:a}})))})),fa.j("expanded"),Q.h((e=>e.length>0)),ei.zg(n),Qn.b((({message:{id:e,messageNode:t,index:n},context:i})=>{this._state.modify((a=>({...a,expandedMessages:new Map(a.expandedMessages).set(e,(0,o.zG)(i,Nn.g_((t=>{const n=`Could not extract context for #${e}: ${t}`;return this._logger.warn(n),u.kH(new zn.DH(n))}),(i=>(0,o.zG)(h.fromNullable(t.querySelector(aa.xR)),h.filter(ha.Re),h.fold((()=>{const n=`Could not find message body for #${e}`;return this._logger.warn(n,t),u.kH(new zn.DH(n))}),(a=>{return this._logger.trace(`Message #${e} extracted`),u.Vp({id:e,index:n,messageNode:t,bodyNode:a,context:i,textMap:(s=a,new ca.Z(s,((e,t)=>ca.Z.defaultFilterNodeAllowList(["PRE","CODE","BLOCKQUOTE"])(e,t)&&!ma.W.maybeGmailHistoryQuote(e)),void 0,ca.Z.isBlockNodeFromTagList((0,o.zG)(new Set(ca.Z.blockTags),oa.Od(ni.yv)("CODE"))),void 0,void 0,ma.W.gmailNodeFormatting,void 0,void 0,!1))});var s})))))))})))}))).subscribe())}dispose(){this._subscriptions.unsubscribe()}}function za(e){return(0,o.zG)(h.fromNullable(e.getAttribute("src")),h.filter((e=>!e.includes("no_photo")&&!e.includes("profile_mask"))))}function Ma(e){return a.Y(Nn.wE)({email:(0,o.zG)(Nn.ij(new zn.DH("No email found"))(null==e?void 0:e.getAttribute("email")),Nn.tS((e=>Nn.Yo((()=>new zn.DH("Invalid email address")))(yn.G.create(e))))),name:(0,o.zG)(Nn.ij(new zn.DH("No name found"))(null==e?void 0:e.getAttribute("name")),Nn.UI((e=>e||void 0)))})}function Ta(e,t=5e3){return n=>$n.T(...e.map((e=>n.pipe(Q.h((t=>t.message.id===e.id)),na.V(t),ia.K((t=>E.of({message:e,context:Nn.t$(new zn.DH((null==t?void 0:t.message)||"Timeout"))})))))))}function Aa(e,t,n,i,s,r=5){return l=>{const{left:d,right:c}=(0,o.zG)(l,Ei.uK(i));return $n.T((0,o.zG)(d,Fa(e),Ta(d)),$n.T((0,o.zG)(c,Fa(e),Ta(c),I.U((e=>({...e,kind:"fromDOM"})))),(0,o.zG)(c,function(e,t,n,i=5){const a=new Zn.xQ,s=new Map;return r=>$n.T(E.of(r),a).pipe(qn.w((e=>En.D(e.reduce(((e,t)=>(e.length>0&&e[e.length-1].length<i?e[e.length-1].push(t):e.push([t]),e)),[])))),Ln.M(e),Xn.b((([e,n])=>function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if((0,ra.k)(n))return da(n,null);if((0,la.K)(n)&&Object.getPrototypeOf(n)===Object.prototype){var i=Object.keys(n);return da(i.map((function(e){return n[e]})),i)}}if("function"==typeof e[e.length-1]){var a=e.pop();return da(e=1===e.length&&(0,ra.k)(e[0])?e[0]:e,null).pipe((0,I.U)((function(e){return a.apply(void 0,e)})))}return da(e,null)}(e.map((e=>En.D(Ca(e.id,n,t())).pipe(I.U((t=>({message:e,headers:t}))))))))),Xn.b((e=>e)),qn.w((({message:e,headers:t})=>(0,o.zG)(t,Nn.g_((t=>{n.warn(`Error accessing MIME headers for #${e.id}:`,t.message);const i=s.get(e.id)||0,o=1;return t.mimeMessageNotFound&&i<o?(n.warn(`Retrying to fetch MIME headers for #${e.id}`),s.set(e.id,i+1),a.next([e]),va.E):E.of({message:e,context:Nn.t$(new zn.DH(t.message))})}),(t=>E.of({message:e,context:Nn.F2({date:{kind:"parsedDate",timestamp:t.date.getTime()},author:t.from,audience:t.to.concat(t.cc||[]).concat(t.bcc||[]),replyTo:t.replyTo||[]})})))))))}(t,n,s,r),Ta(c),I.U((e=>({...e,kind:"fromHeaders"}))))).pipe(_a.v((e=>e.message.id)),ei.zg((e=>e.pipe(ti.R(((e,t)=>({...e,message:t.message,[t.kind]:t.context})),{}),Q.h((e=>!!(null==e?void 0:e.message)&&!!(null==e?void 0:e.fromDOM)&&!!(null==e?void 0:e.fromHeaders))),I.U((e=>(0,o.zG)(a.Y(Nn.wE)({fromDOM:e.fromDOM,fromHeaders:e.fromHeaders}),Nn.UI((({fromDOM:e,fromHeaders:t})=>({...e,replyTo:t.replyTo}))),Nn.wp((()=>e.fromDOM)),Nn.wp((()=>e.fromHeaders)),(t=>({message:e.message,context:t}))))))))))}}function Fa(e){return t=>E.of(t).pipe(Ia.u(),I.U((t=>{var n;const i=(0,o.zG)(Nn.ij(new zn.DH("No message date found"))(null===(n=t.messageNode.querySelector(aa.ms))||void 0===n?void 0:n.getAttribute("title")),Nn.tS((t=>(0,o.zG)(new Date(t),(n=>{var i;return Number.isNaN(n.valueOf())?(0,o.zG)(Nn.ij(new zn.DH("No locale found"))(null===(i=e.querySelector(aa.Gg))||void 0===i?void 0:i.getAttribute(aa.sC)),Nn.UI((e=>({kind:"unparsedDate",date:t,locale:e})))):Nn.F2({kind:"parsedDate",timestamp:n.getTime()})}))))),s=(0,o.zG)(Nn.ij(new zn.DH("No message author found"))(t.messageNode.querySelector(aa.OL)),Nn.tS(Ma)),r=(0,o.zG)(Nn.ij(new zn.DH("No <to> field found in message"))(t.messageNode.querySelectorAll(aa.VN)),Nn.tS((e=>(0,o.zG)(Array.from(e),Ei.UI(Ma),Ei.IX.sequence(Nn.wE)))));return{message:t,context:a.Y(Nn.wE)({date:i,author:s,audience:r,replyTo:Nn.F2([])})}})))}function Pa(e){return Array.from(e.children).filter(Oa)}function Oa(e){return e instanceof HTMLDivElement&&(e.matches("[aria-expanded]")&&!!e.innerText||!e.matches("[aria-expanded]"))}function Va(e){return e instanceof HTMLDivElement&&e.matches('[tabindex="-1"]')&&!!e.innerText}function Ra(e){return Array.from(e.querySelectorAll(aa.Py)).filter(Va).length}function Ba(e){const t=e.querySelector(aa.bK),n=t?Pa(t).length:0;if(!t||0===n)return E.of(Nn.t$("No messages"));if(Ra(e)===n)return E.of(Nn.F2(Ua.noExpansionNeeded));const i=e.querySelector(aa.p4);return null==i||i.click(),(0,o.zG)((a=t,ta.rl(a,{subtree:!0,childList:!1,attributes:!0,attributeFilter:["role","aria-expanded"]}).pipe(xn.O(null))),Yn.b(10),Q.h((()=>Ra(e)===n)),na.V(3e3),Kn.q(1),Jn.h(Nn.F2(Ua.expanded)),ia.K((e=>E.of(Nn.t$(e.message)))));var a}!function(e){e.expanded="expanded",e.noExpansionNeeded="noExpansionNeeded"}(Ua||(Ua={}));var Ha=n(41263),Da=n(86620),ja=n(92132),La=n(33678),Za=n(15073),qa=n(42103),Qa=n(64078);const Ka=({env:e,children:t,className:n})=>x.createElement(Yi.o,{className:n},x.createElement($i.p,null,x.createElement(La.a.Context.Provider,{value:new Da.C(e)},x.createElement(ja.Q,{remSize:E.of(16),setter:e=>Za.u.setRootCssVar(document.documentElement,e)},x.createElement(qa.G.DefaultProvider,null,t,x.createElement(Wi.p,{regular:!0,bold:!0}),x.createElement(Ji.G,null),x.createElement(Qa.X,null))))));var $a=n(16782);const Ja=`${aa.k2} > div + div`;class Wa{constructor(e,t,n=Hn.Y.create("Reader-Gmail-Panel")){this._logger=n,this._mounted=new $a.t(1),this.elementRef=x.createRef(),this.mounted=this._mounted.asObservable(),this._injectionSub=e.pipe(qn.w((e=>new sa.y((()=>(0,o.zG)(h.fromNullable(e.querySelector(Ja)),h.filter((e=>e instanceof HTMLElement)),h.fold((()=>o.Q1),(e=>{const n=Mi.VB.get({monitorAs:"reader-panel"}).inject(Ti.EM.fromDocument(e.ownerDocument,"grammarly-extension"),Ti.zs.appendChild(e),(()=>x.createElement(Ha.L,{chunkName:"readerGmailThreadIntegration"},x.createElement(Ka,{env:(0,d.O)()},x.createElement("div",{style:{marginTop:"2rem"},ref:this.elementRef},x.createElement(t,null))))));return this._mounted.next(),this._logger.debug("Panel injected"),()=>{n.dispose(),this._logger.debug("Panel disposed")}})))))))).subscribe()}dispose(){this._injectionSub.unsubscribe()}}var Ya=n(35214),Xa=n(32426),eo=n(45701),to=Ya.getFunctionMonoid(h.getApplyMonoid({concat:(0,Xa.getJoinSemigroup)(eo.ordNumber).concat,empty:0}))();function no(e){return function(t){return t.iterNumber>=e?h.none:h.some(0)}}function io(e){return function(t){return h.some(e*Math.pow(2,t.iterNumber))}}var ao={iterNumber:0,cumulativeDelay:0,previousDelay:h.none};var oo=to;class so{constructor(e){this._rpc=e,this.getReaderAnnotations=this._rpc.getReaderAnnotations,this.getReaderSummaries=this._rpc.getReaderSummaries}}var ro=n(99596),lo=n(99950),co=n(62965);function mo(e,t,n){var i=Ya.fold(oo)(t);return sa.y.create((function(t){var a=!1,o=function(s){return(0,wi.pipe)(co.dk((function(){return t.next(u.x5)})),co.a1(e),co.g_((function(e){var r=!a&&n(e)?function(e,t){var n=e(t);return{iterNumber:t.iterNumber+1,cumulativeDelay:t.cumulativeDelay+h.getOrElse((function(){return 0}))(n),previousDelay:n}}(i,s):ao;return(0,wi.pipe)(r.previousDelay,h.fold((function(){return co.t$(e)}),(function(n){return t.next(u.vU(e,{cumulativeDelay:r.cumulativeDelay,iterNumber:r.iterNumber,previousDelay:n})),(0,wi.pipe)(co.F2(r),lo.delay(n),co.tS((function(t){return a?co.t$(e):o(t)})))})))}),co.F2))};return(0,wi.pipe)(o(ao),co.Pd((function(e){return t.next(u.kH(e))}),(function(e){return t.next(u.Vp(e))})))().then((function(){return t.complete()}),(function(e){return t.error(e)})),function(){return a=!0}}))}var uo=n(77150);class po{constructor(e,t,n=d.O,i,a=Hn.Y.create("Reader-Gmail-Remote-Data")){this._threadContext=e,this._useCaching=t,this._getEnv=n,this._telemetry=i,this._logger=a,this._subscriptions=new In.w,this._rpcClient=(0,Bn.Vo)((()=>new so(this._getEnv().bgRpc.api))),this._summariesToFetch=new Zn.xQ,this._annotationsToFetch=new Zn.xQ,this._summariesReadyToFetch=new Zn.xQ,this._annotationsReadyToFetch=new Zn.xQ,this._summaries=Cn.h.create(new Map),this._annotations=Cn.h.create(new Map),this.summaries=this._summaries.view(),this.annotations=this._annotations.view(),this._subscriptions.add(this._summariesToFetch.pipe(ho(this._threadContext)).subscribe((e=>this._summariesReadyToFetch.next(e)))),this._subscriptions.add(this._annotationsToFetch.pipe(ho(this._threadContext)).subscribe((e=>this._annotationsReadyToFetch.next(e)))),this._subscriptions.add(this._summariesReadyToFetch.pipe(ei.zg((e=>this._getSummaries(e).pipe(I.U((t=>({requestedIds:e,response:t}))))))).subscribe((({requestedIds:e,response:t})=>{this._summaries.modify((n=>Array.from(e).reduce(((e,i)=>e.set(i,(0,o.zG)(u.n2(t)?(0,o.zG)(h.fromNullable(n.get(i)),h.getOrElse((()=>u.x5))):t,u.UI((e=>h.fromNullable(e[i])))))),new Map(n))))}))),this._subscriptions.add(this._annotationsReadyToFetch.pipe(ei.zg((e=>this._getAnnotations(e).pipe(I.U((t=>({requestedIds:e,response:t}))))))).subscribe((({requestedIds:e,response:t})=>{this._annotations.modify((n=>Array.from(e).reduce(((e,i)=>e.set(i,(0,o.zG)(u.n2(t)?(0,o.zG)(h.fromNullable(n.get(i)),h.getOrElse((()=>u.x5))):t,u.UI((e=>e[i]||[]))))),new Map(n))))})))}fetchSummaries(e){this._logger.debug(`requesting summaries for [${Array.from(e)}]`),this._summariesToFetch.next(e)}fetchAnnotations(e){this._logger.debug(`requesting annotations for [${Array.from(e)}]`),this._annotationsToFetch.next(e)}dispose(){this._subscriptions.unsubscribe()}_getThreadInfoForBackend(){return(0,o.zG)(this._threadContext.get(),(e=>a.Y(Nn.wE)({id:e.threadId,subject:e.subject,messageCount:Nn.F2(e.messageCount),messages:Nn.F2(Array.from(e.expandedMessages.values()).filter(u.d6).map((e=>e.value))),loggedUser:e.loggedUser})),Nn.UI((e=>({...e,messages:e.messages.reduce(((t,n)=>(t[n.id]={id:n.id,index:n.index,subject:e.subject,body:n.textMap.getRichText(),plainText:n.textMap.getPlainText(),date:n.context.date,author:n.context.author,audience:n.context.audience,replyTo:n.context.replyTo},t)),{})}))))}_getSummaries(e){return(0,o.zG)(this._getThreadInfoForBackend(),Nn.g_((e=>E.of(u.kH(e))),(t=>mo((()=>(this._logger.debug(`Fetching summaries for [${Array.from(e)}]`),this._rpcClient.get().getReaderSummaries({id:t.id,subject:t.subject,messages:(0,o.zG)(t.messages,l.u4({},((e,t)=>(e[t.index]=(0,bn.fH)(t),e)))),num_messages:t.messageCount},(0,bn.Rs)(t.loggedUser),Array.from(e),this._useCaching.get()).then((e=>((0,o.zG)(e,Nn.Pd((e=>{this._telemetry.readerGmail.warning("summariesResponse",e.message,e),this._logger.warn("Summaries error",e.message)}),(e=>{this._logger.debug("Received summaries",e)}))),e))))),[no(3),io(5e3)],(e=>e instanceof ro.Lu||e instanceof ro.Bb&&e.code>=500)))))}_getAnnotations(e){return(0,o.zG)(this._getThreadInfoForBackend(),Nn.g_((e=>E.of(u.kH(e))),(t=>mo((()=>(this._logger.debug(`Fetching annotations for [${Array.from(e)}]`),this._rpcClient.get().getReaderAnnotations({id:t.id,subject:t.subject,messages:(0,o.zG)(t.messages,l.u4({},((e,t)=>(e[t.index]=(0,bn.fH)(t),e)))),num_messages:t.messageCount},(0,bn.Rs)(t.loggedUser),Array.from(e),this._useCaching.get()).then((e=>((0,o.zG)(e,Nn.Pd((e=>{this._telemetry.readerGmail.warning("annotationsResponse",e.message,e),this._logger.warn("Annotations error",e.message)}),(e=>{this._logger.debug("Received annotations",e)}))),e))).then(Nn.UI((0,o.ls)(l.Su(((e,n)=>{var i;const a=null===(i=t.messages[e])||void 0===i?void 0:i.plainText;return void 0!==a?n.map((e=>({...e,text:a.slice(e.span.s,e.span.e)}))):[]}))))))),[no(3),io(5e3)],(e=>e instanceof ro.Lu||e instanceof ro.Bb&&e.code>=500)))))}}function ho(e){return t=>{const n=new Zn.xQ;return(0,o.zG)(t,Xn.b((e=>En.D(Array.from(e)))),ei.zg((t=>e.pipe(I.U((e=>(0,o.zG)(h.fromNullable(e.expandedMessages.get(t)),h.fold(o.jv,u.d6)))),Q.h(Bn.fQ),Kn.q(1),Jn.h(t)))),Qn.b((()=>n.next())),uo.R((()=>n.pipe(Yn.b(200)))),I.U((e=>new Set(e))),Q.h((e=>e.size>0)))}}function go(e,t,n,i,u,p,g,f,v,y=d.O,x=Hn.Y.create("Reader-Gmail-Thread-Integration")){const k=Bn.iy.create(),U=new Ga(u.doc,e,Aa(u.doc,t,(()=>u.url),(e=>0===e.index),x),v),C=new po(U.threadContext,i,y,v),S=n.has("inlineCards")?new ea(wn.aj([C.annotations,p.view((e=>(0,o.zG)(U.threadContext.get().threadId,h.fromEither,h.chain((t=>{var n,i;return(0,o.zG)(h.fromNullable(null===(i=null===(n=e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.annotations),h.map((0,o.ls)(l.UI((0,o.ls)(m.T.decode,h.fromEither)),l.oA,l.u4(new Set,((e,t)=>t.dismissed?e.add(t.itemId):e)))))})),h.getOrElse((()=>new Set)))))]).pipe(Ln.M(U.threadContext),I.U((([[e,t],n])=>(0,o.zG)(e,r.Su(((e,i)=>(0,o.zG)(a.Y(h.option)({annotations:(0,o.zG)(i,Na.zk,h.map(s.hX((n=>!t.has(m.p.Id.create(e,n.span))))),h.chain(oe.nI)),message:(0,o.zG)(h.fromNullable(n.expandedMessages.get(e)),h.chain(Na.zk))}),h.map((({annotations:e,message:t})=>({messageId:t.id,textMap:t.textMap,bodyNode:t.bodyNode,annotations:e})))))),r.DZ(o.yR))))),e):null,G=new Zn.xQ,z=function(e,t,n){const i=e=>(0,o.zG)(t.get().threadId,h.fromEither,Un.bw(e));return{onboardingFinished:t=>e.seenReaderGmailOnboarding(t),navigate:(e,t)=>n.next({nextActiveIndex:e,navigationAction:t}),updateSummaryItem:t=>i((n=>e.readerGmailUpdateSummaryItem({threadId:n,item:t}))),updateAnnotationItem:t=>i((n=>e.readerGmailUpdateAnnotationItem({threadId:n,item:t}))),updatePersonItem:t=>i((n=>e.readerGmailUpdatePersonItem({threadId:n,item:t})))}}(g,U.threadContext,G),M=(T=n).has("summaries")||T.has("needsResponse")||T.has("peopleAndLinks")?new Tn(U.threadContext,C.summaries,C.annotations,u.config.bundleInfo.browser,f,k,n,p.get(),z):null;var T;const A=M?new Wa(U.threadContext.view((e=>e.messageCount)).pipe(I.U((()=>{const t=Pa(e);return h.fromNullable(t[t.length-1])})),Dn.oA,kn.x()),(()=>{return w.UI.mount(hn,(e=M,w.Z.composeUnion({collapsed:q(e),expanded:Qt(e),onboarding:pn(e)},(()=>e.state.pipe(I.U((e=>_(e)&&b(e.activeView)?{kind:"onboarding"}:e)))))));var e})):null,F=G.pipe(qn.w((()=>Ba(u.doc))),Qn.b(Nn.Pd((e=>x.warn("Error while expanding messages",e)),(e=>{switch(e){case Ua.expanded:return x.trace("Messages expanded");case Ua.noExpansionNeeded:return x.trace("Thread already expanded");default:(0,N.vE)(e)}}))),jn.shareReplay({bufferSize:1,refCount:!0})),P=U.threadContext.pipe(Kn.q(1),Qn.b((e=>f.readerMailSessionStart(e.messageCount,k,(0,o.zG)(e.threadId,h.fromEither,h.toUndefined))))).subscribe(),O=(0,c.W$)(e),V=O?$n.T(G.pipe(I.U((e=>{var t;return(null===(t=null==A?void 0:A.elementRef)||void 0===t?void 0:t.current)?A.elementRef.current.getBoundingClientRect().top:null}))),F.pipe(Jn.h(null))).pipe(Wn.G()).subscribe((([e,t])=>{var n;if((null===(n=null==A?void 0:A.elementRef)||void 0===n?void 0:n.current)&&null===t&&null!==e){const t=A.elementRef.current.getBoundingClientRect().top;O.scrollTop=O.scrollTop+t-e}})):null,R=F.subscribe(),B=p.pipe(qn.w((e=>e.seenOnboarding?E.of(!!e.enabled):p.pipe(Q.h((e=>!!e.seenOnboarding)),I.U((e=>!!e.enabled))))),Kn.q(1)),H=n.has("summaries")&&A?$n.T(G,A.mounted.pipe(I.U((e=>({nextActiveIndex:1/0,navigationAction:"last"}))),(0,Na.Gx)(B))).pipe(Yn.b(100),Xn.b((({nextActiveIndex:e,navigationAction:t})=>{const n=U.threadContext.get().messageCount,i=e=>e>=0&&e<n;switch(t){case"left":return En.D([e-1,e].filter(i));case"right":return En.D([e,e+1].filter(i));case"first":return En.D([0,1].filter(i));case"last":return En.D([n-2,n-1].filter(i));default:(0,N.vE)(t)}})),ei.zg((e=>U.threadContext.view((t=>t.messageIndexToIdMap.get(e))).pipe(Q.h(Bn.fQ),Kn.q(1)))),ti.R(((e,t)=>new Set(e).add(t)),new Set),(0,Na.Yp)(ni.yv)).subscribe((e=>C.fetchSummaries(e))):null,D=n.has("needsResponse")||n.has("inlineCards")?U.threadContext.view((e=>new Set(e.messageIndexToIdMap.values()))).pipe(ti.R(((e,t)=>new Set(Array.from(e).concat(Array.from(t)))),new Set),(0,Na.Yp)(ni.yv),(0,Na.Gx)(B)).subscribe((e=>C.fetchAnnotations(e))):null;return"prod"!==u.config.bundleInfo.env&&(0,Na.h$)(u.doc,{threadContextManager:U,threadRemoteDataManager:C,panelViewModel:M}),x.debug("page integration created"),()=>{f.readerMailSessionEnd(k,(0,o.zG)(U.threadContext.get().threadId,h.fromEither,h.toUndefined)),null==D||D.unsubscribe(),null==H||H.unsubscribe(),P.unsubscribe(),R.unsubscribe(),null==V||V.unsubscribe(),null==A||A.dispose(),null==M||M.dispose(),null==S||S.dispose(),C.dispose(),U.dispose(),x.debug("page integration disposed")}}},86620:(e,t,n)=>{n.d(t,{U:()=>i,C:()=>d});var i,a=n(27378),o=n(29511),s=n(33678),r=n(88056),l=n(95574);!function(e){let t;!function(e){e.isAppleSystem="isAppleSystem"}(t=e.SidebarFlag||(e.SidebarFlag={})),e.Flag={...t,...s.a.Flag},e.Context=a.createContext(r.Y.invariantContent("Environment"))}(i||(i={}));class d{constructor(e=(0,o.O)()){this._flags=new Set,this.actions={openUrl:e=>l.vM((()=>{document.location.href=e.toString()})),openPopup:e=>l.vM((()=>{const t=self.open(e.toString(),void 0,"noreferrer");t&&(t.opener=null)}))},e.config.systemInfo.os.isMac&&this._flags.add(i.Flag.isAppleSystem),this._flags.add(i.Flag.supportsSVGDominantBaseline),this._flags.add(i.Flag.onlyTrustedEvents)}has(e){return this._flags.has(e)}}},92132:(e,t,n)=>{n.d(t,{Q:()=>l});var i=n(27378),a=n(15073),o=n(60797),s=n(95300),r=n(5114);const l=({children:e,remSize:t,setter:n})=>(d+=1,i.useEffect((()=>{const e=t.subscribe((e=>{c.next(r.some(e)),n(r.some(e))}));return()=>{e.unsubscribe(),d-=1,0===d&&(c.next(r.none),n(r.none))}}),[t]),i.createElement(a.u.Context.Provider,{value:c.pipe(o.oA)},e));let d=0;const c=new s.X(r.none)},86705:(e,t,n)=>{n.d(t,{v:()=>o});var i=n(27378),a=n(80895);const o=({browser:e,className:t})=>"safari"!==e?i.createElement(a.C,{title:"BETA",className:t}):null},31944:(e,t,n)=>{n.d(t,{J:()=>r});var i=n(57050),a=n(27378),o=n(12187),s=n(22536);const r=({onChange:e,labelId:t,className:n,checkboxClassName:r,labelClassName:l,checked:d,children:c,disabled:m,dataGrammarlyPart:u="ui-kit-checkbox"})=>{const[p,h]=a.useState(null!=d&&d);a.useEffect((()=>{h(Boolean(d))}),[d]);const g=t=>{t.preventDefault(),t.stopPropagation(),h(!p),null==e||e(!p)};return a.createElement("div",{"data-grammarly-part":u,...(0,o.Sh)(s.checkboxContainer,n)},a.createElement("div",{...(0,o.Sh)(s.checkbox,r,p?s.checkboxChecked:null),role:"checkbox","aria-checked":p,tabIndex:0,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&g(e)},onClick:m?i.Q1:g},p?a.createElement("div",{className:s.checkboxCheckmark}):null),a.createElement("label",{id:t,onClick:g,className:l},c))}},18347:(e,t,n)=>{n.d(t,{Eh:()=>a,e5:()=>o,Od:()=>s,nI:()=>r});var i=n(13853),a=(i.ZN,new Set,i.AO,i.Eh);i.G,i.UI,i.yW,i.tS,i.KX;i.t9,i.G0,i.jV,i.tV;var o=i.e5,s=(i.Lf,i.oP,i.u4,i.Lx,i.ri,i.$T,i.Od);var r=i.nI;i.oA,i.xu,i.DZ},31846:e=>{e.exports={avatar:"xNYnb",image:"_3Yg3q"}},83771:e=>{e.exports={layout:"_1hKpE",column:"_1rBJw",sectionTitle:"-RBKX"}},47397:e=>{e.exports={empty:"_1XVf-",title:"_2AfjV",body:"_21gih"}},50243:e=>{e.exports={list:"u22ST"}},45587:e=>{e.exports={itemLoading:"KdASy",lineOnly:"_3gA50",line:"_3btGG",lineLoading:"_3W_2s",rect:"_2Ln0z",rectLoading:"_1pxCc",lineAndCheckbox:"_3ZgMs",lineAndAvatar:"_1j1Dr"}},3179:e=>{e.exports={personAndAvatar:"_3MMkk",nameOrEmail:"_1R3id"}},60550:e=>{e.exports={item:"_25lS0",pinned:"_3CdmO",dropdownList:"_1dcKJ",dropdownContainer:"_3yFNu",button:"_2jVbU"}},69566:e=>{e.exports={title:"rOb7m"}},11071:e=>{e.exports={textChecked:"_1Sg3F",checkboxWrapper:"_45wj5",label:"_1ybvy",checkbox:"T4rHe"}},48789:e=>{e.exports={loader:"_38SVK"}},79579:e=>{e.exports={emptyCTAButton:"_3kUpB"}},89739:e=>{e.exports={activeMailInfo:"_31J8M",date:"fHbk9",author:"BD2pG"}},37903:e=>{e.exports={header:"_1mfP5"}},14692:e=>{e.exports={navigationFrame:"v_SsT",buttonGroup:"_3n1p4",iconJump:"_22-y3",iconGoFirst:"_2OzZD",icon:"_3hVGV"}},16204:e=>{e.exports={buttonGroup:"_2tWWr",button:"_1jXO0"}},40349:e=>{e.exports={controls:"_2Hipc",onboardingButtonGroup:"_-9OmU",optInButton:"_5OTjn",optOutButton:"_30tah",navigation:"_1jU2d",leftButton:"P6wpw",rightButton:"_3CBvI",arrowRight:"D-jgQ",stepOfN:"_1HJSf"}},57391:e=>{e.exports={illustration:"fcee3"}},51869:e=>{e.exports={onboarding:"_2ODbM",logo:"Lr1qJ",content:"_3-26v",badge:"_3POlX",steps:"_31CBV"}},19230:e=>{e.exports={title:"gf4R_",body:"_2Vehu"}},23556:e=>{e.exports={header:"_3kzGL"}},35300:e=>{e.exports={onboarding:"_1hppt",toolbar:"_38d_I"}},64908:e=>{e.exports={panelGrid:"_1oojw",header:"_15T_5"}},58120:e=>{e.exports={recapButton:"_318vF",logo:"Tn0sZ",recap:"_3L1sH"}},64051:e=>{e.exports={alignRight:"_38MZ-"}},22536:e=>{e.exports={checkboxContainer:"_3bj_g",checkbox:"xrB8R",checkboxChecked:"Uhddy",checkboxCheckmark:"_1qI2g",spin:"_3S_a3"}}}]);