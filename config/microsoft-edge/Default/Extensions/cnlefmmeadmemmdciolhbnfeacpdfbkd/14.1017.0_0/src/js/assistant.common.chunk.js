(self.webpackChunk=self.webpackChunk||[]).push([[8721],{51897:(e,t,i)=>{var a=i(25682),s="chrome-extension://__MSG_@@extension_id__/",r="moz-extension://__MSG_@@extension_id__/",n="safari-web-extension://__MSG_@@extension_id__/",o=self.GR_RESOURCE_ROOT||s,l=self.GR_RESOURCE_ROOT||r,c=self.GR_RESOURCE_ROOT||n;e.exports={__css:a.toString().replace(new RegExp(s,"g"),o).replace(new RegExp(r,"g"),l).replace(new RegExp(n,"g"),c),...a.locals}},16037:(e,t,i)=>{i.d(t,{t:()=>H});var a=i(57050),s=i(40273),r=i(90361),n=i(36991);var o=i(34311),l=i(62337),c=i(95384),d=i(63919),u=i(30067),p=i(74850),m=i(32952),h=i(85985),g=i(77176),v=i(93508);class f{constructor(){this._mapByHighlightId=new Map,this._mapByAlertId=new Map,this._highlightDataChanged=new m.xQ,this.highlightDataChanged=this._highlightDataChanged}getByHighlightId(e){return this._mapByHighlightId.get(e)}getByAlertId(e){const t=this._mapByAlertId.get(e)||new Set;return Array.from(t).map((e=>this._mapByHighlightId.get(e))).filter((e=>!!e))}get(e){return this._mapByHighlightId.get(e)}has(e){return this._mapByHighlightId.has(e)}set(e,t){this._mapByHighlightId.set(e,t);const i=this._mapByAlertId.get(t.alertId)||new Set;i.add(e),this._mapByAlertId.set(t.alertId,i),this._highlightDataChanged.next(e)}delete(e){const t=this._mapByHighlightId.get(e);if(t){const i=this._mapByAlertId.get(t.alertId);void 0!==i&&(i.delete(e),0===i.size&&this._mapByAlertId.delete(t.alertId)),this._mapByHighlightId.delete(e)}this._highlightDataChanged.next(e)}forEach(e){this._mapByHighlightId.forEach(e)}getHighlightDataObs(e){return this._highlightDataChanged.pipe(h.h((t=>t===e)),g.U((()=>this.getByHighlightId(e))),v.O(this.getByHighlightId(e)))}}class w{constructor(e,t,i,a,s=(()=>d.E9.zero),r=p.Y.create(w.name)){this._denaliHighlights=e,this._getFluidHighlights=t,this._getTextMap=i,this._getParentRect=a,this._getParentScroll=s,this._log=r}register(e,t,i,a){if(null!==e){if(this._denaliHighlights.has(e))return this.update(e,t,i,a);{const s=new c.Fd(e,t,this._getFluidHighlights(),this._getParentRect,this._getParentScroll),r={id:e,alertId:a.alertId,mark:s,visualization:i};this._denaliHighlights.set(e,r);const n=this._getTextMap().getPlainText();return this._getFluidHighlights().addHighlight(e,(0,u.rX)((0,u.mp)(s.range),n),a),r}}return null}remove(e){this._denaliHighlights.has(e)?(this._getFluidHighlights().removeHighlights([e]),this._denaliHighlights.delete(e)):this._log.warn(`can't remove mark #${e}, doesn't exist`)}update(e,t,i,a){const s=this._denaliHighlights.get(e);if(s){this._denaliHighlights.set(e,{...s,visualization:i});const r=this._getTextMap().getPlainText();return this._getFluidHighlights().updateHighlight(e,(0,u.rX)(t.meta.range(),r),a),s}return this._log.warn("cannot update not existing highlight",e),null}clearAll(){this._denaliHighlights.forEach((e=>{this._getFluidHighlights().removeHighlights([e.id])}))}}var b=i(55073),S=i(5817),y=i(25938),_=i(6368),k=i(59443),A=i(24645),C=i(51374),E=i(9922),I=i(24209),M=i(40151),T=i(76974),x=i(95300),R=i(77150),L=i(80900),F=i(50628),P=i(22232),V=i(95574),B=i(5114),O=i(71249),N=i(95195);class H{constructor(e,t,i,s,r,n,d=p.Y.create(H.name),u,v){this._highlights=e,this._textObserver=t,this._replacementService=i,this._layout=s,this._scroller=r,this._selectedHighlightsTracker=n,this._log=d,this._requestAwaitService=u,this._formattingService=v,this._subs=new E.w.Keeper,this._disposed=!1,this._highlightedAlertId=null,this._marks=new Map,this._highlightsDataStore=new f,this._highlightUpdater=new w(this._highlightsDataStore,(()=>this._highlights),(()=>this._textObserver.getTextSource()),(()=>{const e=this._layout.textField.rect.getApproximate();return l.Pf.create({...e.client,...e.size})}),(()=>this._layout.textField.scroll.getApproximate())),this.highlightHoverProvider={getHoveredStateBehavior:e=>this._highlightsDataStore.getHighlightDataObs(e).pipe(g.U((e=>e&&e.visualization.type===c.sO.Change.VisualState.Type.highlighted?{[c.sO.Change.VisualState.Source.sidebar]:o.pc.hovered_needs_attention,[c.sO.Change.VisualState.Source.text]:o.pc.hovered,[c.sO.Change.VisualState.Source.api]:this._highlightedAlertId===e.alertId?o.pc.hovered:o.pc.none}[e.visualization.source]:o.pc.none)))},this._updateContentsBuffer=new m.xQ,this._flushUpdater=new m.xQ,this.getContents=(e,t)=>{if(this._log.trace(`getContents, ${e}, ${t}`),this._formattingService){const i=this._textObserver.getTextSource().getRichText();return y.RI.unsafeRes(void 0!==e?i.slice(e,void 0!==t?e+t:void 0):i)}{const i=void 0!==e?this.getText().slice(e,void 0!==t?e+t:void 0):this.getText();return y.RI.resFromText(i)}},this.changes=I.T((0,a.zG)(y.RI.res(this.getContents().delta),N.g_((()=>M.E),(e=>T.of(e)))),this._textObserver.contentChanges.async.pipe(h.h((e=>e.changes.length>0)),g.U((({deltaChange:e})=>e)))),this.activeMarks=new x.X(B.none),this.contentUpdated=new m.xQ,this.hoveredMarks=new x.X(B.none),this.textChangedAfterPaste=new m.xQ,this.activeWord=new x.X(B.none),this.clickedWord=new x.X(B.none),this.ongoingSelection=new x.X(!1),this._log.info(`${H.name} created`),this._subs.push(this._subscribeToContentUpdates(),this._subscribeToSelectedHighlight(),this._trackFocusedAlert())}_trackFocusedAlert(){return this._highlightsDataStore.highlightDataChanged.pipe(g.U((e=>this._highlightsDataStore.getByHighlightId(e))),h.h((e=>!!e))).subscribe((e=>{this._highlightedAlertId===e.alertId||e.visualization.type!==c.sO.Change.VisualState.Type.highlighted||e.visualization.source!==c.sO.Change.VisualState.Source.text&&e.visualization.source!==c.sO.Change.VisualState.Source.sidebar?e.alertId===this._highlightedAlertId&&e.visualization.type===c.sO.Change.VisualState.Type.visible&&(this._highlightedAlertId=null,this._log.trace(`Mark ${e.id} unfocused - alertId ${e.alertId}`)):(this._highlightedAlertId=e.alertId,this._log.trace(`Mark ${e.id} focused - alertId ${e.alertId}`))}))}pushChanges(e,t){this._log.trace("pushChanges",{change:e,source:t}),y.RI.isFlush(e)?this._flushUpdater.next():y.RI.isReset(e)?this._log.warn("Got unknown reset"):this._updateContents(e.delta,t)}getText(){return this._log.trace("getText"),this._formattingService?(0,b.l)(this._textObserver.getTextSource().getRichText(),""):this._textObserver.getTextSource().getPlainText()}getTextLength(){return this._log.trace("getTextLength"),this.getText().length}flushChanges(){this._log.trace("flushChanges")}getCursor(){return this._log.trace("getCursor"),k.Y1.empty}setCursor(e,t,i){return this._log.trace("setCursor",{_index:e,_length:t,_source:i}),N.F2(void 0)}getLastPossibleCursorPosition(){return this._log.trace("getLastPossibleCursorPosition"),0}_doMarkAction(e){const t=o.y$.Id.createFromMark(e.id),i=e.meta.capiAlertId;switch(e.action){case A.v.Change.ActionType.create:const a=this._highlightUpdater.register(t,e,e.meta.visualState,{alertId:i,highlightId:t,highlightColor:e.meta.highlightColor,highlightDisplayFormat:e.meta.highlightDisplayFormat,highlightDisappearOnHoverDelay:e.meta.highlightDisappearOnHoverDelay}),s=(null==a?void 0:a.mark)||null;return s&&this._marks.set(s.id,s),s;case A.v.Change.ActionType.update:const r=this._highlightUpdater.update(t,e,e.meta.visualState,{alertId:i,highlightId:t,highlightColor:e.meta.highlightColor,highlightDisplayFormat:e.meta.highlightDisplayFormat,highlightDisappearOnHoverDelay:e.meta.highlightDisappearOnHoverDelay}),n=(null==r?void 0:r.mark)||null;return n&&this._marks.set(n.id,n),n;case A.v.Change.ActionType.remove:return this._highlightUpdater.remove(t),this._marks.delete(e.id),null;default:(0,P.vE)(e)}}changeMarks(e){return this._disposed?(this._log.debug("changeMarks called after disposed, returning empty result"),A.v.Change.Result.getEmpty()):(this._log.trace("changeMarks",{rawMarks:e}),e.reduce(((e,t)=>{switch(t.action){case A.v.Change.ActionType.create:e.created.set(t.id,N.ij(new Error("Cannot create mark"))(this._doMarkAction(t)));break;case A.v.Change.ActionType.update:e.updated.set(t.id,N.ij(new Error("Cannot update mark"))(this._doMarkAction(t)));break;case A.v.Change.ActionType.remove:this._doMarkAction(t),e.removed.set(t.id,N.F2(void 0))}return e}),A.v.Change.Result.getEmpty()))}scrollToMark(e,t){var i;const a=null!==(i=this._marks.get(e))&&void 0!==i?i:null;return this._log.trace("scrollToMark",{markId:e,mark:a,opts:t}),a?this._scroller.scrollToMark(a,t):(this._log.warn(`Tried to scroll to nonexistent mark with id: ${e}`),M.E)}_subscribeToContentUpdates(){return this._updateContentsBuffer.pipe(R.R((()=>I.T(L.H((0,S.Xd)(20)),this._flushUpdater).pipe(F.P()))),h.h((e=>e.length>0)),g.U((e=>e.reduce(((e,t)=>e.compose(t)),new _.i)))).subscribe((e=>{const t=this._replacementService.performBatchReplacements((i=e,i.reduce((({actions:e,index:t},i)=>{const a=e[0];return n.s.isInsertString(i)?(e.unshift({pos:{start:t,end:t},value:i.insert}),{actions:e,index:t}):n.s.isInsertEmbed(i)?{actions:e,index:t+1}:n.s.isRetain(i)?{actions:e,index:t+i.retain}:n.s.isDelete(i)?(a&&a.pos.start===a.pos.end&&a.pos.end===t?a.pos={...a.pos,end:a.pos.end+i.delete}:e.unshift({pos:{start:t,end:t+i.delete},value:""}),{actions:e,index:t+i.delete}):void(0,r.vE)(i)}),{actions:[],index:0}).actions.reduce(((e,t)=>(e.length&&e[e.length-1].value&&e[e.length-1].pos.start===t.pos.start?e[e.length-1].value=`${t.value}${e[e.length-1].value}`:e.push(t),e)),[]))).then((()=>{const t=(e=>e.reduce((({formattings:e,index:t},i)=>s.m.hasFormatting(i)?n.s.isInsertString(i)?(e.push({range:{start:t,end:"\n"===i.insert?t:t+i.insert.length},formatting:i.attributes}),{formattings:e,index:t+i.insert.length}):n.s.isInsertEmbed(i)?{formattings:e,index:t+1}:n.s.isRetain(i)?(e.push({range:{start:t,end:t+i.retain},formatting:i.attributes}),{formattings:e,index:t+i.retain}):{formattings:e,index:t}:n.s.isInsertString(i)?{formattings:e,index:t+i.insert.length}:n.s.isInsertEmbed(i)?{formattings:e,index:t+1}:n.s.isRetain(i)?{formattings:e,index:t+i.retain}:n.s.isDelete(i)?{formattings:e,index:t}:void(0,r.vE)(i)),{formattings:[],index:0}).formattings)(e);this._formattingService&&t.length&&(this._log.trace("Have formattings, applying",t),t.forEach((e=>{this._formattingService&&this._formattingService.apply(e.range,e.formatting)})))}),(()=>{this._log.warn("Failed to apply batch replacements")}));var i;this._requestAwaitService&&this._requestAwaitService.addRequest(t)}))}_subscribeToSelectedHighlight(){return this._selectedHighlightsTracker.pipe(g.U((0,a.ls)(O.UI((e=>{var t;return(0,a.zG)(B.fromNullable(null===(t=this._highlightsDataStore.get(e))||void 0===t?void 0:t.mark),B.filter((e=>(0,a.zG)(e.range(),N.g_(a.W8,(0,a.ff)(C.x.isEnclosingView))))))})),O.oA))).subscribe((e=>this.activeMarks.next(B.some(e))))}_updateContents(e,t){this._updateContentsBuffer.next((0,b.AQ)(e))}getSelectionRect(){throw this._log.trace("getSelectionRect"),Error("not implemented")}setContents(e){this._log.trace("setContents",{_value:e})}getHTML(){return this._log.trace("getHTML"),""}getPossibleCursorPosition(e,t){return this._log.trace("getPossibleCursorPosition",{_x:e,_y:t}),V.vM((()=>{throw new Error("Not implemented")}))}dispose(){this._highlightUpdater.clearAll(),this._subs.dispose(),this._log.info(`${H.name} disposed`),this._disposed=!0}}},25913:(e,t,i)=>{i.d(t,{Y:()=>p,q:()=>m});var a=i(57050),s=i(41398),r=i(77176),n=i(93508),o=i(46861),l=i(40033),c=i(10720),d=i(66896),u=i(5114);const p=(e,t)=>{const i=(0,c.ux)(e.lensState,e.cardsListScrollManager,e.capabilities),a=Math.max(600,t.size.height+o.O.headerHeight+o.O.panelHeight);return i.pipe((0,s.M)(e.predictionsPreviewViewModel.previewState),(0,r.U)((([e,t])=>{if(t.kind!==l.fA.visible)return e;const i=[t.readersAttention,t.tone].filter(u.isSome).length;return i>0?e+o.O.predictionsPreviewHeaderHeight+o.O.predictionInsightHeight*i+o.O.predictionInsightBottomMargin:e})),(0,n.O)(0),(0,r.U)((e=>Math.max(e+o.O.headerHeight,a))),(0,r.U)((e=>Math.min(e,750))))},m=(e,t,i)=>s=>{const r=e(),n=e=>e*i(),o=n(1),l=n(2.25);return(0,a.zG)(t(),u.map((e=>e-(0,c.US)(r))),u.map((e=>d.R.isMainLens(r)&&s?e-l-o:e-o)),u.map((e=>e-n(1))),u.filter((e=>e>0)))}},18126:(e,t,i)=>{i.d(t,{f:()=>o});var a=i(95300),s=i(2844),r=i(66310),n=i(34311);class o{constructor(e){this._originalHoverProvider=e,this._assistantHoverProviderSbj=new a.X(null)}setAssistantHover(e){this._assistantHoverProviderSbj.next(e)}removeAssistantHover(){this._assistantHoverProviderSbj.next(null)}getHoveredStateBehavior(e){const t=this._originalHoverProvider.getHoveredStateBehavior(e);return this._assistantHoverProviderSbj.pipe((0,r.w)((i=>null==i?t:(0,s.aj)(t,i.getHoveredStateBehavior(e),((e,t)=>t!==n.pc.none?t:e)))))}}},8467:(e,t,i)=>{i.d(t,{t:()=>c});var a=i(40327),s=i(30067),r=i(95384),n=i(91402),o=i(44586),l=i(95195);function c({scrollToMarkRect:e,scrollToRange:t}){return{scrollToMark:(i,c)=>(0,a.pipe)(r.Fd.getMarkRect(i),l.vx((()=>(t((0,s.mp)(i.range)),r.Fd.getMarkRect(i)))),l.g_((e=>n._(new Error(`Cannot get mark's rect: ${i.id}: ${e.message}`))),(t=>new o.y((i=>{i.next(void 0),e(t,c)})))))}}},36918:(e,t,i)=>{i.r(t),i.d(t,{AssistantController:()=>er,AssistantControllerImpl:()=>rr,AssistantControllerInjectedParams:()=>a.AssistantControllerInjectedParams,AssistantService:()=>vr,AssistantServiceInjectedParams:()=>s.AssistantServiceInjectedParams,LocalAssistantHighlightCollection:()=>r.c});var a={};i.r(a),i.d(a,{e:()=>er,Z:()=>rr});var s={};i.r(s),i.d(s,{e:()=>vr});var r=i(45662),n=i(57050),o=i(40327),l=i(27378),c=i(74850),d=i(523),u=i(25913),p=i(53067),m=i(35214),h=i(32281),g=i(50622),v=i(17594),f=i(8125),w=i(18208),b=i(5114),S=i(40330),y=i(79880);const _=e=>{switch(e){case"experiment_human_category":return(0,n.ls)(k,I);case"experiment_benefits":return(0,n.ls)(A,I);default:return}},k=e=>C(e,(e=>v.$.isPremium(e)?e.categoryHuman:e.lensName)),A=e=>C(e,(e=>(0,n.zG)(e.bundleInfo,b.map((e=>e.title)),b.getOrElse((()=>e.lensName))))),C=(e,t)=>{const i=Object.values(e.reduce(((e,i)=>{const a=t(i);return null!=e[a]?e[a]={...e[a],alertsGroup:a,alertsCount:e[a].alertsCount+1}:e[a]={alertsGroup:a,alertsCount:1},e}),{}));return E(i)},E=e=>{const t=e.sort(((e,t)=>t.alertsCount-e.alertsCount)),i=t.slice(0,3),a=t.slice(3).map((e=>e.alertsCount)).reduce(f.Sm,0);return t.length>3?[...i,{alertsGroup:"more...",alertsCount:a}]:i},I=e=>{const t=e.map((e=>S.X2.create([{type:"block",fraction:1,horizontalAlign:y.Kq.Center,name:"counter",parts:[{type:"count",backgroundColor:y.Il.CoreYellow20,textColor:y.Il.CoreYellow80,value:e.alertsCount.toString(),id:"#count-counter"}],id:"#block-counter"},{type:"block",fraction:11,name:"alertGroup",parts:[S.xv.create(w.kC(e.alertsGroup),y.yH.Regular,[],y.Il.CoreNeutral90,void 0,void 0)],id:"#block-alert-group"}],[],S.Ki.create("0.5","0.25","0.25","0.75"))));return S.sg.create([S.X2.create([S.gO.create("title",void 0,void 0,S.xv.create("Premium suggestions available:",y.yH.Regular,[y.SQ.Bold],y.Il.CoreNeutral90,void 0,void 0))],[S.gO.create("right-top-buttons",void 0,void 0,S.zx.createIcon("feedback",S.JO.Source.createKnown(y.Tb.Feedback),[{type:"openFeedback"}],y.Lv.Secondary,"Provide feedback"),S.zx.createIcon("settings",S.JO.Source.createKnown(y.Tb.Gear),[{type:"openSettings"}],y.Lv.Secondary,"Options"),S.zx.createIcon("close",S.JO.Source.createKnown(y.Tb.Close),[{type:"closeCard"}],y.Lv.Secondary,"Close panel"))],S.Ki.create("0.75","0.25","0.5","0.75")),S.gO.create("content",void 0,void 0,...t),S.X2.create([{type:"button",id:"goPremium",name:"goPremium",actions:[{type:"upgradeToPremium"}],kind:y.Lv.Primary,state:y.BN.Enabled,label:{...S.gO.create("",S.Ki.create("0","0.5","0","0.25"),{horizontal:y.T.D025,vertical:y.T.D025},S.JO.create(S.JO.Source.createKnown(y.Tb.Diamond),void 0),S.xv.create("Unlock Premium",y.yH.Regular,[],y.Il.CoreNeutral0,void 0,void 0)),verticalAlign:y.g$.Middle}},{type:"button",id:"dismiss",name:"dismiss",actions:[{type:"removeCard"}],kind:y.Lv.Secondary,state:y.BN.Enabled,label:S.gO.create("",S.Ki.create("0","0.5","0","0.5"),{horizontal:y.T.D025,vertical:y.T.D0},S.xv.create("Dismiss",y.yH.Regular,[],y.Il.CoreNeutral50,void 0,void 0))}],[S.gO.create("navigation-arrows",void 0,void 0,S.zx.createIcon("prev",S.JO.Source.createKnown(y.Tb.ArrowLeft),[{type:"prevCard"},{type:"transition",fromName:"content",toName:"content",animateFrom:y.c1.SlideRight,animateTo:y.c1.SlideRight},{type:"transition",fromName:"title",toName:"title",animateFrom:y.c1.SlideRight,animateTo:y.c1.SlideRight}],y.Lv.Secondary,"Previous suggestion"),S.zx.createIcon("next",S.JO.Source.createKnown(y.Tb.ArrowRight),[{type:"nextCard"}],y.Lv.Secondary,"Next suggestion"))],S.Ki.create("0.5","0.25","1","0.75"))])};var M,T=i(32154),x=i(66896),R=i(5920),L=i(15646),F=i(39648),P=i(35416),V=i(93265),B=i(60797),O=i(28043),N=i(85985),H=i(41398),U=i(77176),D=i(24209),W=i(17343),j=i(95574),G=i(83078);!function(e){const t=(0,f.HP)(c.Y.create),i=e=>"column"===e.type;let a;e.BulkDismissBufferCardName="bulk-dismiss-buffer-card",e.BulkDismissBufferCardId=S.JX.from(e.BulkDismissBufferCardName),e.BulkDismissBufferCardDismissButtonName="bulk-dismiss-buffer-card-dismiss-button",e.BulkDismissBufferCardDismissButtonId=S.JX.from(e.BulkDismissBufferCardDismissButtonName),e.BulkDismissBufferCardDismissReviewAllButtonName="bulk-dismiss-buffer-card-review-all-button",e.BulkDismissBufferCardDismissReviewAllButtonId=S.JX.from(e.BulkDismissBufferCardDismissReviewAllButtonName),e.isBulkDismissBufferCardSDUI=t=>(0,o.pipe)(t.cardDSL,b.exists((0,f.W9)(i,(t=>t.name===e.BulkDismissBufferCardName)))),e.findBulkDismissItem=e=>(0,o.pipe)(e,b.fromPredicate(P.nL.hasCards),b.chain((e=>R.l.find(e.currentLens.items,(0,f.W9)(F.P.isAlertRefSDUIItem,F.P.Item.isBulkDismissSDUI))))),function(i){let a,s,r,n;!function(i){i.getBulkDismissBufferCardSDUI=t=>({...S.sg.create([S.X2.create([],[S.gO.create("right-top-buttons",void 0,void 0,S.zx.createIcon("feedback",S.JO.Source.createKnown(y.Tb.Feedback),[{type:"openFeedback"},{type:"notify",userAction:y.nz.Click}],y.Lv.Secondary,"Provide feedback"),S.zx.createIcon("settings",S.JO.Source.createKnown(y.Tb.Gear),[{type:"openSettings"},{type:"notify",userAction:y.nz.Click}],y.Lv.Secondary,"Options"),S.zx.createIcon("close",S.JO.Source.createKnown(y.Tb.Close),[{type:"closeCard"},{type:"notify",userAction:y.nz.Click}],y.Lv.Secondary,"Close panel"))],S.Ki.create("0.5","0.5","0.25","0.75")),S.sg.create([S.X2.create([S.gO.create("bulk-dismiss-buffer-card-content-image-block",S.Ki.create("0","1","0","0"),void 0,{type:"image",width:4,height:4.5,name:"bulk-dismiss-buffer-card-content-image",id:S.JX.from("bulk-dismiss-buffer-card-content-image"),url:"https://assets.grammarly.com/icons/v1/bulk-dismiss-buffer-card.svg"}),S.sg.create([S.X2.create([S.gO.create("bulk-dismiss-buffer-card-content-description-title",void 0,void 0,S.xv.create(`${t} suggestions dismissed for you`,y.yH.Regular,[y.SQ.Bold],y.Il.CoreNeutral90,void 0,void 0))],[],S.Ki.create("0","0","0","1")),S.X2.create([S.gO.create("bulk-dismiss-buffer-card-content-description-text",void 0,void 0,S.xv.create("We hid these suggestions because they didn’t seem relevant to your text.",y.yH.Regular,[],y.Il.CoreNeutral50,void 0,void 0))],[],S.Ki.create("0.5","0","0","1"))])],[],S.Ki.create("0.5","1","0.5","1"))]),S.X2.create([S.gO.create("bulk-dismiss-buffer-card-actions",void 0,S.n4.create("0.5","0"),{type:"button",name:e.BulkDismissBufferCardDismissReviewAllButtonName,id:e.BulkDismissBufferCardDismissReviewAllButtonId,label:{...S.gO.create("bulk-dismiss-buffer-card-review-button-label",S.Ki.create("0","0.5","0","0.5"),void 0,S.xv.create("Review them",y.yH.Regular,[],y.Il.CoreNeutral0,void 0,void 0)),verticalAlign:y.g$.Middle},actions:[{type:"notify",userAction:y.nz.Click}],kind:y.Lv.Primary,state:y.BN.Enabled},{type:"button",name:e.BulkDismissBufferCardDismissButtonName,id:e.BulkDismissBufferCardDismissButtonId,label:{...S.gO.create("bulk-dismiss-buffer-card-dismiss-button-label",S.Ki.create("0","0.5","0","0.5"),void 0,S.xv.create("Dismiss",y.yH.Regular,[],y.Il.CoreNeutral50,void 0,void 0)),verticalAlign:y.g$.Middle},actions:[{type:"notify",userAction:y.nz.Click},{type:"removeCard"}],kind:y.Lv.Secondary,state:y.BN.Enabled})],[S.gO.create("bulk-dismiss-buffer-card-navigation-arrows",void 0,S.n4.create("0.5","0"))],S.Ki.create("0.5","0.5","1","1"))]),name:e.BulkDismissBufferCardName}),i.create=a=>{const s=t("BulkDismissSDUI.SideEffects.AddBulkDismissBufferCard.create"),r=P.nL.Prism.getLensWithItems().compose(V.v.Prism.getFeedItems());return{id:"BulkDismissSDUI.SideEffects.AddBulkDismissBufferCard",when:x.R.isWithAlertsId,what:P.nL.Effect.ItemsApplicator.create(a.bulkDismissAlertsCount.pipe(O.x(),N.h((e=>e>0)),H.M(a.bulkDismissHasBeenReviewed),N.h((([e,t])=>!0!==t)),U.U((([e,t])=>e)),U.U((t=>a=>{s.trace("Side effect to add/update bulk-dismiss buffer card triggered.",{bulkDismissAlertsCount:t});const n=R.l.find(a.currentLens.items,(0,f.W9)(F.P.isAlertRefSDUIItem,F.P.Item.isBulkDismissSDUI)),l=R.l.find(a.currentLens.items,(0,f.W9)(F.P.isAlertRefSDUIItem,e.isBulkDismissBufferCardSDUI));if(b.isNone(l)&&b.isSome(n)){s.trace("Adding bulk dismiss buffer card.",{bulkDismissAlertsCount:t});const o=F.P.Capabilities.createItem(e.BulkDismissBufferCardId,i.getBulkDismissBufferCardSDUI(n.value.value.alerts.length),[]);return r.set(a.currentLens.items.add(o),a)}if(b.isSome(l)&&b.isSome(n)){s.trace("Updating bulk dismiss buffer card.",{bulkDismissAlertsCount:t});const n=F.P.Capabilities.createItem(e.BulkDismissBufferCardId,i.getBulkDismissBufferCardSDUI(t),[]);return r.set((0,o.pipe)(a.currentLens.items.update(l.value.value.id,(()=>n)),j.MH),a)}return a}))))}}}(a=i.AddBulkDismissBufferCard||(i.AddBulkDismissBufferCard={})),function(i){i.create=i=>{const a=t("BulkDismissSDUI.SideEffects.RemoveBulkDismissBufferCard.create"),s=P.nL.Prism.getLensWithItems().compose(V.v.Prism.getFeedItems());return{id:"BulkDismissSDUI.SideEffects.RemoveBulkDismissBufferCard",when:x.R.isWithAlertsId,what:P.nL.Effect.ItemsApplicator.create(D.T(i.bulkDismissHasBeenReviewed.pipe(N.h((e=>!0===e))),i.bulkDismissAlertsCount.pipe(N.h((e=>0===e)))).pipe(W.h((t=>{const i=R.l.find(t.currentLens.items,(0,f.W9)(F.P.isAlertRefSDUIItem,e.isBulkDismissBufferCardSDUI));return b.isSome(i)?(a.trace("Removing bulk-dismiss buffer card."),s.set(t.currentLens.items.remove(i.value.value.id),t)):t}))))}}}(s=i.RemoveBulkDismissBufferCard||(i.RemoveBulkDismissBufferCard={})),function(e){e.create=(e,i)=>{const a=t("BulkDismissSDUI.SideEffects.RemoveBulkDismiss.create");return{id:"BulkDismissSDUI.SideEffects.RemoveBulkDismiss",when:x.R.isWithAlertsId,what:P.nL.Effect.ItemsApplicator.create(e.bulkDismissBufferCardRemoveActions.pipe(U.U((({sourceId:e})=>t=>{const s=R.l.find(t.currentLens.items,(0,f.W9)(F.P.isAlertRefSDUIItem,F.P.Item.isBulkDismissSDUI));return b.isSome(s)&&(a.trace("Removing bulk-dismiss card."),(0,o.pipe)(s.value.value.cardDSL,b.filter((e=>"strongAlertRef"===e.type)),G.bw((t=>i({type:L.lY.Type.sduiCardAction,actions:[{type:"removeCard"}],sourceId:e,cardId:s.value.value.id,scope:{alertRef:b.some(t)}}))))),t}))))}}}(r=i.RemoveBulkDismiss||(i.RemoveBulkDismiss={})),function(t){t.create=(t,i,a)=>({id:"BulkDismissSDUI.SideEffects.FocusBulkDismiss",when:P.nL.Effect.When.isSidebarOpen,what:P.nL.Effect.ItemsApplicator.create((0,o.pipe)(t.bulkDismissReviewClicks,U.U((()=>e.findBulkDismissItem(i.get()))),B.oA,U.U((({value:e})=>t=>P.nL.Prism.getLensWithItems().modify(a.selectItemById(e.id,[{type:"transition",fromName:"title",toName:"title",animateFrom:y.c1.SlideLeft,animateTo:y.c1.SlideLeft},{type:"transition",fromName:"content",toName:"content",animateFrom:y.c1.SlideLeft,animateTo:y.c1.SlideLeft}]),t)))))})}(n=i.FocusBulkDismiss||(i.FocusBulkDismiss={}))}(a=e.SideEffects||(e.SideEffects={}))}(M||(M={}));var z=i(37517),q=i(19751),K=i(14601),Z=i(32952),X=i(95300);class Q{constructor(e,t,i){this._sduiManager=e,this._subs=new K.w,this.bulkDismissFooterReviewClicks=new Z.xQ;const a=(0,o.pipe)(t.actionEvents,N.h(L.lY.isSDUICardAction),q.skipBy(L.lY.SDUICardAction.eq),N.h((e=>!!e.actions.find((e=>"notify"===e.type))&&e.sourceId===M.BulkDismissBufferCardDismissReviewAllButtonId)),U.U((()=>{})));this.bulkDismissReviewClicks=D.T(this.bulkDismissFooterReviewClicks,a),this._bulkDismissHasBeenReviewed=new X.X(!1),this._subs.add(this.bulkDismissReviewClicks.subscribe((()=>this._bulkDismissHasBeenReviewed.next(!0)))),this.bulkDismissBufferCardRemoveActions=t.actionEvents.pipe(N.h(L.lY.isSDUICardAction),q.skipBy(L.lY.SDUICardAction.eq),N.h((e=>e.cardId===M.BulkDismissBufferCardId&&e.sourceId===M.BulkDismissBufferCardDismissButtonId&&e.actions.some((e=>"removeCard"===e.type))))),this.onlyBulkDismissItemsRemain=i.pipe(U.U((e=>P.nL.hasItems(e)&&e.currentLens.items.values().every((e=>F.P.isAlertRefSDUIItem(e)&&(F.P.Item.isBulkDismissSDUI(e)||M.isBulkDismissBufferCardSDUI(e)))))))}get bulkDismissHasBeenReviewed(){return this._bulkDismissHasBeenReviewed.asObservable()}get bulkDismissAlertsCount(){return this._sduiManager.state.view((e=>(0,o.pipe)(e,z.a.find((e=>"strongAlertRef"===e.content.type&&"BulkDismiss"===e.content.name)),b.chain((e=>"strongAlertRef"===e.content.type?b.some(e.content.alertIds.length):b.none)),b.getOrElse((()=>0)))))}dispose(){this._subs.unsubscribe()}}var $,Y=i(9671),J=i(5178),ee=i(19654),te=i(59456),ie=i(31536),ae=i(68654),se=i(40018),re=i(31847),ne=i(69621),oe=i(16797),le=i(79289),ce=i(16892),de=i(48521),ue=i(60682),pe=i(25975),me=i(45701),he=i(16027);!function(e){const t=e=>(0,o.pipe)(P.In.getActiveItemOfType(a)(e),b.chain(F.P.Capabilities.toAlertItem));function i(e,t){return P.nL.Items.mapper((e=>e.kind),{[F.P.Kind]:e,[ue.B.Kind]:t})}function a(e){return e.kind===F.P.Kind}function s(e){return e.kind===ue.B.Kind}function r(){return{viewState:()=>e=>{switch(e.kind){default:case F.P.Kind:return{view:e,kind:"alertRefSDUI"};case ue.B.Kind:return{view:e,kind:"upgradeHookCard"}}}}}e.isSelectableItem=(0,f.Kg)(s,a),e.getActiveItemWithAlert=function(e){return t(e)},e.getActiveAlignableItem=e=>t(e),e.getActiveFocusableItem=e=>t(e),e.checksFeedItemsMapper=i,e.isAlertRefSDUI=a,e.isUpgradeHook=s,e.getSDUIClientOrd=t=>(0,m.fold)(me.getMonoid())([(0,o.pipe)(me.ordBoolean,me.contramap((0,f.ff)(F.P.Item.isBulkAcceptSDUI))),(0,o.pipe)(me.ordBoolean,me.contramap(F.P.Item.isBulkDismissSDUI)),(0,o.pipe)(me.ordBoolean,me.contramap(M.isBulkDismissBufferCardSDUI)),e.getByActiveAlertPositionOrd(t)]),e.getByActiveAlertPositionOrd=e=>(0,m.fold)(me.getMonoid())([(0,o.pipe)(se.h$.ordHRange,me.contramap((t=>(0,o.pipe)(e.hasActiveAlert(t),b.map((e=>e.alert)),b.getOrElse((()=>({getHighlightRanges:()=>[{start:0,end:0}]})))))))]),e.item=e=>he.UI.Union.make("kind",{upgradeHookCard:le.V.SingleCard,alertRefSDUI:re.p.SingleCard,empty:ne.Q.Empty}),e.viewState=r,e.createCardListFlow=(e,t)=>(0,oe.p)(e,t),e.listItemOrd=e=>me.contramap((e=>e.cell.item.view))(e).compare;const l={equals:(e,t)=>e.kind===t.kind&&ce.s.eqById.equals(e,t)},c=(e,t)=>({equals:(i,a)=>{const s={[F.P.Kind]:e,[ue.B.Kind]:t};return l.equals(i,a)&&function(e,t){return(i,a)=>t[e(i)].equals(i,a)}((e=>e.kind),s)(i,a)}});function d(){return{changePosition:e=>i(F.P.Capabilities.changePosition(e),ue.B.Capabilities.changePosition(e))}}function u(){return{completeTransition:e=>i(F.P.Capabilities.animatable.completeTransition(e),ue.B.Capabilities.animatable.completeTransition(e)),transitionTo:e=>i(F.P.Capabilities.animatable.transitionTo(e),ue.B.Capabilities.animatable.transitionTo(e)),changeVisualState:e=>i(F.P.Capabilities.animatable.changeVisualState(e),ue.B.Capabilities.animatable.changeVisualState(e))}}function p(){return{select:(e,t,a)=>i(F.P.Capabilities.select.select(e,t,a),ue.B.Capabilities.select.select(e,t,a)),selectByAlert:(e,t,a,s)=>i(F.P.Capabilities.select.selectByAlert(e,t,a,s),ue.B.Capabilities.select.selectByAlert(e,t,a,s)),unselect:(e,t)=>i(F.P.Capabilities.select.unselect((0,n.MZ)(e),t),ue.B.Capabilities.select.unselect(e,t))}}function h(){return{removeAlertFromItem:(e,t)=>i(F.P.Capabilities.removeAlert.removeAlertFromItem(e,t),n.yR)}}function g(){return{remove:(e,t)=>i(F.P.Capabilities.remove.remove(e,t),ue.B.Capabilities.remove.remove(e,t))}}function v(){return{updateWithAlerts:e=>i(n.yR,n.yR)}}function w(){return{nextAlert:i((()=>b.none),(()=>b.none)),prevAlert:i((()=>b.none),(()=>b.none))}}function S(){return{updateUserInput:e=>i(n.yR,n.yR)}}e.equatable={structEq:c(F.P.eq,ue.B.eq),idEq:c(l,l),visualStateEq:c(F.P.eq,ue.B.eq)},e.changePosition=d,e.disposable={isScheduledToDispose:i(F.P.Capabilities.disposable.isScheduledToDispose,n.jv)},e.hidable={isHidden:i(de.o.isHidden,de.o.isHidden)},e.animatableItem=u,e.hasAlertsQueries={isSelectableByAlert:e=>i(F.P.Capabilities.hasAlerts.isSelectableByAlert(e),n.jv),hasAlert:e=>i(F.P.Capabilities.hasAlerts.hasAlert(e),n.jv),hasActiveAlert:i(F.P.Capabilities.hasAlerts.hasActiveAlert,G.cS)},e.changePositionStrategyQueries={useReferenceHeightOnRemove:i(n.jv,n.jv)},e.select=p,e.removeAlert=h,e.remove=g,e.updateWithAlert=v,e.releaseAlert=()=>pe.v.Capabilities.getAlertReleaser({...h(),...e.disposable}),e.unselectable=()=>pe.v.Capabilities.getUnselectable(P.In.getActiveItem,p()),e.selectableByAlert=()=>pe.v.Capabilities.getSelectableByAlert(P.In.getActiveItem,{...e.hasAlertsQueries,...p(),...pe.v.Capabilities.getHasChecksFeed()}),e.selectableById=()=>pe.v.Capabilities.getSelectableById(P.In.getActiveItem,p()),e.updateMeta=()=>({updateMeta:pe.v.Capabilities.getMetaUpdatable().updateMeta}),e.animatableFeed=e=>pe.v.Capabilities.getAnimatable(e,{...h(),...u(),...pe.v.Capabilities.getHasChecksFeed()}),e.hasPriorityToggle=()=>pe.v.WithPriority.getHasPriorityToggle({...u(),...e.hasAlertsQueries,...e.disposable}),e.alignable={isValidToAlign:i((t=>!e.disposable.isScheduledToDispose(t)),n.jv)},e.alertIterator=w,e.itemReleaser=()=>pe.v.Capabilities.getItemReleaser(),e.hasAlerts=pe.v.Capabilities.getHasAlerts,e.hasUserInput=S,e.verifiable=()=>pe.v.Capabilities.getVerifiable(e.disposable),e.cloneable=()=>{const e=ce.s.Capabilities.getPojoCloneable().clone;return{clone:i(e,e)}};const y={getFeatures:i((e=>F.P.Item.isBulkDismissSDUI(e)?[F.P.Features.BulkDismiss]:F.P.Item.isBulkAcceptSDUI(e)?[F.P.Features.BulkAccept]:[]),(()=>[]))};e.getCapabilities=function(t,i){return{...r(),...e.disposable,...e.hidable,...e.equatable,...S(),...e.cloneable(),...d(),...u(),...p(),...g(),...h(),...v(),...e.hasAlertsQueries,...e.changePositionStrategyQueries,...e.alignable,...e.releaseAlert(t),...e.unselectable(t),...e.selectableByAlert(t),...e.selectableById(t),...e.updateMeta(t),...e.animatableFeed(t),...e.hasPriorityToggle(t),...e.itemReleaser(),...y,...e.verifiable(),...e.cloneable(),...e.hasAlerts(w(),i,(()=>e.isSelectableItem),{...e.hasAlertsQueries,...e.disposable})}}}($||($={}));var ge,ve=i(7309),fe=i(75003);!function(e){let t;!function(e){e.learnMore="learnMore"}(t=e.Type||(e.Type={})),e.isDefault=function(e){return e.type===fe.aH.Type.default},e.isEmogenie=function(e){return e.type===fe.aH.Type.emogenie},e.isSettings=function(e){return e.type===fe.aH.Type.settings},e.isFeedback=function(e){return e.type===fe.aH.Type.feedback},e.isLearnMore=function(t){return t.type===e.Type.learnMore}}(ge||(ge={}));class we extends fe.D${constructor(e,t,i,a,s,r,n){super(t,i,{type:fe.aH.Type.default},{type:fe.aH.Type.default},new Set([fe.aH.Type.emogenie,ge.Type.learnMore]),a,ve.V.singleCardAssistantLayout),this._sub.add(this._activeView.subscribe((t=>{switch(t.type){case fe.aH.Type.settings:return void e.assistantSettingsShow();default:return}}))),this._sub.add(s.pipe(N.h(L.lY.isSDUICardAction)).subscribe((({actions:e})=>{e.forEach((e=>{"closeCard"===e.type?r():"openSettings"===e.type?this.pushActiveView({type:fe.aH.Type.settings}):"openFeedback"===e.type?this.pushActiveView({type:fe.aH.Type.feedback}):"openToneDetector"===e.type?this.pushActiveView({type:fe.aH.Type.emogenie}):"openLearnMore"===e.type?this.pushActiveView({type:ge.Type.learnMore}):"prevCard"!==e.type&&"nextCard"!==e.type||null==n||n()}))})))}activeViewHasAlerts(){return ge.isDefault(this._activeView.get())}pushActiveView(e){this.replaceActiveView(e)}}var be,Se=i(14532),ye=i(98403),_e=i(38983);!function(e){e.correct="correct",e.incorrect="incorrect",e.neutral="neutral"}(be||(be={}));class ke{constructor(e,t,i){this._learnMoreInfo=_e.h.create(null),this._sub=new K.w,this._sub.add(e.pipe(U.U((e=>{let a=null;if(P.nL.hasItems(e)){const s=(0,o.pipe)($.getActiveItemWithAlert(e.currentLens),b.getOrElseW((()=>null))),r=s?(0,o.pipe)(t.getById(s.activeAlert.id),b.getOrElseW((()=>null))):null,n=(0,o.pipe)(b.fromNullable(r),b.chain(se.bZ.getRawId),b.getOrElseW((()=>null))),l=n?i.alerts.getAlertById(n):null;l&&h.S.isCapiAlert(l)&&(a={title:l.todo,details:l.details||l.explanation,examples:(0,o.pipe)(Se.J.parse(l.examples,l.point.includes("Italicization")),b.map((e=>e.map((e=>e.map((e=>({type:e.color===Se.J.Color.green?be.correct:e.color===Se.J.Color.red?be.incorrect:be.neutral,title:(0,o.pipe)(e.title,b.map((e=>`${e}:`)),b.getOrElseW((()=>null))),text:e.text,useItalicText:!e.hasItalic}))))).flat())),b.getOrElseW((()=>[])))})}return a}))).subscribe(ye.wW(this._learnMoreInfo)))}get learnMoreInfo(){return this._learnMoreInfo.view()}dispose(){this._sub.unsubscribe()}}i(36572);const Ae=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g;var Ce,Ee=i(73582),Ie=i(73763),Me=i(4390);!function(e){e.isToneAISuggestionInfo=function(e){return"emojiId"in e},e.isToneTransformSuggestionInfo=function(e){return"emojiLiteral"in e},e.isToneTransformSuggestionUphookInfo=function(e){return"alertIsHidden"in e&&e.alertIsHidden}}(Ce||(Ce={}));class Te{constructor(e,t,i,a,s,r,n){this._alertsReader=e,this._getSessionUuid=i,this._gnar=a,this._upgradeViewModel=r,this._assistantLayoutViewModel=n,this._jumpToToneSuggestionAlertId=new Z.xQ;const o="test"===s.getTreatment(Ie.p.SingleCardAssistantToneAI),l="test"===s.getTreatment(Ie.p.ToneDetectorUphook);this.toneSuggestionInfo=o||l?t.view((e=>{const t=Me.p.reduce([],((e,t)=>(e.push(t.alert),e)))(e);return Te.getToneSuggestionInfoFromAlerts(t)})):_e.h.create(void 0).view()}static getToneSuggestionInfoFromAlerts(e){const t=e.filter((e=>e.patternName.startsWith("Style/ToneImprovement"))).map((e=>{if(se.bZ.isToneAI(e))return{emojiId:e.toneAlternatives[1].emojiID,title:e.miniCardTitle,alertId:e.id,toneCategory:e.patternName,patternName:e.patternName};{let t,i,a,s;if(e._raw.hidden){const r=e._raw.title.match(Ae);t=r&&r.length?r[0]:"",i=e._raw.title.replace(Ae,"").trim(),a=i,s=!0}else t=(0,o.pipe)(e.extraProperties.tone,b.map((e=>e.emoji)),b.getOrElseW((()=>""))),i=e.miniCardTitle.replace(Ae,"").trim(),a=(0,o.pipe)(e.extraProperties.tone,b.map((e=>e.name)),b.getOrElseW((()=>""))),s=!1;return{emojiLiteral:t,title:i,alertId:e.id,toneCategory:a,patternName:e.patternName,alertIsHidden:s}}})),i=t.reduce(((e,t)=>e.add(t.toneCategory)),new Set),a=t[0];return i.size>1?{...a,title:"Want to adjust your tone?"}:a}_getCurrentSessionUuid(){return(0,o.pipe)(this._getSessionUuid(),b.getOrElse((()=>"")))}getJumpToToneSuggestionSideEffect(){return{id:"jumpToToneSuggestionSideEffect",when:n.W8,what:P.nL.Effect.SwitchAlert.create(this._jumpToToneSuggestionAlertId.pipe(U.U(this._alertsReader.getById),B.oA,U.U((e=>({alertHighlight:{alert:v.$.fromModel(e),highlightIndex:0},alertSource:se.l$.sidebar,options:{}})))))}}onShowToneSuggestionInfo(e){const t=Ce.isToneAISuggestionInfo(e)?e.emojiId:e.emojiLiteral,i=Ce.isToneTransformSuggestionUphookInfo(e);this._gnar.toneDetectorToneSuggestionInfoShow(t,i,e.patternName,this._getCurrentSessionUuid(),e.title)}onClickToneSuggestionInfoCta(e){const t=Ce.isToneAISuggestionInfo(e)?e.emojiId:e.emojiLiteral,i=Ce.isToneTransformSuggestionUphookInfo(e);this._gnar.toneDetectorToneSuggestionInfoCtaClick(t,i,e.patternName,this._getCurrentSessionUuid(),e.title),i?this._upgradeViewModel.openUpgradeUrl(Ee.L.Place.toneSuggestion):(this._assistantLayoutViewModel.popActiveView(),this._jumpToToneSuggestionAlertId.next(e.alertId))}}var xe=i(10299),Re=i(77394),Le=i(86620),Fe=i(16868),Pe=i(51540),Ve=i(40081),Be=i(62346),Oe=i(92783),Ne=i(90361),He=i(44618),Ue=i(84966),De=i(13313),We=i(29317),je=i(74859),Ge=i(21619),ze=i(54216),qe=i(85395),Ke=i(48052),Ze=i(4330),Xe=i(20594),Qe=i(35607),$e=i(4890),Ye=i(73841),Je=i(89770),et=i(39920),tt=i(74364),it=i(76974),at=i(2844),st=i(83401),rt=i(66310),nt=i(40151),ot=i(95195),lt=i(81531);var ct,dt=i(35435),ut=i(26027),pt=i(77610),mt=i(22232),ht=i(73975);!function(e){function t(e,t){return P.nL.Items.mapper((e=>e.kind),{[ut.X.Kind]:e,[ue.B.Kind]:t})}function i(e){return e.kind===ut.X.Kind}function a(e){return e.kind===ue.B.Kind}function s(){return{viewState:(e,t)=>t=>{switch(t.kind){default:case ut.X.Kind:return(0,mt.kG)(pt.C.isSDUIAlertsItem(t),"cannot render alert cards without SDUI content"),{view:t,isLastCard:e,kind:"alertCard",visibleViewportHeight:b.none};case ue.B.Kind:return{view:t,kind:"upgradeHookCard"}}}}}e.isSelectableWithAlertItem=i,e.getActiveItemWithAlert=P.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.getActiveAlignableItem=P.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.getActiveFocusableItem=P.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.checksFeedItemsMapper=t,e.isAlertCard=i,e.isUpgradeHook=a,e.defaultOrd=(0,m.fold)(me.getMonoid())([(0,o.pipe)(me.ordBoolean,me.contramap(a)),(0,o.pipe)(me.ordBoolean,me.contramap(i)),ut.X.ord]),e.item=dt.w,e.viewState=s,e.createCardListFlow=(e,t)=>(0,oe.p)(e,t),e.listItemOrd=e=>me.contramap((e=>e.cell.item.view))(e).compare;const r={equals:(e,t)=>e.kind===t.kind&&ce.s.eqById.equals(e,t)},l=(e,t)=>({equals:(i,a)=>{const s={[ut.X.Kind]:e,[ue.B.Kind]:t};return r.equals(i,a)&&function(e,t){return(i,a)=>t[e(i)].equals(i,a)}((e=>e.kind),s)(i,a)}}),c=(0,m.fold)(ht.uZ())([de.o.eq,ce.s.verticalPositionEq,r]);function d(e){const i=ut.X.Capabilities.getChangePosition(e);return{changePosition:e=>t(i.changePosition(e),ue.B.Capabilities.changePosition(e))}}function u(e){const i=ut.X.Capabilities.getAnimatable(e);return{completeTransition:e=>t(i.completeTransition(e),ue.B.Capabilities.animatable.completeTransition(e)),transitionTo:e=>t(i.transitionTo(e),ue.B.Capabilities.animatable.transitionTo(e)),changeVisualState:e=>t(i.changeVisualState(e),ue.B.Capabilities.animatable.changeVisualState(e))}}function p(e){const i=ut.X.Capabilities.getSelect(e);return{select:(e,a,s)=>t(i.select(e,a,s),ue.B.Capabilities.select.select(e,a,s)),selectByAlert:(e,a,s,r)=>t(i.selectByAlert(e,a,s,r),ue.B.Capabilities.select.selectByAlert(e,a,s,r)),unselect:(e,a)=>t(i.unselect((0,n.MZ)(e),a),ue.B.Capabilities.select.unselect(e,a))}}function h(e){return{removeAlertFromItem:(a,s)=>t((t=>ut.X.Capabilities.getRemoveAlerts(e,s.itemsOrd)(a,P.In.getActiveItemOfType(i)(s))(t)),n.yR)}}function g(e){const i=ut.X.Capabilities.getRemove(e);return{remove:(e,a)=>t(i.remove(e,a),ue.B.Capabilities.remove.remove(e,a))}}function v(e){const i=ut.X.Capabilities.getUpdateWithAlert(e);return{updateWithAlerts:e=>t(i.updateWithAlerts(e),n.yR)}}function w(e){const i=Xe.Mq.getCardSelections(e);return{nextAlert:t(i.nextAlert,(()=>b.none)),prevAlert:t(i.prevAlert,(()=>b.none))}}function S(){return{updateUserInput:e=>t(ut.X.updateUserInput(e),n.yR)}}e.equatable={structEq:l(ut.X.eq,ue.B.eq),idEq:l(r,r),visualStateEq:l(c,ue.B.eq)},e.changePosition=d,e.disposable={isScheduledToDispose:t((e=>pt.C.willBeDisposed(e,e.removedAlertsIds)),n.jv)},e.hidable={isHidden:t(de.o.isHidden,de.o.isHidden)},e.animatableItem=u,e.hasAlertsQueries={isSelectableByAlert:e=>t(pt.C.hasAlert(e.alert.id),n.jv),hasAlert:e=>t(pt.C.hasAlert(e),n.jv),hasActiveAlert:t(pt.C.hasActiveAlert,G.cS)},e.changePositionStrategyQueries={useReferenceHeightOnRemove:t(n.jv,n.jv)},e.select=p,e.removeAlert=h,e.remove=g,e.updateWithAlert=v,e.releaseAlert=t=>pe.v.Capabilities.getAlertReleaser({...h(t),...e.disposable}),e.unselectable=e=>pe.v.Capabilities.getUnselectable(P.In.getActiveItem,p(e)),e.selectableByAlert=t=>pe.v.Capabilities.getSelectableByAlert(P.In.getActiveItem,{...e.hasAlertsQueries,...p(t),...pe.v.Capabilities.getHasChecksFeed()}),e.selectableById=e=>pe.v.Capabilities.getSelectableById(P.In.getActiveItem,p(e)),e.updateMeta=()=>({updateMeta:pe.v.Capabilities.getMetaUpdatable().updateMeta}),e.animatableFeed=e=>pe.v.Capabilities.getAnimatable(e,{...h(e),...u(e),...pe.v.Capabilities.getHasChecksFeed()}),e.hasPriorityToggle=t=>pe.v.WithPriority.getHasPriorityToggle({...u(t),...e.hasAlertsQueries,...e.disposable}),e.alignable={isValidToAlign:t((t=>!e.disposable.isScheduledToDispose(t)),n.jv)},e.alertIterator=w,e.itemReleaser=()=>pe.v.Capabilities.getItemReleaser(),e.hasAlerts=pe.v.Capabilities.getHasAlerts,e.getDefaultNextAlertItemFilter=t=>(0,f.W9)(e.isSelectableWithAlertItem,(i=>!e.disposable.isScheduledToDispose(i)&&(0,o.pipe)(i,e.hasAlertsQueries.hasActiveAlert,b.map((e=>t.isRegistered(e.alert.id))),b.getOrElse(n.jv)))),e.hasUserInput=S,e.verifiable=()=>pe.v.Capabilities.getVerifiable(e.disposable),e.cloneable=()=>({clone:t(ut.X.Capabilities.getCloneable().clone,ce.s.Capabilities.getPojoCloneable().clone)}),e.getCapabilities=function(t,i){return{...s(),...e.disposable,...e.hidable,...e.equatable,...S(),...e.cloneable(),...d(t),...u(t),...p(t),...g(t),...h(t),...v(t),...e.hasAlertsQueries,...e.changePositionStrategyQueries,...e.alignable,...e.releaseAlert(t),...e.unselectable(t),...e.selectableByAlert(t),...e.selectableById(t),...e.updateMeta(t),...e.animatableFeed(t),...e.hasPriorityToggle(t),...e.itemReleaser(),...e.verifiable(),...e.cloneable(),...e.hasAlerts(w(i),i,(()=>e.isSelectableWithAlertItem),{...e.hasAlertsQueries,...e.disposable})}}}(ct||(ct={}));class gt{constructor(e,t,i){this._learnMoreInfo=_e.h.create(null),this._sub=new K.w,this._sub.add(e.pipe(U.U((e=>{let a=null;if(P.nL.hasItems(e)){const s=(0,o.pipe)(ct.getActiveItemWithAlert(e.currentLens),b.getOrElseW((()=>null))),r=s?(0,o.pipe)(t.getById(s.activeAlert.id),b.getOrElseW((()=>null))):null,n=(0,o.pipe)(b.fromNullable(r),b.chain(se.bZ.getRawId),b.getOrElseW((()=>null))),l=n?i.alerts.getAlertById(n):null;l&&h.S.isCapiAlert(l)&&(a={title:l.todo,details:l.details||l.explanation,examples:(0,o.pipe)(Se.J.parse(l.examples,l.point.includes("Italicization")),b.map((e=>e.map((e=>e.map((e=>({type:e.color===Se.J.Color.green?be.correct:e.color===Se.J.Color.red?be.incorrect:be.neutral,title:(0,o.pipe)(e.title,b.map((e=>`${e}:`)),b.getOrElseW((()=>null))),text:e.text,useItalicText:!e.hasItalic}))))).flat())),b.getOrElseW((()=>[])))})}return a}))).subscribe(ye.wW(this._learnMoreInfo)))}get learnMoreInfo(){return this._learnMoreInfo.view()}dispose(){this._sub.unsubscribe()}}var vt,ft=i(41572),wt=i(88056),bt=i(35407),St=i(19429);!function(e){e.Context=l.createContext(wt.Y.invariantContent("AssistantTextResources")),e.holder=St.VF((()=>({setGoalsTooltip:"Set goals to get tailored writing suggestions",proofitTooltip:"Expert writing help"})))}(vt||(vt={}));const yt=bt.Pj(bt.GG({denali:ft.m.holder,assistant:vt.holder}))((()=>({denali:{}})));var _t=i(18756),kt=i(38152),At=i(51972),Ct=i(87667),Et=i(5739),It=i(31881),Mt=i(75039);const Tt=({headerVM:e,experiments:t})=>l.createElement(Et.F.div,{style:{visibility:e.visibility}},!(null==t?void 0:t.disablePriorityLens)&&l.createElement("div",{className:Mt.lens_switch,"data-grammarly-part":"assistant-lens-switch"},It.UI.mount(xt,e.lensSwitchFlow))),xt=It.UI.Union.asOption(Ct.n.Switch);var Rt=i(40033),Lt=i(68340),Ft=i(10720),Pt=i(40489),Vt=i(93508),Bt=i(19962),Ot=i(12187),Nt=i(33751),Ht=i(89379),Ut=i(28378),Dt=i(62513);const Wt=l.forwardRef((({successView:e},t)=>{const i=l.useContext(ft.m.Context),a=(0,Ht.hM)((0,Ht.JT)((0,o.pipe)(e,B.oA),i));return l.createElement("div",{className:Dt.compactSuccessLens,ref:t},l.createElement("div",{className:Dt.compactSuccessLensContainer},It.UI.mount(Ut.q,a)))})),jt=l.forwardRef((({viewModels:e},t)=>l.createElement("div",{className:Nt.mainView},l.createElement(zt,{ref:t,state:e.lensState,cardsViewModel:e.cardsViewModel,upgradeViewModel:e.upgradeViewModel,cardsListScrollManager:e.cardsListScrollManager,assistantCardListViewModel:e.assistantCardListViewModel,predictionsPreviewViewModel:e.predictionsPreviewViewModel,assistantFeedbackViewModel:e.assistantFeedbackViewModel,headerViewModel:e.assistantHeaderViewModel,layoutViewModel:e.assistantLayoutViewModel,capabilities:e.capabilities,readersAttentionItemViewModel:e.readersAttentionItemViewModel,experiments:e.user.view("experiments").get()})))),Gt=({position:e,isSuccess:t,children:i})=>l.createElement(Et.F.Fragment,null,e.pipe(O.x(((e,t)=>e.offset===t.offset&&e.visible===t.visible)),U.U((e=>e.visible?l.createElement(Et.F.div,{...(0,Ot.Sh)(Nt.cardListFooterStatic,e.animationInProgress?Nt.cardListFooterAnimate:void 0,t?void 0:Nt.cardListFooterDynamic),style:t?{}:{transform:Bt.ux.translateY(e.offset)}},i):null)))),zt=l.forwardRef((({state:e,assistantCardListViewModel:t,cardsViewModel:i,upgradeViewModel:a,cardsListScrollManager:s,capabilities:r,readersAttentionItemViewModel:n,experiments:c,...d},u)=>{const p=ye.jw((e=>{let t=7;return t=31*t+(0,_t.AC)(e.currentLens.id),t=31*t+(pe.v.WithSuccess.State.isInSuccess(r)(e)?1231:1237),t}),e),m=(0,o.pipe)(p,U.U((e=>{const t=e.get();return pe.v.WithSuccess.State.isInSuccess(r)(t)}))),h=(0,o.pipe)((0,Ft.ux)(e,s,r),H.M(e),U.U((([e,t])=>({visible:!P.nL.hasCards(t)||b.isNone(t.currentLens.items.find((e=>!e.positionState.isHeightValid))),offset:e+6,animationInProgress:!0}))),Vt.O({visible:!1,offset:0,animationInProgress:!0}));return l.createElement(Lt.C,{className:Nt.cardList,onClick:e=>{e.target.getAttribute("class")===Nt.cardList&&t.assistantActions.next({type:kt.lo.Type.clickOnEmpty})},footer:l.createElement(Et.F.Fragment,null,(0,o.pipe)(m,U.U((e=>l.createElement(Gt,{position:h,isSuccess:e},l.createElement(Rt.pL,{predictionsVM:d.predictionsPreviewViewModel})))))),ref:e=>{t.cardListViewportHeight.set(b.fromNullable(null==e?void 0:e.offsetHeight))}},(a=>l.createElement(Et.F.Fragment,null,(0,o.pipe)(at.aj([m,t.havePremiumAlerts]),U.U((([o,p])=>o&&!p?l.createElement(l.Fragment,null,l.createElement(Tt,{headerVM:d.headerViewModel,experiments:c}),l.createElement(Wt,{successView:t.successView,ref:u})):l.createElement(Ft.hz,{state:e,cardsViewModel:i,cardsListScrollManager:s,connectorElements:a,ref:u,header:l.createElement(l.Fragment,null,l.createElement(Tt,{headerVM:d.headerViewModel,experiments:c}),p?l.createElement("div",{className:Nt.upgradeHookWrapper,role:"uphook-wrapper"},It.UI.mount(Pt.n.TogglablePanel,t.upgradeHookFlow)):null),comparator:At.O.listItemOrd,capabilities:r,readersAttentionItemViewModel:n})))))))})),qt=l.forwardRef((({viewModels:e,header:t,footer:i,className:a},s)=>l.createElement(Lt.C,{ref:t=>{"function"==typeof s?s(t):s&&(s.current=t),e.assistantCardListViewModel.cardListViewportHeight.set(b.fromNullable(null==t?void 0:t.offsetHeight))},className:a},(a=>l.createElement(Ft.hz,{state:e.lensState,cardsViewModel:e.cardsViewModel,cardsListScrollManager:e.cardsListScrollManager,connectorElements:a,header:t,footer:i,comparator:At.O.listItemOrd,capabilities:e.capabilities,readersAttentionItemViewModel:b.none})))));var Kt=i(88326),Zt=i(73008);const Xt=({children:e,layoutVM:t,panelClassName:i,contentClassName:a,footer:s,onClickBack:r,hideBackButton:n=_e.h.create(!1),dataPartName:o})=>l.createElement("div",{className:Zt.viewOverlay,"data-grammarly-part":"assistant-view-overlay"},l.createElement(Et.F.Fragment,null,n.view((e=>!e&&l.createElement(Kt.M,{className:Zt.viewOverlayGoBack,clickHandler:()=>r?r():t.popActiveView(),dataGrammarlyPart:"assistant-go-back"},"<- Back")))),l.createElement("div",{className:i||Zt.defaultViewOverlayPanel},l.createElement("div",{className:a||Zt.content,"data-grammarly-part":o},e),s&&l.createElement("div",{className:Zt.footer},s)));var Qt=i(41263),$t=i(53112),Yt=i(79461),Jt=i(20855),ei=i(80895),ti=i(24394),ii=i(79921),ai=i(32275),si=i(16118),ri=i(80900),ni=i(8471);const oi=({emotion:e,isBrandTonesEnabled:t,emotionPollValue:i,index:a,onReportEmotionFeedback:s})=>{const r=l.createElement(Jt.u,{message:`${e.prevalence} intensity`,showDelay:300},l.createElement("div",{className:ni.emogenieReportItemEmotionIntensity},[0,1,2,3,4].map((t=>{const i=t/5<=e.confidence;return l.createElement("div",{key:`${e.name}-intensity-${t}`,...(0,Ot.Sh)(ni.emogenieReportItemEmotionIntensityDot,i&&ni.emogenieReportItemEmotionIntensityDotActive)})})))),n=e.brandToneLabel?l.createElement(ei.C,{title:`${e.brandToneLabel}-BRAND`,kind:"off"===e.brandToneLabel?"error":"primary",boldTitle:!0}):r,o=e=>t?e===Yt.b.dislike:e===Yt.b.incorrect||e===Yt.b.offensive,c=(0,ai.K)(i).pipe(si.G(),U.U((([e,t])=>e===Yt.b.none&&o(t))),Vt.O(!1),rt.w((e=>e?ri.H(3e3).pipe(W.h(!1),Vt.O(!0)):it.of(!1)))),d=l.createElement("div",{className:ni.emogenieReportItemFeedback},l.createElement("div",{className:ni.emogenieReportItemFeedbackIcon}),l.createElement("div",{className:ni.emogenieReportItemFeedbackText},"Your feedback helps us improve ",l.createElement("br",null)," our accuracy."));return l.createElement(Et.F.div,{...(0,Ot.Sh)(ni.emogenieReportItem,t?ni.emogenieReportItemBrandTone:null)},c.pipe(U.U((e=>e?d:null))),o(i)?null:l.createElement("div",{role:`emotion-${a}-${e.name}`},l.createElement("div",{className:ni.emogenieReportItemEmotion},l.createElement("div",{className:ni.emogenieReportItemEmotionEmojiAndName},l.createElement(ii.dy,{size:"small-medium",unicodeHexArray:[e.emojiId],unicodeLiteral:e.emoji,className:ni.emogenieReportItemEmotionEmoji}),l.createElement("span",{className:ni.emogenieReportItemEmotionName},e.name)),n,l.createElement(ti.A,{ariaLabel:`Does the emotion "${e.name}" seem correct?`,voteYesAriaLabel:"This seems right",voteNoAriaLabel:"This seems wrong",voteYesTooltipMessage:"This seems right",voteNoTooltipMessage:"This seems wrong",voteYesMarginRight:16,voteNoMenuItems:t?void 0:[{icon:l.createElement("div",{className:ni.emogenieReportItemEmotionVoteNoIncorrect}),label:"Tone detected incorrectly",onClick:()=>{s({emotionName:e.name,feedbackType:"EMOTION_INCORRECT",skipSendingToCAPI:!0})}},{icon:l.createElement("div",{className:ni.emogenieReportItemEmotionVoteNoOffensive}),label:"Report offensive content",onClick:()=>{s({emotionName:e.name,feedbackType:"EMOTION_OFFENSIVE"})}}],onVoteNoMenuToggle:t=>{t&&s({emotionName:e.name,feedbackType:"EMOTION_DISLIKE",skipTracking:!0})},onVote:i=>{const a=t?e.brandToneLabel||"neutral":void 0;i===ti.x.YES?s({emotionName:e.name,feedbackType:"EMOTION_LIKE",brandTone:a}):t&&s({emotionName:e.name,feedbackType:"EMOTION_DISLIKE",brandTone:a})},irrevocable:!0,voteValue:i===Yt.b.dislike||i===Yt.b.incorrect||i===Yt.b.offensive?ti.x.NO:i===Yt.b.like?ti.x.YES:void(i!==Yt.b.none&&(0,mt.vE)(i))})),t?l.createElement("div",{className:ni.emogenieReportItemDescription},e.brandToneDescription):null))};var li=i(31944),ci=i(24606),di=i(12266);const ui=({emotions:e,emotionsPoll:t,showEmojiForDetectedTones:i,isBrandTonesEnabled:a,toneSuggestionInfo:s,onMount:r,onChangeShowEmojiForDetectedTones:n,onReportEmotionFeedback:o})=>{let c,d;switch(l.useEffect(r,[]),!0){case e.some((e=>e.brandToneLabel&&"off"===e.brandToneLabel&&e.confidence>.75)):c="Your tone sounds off";break;case e.some((e=>e.brandToneLabel&&"off"===e.brandToneLabel)):c="Something sounds slightly off...";break;case e.some((e=>e.brandToneLabel&&"on"===e.brandToneLabel)):c=a?"You're on-brand! Great job!":"Your writing sounds clear and aligned. Great job!";break;default:c="How this may sound to readers:"}switch(!0){case a&&e.some((e=>e.brandToneLabel&&"off"===e.brandToneLabel)):d=l.createElement("div",{className:di.emogenieReportHeaderBrandOffSubTitle},"Consider revising your message to align with your brand.");break;case a&&e.some((e=>e.brandToneLabel&&"on"===e.brandToneLabel)):d="Read about the tones below to learn more.";break;case a:d="Check your writing to see if the tone is what you had in mind.";break;default:d=null}return l.createElement("div",{className:di.emogenieReport,"data-grammarly-part":"emogenie-report"},l.createElement("div",{className:di.emogenieReportHeader},l.createElement("div",{className:di.emogenieReportHeaderTitle},c),l.createElement("div",{className:di.emogenieReportHeaderSubTitle},d)),l.createElement("div",{className:di.emogenieReportItems},e.map(((e,i)=>l.createElement(oi,{onReportEmotionFeedback:o,key:e.name,index:i,emotion:e,emotionPollValue:t[e.name]||Yt.b.none,isBrandTonesEnabled:a})))),s?l.createElement(pi,{...s}):null,!a&&l.createElement(li.J,{onChange:n,labelId:"emogenie-report-always-show-emoji-for-detected-tones-checkbox",checked:i,className:di.emogenieReportCheckbox,dataGrammarlyPart:"emogenie-report-always-show-emoji-for-detected-tones-checkbox"},"Always show emoji for detected tones"))},pi=({onMount:e,emojiId:t,emojiLiteral:i,title:a,onClickCta:s,ctaText:r})=>(l.useEffect(e,[]),l.createElement("div",{className:di.emogenieReportToneSuggestionInfo},l.createElement("div",{className:di.emogenieReportToneSuggestionInfoEmojiAndTitle},t?l.createElement(ii.dy,{size:"small-medium",unicodeHexArray:[t],unicodeLiteral:null,className:di.emogenieReportToneSuggestionInfoEmoji}):i?l.createElement(ii.dy,{size:"small-medium",unicodeHexArray:null,unicodeLiteral:i,className:di.emogenieReportToneSuggestionInfoEmoji}):null,l.createElement("div",null,a)),l.createElement(ci.z,{kind:"primary",onClick:s,className:di.emogenieReportToneSuggestionInfoButton,dataGrammarlyPart:"emogenie-report-tone-suggestion-info-cta"},r)));var mi=i(93820);const hi=({emogenieService:e,toneSuggestionInfo:t,onShowToneSuggestionInfo:i,onClickToneSuggestionInfoCta:a})=>l.createElement(Et.F.Fragment,null,_e.h.combine(e.viewState,null!=t?t:_e.h.create(void 0),(({report:t,emotionsPoll:s,settings:r,isBrandTonesEnabled:n},o)=>{let c;return o&&(c={title:o.title,onMount(){null==i||i(o)},onClickCta(){null==a||a(o)},ctaText:"View suggestions"},Ce.isToneAISuggestionInfo(o)?c={...c,emojiId:o.emojiId}:(c={...c,emojiLiteral:o.emojiLiteral},Ce.isToneTransformSuggestionUphookInfo(o)&&(c={...c,ctaText:l.createElement(l.Fragment,null,l.createElement(mi.n,{color:$t.Z.neutral0,width:18})," Unlock Premium")}))),t&&Array.isArray(t.emotions)&&l.createElement(ui,{emotions:t.emotions,showEmojiForDetectedTones:r.showEmoji,emotionsPoll:s,isBrandTonesEnabled:n,onMount:()=>e.actions.trackReportShow(n),onChangeShowEmojiForDetectedTones:t=>e.actions.setShowEmojiState(t),onReportEmotionFeedback:t=>e.actions.reportEmotionFeedback(t),toneSuggestionInfo:c})})));var gi=i(86705),vi=i(57556),fi=i(40145);const wi=l.lazy((()=>i.e(2826).then(i.bind(i,73684)).then((({BrandTonesActivationUphookView:e})=>({default:e}))))),bi=l.forwardRef((({emogenieService:e,viewModels:t},i)=>{const a=l.createElement(l.Fragment,null,l.createElement(Si,{isBrandTonesEnabled:e.viewState.view("isBrandTonesEnabled"),institutionLogo:e.viewState.view("report").view((e=>null==e?void 0:e.institutionLogo)),institutionName:e.viewState.view("institutionName"),browser:t.assistantLayoutViewModel.browser}),l.createElement(hi,{emogenieService:e}),l.createElement(Et.F.Fragment,null,e.viewState.view((t=>!t.isBrandTonesEnabled&&!t.settings.hideBrandTonesActivationUphook&&t.settings.shouldShowBrandTonesActivationUphook&&l.createElement(l.Suspense,{fallback:l.createElement(l.Fragment,null)},l.createElement(Qt.L,{chunkName:"brandTonesActivationUphook"},l.createElement(wi,{trackShow:e.actions.trackBrandToneActivationUphookShow,onActivateClick:e.actions.brandToneActivationUphookCTAClick,onDismissClick:e.actions.brandToneActivationUphookDismissClick})))))));return l.createElement(Xt,{dataPartName:"emogenie-view-overlay",layoutVM:t.assistantLayoutViewModel,panelClassName:Zt.gradientViewOverlayPanel,hideBackButton:t.user.view((e=>e.isAnonymous))},l.createElement(Et.F.Fragment,null,t.lensPreviewViewModel.getLens(x.R.SpecialId.PredictionEmogenie).pipe(U.U((e=>e.count>0)),O.x(),U.U((e=>e?l.createElement(qt,{key:"emogeniePredictionCardList",viewModels:t,ref:i,header:l.createElement(l.Fragment,null,a,l.createElement("div",{className:fi.relatedSuggestionsTitle},"RELATED SUGGESTIONS"))}):l.createElement("div",{className:Zt.gradientViewOverlayContent},a))))))})),Si=({isBrandTonesEnabled:e,institutionLogo:t,institutionName:i,browser:a})=>l.createElement(Et.F.Fragment,null,_e.h.combine(e,t,i,((e,t,i)=>l.createElement("div",{className:Zt.defaultViewOverlayHeader},l.createElement("div",{className:vi.emogenieViewOverlayHeader},e?l.createElement("div",null,t?l.createElement("img",{className:Zt.logo,src:t}):null,i," Tone detector"):"Tone detector",l.createElement(gi.v,{browser:a,className:vi.emogenieViewOverlayHeaderBetaBadge}))))));var yi=i(53844);const _i=({feedbackVM:e,layoutVM:t})=>l.createElement(Xt,{dataPartName:"feedback-view-overlay",layoutVM:t,panelClassName:Zt.gradientViewOverlayPanel},l.createElement("div",{className:Zt.gradientViewOverlayContent},l.createElement("div",{className:Zt.defaultViewOverlayHeader},"Product Feedback"),l.createElement(yi.q5,{domain:e.getDomain(),onClose:()=>t.popActiveView(),align:"left",style:{height:"calc(100% - 48px)"},onSubmit:t=>e.submitFeedback(t),withScore:!0,fixSubmitButtonOverflowBottomPadding:!0,hideLogo:!0})));var ki=i(22667),Ai=i(57398);const Ci=l.memo((({width:e,strokeWidth:t,generalScore:i,componentStyle:a,fontSize:s=9,isLoading:r})=>{const n=e/2,o=n-t/2,c=2*o*Math.PI,d=(r?75:i)/100*c,u=c-d,p=(e=>{const{red40:t,yellow50:i,green50:a}=$t.Z;return e<65?t:e<95?i:a})(i);return l.createElement("div",{...(0,Ot.Sh)(Ai.scoreRing,r&&Ai.loading),style:a},l.createElement("svg",{width:e,height:e,viewBox:`0 0 ${e} ${e}`},l.createElement("circle",{fill:"white",r:o,cx:n,cy:n}),l.createElement("circle",{stroke:$t.Z.neutral20,fill:"transparent",strokeWidth:t,style:{strokeDashoffset:d},r:o,cx:n,cy:n}),l.createElement("circle",{stroke:p,fill:"transparent",strokeWidth:t,strokeDasharray:`${c} ${c}`,style:{strokeDashoffset:u},r:o,cx:n,cy:n}),l.createElement("text",{className:Ai.scoreText,x:"50%",y:"-35%",fontSize:s,fill:"black",textAnchor:"middle",transform:"rotate(90)"},i>0&&!r?i:"")))}));var Ei=i(93756),Ii=i(78846);const Mi=e=>{const t=It.Z.animatingFlow((()=>e.headerVM.logoScore),Ti);return l.createElement("div",{className:Ii.logo_score},It.UI.mount(Pi,t))},Ti=(e,t)=>(0,o.pipe)(e,b.filter((e=>e.type!==t.type)),b.map((()=>Ei.Hk("fadeout","fadein")))),xi=It.UI.Node.make((()=>l.createElement(ki.K,{className:Ii.grammarly_logo,size:22}))),Ri=It.UI.Node.make((({view:e})=>l.createElement(Et.F.div,{className:Ii.score_container,"data-grammarly-part":"assistant-score"},(0,o.pipe)(e("score"),(0,U.U)((({capiScore:e,isLoading:t})=>l.createElement(l.Fragment,null,l.createElement(Ci,{generalScore:e,strokeWidth:2,width:22,fontSize:e<100?11:9,isLoading:t,componentStyle:{transform:"translate(2px, -2px) rotate(-90deg)",cursor:"default"}})))))))),Li=It.UI.Union.make("type",{logo:xi,score:Ri}),Fi=It.UI.Transition.make({fadein:Ii.logoscore_fadein},{fadeout:Ii.logoscore_fadeout}),Pi=It.UI.Animated.make(Fi,Li);var Vi=i(22679),Bi=i(3860),Oi=i(1620),Ni=i(75100),Hi=i.n(Ni);const Ui=({enableTooltip:e=!1,...t})=>l.createElement(Jt.u,{message:"Settings",showDelay:Vi.gk,disabled:!e},l.createElement(Bi.h,{...t},l.createElement("div",{className:Hi().settingsButton}))),Di=e=>{const[t,i]=l.useState(!1),[a,s]=l.useState(!1),r=e.viewModels.assistantLayoutViewModel,n=e.viewModels.assistantHeaderViewModel,c=l.useContext(vt.Context),d=(0,o.pipe)(e.viewModels.assistantProofitViewModel,b.map((e=>e.feature)),b.map((e=>l.createElement(Et.F.Fragment,null,at.aj([e.layoutCreated,r.activeView.view((t=>t.type===e.assistantViewType()))]).pipe(U.U((([t,i])=>t?l.createElement(Jt.u,{message:c.proofitTooltip,showDelay:Vi.gk,disabled:i},l.createElement(Bi.h,{onClick:()=>i?r.popActiveView():r.pushActiveView({type:e.assistantViewType()}),dataGrammarlyPart:"assistant-header-action-btn-proofit"},l.createElement("div",{className:Ii.headerActionBtnProofitIcon}))):null)))))),b.toNullable),u=l.createElement(Oi.P,{onClick:n.close,tooltipMessage:"Close panel",dataGrammarlyPart:"assistant-header-action-btn-close"});return l.createElement(Jt.u,{message:"Grab and drag to move panel",showDelay:Vi.gk,disabled:t},l.createElement("div",{...(0,Ot.Sh)(Ii.header,a&&Ii.actions_hovered),ref:e.draggableRef,onMouseDown:()=>i(!0),onMouseOut:()=>i(!1)},l.createElement(Mi,{headerVM:n}),l.createElement(Wi,null),l.createElement(Et.F.div,{className:Ii.headerActions,onMouseOver:()=>s(!0),onMouseOut:()=>s(!1)},r.isHeaderNavigationEnabled.view((e=>e?l.createElement(l.Fragment,null,d,l.createElement(Et.F.Fragment,null,n.showSetGoalsActionButton.view((e=>e&&l.createElement(Jt.u,{message:c.setGoalsTooltip,showDelay:Vi.gk},l.createElement(Bi.h,{onClick:()=>n.open("setGoals"),dataGrammarlyPart:"assistant-header-action-btn-set-goals"},l.createElement("div",{className:Ii.headerActionBtnGoalsIcon})))))),l.createElement(Et.F.Fragment,null,_e.h.combine(n.showSettingsActionButton,r.activeView,((e,t)=>{const i=t.type===fe.aH.Type.settings;return e&&l.createElement(Ui,{onClick:()=>i?r.popActiveView():r.pushActiveView({type:fe.aH.Type.settings}),enableTooltip:!i,dataGrammarlyPart:"assistant-header-action-btn-settings"})}))),u):u)))))},Wi=()=>l.createElement("div",{className:Ii.draggableWrapper,"data-grammarly-part":"assistant-draggable-handler"},l.createElement("div",{className:Ii.draggable})),ji=()=>null;var Gi=i(55364);const zi=({layoutVM:e,onClickBack:t,children:i})=>{const[a,s]=l.useState(!1);return l.createElement(Xt,{dataPartName:"proofit-view-overlay",layoutVM:e,panelClassName:Gi.proofitViewOverlayPanel,onClickBack:t},l.createElement("div",{className:Gi.proofitViewOverlayContent,tabIndex:-1,ref:e=>{null===e||a||(e.focus(),s(!0))}},l.createElement("div",{className:Zt.defaultViewOverlayHeader},l.createElement("div",{className:Gi.proofitViewOverlayHeader},"Expert Writing Help",l.createElement(gi.v,{browser:e.browser,className:Gi.proofitViewOverlayHeaderBetaBadge}))),i))};var qi=i(10247),Ki=i(2027),Zi=i(81108);var Xi=i(59e3),Qi=i(41063),$i=i(17487);const Yi=({turnaroundTime:e})=>l.createElement("div",{className:Qi.proofitHowItWorksSteps},l.createElement("div",{...(0,Ot.Sh)(Qi.proofitHowItWorksStep,Qi.proofitHowItWorksStepOne)},"Your draft will be minimized and shared with writing experts.",l.createElement("div",{...(0,Ot.Sh)(Qi.proofitHowItWorksStepNumberContainer,Qi.proofitHowItWorksStepOneNumberContainer)},l.createElement("div",{...(0,Ot.Sh)(Qi.proofitHowItWorksStepNumber,Qi.proofitHowItWorksStepOneNumber)},"1"))),l.createElement("div",{...(0,Ot.Sh)(Qi.proofitHowItWorksStep,Qi.proofitHowItWorksStepTwo)},"You will see progress indication. The average turnaround is ",e," seconds.",l.createElement("div",{...(0,Ot.Sh)(Qi.proofitHowItWorksStepNumberContainer,Qi.proofitHowItWorksStepTwoNumberContainer)},l.createElement("div",{...(0,Ot.Sh)(Qi.proofitHowItWorksStepNumber,Qi.proofitHowItWorksStepTwoNumber)},"2"))),l.createElement("div",{...(0,Ot.Sh)(Qi.proofitHowItWorksStep,Qi.proofitHowItWorksStepThree)},"Your draft will re-open with revisions highlighted.",l.createElement("div",{...(0,Ot.Sh)(Qi.proofitHowItWorksStepNumberContainer,Qi.proofitHowItWorksStepThreeNumberContainer)},l.createElement("div",{...(0,Ot.Sh)(Qi.proofitHowItWorksStepNumber,Qi.proofitHowItWorksStepThreeNumber)},"3")))),Ji=({turnaroundTime:e,freeTrialQuota:t,onSubmit:i,disabledInfo:a=null,isLoading:s=!1,style:r,onTogglePrivacyInfo:n,showPrivacyInfo:o,disableHowItWorksInfo:c=!1,onDisableHowItWorksInfo:d,showHowItWorksInfo:u,onShowHowItWorksInfo:p})=>{const[m,h]=l.useState(null!=o&&o),[g,v]=l.useState(null!=u&&u),f=t>0?t:0;var b,S;l.useEffect((()=>{null==n||n(m)}),[m]),l.useEffect((()=>{h(null!=o&&o)}),[o]),l.useEffect((()=>{v(null!=u&&u)}),[u]),b=()=>null==p?void 0:p(),S=g,l.useEffect((()=>{S&&b()}),[S]);const y=l.useCallback((()=>{c||g?i():v(!0)}),[c,g,i]);return l.createElement("div",{"data-grammarly-part":"proofit-request-form",style:{width:"100%",height:"100%",...r}},l.createElement("div",{className:$i.proofitRequestForm},m?l.createElement(l.Fragment,null,l.createElement("div",{className:$i.proofitRequestFormPrivacyInfoTitle},"How we protect you"),l.createElement("div",{className:$i.proofitRequestFormPrivacyInfoDescription},l.createElement("div",{className:$i.proofitRequestFormPrivacyInfoDescriptionItem},l.createElement("div",{className:$i.proofitRequestFormPrivacyInfoDescriptionItemBulletPoint}),l.createElement("div",{className:$i.proofitRequestFormPrivacyInfoDescriptionItemText},"Our writing experts will see only your current email draft—no prior messages or contact details.")),l.createElement("div",{className:$i.proofitRequestFormPrivacyInfoDescriptionItem},l.createElement("div",{className:$i.proofitRequestFormPrivacyInfoDescriptionItemBulletPoint}),l.createElement("div",{className:$i.proofitRequestFormPrivacyInfoDescriptionItemText},"We will not sell, rent, or make public any of your personal data."))),l.createElement(ci.z,{kind:"outlined",onClick:()=>h(!1)},"Continue")):l.createElement(l.Fragment,null,g?l.createElement(Yi,{turnaroundTime:e}):l.createElement(l.Fragment,null,l.createElement("div",{className:$i.proofitRequestFormImg}),l.createElement("div",{className:$i.proofitRequestFormTitle},"Get instant writing help"),l.createElement("div",{className:$i.proofitRequestFormDescription},"Our writing experts are standing by to review your email."),l.createElement("div",{className:$i.proofitRequestFormCostAndTime},l.createElement("div",{className:$i.proofitRequestFormCost},l.createElement("div",{className:$i.proofitRequestFormCostAndTimeTitle},f," free ",w._6(f,"review","reviews")),l.createElement("div",{className:$i.proofitRequestFormCostAndTimeSubtitle},"left this month",l.createElement("sup",null,"*"))),l.createElement("div",{className:$i.proofitRequestFormTime},l.createElement("div",{className:$i.proofitRequestFormCostAndTimeTitle},e," seconds"),l.createElement("div",{className:$i.proofitRequestFormCostAndTimeSubtitle},"average turnaround")))),l.createElement(ci.z,{kind:"primary",className:$i.proofitRequestFormRequestBtn,disabled:Boolean(a||s),onClick:y},s?l.createElement("div",{className:Xi.proofitRequestFormBtnLoadingSpinner}):c||g?"Start review":"Request now"),a||s?a?l.createElement("div",{className:$i.proofitRequestFormUnavailableMsg},l.createElement(Zi.Q,{info:a})):null:l.createElement(ci.z,{kind:"link",onClick:()=>h(!0)},"Learn how we protect your privacy"),l.createElement("div",{...(0,Ot.Sh)($i.proofitRequestFormFootnote,g?$i.proofitRequestFormFootnoteHowItWorksDontShowAgainCheckbox:$i.proofitRequestFormFootnoteFreeTrial)},g?l.createElement(li.J,{labelId:"proofit-request-form-how-it-works-dont-show-again",onChange:d},"Don't show this again"):l.createElement("span",null,l.createElement("sup",null,"*")," included with your Premium subscription")))))},ea=({layoutVM:e,proofitVM:t})=>{const i=(0,Ki.fW)(),[a,s]=l.useState(!1),[r,n]=l.useState(!1);return l.createElement(zi,{layoutVM:e,onClickBack:()=>{a?s(!1):r?n(!1):e.popActiveView()}},l.createElement(Et.F.Fragment,null,(0,at.aj)([t.feature.layoutCreated,t.feature.requestInfo,t.feature.turnaroundTime,t.feature.quotaRemaining,t.feature.requestDisabledInfo,t.feature.disableHowItWorksInfo]).pipe((0,U.U)((([e,o,c,d,u,p])=>e&&o.status!==qi.eE.REVIEWING?l.createElement(Ji,{turnaroundTime:c,freeTrialQuota:d,onSubmit:()=>t.onSubmitRequest(i),style:{height:"calc(100% - 48px)"},disabledInfo:u,isLoading:o.status===qi.eE.PREPARING||o.status===qi.eE.PRE_SUBMIT,showPrivacyInfo:a,onTogglePrivacyInfo:s,disableHowItWorksInfo:p,onDisableHowItWorksInfo:e=>t.feature.onDisableHowItWorksInfo(e),showHowItWorksInfo:r,onShowHowItWorksInfo:()=>n(!0)}):null)))))};var ta=i(8400);const ia=({suggestionsMade:e,onAccept:t,onFeedbackFormSubmitted:i})=>l.createElement("div",{className:ta.proofitReviewForm,"data-grammarly-part":"proofit-review-form"},l.createElement("div",{className:ta.proofitReviewFormTitle},"Our experts made ",e," ",w._6(e,"suggestion","suggestions")),l.createElement("div",{className:ta.proofitReviewFormDescription},"Are you satisfied with the suggestions that our experts provided?"),l.createElement("div",{className:ta.proofitFeedbackForm},l.createElement(yi.q5,{hideLogo:!0,hideTitle:!0,hideTextBoxTitle:!0,withScore:!0,placeholderText:"How can we improve?",onSubmit:i,showPostSubmitScreen:!1})),l.createElement("div",{className:ta.proofitDoneButton},l.createElement(ci.z,{kind:"link",onClick:t},"Done"))),aa=({layoutVM:e,proofitVM:t})=>{const i=(0,Ki.fW)();return l.createElement(zi,{layoutVM:e},l.createElement(Et.F.Fragment,null,(0,at.aj)([t.feature.layoutCreated,t.feature.requestInfo]).pipe((0,U.U)((([e,a])=>e&&a.status===qi.eE.REVIEWING?l.createElement(ia,{suggestionsMade:a.suggestionsMade,onAccept:()=>t.onCompleteRequest(i),onFeedbackFormSubmitted:e=>{t.onSubmitFeedback(e),t.onCompleteRequest(i)}}):null)))))};class sa extends l.Component{render(){return this._idSuffix=this._idSuffix||"readersAttentionOnboardingBanner_"+sa._nextIdSuffix++,l.createElement("svg",{className:this.props.className,viewBox:"0 2 296 144",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("g",{clipPath:`url(#clip0_${this._idSuffix})`},l.createElement("rect",{width:"296",height:"144",fill:"#4A6EE0"}),l.createElement("path",{d:"M-5.5 -3.5H261.5V47.5H-5.5V-3.5Z",fill:"#6E66DE",stroke:"#1F243C"}),l.createElement("path",{d:"M-2.79293 -197.5L429.5 234.793V-197.5H-2.79293Z",fill:"#15C39A",stroke:"#1F243C"}),l.createElement("path",{d:"M219.057 33C222.992 33 226.182 29.8101 226.182 25.875C226.182 21.94 222.992 18.7501 219.057 18.7501C215.122 18.7501 211.932 21.94 211.932 25.875C211.932 29.8101 215.122 33 219.057 33Z",fill:"#1F243C",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M221.477 31.0899C225.92 31.0899 229.522 27.4881 229.522 23.045C229.522 18.6018 225.92 15 221.477 15C217.033 15 213.432 18.6018 213.432 23.045C213.432 27.4881 217.033 31.0899 221.477 31.0899Z",fill:"#41D9B5",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M220.188 27.045C220.009 27.045 219.841 26.9778 219.717 26.8434L216.927 24.0646C216.67 23.8069 216.67 23.3811 216.927 23.1122C217.185 22.8545 217.611 22.8545 217.88 23.1122L220.188 25.4204L225.353 20.2662C225.611 20.0085 226.037 20.0085 226.306 20.2662C226.563 20.5239 226.563 20.9497 226.306 21.2186L220.67 26.8546C220.535 26.9778 220.367 27.045 220.188 27.045Z",fill:"white"}),l.createElement("path",{d:"M68.125 57C72.06 57 75.25 53.8101 75.25 49.875C75.25 45.94 72.06 42.7501 68.125 42.7501C64.19 42.7501 61 45.94 61 49.875C61 53.8101 64.19 57 68.125 57Z",fill:"#1F243C",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M70.545 55.0899C74.9881 55.0899 78.5899 51.4881 78.5899 47.045C78.5899 42.6018 74.9881 39 70.545 39C66.1018 39 62.5 42.6018 62.5 47.045C62.5 51.4881 66.1018 55.0899 70.545 55.0899Z",fill:"#41D9B5",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M69.2564 51.045C69.0771 51.045 68.909 50.9778 68.7858 50.8434L65.9958 48.0646C65.7381 47.8069 65.7381 47.3811 65.9958 47.1122C66.2535 46.8545 66.6793 46.8545 66.9482 47.1122L69.2564 49.4204L74.4217 44.2662C74.6794 44.0085 75.1052 44.0085 75.3741 44.2662C75.6318 44.5239 75.6318 44.9497 75.3741 45.2186L69.7382 50.8546C69.6037 50.9778 69.4357 51.045 69.2564 51.045Z",fill:"white"}),l.createElement("rect",{x:"132",y:"38",width:"39",height:"24",rx:"2",fill:"#1F243C",stroke:"#1F243C"}),l.createElement("rect",{x:"135",y:"35",width:"39",height:"24",rx:"2",fill:"#F8C6DA",stroke:"#1F243C"}),l.createElement("path",{d:"M135 58.3296L149.303 47.4857L153.298 44.4591C154.007 43.923 154.993 43.923 155.702 44.4591L159.697 47.4857L174 58.3296",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M173.914 35.5L159.698 47.6583L155.806 50.9962C155.063 51.6361 153.956 51.6361 153.212 50.9962L149.303 47.6583L135.087 35.5",fill:"#F8C6DA"}),l.createElement("path",{d:"M173.914 35.5L159.698 47.6583L155.806 50.9962C155.063 51.6361 153.956 51.6361 153.212 50.9962L149.303 47.6583L135.087 35.5",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("rect",{x:"135",y:"35",width:"39",height:"24",rx:"2",stroke:"#1F243C"}),l.createElement("rect",{y:"32",width:"296",height:"112",fill:`url(#paint0_linear_${this._idSuffix})`}),l.createElement("path",{d:"M185.5 22C185.5 18.961 183.039 16.5 180 16.5C183.039 16.5 185.5 14.039 185.5 11C185.5 14.039 187.961 16.5 191 16.5C187.965 16.5 185.5 18.9651 185.5 22Z",fill:"#F9EA9E",stroke:"#1F243C",strokeLinecap:"round",strokeLinejoin:"round"}),l.createElement("path",{d:"M239.5 128C239.5 124.961 237.039 122.5 234 122.5C237.039 122.5 239.5 120.039 239.5 117C239.5 120.039 241.961 122.5 245 122.5C241.965 122.5 239.5 124.965 239.5 128Z",fill:"#F9EA9E",stroke:"#1F243C",strokeLinecap:"round",strokeLinejoin:"round"}),l.createElement("path",{d:"M24.5 63C24.5 59.961 22.039 57.5 19 57.5C22.039 57.5 24.5 55.039 24.5 52C24.5 55.039 26.961 57.5 30 57.5C26.9651 57.5 24.5 59.9651 24.5 63Z",fill:"#F9EA9E",stroke:"#1F243C",strokeLinecap:"round",strokeLinejoin:"round"}),l.createElement("rect",{x:"263",y:"76",width:"63",height:"77",rx:"2",fill:"#1F243C",stroke:"#1F243C"}),l.createElement("rect",{x:"267",y:"72",width:"63",height:"77",rx:"2",fill:"#F9FAFF",stroke:"#1F243C"}),l.createElement("path",{d:"M318.759 89.7112H278",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M318.759 101.227H278",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M318.759 112.743H278.095",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("path",{d:"M318.759 124.259H278",stroke:"#1F243C",strokeMiterlimit:"10"}),l.createElement("g",{style:{mixBlendMode:"multiply"},opacity:"0.4"},l.createElement("path",{d:"M318.759 101.227H278",stroke:"#41D9B5",strokeWidth:"10",strokeMiterlimit:"10"})),l.createElement("g",{style:{mixBlendMode:"multiply"},opacity:"0.4"},l.createElement("path",{d:"M305.43 112.743H278.095",stroke:"#41D9B5",strokeWidth:"10",strokeMiterlimit:"10"}))),l.createElement("defs",null,l.createElement("linearGradient",{id:`paint0_linear_${this._idSuffix}`,x1:"148",y1:"32",x2:"148",y2:"144",gradientUnits:"userSpaceOnUse"},l.createElement("stop",{stopColor:"#26307D",stopOpacity:"0"}),l.createElement("stop",{offset:"1",stopColor:"#26307D",stopOpacity:"0.5"})),l.createElement("clipPath",{id:`clip0_${this._idSuffix}`},l.createElement("rect",{width:"296",height:"144",fill:"white"}))))}}sa._nextIdSuffix=0;var ra=i(44715);const na=({layoutVM:e})=>l.createElement(Xt,{dataPartName:"readers-attention-help-overlay",layoutVM:e,panelClassName:ra.helpPanel,contentClassName:ra.helpPanelContent},l.createElement("div",{className:ra.helpBanner},l.createElement(sa,{className:ra.helpBannerImage}),l.createElement("div",{className:ra.helpHeader},"Reader′s attention",l.createElement(ei.C,{title:"NEW",kind:"gold"})),l.createElement("div",{className:ra.helpBannerMessage},"Get your important information across")),l.createElement("div",{className:ra.helpContent},l.createElement("div",null,"Grammarly predicts which parts of your email will be read.",l.createElement("ul",null,l.createElement("li",null,l.createElement("span",{className:ra.heatmap},l.createElement("b",null,"Highlighted text is most likely to be read."))),l.createElement("li",null,"The rest of the text may be skimmed or skipped.")),"Follow Grammarly’s suggestions to keep your reader’s attention.")));var oa=i(47960),la=i(90282);const ca=({feedbackVM:e,entryPoint:t})=>l.createElement(Jt.u,{showDelay:Vi.gk,message:"Leave feedback"},l.createElement("div",{className:la.feedbackButton,onClick:()=>e.openFeedback(t),"data-grammarly-part":"assistant-feedback-btn"},l.createElement(oa.A,{color:$t.Z.blue50}),"Anything we can improve?"));var da=i(35327);const ua=e=>{const t=It.Z.animatingFlow((()=>e.summaryVM.summary),pa);return l.createElement("div",{...(0,Ot.Sh)(da.summary_wrapper,e.className)},It.UI.mount(ga,t))},pa=(e,t)=>(0,o.pipe)(e,b.filter((e=>e.content!==t.content)),b.map((()=>Ei.Hk("fadeout","fadein")))),ma=It.UI.Node.make((({view:e})=>l.createElement(Et.F.div,{className:da.summary_heading,"data-grammarly-part":"assistant-summary-header"},e("content")))),ha=It.UI.Transition.make({fadein:da.summary_fadein},{fadeout:da.summary_fadeout}),ga=It.UI.Animated.make(ha,ma);var va=i(35501),fa=i(61922),wa=i(82318);const ba=l.forwardRef((({viewModels:e,readersAttentionVM:t},i)=>l.createElement(Xt,{dataPartName:"readers-attention-view-overlay",layoutVM:e.assistantLayoutViewModel,panelClassName:Zt.gradientViewOverlayPanel},l.createElement(qt,{key:"takeawaysPredictionCardList",ref:i,viewModels:e,className:wa.cardList,header:l.createElement(Sa,{readersAttentionVM:t,layoutVM:e.assistantLayoutViewModel}),footer:l.createElement(ca,{feedbackVM:e.assistantFeedbackViewModel,entryPoint:J.Q.readersAttention})})))),Sa=({readersAttentionVM:e,layoutVM:t})=>{const i=e.panelState.pipe(U.U(b.fold((()=>({content:""})),(e=>({content:e.headerMessage})))));return l.createElement(l.Fragment,null,l.createElement("div",{className:Zt.defaultViewOverlayHeader},l.createElement("div",{className:wa.headerGroup},"Reader′s attention",l.createElement("div",{onClick:()=>e.showHelp(),className:wa.questionMarkButton,"data-grammarly-part":"readers-attention-question-mark-button"},l.createElement(fa.JO.QuestionMark,{width:12,className:wa.questionMarkIcon}))),l.createElement(gi.v,{browser:t.browser})),l.createElement(ua,{summaryVM:{summary:i},className:wa.summaryWrapper}),l.createElement("div",{className:wa.message},he.UI.mount(he.UI.Union.asOption(va.r),(()=>e.panelState))),l.createElement(Et.F.div,{...(0,Ot.Sh)(fi.relatedSuggestionsTitle,wa.relatedSuggestionsTitle)},e.panelState.pipe(U.U(b.fold(n.gn,(e=>`${e.numChecklistItemsChecked} OF ${e.numChecklistItems} COMPLETED`))))))};var ya=i(19106),_a=i(17324),ka=i(99446);const Aa=()=>l.createElement("svg",{width:"11",height:"12",viewBox:"0 0 11 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{d:"M4 1H2.5C1.39543 1 0.5 1.89543 0.5 3V9C0.5 10.1046 1.39543 11 2.5 11H8.5C9.60457 11 10.5 10.1046 10.5 9V7.5M5.5 6L10.5 1M10.5 1H6.5M10.5 1V5",stroke:"#4A6EE0",strokeLinecap:"round"}));var Ca=i(5872),Ea=i(26485),Ia=i(68089);const Ma=({children:e,blocked:t,wrapperClassName:i})=>t?l.createElement(Jt.u,{message:"Sign in to use this feature",position:"top"},l.createElement("div",{className:i},l.createElement("div",{className:Ia.hover_blocker,onClick:Ne.EI,onDoubleClick:Ne.EI},e))):l.createElement(l.Fragment,null,e);class Ta extends l.Component{constructor(){super(...arguments),this.handleChange=e=>{(this.props.skipTrustedCheck||e.isTrusted)&&this.props.onChange(e)}}render(){return l.createElement("div",{...(0,Ot.Sh)(this.props.extraClassName,Ea.setting_item,this.props.disabled&&Ea.disabled)},l.createElement("label",{className:(0,Ca.cs)(Ea.select_checkbox,this.props.centered?Ea.centered:void 0),"data-grammarly-part":this.props.dataGrammarlyPart},l.createElement("div",{className:Ea.select_children},this.props.children,this.props.beta&&l.createElement("span",{className:(0,Oe.G6)()?Ea.new:Ea.beta}),this.props.alpha&&l.createElement("span",{className:(0,Oe.G6)()?Ea.new:Ea.alpha})),l.createElement(Ma,{wrapperClassName:Ea.checkbox_control_wrapper,blocked:this.props.disabled}),l.createElement("input",{className:Ea.checkbox,onChange:this.props.disabled?Ne.EI:this.handleChange,checked:this.props.checked,type:"checkbox"}),l.createElement("div",{...(0,Ot.Sh)(Ea.checkbox_check,this.props.grayOut&&Ea.grayOut,this.props.checked?Ea.on:Ea.off)},l.createElement("div",{...(0,Ot.Sh)(Ea.on_off)},this.props.checked?"ON":"OFF"),l.createElement("div",{className:Ea.checkbox_check_round}))))}}var xa=i(62111),Ra=i(47740);const La=({showTitle:e,showBackground:t,openGBLanding:i})=>l.createElement("div",{...(0,Ot.Sh)(Ra.container,t?Ra.containerWithBackground:null)},l.createElement("div",{className:Ra.content},e&&l.createElement("div",{className:Ra.title},"Grammarly for your team"),l.createElement("div",null,"Help your team make your business look great with top-notch writing."),l.createElement(ci.z,{size:"medium",onClick:()=>{i((0,Oe.Um)().businessEHomepage),(0,xa.T)().gGbUpHookClick()},className:Ra.button},"Explore Grammarly Business")));var Fa=i(1005);const Pa=({heading:e,enabled:t,children:i})=>t?l.createElement(l.Fragment,null,l.createElement("div",{className:Fa.heading},e),l.createElement("div",null,i)):l.createElement(l.Fragment,null,i);var Va=i(4120),Ba=i(24372);class Oa extends l.Component{constructor(){super(...arguments),this.onEnableDefsClick=e=>{const{toggleDefs:t}=this.props,i=e.target.checked;t(i),Ba.J.definitionToggleClick(i?"on":"off"),(0,xa.T)().toggleExtensionDefs(i)}}render(){const{enabledDefs:e,disabled:t}=this.props;return l.createElement(Ta,{onChange:this.onEnableDefsClick,checked:e,extraClassName:_a.def_switcher,dataGrammarlyPart:"definitionAndSynonymsSwitcher",disabled:t,skipTrustedCheck:this.props.skipTrustedCheck},"Show definitions and synonyms ",l.createElement("br",null),"via double clicks (all sites)")}}var Na=i(6304),Ha=i(66402);const Ua=()=>l.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{d:"M13.9207 15L15.5 17.2562L17.0793 15H13.9207Z",stroke:"#6D758D",strokeWidth:"2"}));var Da=i(64757),Wa=i(18813),ja=i(71527);const Ga={american:l.createElement((()=>l.createElement("div",{className:Ha.american,role:"presentation"})),null),australian:l.createElement((()=>l.createElement("div",{className:Ha.australian,role:"presentation"})),null),british:l.createElement((()=>l.createElement("div",{className:Ha.british,role:"presentation"})),null),canadian:l.createElement((()=>l.createElement("div",{className:Ha.canadian,role:"presentation"})),null)},za=["british","american","australian","canadian"],qa=e=>{return l.createElement(l.Fragment,null,Ga[e.dialect],l.createElement("span",{"data-test-attr":`dialect_${e.dialect}`,className:ja.label},(t=e.dialect).charAt(0).toUpperCase()+t.slice(1)+" English"));var t};class Ka extends l.Component{render(){const e=this.props.dropdownOnTop?{customPosition:{top:"-100px",left:"0"},vAlign:"top"}:{customPosition:{top:"36px",left:"0"}};return l.createElement(Wa.L,{...e,showDelay:0,closeDelay:150,appearanceBehavior:"mouseClick",name:"dialect",label:l.createElement(Da.zx.White,{name:"dialect.box",style:{padding:"0"}},l.createElement("div",{className:ja.selected},l.createElement(qa,{dialect:this.props.dialect}),l.createElement(Ua,null)))},za.filter((e=>e!==this.props.dialect)).map((e=>l.createElement(Da.zx.Flat,{name:e,key:e,onClick:t=>(null==t?void 0:t.isTrusted)&&this.props.onSetDialect(e)},l.createElement("div",{className:ja.option},l.createElement(qa,{dialect:e}))))))}}class Za extends l.Component{constructor(){super(...arguments),this.setDialect=e=>{const{changeStrongDialect:t,dialectWeak:i}=this.props;t(e);const a=e+"English";Ba.J.languageSettingUpdate(a,"user",i&&e===i)}}render(){const e=this.props.dialectStrong||this.props.dialectWeak||"american";return l.createElement("div",{...(0,Ot.Sh)(Na.line,this.props.disabled&&Na.disabled)},l.createElement("div",null,"I write in"),l.createElement(Ma,{blocked:this.props.disabled},l.createElement("div",{className:Na.dialectPicker},l.createElement(Ka,{dialect:e,onSetDialect:this.setDialect,dropdownOnTop:!!this.props.dropdownOnTop}))))}}const Xa=e=>{const t="docs.google.com"===e.domain,i=t?"Google Docs":e.domain,a=t&&!(0,Oe.Am)(),{enabledInConfig:s,siteSwitcherChecked:r,favicon:n}=e,o=r.checked&&s,c=s?"Check for writing suggestions":"Checking is not supported";return l.createElement(Ta,{grayOut:!s,onChange:e=>r.update(e.target.checked),checked:o,extraClassName:_a.site_switcher,dataGrammarlyPart:"siteSwitcher",skipTrustedCheck:e.skipTrustedCheck,centered:!!e.centeredToggle},l.createElement("div",{"data-test-attr":"siteControlsLabelText"},c,l.createElement("br",null)," ",l.createElement("span",{...(0,Ot.Sh)(_a.domain,e.centeredToggle&&_a.centered)},l.createElement("span",{className:_a.thin_text},"on")," ",n&&l.createElement("span",{className:_a.favicon},l.createElement("img",{width:"16px",height:"16px",src:n})),i,a&&l.createElement("span",{className:Ea.beta}))))};var Qa=i(56542),$a=i(37896),Ya=i(23345);const Ja=l.createContext({}),es=e=>{const t=l.useContext(Ja),{registrationDate:i}=e.user,a=(0,$a.p6)(i);return l.createElement("div",{className:Ya.line},l.createElement("div",{className:Ya.content},a&&l.createElement("div",{"data-test-attr":"checked_since"},"Grammarly has been correcting your text since ",a,"."),l.createElement("div",{"data-grammarly-part":"summaryUpgradeBtn",className:Ya.upgrade,onClick:()=>{e.openSubscriptionDialog({utmSource:"upHook",utmCampaign:"extensionSettingsToolbar"}),Ba.J.getPremiumButtonClick(e.isAssistant?"assistantSettings":"settingsToolbar","GoPremiumToEnableAdvancedFixes"),(0,xa.T)().userUpgradeClick("settingsToolbar")},style:{fontSize:t.ctaFontSize}},"Go Premium to Enable Advanced Fixes")))},ts=e=>l.createElement(Ta,{onChange:t=>{e.toggle(t.target.checked)},checked:e.enabled,extraClassName:_a.def_switcher},"Correct spelling automatically"),is=e=>l.createElement(Ta,{checked:!e.enabled,extraClassName:_a.def_switcher,onChange:t=>{e.toggle(!t.target.checked)},dataGrammarlyPart:"disableDesktopIntegrationToggle"},l.createElement("div",{className:_a.llamaTitle},"Check text with browser extension"),e.enabled&&l.createElement("div",{className:_a.llamaDescription},"Grammarly's browser extension was deactivated since you're using Grammarly's desktop application.")),as=e=>l.createElement(Ta,{onChange:t=>{e.toggle(t.target.checked)},beta:!0,checked:e.enabled,extraClassName:_a.def_switcher},"Show phrasal predictions"),ss=e=>l.createElement(Ta,{onChange:t=>{e.toggle(t.target.checked)},beta:!0,checked:e.enabled,extraClassName:_a.def_switcher},"Show email recaps"),rs=e=>{var t,i,a,s;const{actions:r,activeTab:n,config:o,settings:c,user:d,siteCategory:u,openSubscriptionDialog:p,openGBLanding:m,showGBUpHook:h,placement:g,dynamicConfig:v,enableRenderingHack:f=!1,isReaderSupported:w=!1}=e;f&&l.useEffect((()=>{(0,Oe.CB)()&&(self.screenLeft<0||self.screenTop<0||self.screenLeft>self.screen.width||self.screenTop>self.screen.height)&&chrome.runtime.getPlatformInfo((e=>{if("mac"===e.os){const e=new CSSStyleSheet;e.insertRule("\n            @keyframes redraw {\n              0% {\n                opacity: 1;\n              }\n              100% {\n                opacity: .99;\n              }\n            }\n          "),e.insertRule("\n            html {\n              animation: redraw 1s linear infinite;\n            }\n          "),document.adoptedStyleSheets=[...document.adoptedStyleSheets,e]}}))}),[]);const{premium:b,experiments:S,anonymous:y}=d,_=h&&b&&!Va.n5.doesUserBelongToInstitution(d),k=b||y,A=e.siteSwitcherChecked||{checked:!!c.enabled,update:t=>{const{siteCategory:i}=e;r.toggleSite(t,o.domain),Ba.J.checkingToggleClick("toolbar",i,t?"on":"off"),(0,xa.T)().toggleExtension(t,"toolbar")}},C=!1;return l.createElement("div",{className:Qa.settingsContent,"data-grammarly-part":"settings"},l.createElement("div",{className:Qa.heading},l.createElement("div",null,"Quick Settings"),l.createElement(ci.z,{kind:"link",onClick:()=>{e.openUrl((0,Oe.Um)().allSettings),Ba.J.allSettingsButtonClick(g)}},l.createElement("div",{className:Qa.allSettings},l.createElement("span",null,"All Settings"),l.createElement(Aa,null)))),ka.q.showSettingPopupToggle(c,v,null==n?void 0:n.url)&&l.createElement(Pa,{heading:"DESKTOP INTEGRATION SETTING",enabled:C},l.createElement(is,{toggle:e=>{r.setDesktopIntegration(e),Ba.J.desktopIntegrationToggleClick(e?"on":"off")},enabled:c.isDesktopIntegrationEnabled}),l.createElement("div",{className:Qa.separator})),l.createElement(Pa,{heading:"SITE SETTINGS",enabled:C},l.createElement(Xa,{domain:o.domain,enabledInConfig:o.enabled,siteSwitcherChecked:A,favicon:null==n?void 0:n.favIconUrl,siteCategory:u,experiments:S}),l.createElement("div",{className:Qa.separator})),l.createElement(Pa,{heading:"FEATURES (ALL SITES)",enabled:C},l.createElement(Oa,{disabled:y,enabledDefs:c.enabledDefs,toggleDefs:r.toggleDefs}),l.createElement("div",{className:Qa.separator}),l.createElement(ts,{enabled:c.autocorrectEnabled||!1,toggle:e=>{r.toggleAutocorrect(e),Ba.J.autocorrectToggleClick(e?"on":"off")}}),l.createElement("div",{className:Qa.separator}),l.createElement(as,{enabled:c.autocompleteEnabled||!1,toggle:e=>{r.toggleAutocomplete(e),Ba.J.autocompleteFeatureToggleClick("popup",e?"on":"off")}}),w&&(null===(i=null===(t=c.reader)||void 0===t?void 0:t.gmail)||void 0===i?void 0:i.seenOnboarding)&&l.createElement(l.Fragment,null,l.createElement("div",{className:Qa.separator}),l.createElement(ss,{enabled:(null===(s=null===(a=c.reader)||void 0===a?void 0:a.gmail)||void 0===s?void 0:s.enabled)||!1,toggle:e=>{r.toggleReader(e),Ba.J.readerMailFeatureToggleClick(e?"on":"off")}}))),l.createElement(Pa,{heading:"CUSTOMIZE GRAMMARLY",enabled:C},l.createElement("div",{className:Qa.separator}),l.createElement(Za,{changeStrongDialect:r.changeStrongDialect,dialectStrong:c.dialectStrong,dialectWeak:c.dialectWeak,dropdownOnTop:k,disabled:y}),C),!k&&l.createElement(es,{user:d,openSubscriptionDialog:p,isAssistant:"assistant"===g}),_&&l.createElement(La,{openGBLanding:m,showTitle:"popup"===g,showBackground:"popup"===g}))};var ns=i(32138),os=i(82785),ls=i(91574);const cs=({viewModels:e,children:t})=>{const{domain:i,actions:a,state:s}=e.assistantSettingsViewModel,[r,n]=l.useState(!!s.view("commonSettings","enabled").get()),o={checked:r,update:n};return t({content:l.createElement(Et.F.Fragment,null,s.view((({user:t,commonSettings:s,dynamicConfig:r})=>l.createElement(Ja.Provider,{value:{ctaFontSize:13}},l.createElement(rs,{actions:a,config:{enabled:!0,domain:i},settings:s,user:t,dynamicConfig:r,siteCategory:os.y.other,openSubscriptionDialog:()=>e.upgradeViewModel.openUpgradeUrl(Ee.L.Place.extensionSettingsAssistant),openGBLanding:e=>{const t=(0,ns.Z4)(e,"gbExtensionSettingsAssistant");self.open(t),ya.J.getGBButtonClick("gbExtAssistantSettings","ExploreGrammarlyBusiness")},openUrl:e=>self.open(e),showGBUpHook:(0,Oe.i7)(),placement:"assistant",siteSwitcherChecked:o})))),e.isSingleCardAssistant?null:l.createElement(ca,{feedbackVM:e.assistantFeedbackViewModel,entryPoint:J.Q.settings})),onDone:()=>{a.toggleSite(r,i),ya.J.checkingToggleClick("assistant",os.y.other,r?"on":"off"),(0,xa.T)().toggleExtension(r,"assistant"),e.assistantLayoutViewModel.popActiveView()}})},ds=({viewModels:e})=>l.createElement(cs,{viewModels:e},(({content:t,onDone:i})=>l.createElement(Xt,{dataPartName:"settings-view-overlay",layoutVM:e.assistantLayoutViewModel,panelClassName:ls.settingsViewOverlayPanel,contentClassName:ls.settingsViewOverlayContent,footer:l.createElement(ci.z,{className:ls.settingsViewDoneButton,kind:"success",type:"submit",onClick:i},"Done")},t)));var us=i(62727),ps=i(80550),ms=i(92132),hs=i(70091),gs=i(63544),vs=i(17161),fs=i(53447),ws=i(67521),bs=i(5817),Ss=i(64078),ys=i(42103),_s=i(33678),ks=i(15073),As=i(101),Cs=i(85089),Es=i(2834),Is=i(89068),Ms=i(78674),Ts=i(50628),xs=i(72481),Rs=i(8313);const Ls=l.memo((({viewModels:e,emogenieService:t,height:i,ready:a,OuterElementsPortalSource:s})=>{const r=new Le.C;(0,f.iR)("viewModels",e);const n=(0,Ki.IQ)(),c=(0,Ki.e8)(),d=l.useContext(Ki.Dg).state.pipe(N.h((e=>!e.dragging)),Vt.O(gs.zM)),u=l.useContext(vs.Y4),p=(0,fs.C7)(),m=_e.h.create(Bt.UL.empty);(0,ws.A)(at.aj([d,u]).pipe(U.U((([e,t])=>{const i=t.top+e.translate.y,a=t.left+e.translate.x,s=p.height-i-t.height,r=p.width-a-t.width;return{height:t.height,width:t.width,top:i,left:a,bottom:s,right:r}})),Es.b(ye.wW(m)))),(0,ws.A)(d.pipe(Es.b((t=>e.positionViewModel.onDrag(t))))),(0,ws.A)(e.assistantLayoutViewModel.activeView.pipe(si.G(),Es.b((([t,i])=>{t.type!==i.type&&fe.aH.isDefault(i)&&e.cardsListScrollManager.paddingTop.set(0)}))));const h=l.useRef(null);return l.useEffect((()=>{e.assistantCardListViewModel.cardListContext.next(b.fromNullable(h.current));const t=h.current?Cs.rl(h.current,{subtree:!0,childList:!0}):st.C,i=m.view((e=>({top:e.top,left:e.left}))),s=(0,o.pipe)(t,Is.V((0,bs.m9)(1)),Ms.b(10),Ts.P()).subscribe((()=>a(i,n)),(()=>{a(i,n,!0)}));return()=>{s.unsubscribe()}}),[]),l.createElement(Fs,{remSize:e.remSize,environment:r,viewport:m},l.createElement(Et.F.div,{"data-grammarly-part":"assistant-popup-content",...(0,Ot.Sh)(Nt.assistant,n.pipe(Vt.O(!1),U.U((e=>e&&Nt.dragging)))),style:{height:i,maxHeight:"90vh"}},l.createElement(Di,{viewModels:e,draggableRef:c}),e.assistantLayoutViewModel.activeView.view((i=>fe.aH.isDefault(i)?l.createElement(jt,{viewModels:e,ref:h,key:"default-view"}):fe.aH.isEmogenie(i)?l.createElement(bi,{emogenieService:t,viewModels:e,key:"emogenie-view",ref:h}):fe.aH.isReadersAttention(i)?l.createElement(ba,{viewModels:e,readersAttentionVM:e.readersAttentionViewModel,key:"readers-attention-view",ref:h}):fe.aH.isReadersAttentionHelp(i)?l.createElement(na,{layoutVM:e.assistantLayoutViewModel,key:"readers-attention-help"}):fe.aH.isFeedback(i)?l.createElement(_i,{feedbackVM:e.assistantFeedbackViewModel,layoutVM:e.assistantLayoutViewModel,key:"feedback-view"}):fe.aH.isSettings(i)?l.createElement(ds,{viewModels:e,key:"settings-view"}):fe.aH.isProofitRequest(i)&&b.isSome(e.assistantProofitViewModel)?l.createElement(ea,{layoutVM:e.assistantLayoutViewModel,proofitVM:e.assistantProofitViewModel.value,key:"proofit-request-view"}):fe.aH.isProofitReview(i)&&b.isSome(e.assistantProofitViewModel)?l.createElement(aa,{layoutVM:e.assistantLayoutViewModel,proofitVM:e.assistantProofitViewModel.value,key:"proofit-review-view"}):fe.aH.isPopup(i)?l.createElement(ji,{key:"popup-view",viewModels:e}):null))),l.createElement(s,null,l.createElement(hs.jv,null,l.createElement(ps.L,{modalManager:e.assistantModalManager}))),l.createElement(Ss.X,null))})),Fs=({environment:e,viewport:t,children:i,remSize:a})=>{var s;const r=l.useRef(yt(ft.m.getConfig(e.has(Le.U.Flag.isAppleSystem)?"mac":"windows"))),n=null===(s=l.useContext(us.n.Context))||void 0===s?void 0:s.host;return l.createElement(ms.Q,{remSize:a,setter:e=>ks.u.setRootCssVar(n||document.documentElement,e)},l.createElement(xs.p.Manager,{cardWidth:xs.p.withCardWidthEffect(xs.p.defaultSizeObserver,(e=>{xs.p.setRootCssVar(n||document.documentElement,e)}))},l.createElement(Le.U.Context.Provider,{value:e},l.createElement(_s.a.Context.Provider,{value:e},l.createElement(vt.Context.Provider,{value:r.current.assistant},l.createElement(ft.m.Context.Provider,{value:r.current.denali},l.createElement(Rs.TG.ContextMock,null,l.createElement(As.l.RootVirtualContainer,{viewport:t,name:"draggable"},l.createElement(ys.G.DefaultProvider,null,l.createElement(hs.jv,null,i))))))))))};var Ps=i(63919),Vs=i(62337);const Bs=({textFieldRect:e,viewModels:t,gButtonRect:i,draggableGButtonType:a,children:s})=>{const{initialPositionOffset:r}=t.positionViewModel,n=Vs.UL.shift(i,Ps.E9.minus(e.client,e.page)),o=null===a?{...e.client,...e.size}:n,c=(0,fs.C7)(),d=null===a?t.assistantLayoutViewModel.layout:ve.V.draggableGButtonClassicAssistantLayout(n,e);return l.createElement(Ki._l,{bounds:c,hasDragHandle:!0},(({translate:e})=>l.createElement(vs.sX,{anchorRect:o,viewportRect:c,anchorOrigin:d.anchorOrigin,elementOrigin:d.assistantOrigin,anchorMargin:d.anchorMargin,repositioning:d.repositioningStrategy,stickToTarget:!1,viewportMargin:0,postRepositioningOffset:{horizontal:r.left,vertical:r.top}},(({top:t,left:i})=>l.createElement("div",{"data-grammarly-part":"assistant-popup",style:{position:"fixed",transform:`translate(${e.x}px, ${e.y}px)`,zIndex:Vi.Eq,top:t,left:i}},s)))))},Os=({gbuttonRect:e,viewModels:t,onDomRectChange:i,children:a})=>{const s=(0,fs.C7)(),[r,n]=l.useState(gs.zM),[o,c]=l.useState(null),[d,u]=l.useState(null),[p,m]=l.useState(vs.KC.top),[h,g]=l.useState(vs.KC.left),[v,f]=l.useState(vs.KC.height),[w,b]=l.useState(vs.KC.width),S=l.useRef(new X.X(vs.KC)),y=null!=d?d:r.translate;return l.useEffect((()=>{const e=S.current.pipe(si.G()).subscribe((([e,t])=>{let i,a;h!==vs.KC.left&&e.left===t.left||(i=t.left),p===vs.KC.top?a=t.top:e.height!==t.height&&(a=p-(t.height-e.height),a<0&&(a=0)),void 0!==a&&m(a),void 0!==i&&g(t.left),f(t.height),b(t.width)}));return()=>e.unsubscribe()}),[p,h]),l.useEffect((()=>{const e=s.height-p-v,t=s.height-h-w;i({top:p,left:h,bottom:e,right:t,height:v,width:w})}),[p,h,w,v]),l.useEffect((()=>{!r.dragging&&r.dragEnd&&(m(p+y.y),g(h+y.x),c(r.translate),u({x:0,y:0}))}),[r]),l.useEffect((()=>{r.dragging&&d&&o&&u({x:r.translate.x-o.x,y:r.translate.y-o.y})}),[r]),l.createElement(Ki._l,{bounds:s,hasDragHandle:!0,onChangeDragState:n},l.createElement(vs.sX,{anchorRect:e,viewportRect:s,anchorOrigin:t.assistantLayoutViewModel.layout.anchorOrigin,elementOrigin:t.assistantLayoutViewModel.layout.assistantOrigin,anchorMargin:t.assistantLayoutViewModel.layout.anchorMargin,repositioning:t.assistantLayoutViewModel.layout.repositioningStrategy,stickToTarget:!1,viewportMargin:0,postRepositioningOffset:{horizontal:t.positionViewModel.initialPositionOffset.left,vertical:t.positionViewModel.initialPositionOffset.top},onChangePosition:e=>S.current.next(e)},l.createElement("div",{"data-grammarly-part":"single-card-assistant-popup",style:{position:"fixed",transform:`translate(${y.x}px, ${y.y}px)`,zIndex:Vi.Eq,top:p,left:h}},a)))};var Ns=i(31699);const Hs=({htmlToSanitize:e,...t})=>l.createElement("div",{...t,dangerouslySetInnerHTML:{__html:(0,Ns.sanitize)(e)}});var Us=i(7538);const Ds=({details:e,examples:t})=>l.createElement("div",{className:Us.learnMore},l.createElement(Hs,{htmlToSanitize:e}),t.map(((e,t)=>{const i=e.type===be.correct,a=e.type===be.incorrect,s=i||a?l.createElement("div",{...(0,Ot.Sh)(Us.learnMoreExampleIcon,i?Us.learnMoreExampleCorrectIcon:null,a?Us.learnMoreExampleIncorrectIcon:null)}):null;return l.createElement("div",{className:Us.learnMoreExample,key:`learn-more-example-${t}`},e.title?l.createElement(l.Fragment,null,l.createElement("div",{className:Us.learnMoreExampleIconAndTitle},s,l.createElement("div",{className:Us.learnMoreExampleTitle},e.title)),l.createElement(Hs,{...(0,Ot.Sh)(s?Us.learnMoreExampleTextMarginLeft:null,e.useItalicText?Us.learnMoreExampleTextItalic:null),htmlToSanitize:e.text})):l.createElement(Hs,{...(0,Ot.Sh)(e.useItalicText?Us.learnMoreExampleTextItalic:null),htmlToSanitize:e.text}))}))),Ws=({learnMoreInfo:e})=>l.createElement(Et.F.Fragment,null,e.view((e=>e?l.createElement(Ds,{details:e.details,examples:e.examples}):null)));var js=i(29758),Gs=i(24641),zs=i(12267);const qs=l.forwardRef((({icon:e,tooltip:t,name:i,onClick:a,id:s},r)=>{const n=l.createElement(Gs.k.button.secondary,{text:l.createElement(Gs.k.block,{spacing:{top:y.T.D0,bottom:y.T.D0,left:y.T.D025,right:y.T.D025},verticalAlign:y.g$.Middle,children:l.createElement(Gs.k.icon[e]),id:s}),name:i,state:y.BN.Enabled,tooltip:void 0,onClick:a});return l.createElement(Jt.u,{message:t,showDelay:Vi.gk},l.createElement("span",{ref:r},n))})),Ks=l.forwardRef((({draggableRef:e,onClickSettings:t,onClickFeedback:i,onClickClose:a,onClickBack:s,overlapContentWithHeader:r=!1,headerContent:n,className:o,children:c,includeContentPadding:d=!1,footer:u,maxContentHeight:p},m)=>{const[h,g]=l.useState(!1),[v,f]=l.useState(!1),[w,b]=l.useState(!1),[S,_]=l.useState(!1),[k,A]=l.useState(!1),[C,E]=l.useState(0),[I,M]=l.useState(0),[T,x]=l.useState(r?0:40),[R,L]=l.useState(!1),F=l.useRef(null),P=l.useRef(null);l.useEffect((()=>{f(S||w)}),[S,w]),l.useEffect((()=>{s||_(!1)}),[s]),l.useEffect((()=>{x(C+I+(r?0:40))}),[C,I,r]);const V=l.useRef(null);l.useEffect((()=>{var e;return F.current?(null===(e=V.current)||void 0===e||e.disconnect(),V.current=js.N.getResizeObserver((()=>{F.current&&E(F.current.getBoundingClientRect().height)})),V.current.observe(F.current)):E(0),()=>{var e;return null===(e=V.current)||void 0===e?void 0:e.disconnect()}}),[F.current]);const B=l.useRef(null);l.useEffect((()=>{var e;return P.current?(null===(e=B.current)||void 0===e||e.disconnect(),B.current=js.N.getResizeObserver((()=>{P.current&&M(P.current.getBoundingClientRect().height)})),B.current.observe(P.current)):M(0),()=>{var e;return null===(e=B.current)||void 0===e?void 0:e.disconnect()}}),[u,P.current]);const O=l.useCallback((()=>L(!!F.current&&F.current.scrollTop>0)),[F.current]);return l.useEffect((()=>{F.current&&(F.current.scrollTop=0,L(!1))}),[F.current,C]),l.createElement("div",{...(0,Ot.Sh)(zs.singleCardAssistant,o),"data-grammarly-part":"single-card-assistant",ref:m,style:{height:T}},l.createElement(Jt.u,{disabled:!e||k,message:"Grab and drag to move panel",showDelay:Vi.gk},l.createElement("div",{...(0,Ot.Sh)(zs.singleCardAssistantHeader,e?zs.singleCardAssistantHeaderDraggable:null,r?zs.singleCardAssistantHeaderWithOverlappingContent:zs.singleCardAssistantHeaderWithoutOverlappingContent,v?zs.singleCardAssistantHeaderWithButtonHovered:null),ref:e,onMouseDown:()=>A(!0),onMouseOver:()=>{v||g(!0)},onMouseOut:()=>{g(!1),A(!1)},"data-grammarly-part":"single-card-assistant-header"},l.createElement("div",{className:zs.singleCardAssistantHeaderButtons,onMouseEnter:()=>{g(!1),b(!0)},onMouseLeave:()=>b(!1)},i?l.createElement(qs,{icon:y.Tb.Feedback,tooltip:"Provide feedback",name:"feedback",onClick:i,id:"#single-card-assistant-header-button-feedback"}):null,t?l.createElement(qs,{icon:y.Tb.Gear,tooltip:"Settings",name:"settings",onClick:t,id:"#single-card-assistant-header-button-settings"}):null,a?l.createElement(qs,{icon:y.Tb.Close,tooltip:"Close panel",name:"close",onClick:a,id:"#single-card-assistant-header-button-close"}):null),l.createElement("div",{className:zs.singleCardAssistantHeaderContent},e?l.createElement("div",{className:zs.singleCardAssistantHeaderDraggableIcon}):null,s?l.createElement(Jt.u,{message:"Back to all alerts",showDelay:Vi.gk},l.createElement(Bi.h,{dataGrammarlyPart:"single-card-assistant-back-button",kind:"neutral",className:zs.singleCardAssistantHeaderBackButton,onClick:s,onMouseEnter:()=>{g(!1),_(!0)},onMouseLeave:()=>_(!1)},l.createElement("div",{className:zs.singleCardAssistantHeaderBackButtonIcon}))):null,n?l.createElement("div",{className:zs.singleCardAssistantHeaderContentInner},n):null))),e&&r&&h?l.createElement("div",{className:zs.singleCardAssistantHeaderDraggableHoveredBackground}):null,l.createElement("div",{...(0,Ot.Sh)(zs.singleCardAssistantContent,r?zs.singleCardAssistantContentWithOverlappingHeader:null,d?zs.singleCardAssistantContentWithPadding:null,R?zs.singleCardAssistantContentScrolled:null),style:p?{maxHeight:p,overflowY:"auto"}:void 0,ref:F,onScroll:O},c),u?l.createElement("div",{className:zs.singleCardAssistantFooter,ref:P,onClick:()=>u.onClick()},l.createElement("div",{className:zs.singleCardAssistantFooterText},u.content),l.createElement("div",null,l.createElement(qs,{icon:y.Tb.ArrowRight,tooltip:u.tooltip,name:"footer",onClick:()=>u.onClick(),id:"#single-card-assistant-footer-button"}))):null)}));var Zs=i(17208);const Xs=({acceptedSuggestionsCount:e,wordsCount:t})=>l.createElement("div",{className:Zs.successReport},l.createElement("div",{className:Zs.successReportIcon}),l.createElement("div",{className:Zs.successReportTitle},t<2?"Looking good so far":e>0?`${e} ${w._6(e,"issue addressed","issues addressed")}`:"Nice job!"),l.createElement("div",{className:Zs.successReportSubtitle},t<2?"Keep writing to see suggestions.":e>0?"All clear!":"You made that look easy!"));var Qs=i(43314),$s=i(40656);const Ys=l.memo((({viewModels:e,emogenieService:t,height:i,domRect:a,ready:s})=>{var r,n,c,d,u,p;const m=new Le.C;(0,f.iR)("viewModels",e);const h=(0,Ki.IQ)(),g=(0,Ki.e8)(),v=l.useContext(Ki.Dg).state.pipe(N.h((e=>!e.dragging)),Vt.O(gs.zM));(0,ws.A)(v.pipe(Es.b((t=>e.positionViewModel.onDrag(t))))),l.useEffect((()=>{const e=a.view((e=>({top:e.top,left:e.left})));s(e,h)}),[]);const S=l.useRef(null),y=l.useRef(null);l.useEffect((()=>{var e;return S.current&&(null===(e=y.current)||void 0===e||e.disconnect(),y.current=js.N.getResizeObserver(_),y.current.observe(S.current)),()=>{var e;return null===(e=y.current)||void 0===e?void 0:e.disconnect()}}),[S.current]);const _=()=>{S.current&&i.set(S.current.getBoundingClientRect().height)},k=e.lensState,A=at.aj([k,null!==(n=null===(r=e.bulkDismissViewModel)||void 0===r?void 0:r.onlyBulkDismissItemsRemain)&&void 0!==n?n:it.of(!1),null!==(d=null===(c=e.bulkDismissViewModel)||void 0===c?void 0:c.bulkDismissHasBeenReviewed)&&void 0!==d?d:it.of(!1)]).pipe(U.U((([t,i,a])=>!0===pe.v.WithSuccess.State.isInSuccess(e.capabilities)(t)||i&&!a))),C=l.createElement(Et.F.Fragment,null,e.assistantLayoutViewModel.activeView.view((i=>ge.isLearnMore(i)?l.createElement(Et.F.Fragment,null,e.learnMoreViewModel.learnMoreInfo.view((e=>e?w.kC(e.title):null))):ge.isEmogenie(i)?l.createElement(Et.F.div,{className:$s.singleCardAssistantEmogenieReportHeader},t.viewState.view((e=>{var t;return e.isBrandTonesEnabled?l.createElement("div",{className:$s.singleCardAssistantEmogenieReportHeaderBrandTones},(null===(t=e.report)||void 0===t?void 0:t.institutionLogo)?l.createElement("img",{className:$s.singleCardAssistantEmogenieReportHeaderBrandTonesLogo,src:e.report.institutionLogo}):null,e.institutionName," Tone Detector"):"Tone insights"})),l.createElement(gi.v,{browser:e.assistantLayoutViewModel.browser,className:$s.singleCardAssistantEmogenieReportHeaderBetaBadge})):fe.aH.isSettings(i)?"Settings":fe.aH.isFeedback(i)?"Product Feedback":null))),E=$.item(e.cardsViewModel.actionEvents),I=(0,o.pipe)(Qs.c.assistant(E),he.UI.patch("content","card")((t=>(0,o.pipe)(he.UI.Union.asOption(he.UI.Knot.make(he.UI.Grid.make((({slots:t})=>l.createElement(Et.F.div,{"data-grammarly-part":"single-card-assistant-checks-feed",...(0,Ot.Sh)(e.toneDetectorViewModel.toneSuggestionInfo.view((e=>e?$s.singleCardAssistantChecksFeedWithToneSuggestions:null)),$s.singleCardAssistantChecksFeed)},t.children))),{children:t})),he.UI.squash,he.UI.contramapState((e=>"empty"===e.kind?b.none:b.some({children:e}))),he.UI.mapAction((e=>e.action.action.action)))))),M=k.lens(P.nL.Prism.getLens()),T=$.createCardListFlow(M,e.capabilities),x=(0,o.pipe)(T,he.Z.extendActions(Es.b((t=>{"content"===t.key&&"card"===t.action.key&&"alertRefSDUI"===t.action.action.key&&e.cardsViewModel.actionEvents.next(t.action.action.action),"content"===t.key&&"card"===t.action.key&&"upgradeHookCard"===t.action.action.key&&("onUpgradeHookCardMount"===t.action.action.action.type?e.upgradeHookItemViewModel.events.next({type:"showedUpgradeHook"}):e.upgradeHookItemViewModel.events.next(t.action.action.action))}))));return l.createElement(Fs,{remSize:e.remSize,environment:m,viewport:a},l.createElement(Et.F.Fragment,null,at.aj([e.assistantLayoutViewModel.activeView,A,null!==(p=null===(u=e.bulkDismissViewModel)||void 0===u?void 0:u.bulkDismissAlertsCount)&&void 0!==p?p:_e.h.create(0)]).pipe(U.U((([i,a,s])=>{const r=ge.isDefault(i),n=r&&!a,o=r&&a,c=ge.isLearnMore(i),d=ge.isSettings(i),u=ge.isFeedback(i),p=ge.isEmogenie(i);return l.createElement(Ks,{className:$s.singleCardAssistant,draggableRef:g,onClickSettings:n?void 0:()=>d?e.assistantLayoutViewModel.popActiveView():e.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.settings}),onClickFeedback:n?void 0:()=>u?e.assistantLayoutViewModel.popActiveView():e.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.feedback}),onClickClose:n?void 0:e.closeAssistant,onClickBack:r?void 0:()=>e.assistantLayoutViewModel.popActiveView(),headerContent:C,overlapContentWithHeader:n,includeContentPadding:!n,footer:o&&s>0?{content:l.createElement(l.Fragment,null,"We hid ",s," suggestions that didn’t seem relevant to your text. Want to review them?"),tooltip:"Review suggestions",onClick:()=>{var t;null===(t=e.bulkDismissViewModel)||void 0===t||t.bulkDismissFooterReviewClicks.next(void 0)}}:void 0,ref:S,maxContentHeight:c?216:void 0},r?n?he.UI.mount(I,x):l.createElement(Et.F.Fragment,null,_e.h.combine(e.statisticsService.sessionStats,e.statisticsService.wordsCount,((e,t)=>{var i;return l.createElement(Xs,{acceptedSuggestionsCount:null!==(i=null==e?void 0:e.alertsStats.accepted.total)&&void 0!==i?i:0,wordsCount:t})}))):c?l.createElement(Ws,{learnMoreInfo:e.learnMoreViewModel.learnMoreInfo}):p?l.createElement(hi,{emogenieService:t,toneSuggestionInfo:e.toneDetectorViewModel.toneSuggestionInfo,onShowToneSuggestionInfo:t=>e.toneDetectorViewModel.onShowToneSuggestionInfo(t),onClickToneSuggestionInfoCta:t=>e.toneDetectorViewModel.onClickToneSuggestionInfoCta(t)}):d?l.createElement(cs,{viewModels:e},(({onDone:e,content:t})=>l.createElement(l.Fragment,null,t,l.createElement(ci.z,{kind:"primary",type:"submit",onClick:e,className:$s.singleCardAssistantSettingsDoneButton},"Done")))):u?l.createElement(yi.q5,{domain:e.assistantFeedbackViewModel.getDomain(),hideDomainHelpText:!0,onClose:()=>e.assistantLayoutViewModel.popActiveView(),align:"left",title:l.createElement("span",null,"How do you like Grammarly?"),onSubmit:t=>e.assistantFeedbackViewModel.submitFeedback(t),withScore:!0,hideLogo:!0,hideTextBoxTitle:!0,placeholderText:"How can we improve?",compactDisplay:!0,submitButtonKind:"primary"}):null)})))),l.createElement(Ss.X,null))})),Js=l.memo((({viewModels:e,emogenieService:t,height:i,domRect:a,ready:s})=>{const r=new Le.C;(0,f.iR)("viewModels",e);const n=(0,Ki.IQ)(),c=(0,Ki.e8)(),d=l.useContext(Ki.Dg).state.pipe(N.h((e=>!e.dragging)),Vt.O(gs.zM));(0,ws.A)(d.pipe(Es.b((t=>e.positionViewModel.onDrag(t))))),l.useEffect((()=>{const e=a.view((e=>({top:e.top,left:e.left})));s(e,n)}),[]);const u=l.useRef(null),p=l.useRef(null);l.useEffect((()=>{var e;return u.current&&(null===(e=p.current)||void 0===e||e.disconnect(),p.current=js.N.getResizeObserver(m),p.current.observe(u.current)),()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.disconnect()}}),[u.current]);const m=()=>{u.current&&i.set(u.current.getBoundingClientRect().height)},h=e.lensState,g=h.lens(P.nL.Prism.getLens()),v=h.view(pe.v.WithSuccess.State.isInSuccess(e.capabilities)),S=l.createElement(Et.F.Fragment,null,e.assistantLayoutViewModel.activeView.view((i=>ge.isLearnMore(i)?l.createElement(Et.F.Fragment,null,e.learnMoreViewModel.learnMoreInfo.view((e=>e?w.kC(e.title):null))):ge.isEmogenie(i)?l.createElement(Et.F.div,{className:$s.singleCardAssistantEmogenieReportHeader},t.viewState.view((e=>{var t;return e.isBrandTonesEnabled?l.createElement("div",{className:$s.singleCardAssistantEmogenieReportHeaderBrandTones},(null===(t=e.report)||void 0===t?void 0:t.institutionLogo)?l.createElement("img",{className:$s.singleCardAssistantEmogenieReportHeaderBrandTonesLogo,src:e.report.institutionLogo}):null,e.institutionName," Tone Detector"):"Tone insights"})),l.createElement(gi.v,{browser:e.assistantLayoutViewModel.browser,className:$s.singleCardAssistantEmogenieReportHeaderBetaBadge})):fe.aH.isSettings(i)?"Settings":fe.aH.isFeedback(i)?"Product Feedback":null))),y=ct.item(e.cardsViewModel.actionEvents),_=(0,o.pipe)(Qs.c.assistant(y),he.UI.patch("content","card")((t=>(0,o.pipe)(he.UI.Union.asOption(he.UI.Knot.make(he.UI.Grid.make((({slots:t})=>l.createElement(Et.F.div,{"data-grammarly-part":"single-card-assistant-checks-feed",...(0,Ot.Sh)(e.toneDetectorViewModel.toneSuggestionInfo.view((e=>e?$s.singleCardAssistantChecksFeedWithToneSuggestions:null)),$s.singleCardAssistantChecksFeed)},t.children))),{children:t})),he.UI.squash,he.UI.contramapState((e=>"empty"===e.kind?b.none:b.some({children:e}))),he.UI.mapAction((e=>e.action.action.action)))))),k=ct.createCardListFlow(g,e.capabilities),A=(0,o.pipe)(k,he.Z.extendActions(Es.b((t=>{"content"===t.key&&"card"===t.action.key&&"alertRefSDUI"===t.action.action.key&&e.cardsViewModel.actionEvents.next(t.action.action.action),"content"===t.key&&"card"===t.action.key&&"upgradeHookCard"===t.action.action.key&&("onUpgradeHookCardMount"===t.action.action.action.type?e.upgradeHookItemViewModel.events.next({type:"showedUpgradeHook"}):e.upgradeHookItemViewModel.events.next(t.action.action.action))}))));return l.createElement(Fs,{remSize:e.remSize,environment:r,viewport:a},l.createElement(Et.F.Fragment,null,_e.h.combine(e.assistantLayoutViewModel.activeView,v,((i,a)=>{const s=ge.isDefault(i),r=s&&!a,n=ge.isLearnMore(i),o=ge.isSettings(i),d=ge.isFeedback(i),p=ge.isEmogenie(i);return l.createElement(Ks,{className:$s.singleCardAssistant,draggableRef:c,onClickSettings:r?void 0:()=>o?e.assistantLayoutViewModel.popActiveView():e.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.settings}),onClickFeedback:r?void 0:()=>d?e.assistantLayoutViewModel.popActiveView():e.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.feedback}),onClickClose:r?void 0:e.closeAssistant,onClickBack:s?void 0:()=>e.assistantLayoutViewModel.popActiveView(),headerContent:S,overlapContentWithHeader:r,includeContentPadding:!r,ref:u,maxContentHeight:n?216:void 0},s?r?he.UI.mount(_,A):l.createElement(Et.F.Fragment,null,_e.h.combine(e.statisticsService.sessionStats,e.statisticsService.wordsCount,((e,t)=>{var i;return l.createElement(Xs,{acceptedSuggestionsCount:null!==(i=null==e?void 0:e.alertsStats.accepted.total)&&void 0!==i?i:0,wordsCount:t})}))):n?l.createElement(Ws,{learnMoreInfo:e.learnMoreViewModel.learnMoreInfo}):p?l.createElement(hi,{emogenieService:t,toneSuggestionInfo:e.toneDetectorViewModel.toneSuggestionInfo,onShowToneSuggestionInfo:t=>e.toneDetectorViewModel.onShowToneSuggestionInfo(t),onClickToneSuggestionInfoCta:t=>e.toneDetectorViewModel.onClickToneSuggestionInfoCta(t)}):o?l.createElement(cs,{viewModels:e},(({onDone:e,content:t})=>l.createElement(l.Fragment,null,t,l.createElement(ci.z,{kind:"primary",type:"submit",onClick:e,className:$s.singleCardAssistantSettingsDoneButton},"Done")))):d?l.createElement(yi.q5,{domain:e.assistantFeedbackViewModel.getDomain(),hideDomainHelpText:!0,onClose:()=>e.assistantLayoutViewModel.popActiveView(),align:"left",title:l.createElement("span",null,"How do you like Grammarly?"),onSubmit:t=>e.assistantFeedbackViewModel.submitFeedback(t),withScore:!0,hideLogo:!0,hideTextBoxTitle:!0,placeholderText:"How can we improve?",compactDisplay:!0,submitButtonKind:"primary"}):null)}))),l.createElement(Ss.X,null))}));var er,tr=i(9922),ir=i(79692),ar=i(49708),sr=i(2768);(0,p.C)();class rr{constructor(e,t){this._params=e,this._felog=t,this._log=c.Y.create(rr.name),this._integration=null,this._viewModels=_e.h.create(null),this._assistantPopupIsReady=new Z.xQ,this._initPerformance=void 0,this._openMeasure=void 0,this._height=_e.h.create(0),this._domRect=_e.h.create(Bt.UL.empty),this._openState=_e.h.create("closed"),this._subs=new tr.w.Keeper,this.openState=this._openState.view(),this.open=(e,t)=>{var i,a;const s=this._params.contentScriptState.view("user").view((e=>({isPremium:e.premium,isAnonymous:e.anonymous,experiments:e.experiments,customFields:e.customFields,institutionInfo:e.institutionInfo}))),r=this._viewModels.get();if(null!==r)nr(!0,r,t);else{this._openMeasure=this._felog.openTime.startMeasure();const r=this._felog.initTime.startMeasure();this._openState.set("opening");const l=this._params.assistantService,c=l.createIntegration({gnar:this._params.gnar,readersAttentionFeature:this._params.readersAttentionFeature,snippetsFeature:this._params.snippetsFeature,shortenItFeature:this._params.shortenItFeature,sentenceLevelBrandTonesFeature:this._params.sentenceLevelBrandTonesFeature,getSduiEnabled:this._params.getSduiEnabled,experimentClient:this._params.experimentClient,sduiV2Enabled:this._params.sduiV2Enabled});if(!c)return this._log.warn("tried to open assistant with checking service not initialized"),r.cancelMeasure(),void this._openMeasure.cancelMeasure();null===(a=(i=this._params).onOpen)||void 0===a||a.call(i,c),this._integration=c;const d=(0,o.pipe)(this._params.getSduiEnabled(),b.fold((()=>!1),n.yR))?this._params.sduiV2Enabled?((e,t,i,a,s,r,o,l,c,d,u,p,v,w,S,y,k,A,C,E,I,R,L)=>{const V=lt.C8.Logging.getLogger("single_card_assistant_view_modes"),B=_e.h.create(De.A.defaultState),O=_e.h.create(!1),N=(0,xe.z)(r.view("user").get(),R),H=ze.t.create(ze.t.defaultLensFilters,{...ze.t.defaultTextFilters,[x.R.SpecialId.Closed]:n.jv,[x.R.SpecialId.AllAlerts]:se.bZ.belongsToAllAlerts}),D=De.A.get(e.alertsList.state,e.alertsList.lensesScores,H).subscribe(ye.wW(B)),z=new Ve.t(B.view("lenses"),H,e.sessionModel.scoreStatus),q=(0,Ke.$y)((0,He.a)(t).getContents),K={features:new Set([Xe.IG.Features.showCardLabelInOutcomes]),cardLayoutDensityMode:$e.j.Density.minimal,shouldAnimateAlertApply:Xe.IG.Default.shouldAnimateAlertApply,cardVisualMode:_e.h.create($e.j.CardVisualMode.RegularLightMode)},X=(0,Xe.Ls)(q,e.alertsReader,K,(()=>it.of(b.none)),e.mutingAlertsReader),re=_e.h.create(16),ne=$.getCapabilities(X,e.alertsReader),oe=$.getSDUIClientOrd(ne),le=new Je.oq(e.alertsList.state,e.alertsReader,B.view("lenses"),e.positionManager,z,new et.gi($.equatable.structEq,oe),(()=>()=>n.yR),ne,H),ce=_e.h.create(le.emptyState(x.R.SpecialId.AllAlerts).patch({alertSource:se.l$.sidebar}));i.next({kind:Re.R.ChangeLens,selectedLens:"all"});const de=(0,Ze.u0)((()=>t.getCursor().index),le),me=new Le.C(I()),he=new qe.Xx({flush:()=>t.flushChanges()},new Z.xQ,X,e.alertsService,e.sduiService,(()=>Promise.resolve()),(()=>Promise.resolve()),(0,n.zG)(e.mutedAlertsCategoriesModel,b.map((e=>({model:e,openSuggestionsManagement:()=>self.open((0,Oe.Um)().suggestionsSettings)})))),b.some(ee.B.getCardsViewModelSendToURLExperiment(me,l)),(()=>!1),$.getActiveItemWithAlert,ne,ce,me,{bufferTransitions:!0,showGbPrompt:ee.B.shouldShow(d.get())},e.sduiManager,void 0,b.isSome(e.sduiManager)),ge=N?()=>{O.get()&&O.set(!1)}:void 0,ve=new we(l,p,v,A,he.actionEvents,u,ge),fe=new J._(ve,c,l),be=new Y.y(he.actionEvents,l,e.alertsReader),Se=new Qe.o((()=>ot.F2(void 0))),Ae=O.pipe(W.h(ye.PU)),Ce=r.view("user").pipe(U.U((e=>e.premium))).subscribe((e=>{e&&O.set(!1)})),Me=(0,Be.xl)(ce,H,Ae,O),ct=(0,n.zG)(at.aj([Me,F.P.Filters.getBulkDismissAhiFilter(ce,ne)]),U.U((([e,t])=>(0,f.W9)(e,t)))),dt=new Be.o$(e.alertsList,e.alertsReader,e.positionManager,e.alertsService,t,ce,ct,$.getActiveItemWithAlert,a,!0,O),ut=(0,Fe.hp)(ce,dt,re,Se,t,V),pt=new Ge.mN(t,ce,dt,e.alertsReader,$.getActiveItemWithAlert,(t=>{const i=t.reduce(((t,i)=>(0,n.zG)(e.alertsReader.getById(i.alert.id),b.chain(se.bZ.getRawId),G.bw((e=>t.set(e,i))),b.fold((()=>t),(()=>t)))),new Map),a=Array.from(i.keys()).map(S.alerts.getAlertById).filter(Ne.fQ);if(a.length){const e=a.reduce(((e,t)=>h.S.ordering.greaterThanOrEqual(t,e)?t:e));return b.fromNullable(i.get(Ue.wQ.Id.create(e.id)))}return b.none})),mt=new Ee.x(e.alertsList,ce,3),ht=new ue.B.ViewModel.UpgradeHookItemViewModelImpl(he,mt,st.C,Ee.L.Place.assistantCardList,{onShowUpgradeHook:()=>{N&&O.set(!0),l.assistantExpandedUpgradeHookShow((0,n.zG)(mt.advancedAlerts.get(),b.fold((()=>0),(e=>e.count))),100)},onOpenUpgradeUrl:()=>l.getPremiumButtonClick("assistantList","SeeWhatsInPremium"),onDismissUpgradeHook:()=>{O.set(!1)}}),gt=new Te(e.alertsReader,e.alertsList.state,(()=>b.fromNullable(null==y?void 0:y.sessionUuid)),l,R,mt,ve),vt=new ke(ce,e.alertsReader,S),ft=R.getTreatment(Ie.p.SingleCardAssistantUpHookFormats),wt=b.isSome(e.sduiManager)?new Q(e.sduiManager.value,he,ce):null,bt=[(0,Pe.A7)(pt,ce,N),(0,n.zG)(tt.EQ.focusMarkByActiveAlert(ce,dt,e.alertsReader,$.getActiveFocusableItem,V.getLogger("MarksEffects.focusMarkByActiveAlert")),P.nL.Effect.Producer.delayed(a)),(0,ae.yS)(dt.events,ne,V.getLogger("createOnAlertApplySideEffect")),...he.getApplicatorEffects(),(0,n.zG)((0,Fe.k9)(ce,ut,_e.h.create(b.none),$.getActiveAlignableItem,ne),P.nL.Effect.Producer.delayed(a)),qe.dv.createSendActiveAlertFeedbacksEffect(ce,$.getActiveItemWithAlert,e.alertsService,e.alertsReader,V.getLogger("CardsViewModelEffects.createSendActiveAlertFeedbacksEffect")),We.N.PrevNextNavigation.sideEffect(We.N.PrevNextNavigation.Events.fromCardActions(he.actionEvents),ce,ne),F.P.SideEffects.createSDUIFeedSideEffect((0,n.zG)(e.sduiManager,b.map((e=>e.state))),ne),ue.B.getSideEffect(ue.B.getPremiumAlerts(e.alertsList.state,ce),ce,ht.upgradeHookDismissed,ne,Xe.IG.Default,ue.B.ItemFactory.create(Xe.IG.Default),_(ft)),gt.getJumpToToneSuggestionSideEffect(),...null!==wt?[M.SideEffects.AddBulkDismissBufferCard.create(wt),M.SideEffects.RemoveBulkDismissBufferCard.create(wt),M.SideEffects.RemoveBulkDismiss.create(wt,(e=>he.actionEvents.next(e))),M.SideEffects.FocusBulkDismiss.create(wt,ce,ne)]:[]],St=_e.h.create(x.R.SpecialId.AllAlerts),yt=_e.h.create(s),_t=e=>(0,n.zG)(yt.get(),b.chain((t=>(yt.set(b.none),P.nL.hasCards(e)?(0,n.zG)(e.currentLens.items.reduce(((e,i)=>(0,n.zG)(e,b.alt((()=>(0,n.zG)(i,b.fromPredicate($.isAlertRefSDUI),b.chain((e=>b.fromNullable(e.alerts.find((e=>e.id.startsWith(t+"_"))))))))))),b.none),b.map((t=>({alert:t,highlightIndex:0,lensId:e.currentLens.id})))):b.none)))),kt=(0,n.zG)([(0,n.zG)((0,f.W9)((()=>b.isSome(yt.get())),Ze.Py.whenNoActiveCard),Ze.Py.behaviorToEffect((e=>(0,n.zG)(e,_t,b.map(P.nL.Effect.FocusBehavior.focusAlert))))),(0,n.zG)((0,f.Kg)(Ze.Py.whenNoActiveCard,Ze.Py.whenShouldVerifyCurrentLens($.getActiveItemWithAlert,ne)),Ze.Py.behaviorToEffect((()=>b.some(P.nL.Effect.FocusBehavior.focusNext))))],(0,m.fold)((0,m.getFunctionMonoid)(b.getFirstMonoid())())),At=(0,Ze.VC)(le,de,St,ne,pe.v.WithSuccess.State.isInGlobalSuccess(ne),n.jv),Ct=(0,Ze.Dv)((e=>x.R.isMainLens(e.currentLens.id)),At,ne),Et=Ze.Py.getStateTransformer(kt,Ct,e.alertsReader,ne,Ze.Py.getShouldAutoFocusSDUI(),n.Q1,St,Ze.Py.getSDUITransitions),It=pe.v.Items.getSingleItemFeedPositionsUpdateTransformer(ne),Mt=pe.v.Items.getRemoveDisposedItemsTransformer(ne),Tt=je.i.DisablePrevNextButtons.create(ne),xt=(0,n.ls)(Et,j.L9(Mt),j.L9(Tt),j.L9(It)),Rt=new Ye.l(ce,le,e.alertsReader,e.alertsService,bt,$.getActiveItemWithAlert,xt),Lt=new ie.X(r,o,c),Ft=he.actionEvents.subscribe((0,n.ls)((0,g.JH)(e.alertsReader,g.SV.Source.assistant),G.bw((async e=>(e.kind===g.SV.Kind.alertApply&&e.source===g.SV.Source.assistant&&await L.incrementCounter(),k.next(e)))))),Pt=(0,te.W)(w),Vt=E.pipe(rt.w(b.fold((()=>nt.E),(t=>t.initSingleCardAssistantActionsProcessing(e.alertsReader,(0,T.X5)(pt,ce)))))).subscribe();return{lensState:ce,cardsViewModel:he,lensPreviewViewModel:z,cardsListScrollManager:Se,alertProcessor:S,checkingService:y,assistantLayoutViewModel:ve,assistantFeedbackViewModel:fe,assistantSettingsViewModel:Lt,marksViewModel:dt,upgradeViewModel:mt,upgradeHookItemViewModel:ht,gnar:l,user:d,positionViewModel:Pt,capabilities:ne,remSize:re,isSingleCardAssistant:!0,isSduiV2Enabled:!0,statisticsService:C,toneDetectorViewModel:gt,learnMoreViewModel:vt,closeAssistant:u,bulkDismissViewModel:wt,dispose:()=>{Ft.unsubscribe(),Ce.unsubscribe(),he.dispose(),ve.dispose(),Rt.dispose(),dt.dispose(),D.unsubscribe(),be.dispose(),Vt.unsubscribe(),vt.dispose(),null==wt||wt.dispose()}}})(c.engine,c.denaliViewAdapter,l.sidebarEvents,this._assistantPopupIsReady,(0,o.pipe)(b.fromNullable(e),b.map(Ue.wQ.Id.create)),this._params.contentScriptState,this._params.contentScriptActions,this._params.gnar,this._params.domain,s,this.close,this._params.assistantService.selectedHighlightsTracker,this._params.assistantService.isTextFieldEmpty,this._params.assistantService.positionModel,this._params.alertProcessor,this._params.checkingService,this._params.cardEvents,this._params.browser,this._params.statisticsService,this._params.toneAIFeature,this._params.envFactory,this._params.experimentClient,this._params.userEngagedByAlertsAcceptedService):((e,t,i,a,s,r,o,l,c,d,u,p,v,w,S,y,k,A,C,E,I,M,R)=>{const L=lt.C8.Logging.getLogger("single_card_assistant_view_modes"),F=_e.h.create(De.A.defaultState),V=_e.h.create(!1),B=(0,xe.z)(r.view("user").get(),M),O=ze.t.create(ze.t.defaultLensFilters,{...ze.t.defaultTextFilters,[x.R.SpecialId.Closed]:n.jv,[x.R.SpecialId.AllAlerts]:se.bZ.belongsToAllAlerts}),N=De.A.get(e.alertsList.state,e.alertsList.lensesScores,O).subscribe(ye.wW(F)),H=new Ve.t(F.view("lenses"),O,e.sessionModel.scoreStatus),D=(0,Ke.$y)((0,He.a)(t).getContents),z={features:new Set([Xe.IG.Features.showCardLabelInOutcomes]),cardLayoutDensityMode:$e.j.Density.minimal,shouldAnimateAlertApply:Xe.IG.Default.shouldAnimateAlertApply,cardVisualMode:_e.h.create($e.j.CardVisualMode.RegularLightMode)},q=(0,Xe.Ls)(D,e.alertsReader,z,(()=>it.of(b.none)),e.mutingAlertsReader),K=_e.h.create(16),X=ct.getCapabilities(q,e.alertsReader),Q=new Je.oq(e.alertsList.state,e.alertsReader,F.view("lenses"),e.positionManager,H,new et.gi(ct.equatable.structEq,ct.defaultOrd),(0,et.is)(q,X),X,O),$=_e.h.create(Q.emptyState(x.R.SpecialId.AllAlerts).patch({alertSource:se.l$.sidebar}));i.next({kind:Re.R.ChangeLens,selectedLens:"all"});const re=(0,Ze.u0)((()=>t.getCursor().index),Q),ne=new Le.C(I()),oe=new qe.Xx({flush:()=>t.flushChanges()},new Z.xQ,q,e.alertsService,e.sduiService,(()=>Promise.resolve()),(()=>Promise.resolve()),(0,n.zG)(e.mutedAlertsCategoriesModel,b.map((e=>({model:e,openSuggestionsManagement:()=>self.open((0,Oe.Um)().suggestionsSettings)})))),b.some(ee.B.getCardsViewModelSendToURLExperiment(ne,l)),(()=>!1),ct.getActiveItemWithAlert,X,$,ne,{bufferTransitions:!0,showGbPrompt:ee.B.shouldShow(d.get())}),le=B?()=>{V.get()&&V.set(!1)}:void 0,ce=new we(l,p,v,A,oe.actionEvents,u,le),de=new J._(ce,c,l),me=new Y.y(oe.actionEvents,l,e.alertsReader),he=new Qe.o((()=>ot.F2(void 0))),ge=V.pipe(W.h(ye.PU)),ve=r.view("user").pipe(U.U((e=>e.premium))).subscribe((e=>{e&&V.set(!1)})),fe=(0,Be.xl)($,O,ge,V),be=new Be.o$(e.alertsList,e.alertsReader,e.positionManager,e.alertsService,t,$,fe,ct.getActiveItemWithAlert,a,!0,V),Se=(0,Fe.hp)($,be,K,he,t,L),ke=new Ge.mN(t,$,be,e.alertsReader,ct.getActiveItemWithAlert,(t=>{const i=t.reduce(((t,i)=>(0,n.zG)(e.alertsReader.getById(i.alert.id),b.chain(se.bZ.getRawId),G.bw((e=>t.set(e,i))),b.fold((()=>t),(()=>t)))),new Map),a=Array.from(i.keys()).map(S.alerts.getAlertById).filter(Ne.fQ);if(a.length){const e=a.reduce(((e,t)=>h.S.ordering.greaterThanOrEqual(t,e)?t:e));return b.fromNullable(i.get(Ue.wQ.Id.create(e.id)))}return b.none})),Ae=new Ee.x(e.alertsList,$,3),Ce=new ue.B.ViewModel.UpgradeHookItemViewModelImpl(oe,Ae,st.C,Ee.L.Place.assistantCardList,{onShowUpgradeHook:()=>{B&&V.set(!0),l.assistantExpandedUpgradeHookShow((0,n.zG)(Ae.advancedAlerts.get(),b.fold((()=>0),(e=>e.count))),100)},onOpenUpgradeUrl:()=>l.getPremiumButtonClick("assistantList","SeeWhatsInPremium"),onDismissUpgradeHook:()=>{V.set(!1)}}),Me=new Te(e.alertsReader,e.alertsList.state,(()=>b.fromNullable(null==y?void 0:y.sessionUuid)),l,M,Ae,ce),at=new gt($,e.alertsReader,S),dt=M.getTreatment(Ie.p.SingleCardAssistantUpHookFormats),ut=[(0,Pe.A7)(ke,$,B),(0,n.zG)(tt.EQ.focusMarkByActiveAlert($,be,e.alertsReader,ct.getActiveFocusableItem,L.getLogger("MarksEffects.focusMarkByActiveAlert")),P.nL.Effect.Producer.delayed(a)),(0,ae.yS)(be.events,X,L.getLogger("createOnAlertApplySideEffect")),...oe.getApplicatorEffects(),(0,n.zG)((0,Fe.k9)($,Se,_e.h.create(b.none),ct.getActiveAlignableItem,X),P.nL.Effect.Producer.delayed(a)),qe.dv.createSendActiveAlertFeedbacksEffect($,ct.getActiveItemWithAlert,e.alertsService,e.alertsReader,L.getLogger("CardsViewModelEffects.createSendActiveAlertFeedbacksEffect")),We.N.PrevNextNavigation.sideEffect(We.N.PrevNextNavigation.Events.fromCardActions(oe.actionEvents),$,X),ue.B.getSideEffect(ue.B.getPremiumAlerts(e.alertsList.state,$),$,Ce.upgradeHookDismissed,X,Xe.IG.Default,ue.B.ItemFactory.create(Xe.IG.Default),_(dt)),Me.getJumpToToneSuggestionSideEffect()],pt=_e.h.create(x.R.SpecialId.AllAlerts),mt=_e.h.create(s),ht=e=>{const t=(0,b.fromPredicate)((0,f.Kg)(ct.isAlertCard));return(0,n.zG)(mt.get(),b.chain((i=>(mt.set(b.none),P.nL.hasCards(e)?(0,n.zG)(e.currentLens.items.reduce(((e,a)=>(0,n.zG)(e,b.alt((()=>(0,n.zG)(a,t,b.chain((e=>b.fromNullable(e.alerts.find((e=>e.id.startsWith(i+"_"))))))))))),b.none),b.map((t=>({alert:t,highlightIndex:0,lensId:e.currentLens.id})))):b.none))))},vt=(0,n.zG)([(0,n.zG)((0,f.W9)((()=>b.isSome(mt.get())),Ze.Py.whenNoActiveCard),Ze.Py.behaviorToEffect((e=>(0,n.zG)(e,ht,b.map(P.nL.Effect.FocusBehavior.focusAlert))))),(0,n.zG)((0,f.Kg)(Ze.Py.whenNoActiveCard,Ze.Py.whenShouldVerifyCurrentLens(ct.getActiveItemWithAlert,X)),Ze.Py.behaviorToEffect((()=>b.some(P.nL.Effect.FocusBehavior.focusNext))))],(0,m.fold)((0,m.getFunctionMonoid)(b.getFirstMonoid())())),ft=(0,Ze.VC)(Q,re,pt,X,pe.v.WithSuccess.State.isInGlobalSuccess(X),n.jv),wt=(0,Ze.Dv)((e=>x.R.isMainLens(e.currentLens.id)),ft,X),bt=Ze.Py.getStateTransformer(vt,wt,e.alertsReader,X,n.W8,n.Q1,pt,Ze.Py.getSDUITransitions),St=pe.v.Items.getSingleItemFeedPositionsUpdateTransformer(X),yt=pe.v.Items.getRemoveDisposedItemsTransformer(X),_t=je.i.DisablePrevNextButtons.create(X),kt=(0,n.ls)(bt,j.L9(yt),j.L9(_t),j.L9(St)),At=new Ye.l($,Q,e.alertsReader,e.alertsService,ut,ct.getActiveItemWithAlert,kt),Ct=new ie.X(r,o,c),Et=oe.actionEvents.subscribe((0,n.ls)((0,g.JH)(e.alertsReader,g.SV.Source.assistant),G.bw((async e=>(e.kind===g.SV.Kind.alertApply&&e.source===g.SV.Source.assistant&&await R.incrementCounter(),k.next(e)))))),It=(0,te.W)(w),Mt=E.pipe(rt.w(b.fold((()=>nt.E),(t=>t.initSingleCardAssistantActionsProcessing(e.alertsReader,(0,T.X5)(ke,$)))))).subscribe();return{lensState:$,cardsViewModel:oe,lensPreviewViewModel:H,cardsListScrollManager:he,alertProcessor:S,checkingService:y,assistantLayoutViewModel:ce,assistantFeedbackViewModel:de,assistantSettingsViewModel:Ct,marksViewModel:be,upgradeViewModel:Ae,upgradeHookItemViewModel:Ce,gnar:l,user:d,positionViewModel:It,capabilities:X,remSize:K,isSingleCardAssistant:!0,isSduiV2Enabled:!1,statisticsService:C,toneDetectorViewModel:Me,learnMoreViewModel:at,closeAssistant:u,dispose:()=>{Et.unsubscribe(),ve.unsubscribe(),oe.dispose(),ce.dispose(),At.dispose(),be.dispose(),N.unsubscribe(),me.dispose(),Mt.unsubscribe(),at.dispose()}}})(c.engine,c.denaliViewAdapter,l.sidebarEvents,this._assistantPopupIsReady,(0,o.pipe)(b.fromNullable(e),b.map(Ue.wQ.Id.create)),this._params.contentScriptState,this._params.contentScriptActions,this._params.gnar,this._params.domain,s,this.close,this._params.assistantService.selectedHighlightsTracker,this._params.assistantService.isTextFieldEmpty,this._params.assistantService.positionModel,this._params.alertProcessor,this._params.checkingService,this._params.cardEvents,this._params.browser,this._params.statisticsService,this._params.toneAIFeature,this._params.envFactory,this._params.experimentClient,this._params.userEngagedByAlertsAcceptedService):(0,T.n)(c.engine,c.denaliViewAdapter,c.document.settings.lens("selectedLens"),this._params.emogenieService,b.fromNullable(this._params.readersAttentionFeature),this._params.shortenItFeature,b.fromNullable(this._params.sentenceLevelBrandTonesFeature),this._params.toneAIFeature,this._params.ethicalAIFeature,this._params.snippetsFeature,b.fromNullable(this._params.proofitFeature),l.sidebarEvents,this._assistantPopupIsReady,(0,o.pipe)(b.fromNullable(e),b.map(Ue.wQ.Id.create)),this._params.contentScriptState,this._params.contentScriptActions,this._params.gnar,this._params.statisticsService,this._params.domain,s,this.close,this._params.assistantService.selectedHighlightsTracker,this._params.assistantService.isTextFieldEmpty,this._params.assistantService.positionModel,this._params.alertProcessor,this._params.cardEvents,this._params.browser,this._params.layout.assistant,this._params.envFactory,this._params.experimentClient,this._params.userEngagedByAlertsAcceptedService);nr(!1,d,t),this._initPerformance=r.endMeasure(),this._viewModels.set(d)}},this.close=()=>{var e,t,i,a;null!==this._viewModels.get()&&(this._trackAssistantClose(),null===(t=(e=this._params).onClose)||void 0===t||t.call(e),this._openState.set("closed"),null===(i=this._integration)||void 0===i||i.dispose(),this._integration=null,null===(a=this._viewModels.get())||void 0===a||a.dispose(),this._viewModels.set(null))},this._asyncReadyCbSub=null,this._getReadyFn=()=>{const e=this._felog.renderTime.startMeasure();return(t,i,a)=>{const s=e.endMeasure();let r;if((0,mt.kG)(!!this._openMeasure,"Expected Assistant to be open"),a)this._openMeasure.cancelMeasure();else{const e=this._openMeasure.endMeasure();r=null==e?void 0:e.duration,e&&e.duration>500&&this._log.warn("assistant popup took too long to open:",{init:this._initPerformance.duration,render:s.duration,total:e.duration})}this._asyncReadyCbSub=ir.E.schedule((()=>{this._openState.set("open"),this._assistantPopupIsReady.next(),this._trackAssistantOpen(t,r),this._trackAssistantDrag(t,i)}))}},this._applyIframeOffset=e=>{var t,i;const a=null===(i=(t=this._params).getCustomOffset)||void 0===i?void 0:i.call(t);return a?{...e,size:{width:a.width,height:a.height},client:{...e.client,left:a.left+e.client.left,top:a.top+e.client.top},offset:{...e.offset,left:a.left+e.offset.left,top:a.top+e.offset.top},page:{...e.page,left:a.left+e.page.left,top:a.top+e.page.top}}:e}}get view(){return this._viewModels.pipe(rt.w((e=>null===e?it.of(null):ar.R(self,"resize").pipe(Vt.O(null),H.M(this._params.layout.textField.rect.behavior),H.M(at.aj([this._params.layout.gbutton.positionBehavior,this._params.layout.gbutton.sizeBehavior]).pipe(U.U((([e,t])=>{const i=t.draggable?t.width:t.heightAndWidth,a=t.draggable?t.height:t.heightAndWidth;return{top:e.draggable?e.client.top:e.client.top-a,left:e.draggable?e.client.left:e.client.left-i,width:i,height:a}})))),U.U((([[t,i],a])=>{const s=this._applyIframeOffset(i),r=this._getReadyFn();return e.isSingleCardAssistant?l.createElement(Os,{gbuttonRect:a,viewModels:e,onDomRectChange:e=>this._domRect.set(e)},e.isSduiV2Enabled?l.createElement(Ys,{viewModels:e,emogenieService:this._params.emogenieService,height:this._height,ready:r,domRect:this._domRect.view()}):l.createElement(Js,{viewModels:e,emogenieService:this._params.emogenieService,height:this._height,ready:r,domRect:this._domRect.view()})):l.createElement(Bs,{textFieldRect:s,gButtonRect:a,viewModels:e,draggableGButtonType:this._params.draggableGButtonType},l.createElement(Ls,{viewModels:e,emogenieService:this._params.emogenieService,height:(0,u.Y)(e,s).pipe(sr.R(this._assistantPopupIsReady.asObservable()),Es.b(ye.wW(this._height))),ready:r,OuterElementsPortalSource:this._params.OuterElementsPortalSource}))}))))))}get activeView(){return this._viewModels.pipe(rt.w((e=>{var t;return null!==(t=null==e?void 0:e.assistantLayoutViewModel.activeView)&&void 0!==t?t:it.of(null)})))}dispose(){var e;this.close(),this._subs.dispose(),null===(e=this._asyncReadyCbSub)||void 0===e||e.unsubscribe()}_trackAssistantOpen(e,t){var i,a;const s=this._viewModels.get();if(null!==s){const r=s.isSingleCardAssistant?{top:0,left:0}:s.positionViewModel.initialPositionOffset,{statisticsService:n}=this._params,o=n.alertCounts.get(),l=0===r.top&&0===r.left?["default","single-card-assistant"].includes(s.assistantLayoutViewModel.layout.name)?"smart":"hardcoded":"sticky",c=s.assistantLayoutViewModel.activeView.get();this._params.gnar.assistantPopupShow(c.type,this._height.get(),e.get().left,e.get().top,o.expandedViewSupported,o.freeClarity,o.critical,o.filter((e=>"priority"===e.assistantView)).expandedViewSupported,n.wordsCount.get(),l,null!==(a=null===(i=this._params.checkingService)||void 0===i?void 0:i.sessionUuid)&&void 0!==a?a:"",c.type===fe.aH.Type.popup?c.popupType:void 0,t,n.generalScore.get())}}_trackAssistantClose(){var e;const{statisticsService:t}=this._params,i=t.alertCounts.get(),a=(null===(e=this._viewModels.get())||void 0===e?void 0:e.assistantLayoutViewModel.activeView.get())||{type:fe.aH.Type.default};this._params.gnar.assistantPopupCloseButtonClick(a.type,i.expandedViewSupported,i.freeClarity,i.critical,i.filter((e=>"priority"===e.assistantView)).expandedViewSupported,a.type===fe.aH.Type.popup?a.popupType:void 0)}_trackAssistantDrag(e,t){const i=e.get();let a=i;this._subs.push(t.pipe(si.G(),N.h((([e,t])=>e&&!t))).subscribe((()=>{const t=e.get();Ps.E9.l1Distance(t,a)<10||(this._params.gnar.assistantPopupDrag(t.left,t.top,this._height.get(),i.left,i.top),a=t)})))}}function nr(e,t,i){i.caller===d.Rx.emogenie?t.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.emogenie}):t.isSingleCardAssistant?t.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.default}):t.isSingleCardAssistant||(i.caller===d.Rx.proofitRequest?t.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.proofitRequest}):i.caller===d.Rx.proofitReview?t.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.proofitReview}):e||i.caller!==d.Rx.popupOpener?t.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.default}):t.assistantLayoutViewModel.pushActiveView({type:fe.aH.Type.popup,popupType:i.popupType}))}!function(e){e.Mock=class extends rr{constructor(e,t){super(e,t),this.debugView=this._viewModels.pipe(rt.w((e=>{if(null!==e){this._getReadyFn()(_e.h.create(Ps.E9.create({top:0,left:0})),it.of(!1))}return it.of(null)}))),this.viewModels=this._viewModels.view()}}}(er||(er={}));var or=i(18126),lr=i(16037),cr=i(64213),dr=i(14568),ur=i(99015);class pr{constructor(e,t,i,a,s,r,n,o,l,c){this.connectionState=e,this.gnar=t,this.user=i,this._hoverProvider=a,this.document=s,this.formattingService=r,this.denaliViewAdapter=n,this.capiProxy=o,this.engine=l,this.experimentClient=c,a.setAssistantHover(n.highlightHoverProvider)}static create(e){var t;const i=new lr.t(e.highlights,e.textObserver,e.replacementService.get(),e.layout,e.scroller,e.selectedHighlightsTracker,void 0,e.requestAwaitService,null===(t=e.formattingService)||void 0===t?void 0:t.get()),a=dr.p.create(e.checkingService.get(),e.checkingServiceInitialState,e.alertsTransformer,e.alertProcessor,e.sidebarEvents),s=(0,ur.r)(a,i,e.document.settings.lens("context"),(()=>{var t,i;return null!==(i=null===(t=e.getExistingAlerts)||void 0===t?void 0:t.call(e))&&void 0!==i?i:(0,cr.q)(e.alertProcessor)}),e.textObserver,(()=>e.checkingServiceInitialState.value.lastStart),e.readersAttentionFeature,e.shortenItFeature,e.sentenceLevelBrandTonesFeature,e.snippetsFeature,e.getSduiEnabled,e.sduiManagerFactory,e.sduiV2Enabled);return new pr(e.connectionState,e.gnar,e.user,e.hoverProvider,e.document,e.formattingService,i,a,s,e.experimentClient)}dispose(){this.capiProxy.dispose(),this.denaliViewAdapter.dispose(),this.engine.shutdown(),this._hoverProvider.removeAssistantHover()}}var mr=i(8467);class hr{constructor({layout:e}){this._scroller=(0,mr.t)({scrollToMarkRect(t,i){const a=e.textField.visibleRect.getApproximate();let s=(i&&i.paddingTop||0)-a.client.top;(s<=0||s>=a.size.height)&&(s=a.size.height/2);const r=t.top-s-a.client.top,n=t.right-t.left,o=Math.max(0,(a.size.width-n)/2);t.left,a.client.left;requestAnimationFrame((()=>e.textField.scroller.scrollBy({top:r,left:void 0})))},scrollToRange(){}})}scrollToMark(e,t){return this._scroller.scrollToMark(e,t)}}var gr=i(50004);class vr{constructor(e){this._params=e,this.sidebarEvents=new Z.xQ,this.hoverProvider=new or.f(this._params.hoverProvider),this.selectedHighlightsTracker=this._params.highlights.getSelectedHighlightsTracker({textField:this._params.originalTextField,selectionService:this._params.selectionService}),this.positionModel=((e,t,i,a)=>{const s=t.view("page","domain").get(),r=(0,gr.U)(e,s),n=i.view((({widgetOffset:e})=>null!=e?e:Ps.E9.zero));return{initialPositionOffset:n,updateInitialPositionOffset:e=>{Ps.E9.equals(e,n.get())||a.field.patchFieldSettings({fieldId:r,fieldSettings:{widgetOffset:e}})}}})(this._params.originalTextField,this._params.state,this._params.fieldSettings,this._params.actions),this.isTextFieldEmpty=this._params.textObserver.contentChanges.async.pipe(U.U((e=>""===e.newText.trim())),O.x()),this._checkingService=null}setCheckingService(e){this._checkingService=e}getCheckingServiceState(){var e;return null===(e=this._checkingService)||void 0===e?void 0:e.state.value}createIntegration(e){const{layout:t,highlights:i,textObserver:a,replacementService:s,alertProcessor:r,state:n,alertsTransformer:o,document:l,requestAwaitService:c,formattingService:d,getCheckingServicePreviousState:u,createAssistantScroller:p=(()=>new hr({layout:t})),getExistingAlerts:m,sduiManagerFactory:h}=this._params;if(null==this._checkingService)return null;const g=null==u?void 0:u();g&&(this._checkingService.state.value=g);const v=p(),{user:f}=n.get();return pr.create({layout:t,alertProcessor:r,connectionState:n.view((e=>e.connection)),highlights:i,textObserver:a,replacementService:s,checkingService:this._checkingService.lazyCheckingService,checkingServiceInitialState:this._checkingService.state,gnar:e.gnar,user:{isPremium:f.premium,isAnonymous:f.anonymous,experiments:f.experiments,customFields:f.customFields},hoverProvider:this.hoverProvider,selectedHighlightsTracker:this.selectedHighlightsTracker,scroller:v,sidebarEvents:this.sidebarEvents,document:l,alertsTransformer:o,requestAwaitService:c,formattingService:d,getExistingAlerts:m,readersAttentionFeature:e.readersAttentionFeature,shortenItFeature:e.shortenItFeature,sentenceLevelBrandTonesFeature:e.sentenceLevelBrandTonesFeature,snippetsFeature:e.snippetsFeature,getSduiEnabled:e.getSduiEnabled,experimentClient:e.experimentClient,sduiManagerFactory:h,sduiV2Enabled:e.sduiV2Enabled})}dispose(){var e;null===(e=this._checkingService)||void 0===e||e.state.dispose()}}},99015:(e,t,i)=>{i.d(t,{r:()=>R});var a=i(57050),s=i(35214),r=i(40327),n=i(73353),o=i(21729),l=i(83078),c=i(51072),d=i(5114),u=i(38983);var p=i(80358),m=i(84966),h=i(34101),g=i(6488),v=i(79227),f=i(16724),w=i(95362),b=i(5008),S=i(43320),y=i(35301),_=i(85654),k=i(72720),A=i(55360),C=i(9922),E=i(98403),I=i(2834),M=i(78674),T=i(77176),x=i(71249);const R=(e,t,i,R,L,F,P,V,B,O,N,H,U)=>{const D=new C.w.Keeper,W=function(e,t,i){const s=u.h.create(d.none),p=u.h.create(d.none);return{score:u.h.create(d.none),scoreStatus:u.h.create(d.none),title:u.h.create(void 0),textInfo:u.h.create(d.none),checkingState:u.h.create(e.checkingState),asyncChecksState:u.h.create(e.asyncChecksState),context:i,contextCompleteness:i.view(o.j.calculateCompleteness),updateContext:e=>{const t=!n.R$.eq.equals(i.get(),e);return i.set(e),t},defaultContext:s,updateDefaultContext:e=>{const t=!(0,r.pipe)((0,a.bc)([s.get(),e],l.vB(n.R$.eq.equals)));return s.set(e),t},documentText:t.getText(),documentLength:u.h.create({full:t.getTextLength(),trimmed:t.getTextLength()}),counters:u.h.create(o.dM.group.empty),calculateStats:()=>c.Vi(e.requestDocStats).then((e=>(p.set(d.some(e)),e))),recentDocumentStats:p}}(e,t,i),j=(0,r.pipe)(N(),d.filter(a.yR),d.map((()=>new k.Q(e))));D.push(e.events.pipe(I.b((t=>{W.checkingState.set(e.checkingState),p.h.is("text_info")(t)?W.textInfo.set(d.some(t.data)):p.h.is("finish")(t)?(W.score.set(t.score),W.scoreStatus.set(t.scoreStatus)):p.h.is("feedback_ack")(t)?((0,r.pipe)(t,d.fromPredicate(p.h.isUserFeedbackWithGeneralScore),d.map((e=>e.outcomeScores.GeneralScore)),d.map((e=>Math.trunc(100*e))),l.bw((e=>W.score.modify((0,a.ls)(d.map((t=>({...t,rank:e}))),l.vx(d.some({errorRateScore:0,rank:e}))))))),(0,r.pipe)(t,d.fromPredicate(p.h.isUserFeedbackWithScoreStatus),d.map((e=>e.scoreStatus)),l.bw((e=>W.scoreStatus.set(d.some(e)))))):p.h.is("session_started")(t)&&W.updateDefaultContext(t.defaultDocumentContext)}))).subscribe(),L.contentChanges.async.pipe(M.b(300),T.U((e=>e.newText)),T.U((e=>({full:e.length-1,trimmed:e.trim().length}))),I.b(E.wW(W.documentLength))).subscribe()),(0,r.pipe)(F(),d.map((e=>{W.updateDefaultContext(n.R$.parseDefault(e.defaultDocumentContext))})));const G=new A.Xr,z=new w.Ek,q=(0,s.fold)((0,s.getEndomorphismMonoid)())(x.oA([d.fromNullable(null==P?void 0:P.takeawaysFeedbackStore.addFeedbackToRawAlertTransformer),d.fromNullable(null==B?void 0:B.addFeedbackToRawAlertTransformer),d.some((e=>(0,r.pipe)(V.get(),d.fold((()=>e),(t=>t.addStateToRawAlertTransformer(e)))))),d.some((e=>(0,r.pipe)(O.get(),d.fold((()=>e),(t=>t.addSnippetsTriggerToAlert(e))))))])),K=new h.a,Z=new f.SC(G,z,(()=>t.getContents().delta),e.events,e,W.counters,q,void 0,(0,r.pipe)(N(),d.fold((()=>!1),(e=>e&&!U))),K),X=g.e.create(Z.state),Q=new v.k(X,Z._ops);D.push(S.R.init(S.R.UserTextChangesSync.create(t),e.events,b.n.ignoreTEResult(e),b.n.ignoreResult(G),z,b.A.merge([Z])).subscribe()),e.loadAlerts(R()),Z.flushAlerts();const $=(0,r.pipe)(H,d.map((e=>e.createSDUIManager(Z.state,K.getByRawAlertId.bind(K))))),Y=d.some(y.J.CategoriesModel.create(e.events,e,Z.state,Q,m.JW.ScopeType.GLOBAL)),J=d.some(_.k.create(X));return{alertsList:Z,alertsReader:X,alertsService:Q,positionManager:G,sessionModel:W,mutedAlertsCategoriesModel:Y,mutingAlertsReader:J,sduiService:j,shutdown:()=>{Z.dispose(),D.dispose()},sduiManager:$}}},32154:(e,t,i)=>{i.d(t,{aU:()=>rt,X5:()=>nt,n:()=>ot});var a,s=i(57050),r=i(35214),n=i(5114),o=i(40327),l=i(32281),c=i(50622),d=i(25913),u=i(9671),p=i(38152),m=i(51972),h=i(5178),g=i(19654),v=i(2844),f=i(75003),w=i(40033),b=i(81301),S=i(66896),y=i(87667),_=i(9922),k=i(77176),A=i(28043),C=i(85985),E=i(24713),I=i(16118),M=i(22232),T=i(83078),x=i(38983),R=i(31881);!function(e){e.equals=(e,t)=>"score"in e&&"score"in t?e.score===t.score:e.type===t.type}(a||(a={}));class L{constructor(e,t,i,r,l,c,d,u,p,m){this._sessionModel=e,this._layoutVM=t,this._predictionsVM=i,this._modalManager=r,this._lensPreviewVM=l,this._currentLensId=c,this._lensChanged=d,this._user=u,this._gnar=p,this._closeAssistant=m,this.showSetGoalsActionButton=x.h.create(!0),this.showSettingsActionButton=x.h.create(!0),this.close=()=>{this._closeAssistant()},this.score=v.aj([this._sessionModel.score.view(n.map((e=>({capiScore:e.rank})))),this._sessionModel.checkingState]).pipe(k.U((([e,t])=>(0,o.pipe)(e,n.map((e=>({...e,isLoading:"idle"!==t}))))))),this.summary=this._sessionModel.textInfo.view((0,s.ls)(n.chain((e=>e.messages)),n.map((e=>e.assistantHeader)),n.getOrElse((()=>"Looking good so far")),(e=>({content:e})))),this.logoScore=(0,v.aj)([this._layoutVM.activeView,this.score]).pipe(k.U((([e,t])=>(0,o.pipe)(t,n.fold((()=>({type:"logo"})),(t=>e.type!==f.aH.Type.default?{type:"logo"}:{type:"score",score:t}))))),A.x(a.equals)),this.visibility=this._layoutVM.activeView.view((e=>e.type===f.aH.Type.default?"visible":"hidden")),this.lensSwitchFlow=R.Z.fromSideEffect((e=>{switch(e.action.action){case y.n.Actions.switchToAll:this._lensChanged.next({lensId:S.R.SpecialId.AllAlerts,focusFirstCard:!0}),this._gnar.assistantPriorityDropdownClick("all");break;case y.n.Actions.switchToPriority:this._lensChanged.next({lensId:S.R.SpecialId.Priority,focusFirstCard:!0}),this._gnar.assistantPriorityDropdownClick("priority");break;case y.n.Actions.openSetGoals:break;default:(0,M.vE)(e.action.action)}}),v.aj([this._currentLensId.pipe(C.h((e=>e!==S.R.SpecialId.Premium)),k.U((e=>e===S.R.SpecialId.Priority?"priority":"all")),A.x()),this._lensPreviewVM.getLens(S.R.SpecialId.AllAlerts).pipe(E.j("count"),A.x()),this._lensPreviewVM.getLens(S.R.SpecialId.Priority).pipe(E.j("count"),A.x()),this._predictionsVM.previewState]).pipe(k.U((([e,t,i,a])=>(0,o.pipe)({allAlertsCount:t,priorityAlertsCount:i,selectedLens:e},n.fromPredicate((()=>a.kind!==w.fA.hidden))))))),this._subs=new _.w.Keeper,this._trackHeaderMessageChanges(),this._trackToShowActionButtons()}open(e){switch(e){case"setGoals":this._subs.push(this._modalManager.show(b.Iy.setGoals("user")).subscribe());break;default:(0,M.vE)(e)}}_trackHeaderMessageChanges(){const e=this.summary.pipe(I.G()).subscribe((([e,t])=>{var i,a;this._gnar.assistantHeaderMessageUpdate(e.content,t.content,null===(i=(0,o.pipe)(this._sessionModel.textInfo.get(),n.toUndefined))||void 0===i?void 0:i.wordsCount,null===(a=(0,o.pipe)(this._sessionModel.score.get(),T.Fc))||void 0===a?void 0:a.rank)}));this._subs.push(e)}_trackToShowActionButtons(){const e=(0,v.aj)([this._layoutVM.activeView,this._user]).subscribe((([e,t])=>{t.isAnonymous||e.type===f.aH.Type.popup?(this.showSetGoalsActionButton.set(!1),this.showSettingsActionButton.set(!1)):(this.showSetGoalsActionButton.set(!0),this.showSettingsActionButton.set(!0))}));this._subs.push(e)}dispose(){this._subs.dispose()}}var F=i(59456),P=i(98403);class V{constructor(e,t,i,a,s,r,l){this._lensPreviewVM=e,this._layoutVM=t,this._readersAttentionVM=i,this._emogenieService=a,this._session=s,this._readersAttentionPredictionCardState=r,this._gnar=l,this._subs=new _.w.Keeper,this.previewState=x.h.create({kind:w.fA.hidden}),this.previewFlow=R.Z.fromSideEffect((e=>{switch(e.action.key){case"tone":const t=this._emogenieService.viewState.view("prevalentEmotion").get();return t&&this._gnar.emogeniePredictionButtonClick(t.name),this._layoutVM.pushActiveView({type:f.aH.Type.emogenie});case"readersAttention":return this._readersAttentionVM.openPanel({type:f.aH.ReadersAttention.Caller.Type.predictionWidget});default:(0,M.vE)(e.action)}}),this.previewState),this._previewState=(0,o.pipe)(v.aj([this._emogenieService.viewState.view((e=>n.fromNullable(e.settings.hiddenReport?void 0:e.prevalentEmotion))),this._emogenieService.viewState.view("brandToneOffImageUrl"),this._readersAttentionPredictionCardState,this._session.documentLength,this._lensPreviewVM.getLens(S.R.SpecialId.PredictionEmogenie),this._lensPreviewVM.getLens(S.R.SpecialId.PredictionTakeaways)]),k.U((([e,t,i,a,s,r])=>(n.isSome(e)||n.isSome(i))&&a.trimmed>0?{kind:w.fA.visible,tone:(0,o.pipe)(e,n.map((e=>({emotion:e,alertsCount:s.count,brandToneOffImageUrl:t})))),readersAttention:(0,o.pipe)(i,n.map((e=>({...e,alertsCount:(0,o.pipe)(i,n.map((e=>e.alertsCount)),n.getOrElse((()=>r.count)))}))))}:a.trimmed>0?{kind:w.fA.zero}:{kind:w.fA.hidden}))),this._subs.push(this._previewState.subscribe(P.wW(this.previewState)))}dispose(){this._subs.dispose()}}var B=i(77843),O=i(41398),N=i(2768),H=i(10247);class U{constructor(e,t,i,a){this.feature=t,this._closeAssistant=i,this._gnar=a,this._subs=[],this._subs.push(this.feature.requestInfo.view("status").pipe((0,A.x)(),(0,I.G)(),(0,O.M)(e.activeView)).subscribe((([[t,i],a])=>{t===H.eE.REVIEWING&&a.type===f.aH.Type.proofitReview&&e.popActiveView()}))),this._subs.push(this.feature.layoutCreated.pipe((0,O.M)(e.activeView)).subscribe((([t,i])=>{i.type!==f.aH.Type.proofitRequest&&i.type!==f.aH.Type.proofitReview||t||e.popActiveView()})))}onSubmitRequest(e){this.feature.submitRequest(),this._gnar.proofitRequestFormSubmit();const t=this.feature.requestInfo.lens("status").pipe((0,C.h)((e=>e===H.eE.ACCEPTED)));(0,B.F)(100).pipe((0,N.R)(t)).subscribe({complete:()=>this._closeAssistant(e)})}onCompleteRequest(e){this.feature.resetRequest(),this._gnar.proofitOrderDone(),this._closeAssistant(e)}onSubmitFeedback(e){this._gnar.proofitFeedbackFormSubmit(e.text,e.score)}dispose(){this._subs.forEach((e=>e.unsubscribe()))}}var D=i(17771),W=i(90361),j=i(40018),G=i(14601),z=i(15646),q=i(35416);class K{constructor(e,t,i,a,r){this._feature=e,this._assistantLensState=t,this._assistantCardActions=i,this._getAlertById=a,this._getActiveAlert=r,this._subs=new G.w,(0,o.pipe)(this._feature,T.bw((e=>{var t,i;this._subs.add((t=this._assistantCardActions,i=e=>this._getAlertById(e),t.pipe(C.h(z.lY.isTakeawayAction)).pipe(k.U((e=>(0,o.pipe)(i(e.alertId),n.chain((t=>D.Y(n.option)({id:n.some(t.id),rawId:j.bZ.getRawId(t),isLikelyToRead:(0,o.pipe)(t.extraProperties.takeaway,n.map((e=>e.isLikelyToBeRead))),score:(0,o.pipe)(t.extraProperties.takeaway,n.map((e=>e.score))),textRange:n.fromNullable(t.getHighlightRanges()[0]),action:n.some(e)}))),T.Fc))),C.h(W.fQ))).subscribe((t=>{e.tracking.onTakeawayUserAction(t.isLikelyToRead,t.score,t.action,t.textRange)}))),this._subs.add(function(e,t,i){return e.pipe(k.U(q.nL.getActiveAlert(i)),k.U(n.map((e=>e.id)))).pipe(k.U(T.Fc),C.h(W.fQ),A.x(),k.U((0,s.ls)(t,n.chain((e=>(0,o.pipe)(e.extraProperties.takeaway,n.map((({score:t})=>({score:t,textRange:e.getHighlightRanges()[0]})))))),T.Fc)),C.h(W.fQ))}(this._assistantLensState,(e=>this._getAlertById(e)),this._getActiveAlert).subscribe((t=>{e.tracking.onKeyTakeawayCardShow(t.score,t.textRange)})))})))}dispose(){this._subs.unsubscribe()}}var Z=i(41354),X=i(31536),Q=i(68654),$=i(10299),Y=i(5920),J=i(16892),ee=i(48521),te=i(25975),ie=i(55415),ae=i(95195),se=i(65060);const re=(e,t)=>i=>(0,s.zG)(t,n.fold((()=>n.some({lens:i,newItem:n.none})),(t=>(0,s.zG)(e,n.fold((()=>n.some({lens:i,newItem:n.some(se.g.create(t,J.s.PositionState.empty,ee.o.VisualState.initial({type:"rendered",clockwise:!0},!1)))})),(e=>(0,s.zG)(se.g.create(t,e.positionState,e.visualState),n.fromPredicate((t=>se.g.hashCodeOwnFields(t)!==se.g.hashCodeOwnFields(e))),n.map((e=>({lens:i,newItem:n.some(e)}))))))))));var ne=i(48439),oe=i(19751),le=i(32952),ce=i(8125),de=i(73975),ue=i(74850),pe=i(71249),me=i(16314);const he=ue.Y.create("ReadersAttentionItemSideEffects");function ge(e){return e.pipe(k.U((()=>s.yR)))}function ve(e,t){return e.pipe(C.h(me.Vl),k.U((e=>i=>i.patch({currentLens:(0,o.pipe)(i.currentLens.items.find((t=>t.id===e.id)),n.fold((()=>(he.error("Cannot focus non-existing ReadersAttentionItem."),i.currentLens)),(()=>(0,s.MZ)((0,o.pipe)(i.currentLens,t.selectItemById(e.id,[]))))))}))))}class fe{constructor(e,t,i,a,r,o,l,c,d){this._cardActions=e,this._readersAttentionItemInfo=t,this._assistantLensState=i,this._checksFeedCapabilities=a,this._heatmapVisible=r,this._layoutViewModel=o,this._onDismiss=l,this._gnar=c,this._statistics=d,this._subs=new G.w,this.actions=new le.xQ,this._relayBaseActions=this.actions.pipe(C.h((0,ce.Kg)(z.eI.isStartTransitionTo,z.eI.isCompleteTransitionTo))).subscribe((e=>this._cardActions.next(e))),this._goToReadersAttentionView=this.actions.pipe(C.h(me.Q)).subscribe((e=>{this._gnar.attentionScoreFullCardSeeSuggestionsButtonClick(),this._layoutViewModel.pushActiveView({type:f.aH.Type.readersAttention,caller:{type:f.aH.ReadersAttention.Caller.Type.readersAttentionItem,item:e.item}})})),this._goToFeedbackView=this.actions.pipe(C.h(me.RJ)).subscribe((()=>{this._layoutViewModel.pushActiveView({type:f.aH.Type.feedback})})),this._dismissItem=this.actions.pipe(C.h(me.l9)).subscribe((()=>{this._gnar.attentionScoreFullCardDismissButtonClick(),this._onDismiss()})),this._toggleHeatmapVisibility=this._assistantLensState.pipe(k.U((e=>(0,s.zG)(ae.DT(q.nL.hasItems,(()=>e.currentLens.id))(e),ae.UI(q.nL.Prism.getLens().get),ae.tS((e=>(0,s.zG)(e,q.In.getActiveItemOfType(se.m),ae.Yo((()=>e.id)),ae.UI((e=>e.id)))))))),oe.skipBy(ae.Eh(de.yv,de.yv))).subscribe(ae.g_((e=>{e!==S.R.SpecialId.PredictionTakeaways&&this._heatmapVisible.set(!1)}),(()=>this._heatmapVisible.set(!0)))),this._activeCardOpenStats=null,this._trackOpenClose=this._assistantLensState.pipe(k.U((e=>(0,s.zG)(n.fromPredicate(q.nL.hasItems)(e),n.map(q.nL.Prism.getLens().get),n.chain(q.In.getActiveItemOfType(se.m)),n.fold(s.jv,s.W8)))),A.x()).subscribe((e=>{(0,s.zG)(this._readersAttentionItemInfo.get(),n.map((e=>ne.T.prism.reverseGet(e.attentionScore))),T.bw((t=>{const i=this._statistics.wordsCount.get();e?(this._gnar.attentionScoreFullCardShow(i,t),this._activeCardOpenStats={numWords:i,attentionScore:t}):this._activeCardOpenStats&&(this._gnar.attentionScoreFullCardHide(i,t,this._activeCardOpenStats.numWords,this._activeCardOpenStats.attentionScore),this._activeCardOpenStats=null)})))})),this._subs.add(this._relayBaseActions),this._subs.add(this._toggleHeatmapVisibility),this._subs.add(this._goToReadersAttentionView),this._subs.add(this._goToFeedbackView),this._subs.add(this._dismissItem),this._subs.add(this._trackOpenClose)}getApplicatorEffects(){return e=this._readersAttentionItemInfo,t=this.actions,i=this._checksFeedCapabilities,(0,o.pipe)([[ge(e),"newReadersAttentionInfo"],[ve(t,i),"focusReadersAttentionItem"]],pe.UI((([e,t])=>({id:`readersAttentionFeedItem.effects.${t}`,when:S.R.isMainLens,what:q.nL.Effect.Applicator.create(e)}))));var e,t,i}dispose(){if(this._activeCardOpenStats){const e=this._activeCardOpenStats.numWords,t=this._activeCardOpenStats.attentionScore;(0,s.zG)(this._readersAttentionItemInfo.get(),n.map((e=>ne.T.prism.reverseGet(e.attentionScore))),T.bw((i=>{this._gnar.attentionScoreFullCardHide(this._statistics.wordsCount.get(),i,e,t)}))),this._heatmapVisible.set(!1),this._activeCardOpenStats=null}this._subs.unsubscribe()}}var we,be=i(85395);!function(e){const t=(e,t)=>e.pipe(C.h(z.lY.isCreateSnippetAction),k.U((({id:e})=>i=>{const a=(0,s.zG)(i.currentLens.items.update(e,t({type:"success",clockwise:!0})),ae.g_((()=>i.currentLens.items),s.yR));return be.sU.itemsLens.set(a,i)})));e.applicatorEffects=(e,i)=>(0,s.zG)([[t(e,i),"suggestedSnippetSuccessEffect"]],pe.UI((([e,t])=>({id:`cardsViewModel.effects.${t}`,when:S.R.isWithAlertsId,what:q.nL.Effect.Applicator.create(e)}))))}(we||(we={}));var Se=i(77394),ye=i(86620),_e=i(16868),ke=i(51540),Ae=i(40081),Ce=i(62346),Ee=i(780),Ie=i(73582),Me=i(92783),Te=i(44618),xe=i(84966),Re=i(13313),Le=i(21619),Fe=i(54216),Pe=i(48052),Ve=i(91549),Be=i(4330),Oe=i(20594),Ne=i(35607),He=i(20291),Ue=i(34383),De=i(33806),We=i(86775),je=i(11245),Ge=i(4890),ze=i(73841),qe=i(89770),Ke=i(39920),Ze=i(88772),Xe=i(74364),Qe=i(93508),$e=i(68425),Ye=i(24209),Je=i(17343),et=i(76974),tt=i(66310),it=i(40151),at=i(95574),st=i(81531);const rt=e=>e.view((e=>(0,o.pipe)(n.fromPredicate(q.nL.hasItems)(e),n.map((e=>e.currentLens.items)),n.map((e=>e.filter((0,ce.Kg)(m.O.isAlertCard,m.O.isAlertsBundle)))),n.map((e=>e.filter((e=>"rendered"===e.visualState.transition.type)))),n.fold((()=>null),(e=>e.values()))))).pipe(Qe.O([]),C.h(W.Nf),I.G(),k.U((([e,t])=>{const i=new Set(e.map((e=>e.id)));return t.filter((e=>!i.has(e.id)))})),$e.J()),nt=(e,t)=>e.alertClicked.pipe(k.U((e=>(0,o.pipe)(e,n.fold(s.gn,(e=>e.alert))))),C.h(W.fQ),O.M((e=>e.pipe(k.U((e=>q.nL.hasCards(e)&&S.R.isMainLens(e.currentLens.id)?m.O.getActiveItemWithAlert(e.currentLens):n.none)),k.U((e=>(0,o.pipe)(e,n.fold((()=>null),(e=>e.activeAlert)))))))(t)),C.h((([e,t])=>e.id!==(null==t?void 0:t.id))),k.U((([e,t])=>e))),ot=(e,t,i,a,v,w,y,_,E,M,R,B,O,N,H,D,G,J,ee,ne,oe,de,ue,pe,me,he,ge,ve,$e,ot,lt)=>{const ct=st.C8.Logging.getLogger("view_models"),dt=x.h.create(Re.A.defaultState),ut=x.h.create(s.jv),pt=x.h.create(!1),mt=x.h.create(!1),ht=x.h.create(!1),gt=(0,$.z)(H.view("user").get(),ot),vt=e=>(0,ce.W9)((()=>!mt.get()),(0,ce.W9)((e=>!ht.get()||j.bZ.isInline(e)),e)),ft=Fe.t.create({...Fe.t.defaultLensFilters,[S.R.SpecialId.Priority]:j.bZ.belongsToPriorityLens,[S.R.SpecialId.AllAlerts]:(0,ce.W9)(j.bZ.belongsToAllAlerts,(0,s.ff)(j.bZ.isTakeaway))},{...Fe.t.defaultTextFilters,[S.R.SpecialId.Closed]:s.jv,[S.R.SpecialId.Priority]:vt(j.bZ.belongsToPriorityLens),[S.R.SpecialId.AllAlerts]:vt((0,ce.W9)(j.bZ.belongsToAllAlerts,(0,s.ff)(j.bZ.isTakeaway))),[S.R.SpecialId.PredictionTakeaways]:e=>ut.get()(e)}),wt=Ye.T(ut,mt,pt,ht).pipe(Je.h(P.PU)),bt=Re.A.get(e.alertsList.state,e.alertsList.lensesScores,ft).subscribe(P.wW(dt)),St=new Ae.t(dt.view("lenses"),ft,e.sessionModel.scoreStatus),yt=(0,Pe.$y)((0,Te.a)(t).getContents),_t={features:new Set([Oe.IG.Features.showCardLabelInOutcomes]),cardLayoutDensityMode:Ge.j.Density.minimal,shouldAnimateAlertApply:Oe.IG.Default.shouldAnimateAlertApply,cardVisualMode:x.h.create(Ge.j.CardVisualMode.RegularLightMode)},kt=(0,Oe.Ls)(yt,e.alertsReader,_t,(()=>et.of(n.none)),e.mutingAlertsReader),At=Ve.R.ItemFactory.create(yt,e.mutingAlertsReader,_t,(()=>et.of(n.none))),Ct=(0,je.U)(yt,e.alertsReader,_t,Ue.T.ordAlert),Et=x.h.create(Ue.D.empty()),It=x.h.create(n.none),Mt=x.h.create(16),Tt=(0,d.q)((()=>Vt.get().currentLens.id),(()=>It.get()),(()=>Mt.get())),xt=m.O.getCapabilities(kt,At,Ct,e.alertsReader,yt,Et,(()=>Vt.get().currentLens.id),Tt),Rt=new Ke.gi(m.O.equatable.structEq,m.O.defaultOrd),Lt=(0,Ke.is)(kt,xt),Ft=new qe.oq(e.alertsList.state,e.alertsReader,dt.view("lenses"),e.positionManager,St,new Ke.ad((e=>e.id===S.R.SpecialId.Priority),new De.c(Ct,Et,e.alertsReader,(e=>e.id===S.R.SpecialId.PredictionTakeaways),Rt,m.O.equatable.structEq),m.O.equatable.structEq,m.O.bundlesOrd),(0,Ke.kn)(At,_t,(e=>e===S.R.SpecialId.Priority),(0,De.E)(Ct,Et,e.alertsReader,(e=>e===S.R.SpecialId.PredictionTakeaways),Lt,xt),xt),xt,ft),Pt=i.get(),Vt=x.h.create(Ft.emptyState(Pt).patch({alertSource:j.l$.sidebar})),Bt=Vt.view((e=>(0,o.pipe)(n.fromPredicate(q.nL.hasItems)(e),n.map(q.nL.Prism.getLens().get),n.filter((e=>e.id===S.R.SpecialId.PredictionTakeaways)),n.chain(q.In.getActiveItem)))).view(n.fold((()=>s.jv),(e=>t=>xt.hasAlert(t.id)(e)))).subscribe(P.wW(ut)),Ot=Vt.view((e=>(0,o.pipe)(n.fromPredicate(q.nL.hasItems)(e),n.map(q.nL.Prism.getLens().get),n.chain(q.In.getActiveItem),n.filter(se.m),n.fold(s.jv,s.W8)))).subscribe(P.wW(mt));B.next({kind:Se.R.ChangeLens,selectedLens:Pt===S.R.SpecialId.Priority?"priority":"all"});const Nt=(0,Be.u0)((()=>t.getCursor().index),Ft),Ht=new Ie.x(e.alertsList,Vt,3),Ut=new b.EQ(new Ee.o(e.sessionModel,Ht,ne.get().isPremium,G)),Dt=new ye.C($e()),Wt=new be.Xx({flush:()=>t.flushChanges()},new le.xQ,kt,e.alertsService,n.none,(()=>Promise.resolve()),(()=>Promise.resolve()),(0,o.pipe)(e.mutedAlertsCategoriesModel,n.map((e=>({model:e,openSuggestionsManagement:()=>self.open((0,Me.Um)().suggestionsSettings)})))),n.some(g.B.getCardsViewModelSendToURLExperiment(Dt,G)),(()=>!1),m.O.getActiveItemWithAlert,xt,Vt,Dt,{bufferTransitions:!0,showGbPrompt:g.B.shouldShow(ne.get())}),jt=new u.y(Wt.actionEvents,G,e.alertsReader),Gt=new f._z(G,de,ue,ge,ve),zt=new Z.X(v,Gt,e.alertsList.state,e.alertsReader,Vt),qt=new V(St,Gt,zt,a,e.sessionModel,zt.predictionCardState,G),Kt=new p.WY(Vt,qt,Ht,xt,G,gt),Zt=new Ne.o((()=>ae.F2(void 0))),Xt=Kt.upgradeHookExpanded.pipe(k.U((e=>e&&gt)),A.x()).subscribe(P.wW(pt)),Qt=(0,Ce.xl)(Vt,ft,wt,pt),$t=new Ce.o$(e.alertsList,e.alertsReader,e.positionManager,e.alertsService,t,Vt,Qt,m.O.getActiveItemWithAlert,O,!0,pt),Yt=(0,_e.hp)(Vt,$t,x.h.create(16),Zt,t,ct),Jt=new le.xQ,ei=Vt.pipe(k.U((e=>e.currentLens.id))),ti=zt.checklist.subscribe(P.wW(Et)),ii=new L(e.sessionModel,Gt,qt,Ut,St,ei,Jt,ne,G,oe),ai=Gt.activeView.pipe(k.U((e=>e.type)),Qe.O(f.aH.Type.startupPlaceholder),I.G(),k.U((([e,t])=>e===f.aH.Type.startupPlaceholder&&t===f.aH.Type.proofitRequest))).subscribe(P.wW(ht)),si=Kt.cardListViewportHeight.subscribe(P.wW(It)),ri=new h._(Gt,ee,G),ni=(0,o.pipe)(R,n.map((e=>new U(Gt,e,oe,G))));(0,o.pipe)(y,T.bw((t=>t.initCardActionsProcessing(Wt.actionEvents,e.alertsReader))));const oi=new Le.mN(t,Vt,$t,e.alertsReader,m.O.getActiveItemWithAlert,(t=>{const i=t.reduce(((t,i)=>(0,o.pipe)(e.alertsReader.getById(i.alert.id),n.chain(j.bZ.getRawId),T.bw((e=>t.set(e,i))),n.fold((()=>t),(()=>t)))),new Map),a=Array.from(i.keys()).map(me.alerts.getAlertById).filter(W.fQ);if(a.length){const e=a.reduce(((e,t)=>l.S.ordering.greaterThanOrEqual(t,e)?t:e));return n.fromNullable(i.get(xe.wQ.Id.create(e.id)))}return n.none})),li=rt(Vt),ci=nt(oi,Vt),di=_.pipe(tt.w(n.fold((()=>it.E),(t=>t.initAssistantCardActionsProcessing(Wt.actionEvents,e.alertsReader,Vt,li,ci))))).subscribe(),ui=E.pipe(tt.w(n.fold((()=>it.E),(t=>t.initCardActionsProcessing(Wt.actionEvents,e.alertsReader,li,ci,Vt))))).subscribe(),pi=M.pipe(tt.w(n.fold((()=>it.E),(t=>t.initCardActionsProcessing(Wt.actionEvents,e.alertsReader,li,Vt))))).subscribe(),mi=x.h.create((0,o.pipe)(N,n.fold((()=>_e.CV.skip),(()=>j.l$.text)),n.some)),hi=(0,o.pipe)(v,n.map((e=>new fe(Wt.actionEvents,e.feedItemInfo,Vt,xt,e.heatmap.visible,Gt,(()=>e.onDismissFeedItem()),G,J)))),gi=[(0,ke.A7)(oi,Vt,gt),(0,o.pipe)(Xe.EQ.focusMarkByActiveAlert(Vt,$t,e.alertsReader,m.O.getActiveFocusableItem,ct.getLogger("MarksEffects.focusMarkByActiveAlert")),q.nL.Effect.Producer.delayed(O)),(0,Q.yS)($t.events,xt,ct.getLogger("createOnAlertApplySideEffect")),(0,Q.fM)(Wt,Vt,e.alertsReader,kt,ct),(0,Q._2)(Vt,mi,Kt.autoFocusEnabled),...Wt.getApplicatorEffects(),Kt.applicatorEffects,He.R7(Vt,Zt,xt,(0,s.MZ)(Wt.actionEvents),{cardsAroundActive:10,cardsBeyondViewport:10}),(0,o.pipe)((0,_e.k9)(Vt,Yt,mi,m.O.getActiveAlignableItem,xt),q.nL.Effect.Producer.delayed(O)),He.XU(Vt,Zt,xt),(0,Q.qS)(Jt,ei),be.dv.createSendActiveAlertFeedbacksEffect(Vt,m.O.getActiveItemWithAlert,e.alertsService,e.alertsReader,ct.getLogger("CardsViewModelEffects.createSendActiveAlertFeedbacksEffect")),We.G.getChecklistHandlerSideEffect(Ct,zt.checklist,e.alertsReader,m.O.getActiveItemWithAlert,(e=>e===S.R.SpecialId.PredictionTakeaways)),...(0,o.pipe)(hi,n.fold((()=>[]),(e=>e.getApplicatorEffects()))),...we.applicatorEffects(Wt.actionEvents,xt.transitionTo)],vi=x.h.create(S.R.SpecialId.AllAlerts),fi=Vt.view((e=>e.currentLens.id)).pipe(C.h((e=>e===S.R.SpecialId.Priority||e===S.R.SpecialId.AllAlerts))).subscribe(P.wW(vi)),wi=(0,Be.VC)(Ft,Nt,vi,xt),bi=x.h.create(N),Si=(0,Be.Dv)((e=>S.R.isMainLens(e.currentLens.id)),wi,xt),yi=new Be.vM(e.sessionModel.checkingState,Vt),_i=(0,o.pipe)([(0,o.pipe)((e=>Be.Py.whenShouldVerifyCurrentLens(m.O.getActiveItemWithAlert,xt)(e)&&e.currentLens.id!==S.R.SpecialId.PredictionTakeaways),Be.Py.behaviorToEffect((()=>n.some(q.nL.Effect.FocusBehavior.focusNext)))),(0,o.pipe)((0,ce.W9)((()=>n.isSome(bi.get())),Be.Py.whenNoActiveCard),Be.Py.behaviorToEffect((e=>(0,o.pipe)((e=>{const t=(0,n.fromPredicate)((0,ce.Kg)(m.O.isAlertCard,m.O.isAlertsBundle));return(0,o.pipe)(bi.get(),n.chain((i=>(bi.set(n.none),q.nL.hasCards(e)?(0,o.pipe)(e.currentLens.items.reduce(((e,a)=>(0,o.pipe)(e,n.alt((()=>(0,o.pipe)(a,t,n.chain((e=>n.fromNullable(e.alerts.find((e=>e.id.startsWith(i+"_"))))))))))),n.none),n.map((t=>({alert:t,highlightIndex:0,lensId:e.currentLens.id})))):n.none))))})(e),n.map((e=>q.nL.Effect.FocusBehavior.focusAlert(e))))))),(0,o.pipe)((0,ce.W9)((()=>Kt.autoFocusEnabled.get()),(0,ce.W9)(Be.Py.whenFirstOpeningDocumentWithAlerts(yi),Be.Py.whenNoActiveCard)),Be.Py.behaviorToEffect((()=>n.some(q.nL.Effect.FocusBehavior.focusFirst))))],(0,r.fold)((0,r.getFunctionMonoid)(n.getFirstMonoid())())),ki=Be.Py.getStateTransformer(_i,Si,e.alertsReader,xt,(e=>Kt.autoFocusEnabled.get()&&"text"!==e.alertSource),s.Q1,vi),Ai=te.v.Items.getItemsPositionsUpdateTransformer(xt),Ci=(0,o.pipe)(v,n.fold((()=>Ze.t.nothing),(e=>{return t=e.feedItemInfo,({state:e,metadata:i})=>{if(!q.nL.hasItems(e)||!S.R.isMainLens(e.currentLens.id)||!q.nL.isLensview(e))return ae.t$({state:e,metadata:i});const a=(0,s.zG)(Y.l.find(e.currentLens.items,se.m),n.map(ie.ei("value")));return(0,s.zG)(e,q.nL.getLens,n.chain(re(a,t.get())),n.map((({lens:t,newItem:i})=>q.nL.Prism.getLens().compose(te.v.Prism.items).set((0,s.zG)(a,n.fold((()=>t.items),(e=>t.items.remove(e.id))),(e=>(0,s.zG)(i,n.fold((()=>e),(t=>e.add(t)))))),e))),n.getOrElse((()=>e)),(e=>ae.t$({state:e,metadata:i})))};var t}))),Ei=(0,s.ls)(ki,at.L9(Ai),at.L9(Ci)),Ii=new ze.l(Vt,Ft,e.alertsReader,e.alertsService,gi,m.O.getActiveItemWithAlert,Ei),Mi=Jt.pipe(k.U((({lensId:e})=>e)),C.h((e=>e===S.R.SpecialId.AllAlerts||e===S.R.SpecialId.Priority)),A.x()).subscribe((e=>{i.set(e),B.next({kind:Se.R.ChangeLens,selectedLens:e===S.R.SpecialId.Priority?"priority":"all"})})),Ti=Gt.activeView.pipe(k.U((e=>{switch(e.type){case f.aH.Type.default:return i.get();case f.aH.Type.emogenie:return S.R.SpecialId.PredictionEmogenie;case f.aH.Type.readersAttention:return S.R.SpecialId.PredictionTakeaways;case f.aH.Type.readersAttentionHelp:return S.R.SpecialId.Closed;case f.aH.Type.proofitReview:return S.R.SpecialId.RealTimeProofit;default:return null}})),C.h(W.fQ),A.x(),k.U((e=>[e,e===S.R.SpecialId.AllAlerts||e===S.R.SpecialId.Priority]))).subscribe((([e,t])=>Jt.next({lensId:e,focusFirstCard:t}))),xi=new X.X(H,D,ee),Ri=new K(v,Vt,Wt.actionEvents,(t=>e.alertsReader.getById(t)),m.O.getActiveItemWithAlert),Li=w.pipe(tt.w(n.fold((()=>it.E),(t=>t.initAssistantSession(Wt.actionEvents,e.alertsReader,Vt,e.alertsService,e.alertsList.state))))).subscribe(),Fi=Wt.actionEvents.pipe(C.h(z.lY.isOpenIdeasGallery)).subscribe((()=>self.open((0,Me.Um)().grammarlyIdeasSales,"_blank"))),Pi=(0,F.W)(pe),Vi=Wt.actionEvents.subscribe((0,s.ls)((0,c.JH)(e.alertsReader,c.SV.Source.assistant),T.bw((async e=>(e.kind===c.SV.Kind.alertApply&&e.source===c.SV.Source.assistant&&await lt.incrementCounter(),he.next(e))))));return{lensState:Vt,cardsViewModel:Wt,lensPreviewViewModel:St,cardsListScrollManager:Zt,upgradeViewModel:Ht,alertProcessor:me,assistantHeaderViewModel:ii,assistantLayoutViewModel:Gt,assistantCardListViewModel:Kt,lensChanged:Jt,predictionsPreviewViewModel:qt,assistantFeedbackViewModel:ri,assistantSettingsViewModel:xi,assistantProofitViewModel:ni,readersAttentionViewModel:zt,readersAttentionItemViewModel:hi,assistantModalManager:Ut,marksViewModel:$t,gnar:G,positionViewModel:Pi,user:ne,capabilities:xt,remSize:Mt,isSingleCardAssistant:!1,dispose:()=>{Vi.unsubscribe(),Ri.dispose(),Bt.unsubscribe(),ti.unsubscribe(),Wt.dispose(),Ii.dispose(),$t.dispose(),qt.dispose(),Mi.unsubscribe(),bt.unsubscribe(),Ti.unsubscribe(),ii.dispose(),Kt.dispose(),Ut.hideAll(),zt.dispose(),fi.unsubscribe(),si.unsubscribe(),Li.unsubscribe(),Ot.unsubscribe(),ai.unsubscribe(),Fi.unsubscribe(),ui.unsubscribe(),pi.unsubscribe(),di.unsubscribe(),Xt.unsubscribe(),(0,o.pipe)(ni,T.bw((e=>e.dispose()))),(0,o.pipe)(hi,T.bw((e=>e.dispose()))),jt.dispose()}}}},9671:(e,t,i)=>{i.d(t,{y:()=>o,t:()=>l});var a=i(15090),s=i(15646),r=i(77176),n=i(85985);class o{constructor(e,t,i){this._cardActions=e,this._gnar=t,this._alertsReader=i,this._subs=[l(this._cardActions,this._gnar,"assistant"),a.g.createSubscription(this._cardActions,this._gnar,this._alertsReader.getById)]}dispose(){this._subs.forEach((e=>e.unsubscribe()))}}const l=(e,t,i)=>e.pipe(r.U((e=>e.type)),n.h((e=>e===s.lY.Type.muteAlertCategory||e===s.lY.Type.undoMuteAlertCategory||e===s.lY.Type.mutedAlertSuggestionManagementClick||e===s.lY.Type.mutedAlertSuccessShow))).subscribe((e=>{switch(e){case s.lY.Type.muteAlertCategory:t.mutedAlertsCardTurnOffButtonClick(i);break;case s.lY.Type.undoMuteAlertCategory:t.mutedAlertsTurnBackOnButtonClick(i);break;case s.lY.Type.mutedAlertSuggestionManagementClick:t.suggestionManagementClick(i);break;case s.lY.Type.mutedAlertSuccessShow:t.categoryDeactivatedShow(i)}}))},38152:(e,t,i)=>{i.d(t,{lo:()=>a,WY:()=>H});var a,s=i(57050),r=i(40327),n=i(51972),o=i(40033),l=i(73582),c=i(90361),d=i(66896),u=i(40018),p=i(70023),m=i(40489),h=i(9922),g=i(77176),v=i(95300),f=i(28043),w=i(2834),b=i(95093),S=i(32952),y=i(16782),_=i(85985),k=i(24209),A=i(78674),C=i(60797),E=i(57091),I=i(50628),M=i(66310),T=i(85089),x=i(41398),R=i(16118),L=i(35416),F=i(25975),P=i(27125),V=i(5114),B=i(8125),O=i(38983),N=i(31881);!function(e){let t;!function(e){e.clickOnEmpty="clickOnEmpty",e.clickOnFakeCard="clickOnFakeCard",e.clickOnUpgradeCard="clickOnUpgradeCard"}(t=e.Type||(e.Type={}))}(a||(a={}));class H{constructor(e,t,i,H,U,D){this._lensState=e,this._predictionsVM=t,this._upgradeViewModel=i,this._capabilities=H,this._gnar=U,this._isYellowUnderlinesExperimentActive=D,this._subs=new h.w.Keeper,this.activeAlert=this._lensState.pipe(g.U((e=>L.nL.hasCards(e)&&d.R.isMainLens(e.currentLens.id)?n.O.getActiveItemWithAlert(e.currentLens):V.none)),g.U((e=>(0,r.pipe)(e,V.fold((()=>null),(e=>e.activeAlert)))))),this.successView=O.h.combine(this._lensState,this._predictionsVM.previewState,((e,t)=>F.v.WithSuccess.State.isInSuccess(this._capabilities)(e)?t.kind===o.fA.visible?V.some(P.g.SuccessType.applied):V.some(P.g.SuccessType.small):V.none)),this._premiumAlertsCount=this._upgradeViewModel.advancedAlerts.view((0,s.ls)(V.map((e=>e.count)),V.getOrElse((()=>0)))),this.havePremiumAlerts=this._premiumAlertsCount.view((e=>e>0)),this._upgradeHookExpanded=new v.X(!1),this.upgradeHookExpanded=(0,r.pipe)(this._upgradeHookExpanded,f.x()),this.upgradeHookFlow=(0,r.pipe)((0,p.d)(this._upgradeViewModel.advancedAlerts),N.Z.extendActions(w.b((e=>{e.key===m.n.State.expanded?"upgrade"===e.action.kind?(this._upgradeViewModel.openUpgradeUrl(l.L.Place.assistantCardList),this._gnar.getPremiumButtonClick("assistantList","SeeWhatsInPremium")):"onUpgradeButtonMount"===e.action.kind&&this._onUpgradeButtonMount.next(e.action.element):e.key===m.n.State.minimized&&"onClick"===e.action.action&&(this._upgradeHookExpandReason.next("click"),this._isYellowUnderlinesExperimentActive&&this.assistantActions.next({type:a.Type.clickOnUpgradeCard}))}))),N.Z.patchState(b.T(this._minimizeUpgradeHook())),N.Z.patchState(b.T(this._autoOpenUpgradeHook())),N.Z.patchState(w.b((e=>this._onUpgradeHookShown.next(function(e){switch(e){case"hidden":return m.n.State.hidden;case"expanded":return m.n.State.expanded;case"minimized":return m.n.State.minimized;default:(0,c.vE)(e)}}(e.kind))))),N.Z.patchState(w.b((e=>this._upgradeHookExpanded.next("expanded"===e.kind))))),this.cardListContext=new v.X(V.none),this.assistantActions=new S.xQ,this.autoFocusEnabled=O.h.create(!0),this.cardListViewportHeight=O.h.create(V.none),this._onUpgradeButtonMount=new y.t,this._upgradeHookExpandReason=new y.t,this._onUpgradeHookShown=new S.xQ,this._unselectActiveAlert=this.assistantActions.pipe(_.h((e=>e.type===a.Type.clickOnEmpty||e.type===a.Type.clickOnFakeCard||!(!this._isYellowUnderlinesExperimentActive||e.type!==a.Type.clickOnUpgradeCard))),w.b((()=>this.autoFocusEnabled.set(!1))),g.U((()=>e=>e.patch({currentLens:(0,r.pipe)(L.In.getActiveItem(e.currentLens),V.fold((()=>e.currentLens),(t=>L.nL.hasItems(e)?this._capabilities.unselectItem()(e.currentLens):e.currentLens))),switchOrder:"lensOrder",alertSource:u.l$.sidebar})))),this.applicatorEffects={id:"assistantCardListViewModel.effects",when:d.R.isWithAlertsId,what:L.nL.Effect.Applicator.create(k.T(this._unselectActiveAlert))},this._subs.push(this._onUpgradeHookShown.pipe(A.b(1),f.x(),_.h((e=>e===m.n.State.minimized))).subscribe((()=>this._gnar.assistantCollapsedUpgradeHookShow())),this._onUpgradeButtonMount.pipe(C.oA,E.a(this.cardListContext.pipe(C.oA,I.P())),M.w((([e,t])=>T.n(e,{root:t}).pipe(I.P()))),_.h(B.Dw),g.U((e=>Math.trunc(100*e[0].intersectionRatio))),x.M(this._upgradeHookExpandReason,this._premiumAlertsCount)).subscribe((([e,t,i])=>this._gnar.assistantExpandedUpgradeHookShow(i,e,t))),this._lensState.pipe(_.h(L.nL.hasCards),g.U((e=>L.In.getActiveItem(e.currentLens))),R.G(),_.h((([e,t])=>V.isNone(e)&&V.isSome(t)))).subscribe((e=>{this.autoFocusEnabled.set(!0)})))}dispose(){this._subs.dispose()}_minimizeUpgradeHook(){return this.activeAlert.pipe(f.x(),x.M(this.upgradeHookExpanded),_.h((([e,t])=>!!(e&&t&&this._isYellowUnderlinesExperimentActive))),x.M(this._upgradeViewModel.advancedAlerts),g.U((([e,t])=>(0,r.pipe)(t,V.fold((()=>({kind:m.n.State.hidden})),(e=>({kind:m.n.State.minimized,alertsCount:e.count})))))))}_autoOpenUpgradeHook(){return this._lensState.pipe(_.h((e=>(0,r.pipe)(e.currentLens.id,(0,B.Kg)(d.R.isPriority,d.R.isAllAlerts)))),g.U(F.v.WithSuccess.State.isInSuccess(this._capabilities)),E.a(this.havePremiumAlerts,((e,t)=>e&&t)),f.x(),w.b((e=>{e&&this._upgradeHookExpandReason.next("alertsAddressed")})),x.M(this._upgradeViewModel.advancedAlerts),g.U((([e,t])=>(0,r.pipe)(t,V.fold((()=>({kind:m.n.State.hidden})),(t=>e?{kind:m.n.State.expanded,showCloseButton:!0,alertsState:{count:t.count,alerts:t.alerts()}}:{kind:m.n.State.minimized,alertsCount:t.count}))))))}}},51972:(e,t,i)=>{i.d(t,{O:()=>X});var a=i(57050),s=i(35214),r=i(40327),n=i(54483),o=i(31820),l=i(35108),c=i(77176),d=i(40151),u=i(2834),p=i(55415),m=i(22232),h=i(5114),g=i(16027),v=i(27378),f=i(41572),w=i(64757),b=i(61922),S=i(3656),y=i(28706),_=i(26027),k=i(15646),A=i(74754),C=i(66346),E=i(76974),I=i(5739),M=i(16314),T=i(35501),x=i(35630),R=i(32585);const L=g.UI.Node.make((({state:e,notify:t})=>{const i=v.useContext(f.m.Context);return v.createElement(I.F.Fragment,null,e.pipe(c.U((e=>(0,a.zG)(e.details,h.fold((()=>v.createElement("div",null)),(()=>v.createElement(w.zx.Tertiary,{key:"toggle-more",name:(0,C.hC)(e.visualState,i),title:(0,C.hC)(e.visualState,i),onClick:y.hz(t({type:k.eI.Kind.startTransitionTo,id:e.id,transition:{type:_.X.isCardOpen(e.visualState)?"focused":"expanded",clockwise:!0}}))},_.X.isCardOpen(e.visualState)?v.createElement(b.JO.Arrow,{key:"more",className:R.lessIcon}):v.createElement(b.JO.QuestionMark,{key:"expand"}),(0,C.hC)(e.visualState,i)))))))))})),F=g.UI.Node.make((({notify:e})=>v.createElement(w.zx.Tertiary,{name:"dismiss",title:"Dismiss",onClick:y.hz(e({type:M.Dy.ignoreButtonClick}))},v.createElement(b.JO.Ignore,null)))),P=g.UI.Node.make((({state:e})=>v.createElement(I.F.Fragment,null,e.pipe(c.U((e=>(0,a.zG)(e.details,h.fold(a.gn,(t=>v.createElement(C.G3,{key:"card-actions-details",visualState:e.visualState,className:R.more},v.createElement(S.XY,{className:R.minimalDescription,...A.y.renderToHtml(t)}))))))))))),V=g.UI.Node.make((({notify:e})=>v.createElement(w.zx.Flat,{className:R.feedbackFooter,name:"attention-score-card-open-feedback-form",onClick:y.hz(e({type:M.Dy.feedbackButtonClick}))},v.createElement("span",null,"Anything we can improve?"),v.createElement(b.JO.OpenFeedbackFormArrow,null)))),B=g.UI.Node.make((({state:e,notify:t})=>v.createElement(I.F.Fragment,null,e.pipe(c.U((e=>v.createElement(w.zx.Primary,{name:"readersAttentionItem-view-more",onClick:y.hz(t({type:M.Dy.viewMoreButtonClick,item:e})),className:R.viewMoreButton},"See suggestions"))))))),O=g.UI.Knot.make(g.UI.Grid.make((({slots:e})=>v.createElement(I.F.div,{className:x.card,"data-name":"attention-score-card-full"},e.header,v.createElement(I.F.div,{className:R.cardBody},e.content,e.details,v.createElement("div",{className:R.actions},e.viewMoreButton)),v.createElement(I.F.div,{className:R.actionsFooter},e.expandButton,e.dismissButton),e.feedbackFooter))),{header:(0,T.h)("full"),content:T.r,details:P,expandButton:L,dismissButton:F,viewMoreButton:B,feedbackFooter:V}),N=e=>g.Z.composeKnot({header:()=>e,content:()=>e.pipe(c.U((e=>({attentionScore:e.attentionScore,attentionScoreDescription:e.description})))),details:()=>e,expandButton:()=>e,dismissButton:()=>E.of(null),viewMoreButton:g.Z.fromSideEffect(a.Q1,e),feedbackFooter:()=>E.of(null)});var H=i(12187),U=i(65060),D=i(11510);const W=g.UI.Knot.make(g.UI.Grid.make((({slots:e,notify:t})=>v.createElement(I.F.div,{"data-name":"attention-score-card-mini",onClick:y.hz(t({type:M.Dy.miniCardClick,id:U.g.id})),...(0,H.Sh)(x.card,D.miniCard)},e.header))),{header:(0,T.h)("mini")}),j=e=>g.Z.composeKnot({root:g.Z.fromSideEffect(a.Q1,null),header:()=>e});var G;!function(e){const t=g.UI.Union.make("kind",{mini:W,full:O,hidden:g.UI.Node.empty}),i=e=>({mini:j(e.pipe(c.U((e=>({title:e.view.title,attentionScore:e.view.attentionScore,density:e.density}))))),full:N(e.pipe(c.U(p.ei("view")))),hidden:()=>d.E}),s=n.G.make(t);function r(e){switch(e){case"added":case"rendered":return"mini";case"focused":case"expanded":return"full";case"hidden":case"removed":return"hidden";case"presuccess":case"success":case"feedback_form":case"muted":throw new Error(`${e} is not supported for ReadersAttentionCard`);default:(0,m.vE)(e)}}e.Card=g.UI.Node.make((({state:e,notify:t})=>g.UI.mount(s,(0,a.zG)(o.g.flow(e.pipe(c.U(p.ei("view"))),(0,a.zG)((e=>g.Z.composeUnion(i(e),(()=>e.pipe(c.U((e=>({kind:r(e.view.visualState.transition.type)})))))))(e),g.Z.extendActions(u.b((e=>t(e.action.action)())))),(e=>g.Z.composeUnion(i(e),(()=>e.pipe(c.U((e=>({kind:(0,a.zG)(e.view.visualState.from,h.fold((()=>"mini"),r))})))))))(e),p.ei("id"),l.CE.toOption(l.a)),o.g.extend((e=>t(e)()))))))}(G||(G={}));var z=i(48521),q=i(16892);const K=e=>t=>({...t,positionState:e}),Z=e=>t=>({...t,visualState:e});var X,Q=i(66896),$=i(13188),Y=i(7910),J=i(49978),ee=i(84974),te=i(98752),ie=i(17594),ae=i(91549),se=i(20594),re=i(86775),ne=i(77610),oe=i(15215),le=i(70100),ce=i(47306),de=i(35416),ue=i(25975),pe=i(8125),me=i(83078),he=i(73975),ge=i(45701),ve=i(31881);!function(e){function t(e,t,i,a,s){return de.nL.Items.mapper((e=>e.kind),{[_.X.Kind]:e,[ae.R.Kind]:t,[le.X.kind]:i,[ce.J.kind]:a,[U.g.kind]:s})}function i(e){return e.kind===_.X.Kind}function n(e){return e.kind===ae.R.Kind}function o(e){return i(e)&&ne.C.isEthicalAIItem(e)}function l(e){return n(e)&&ne.C.isEthicalAIItem(e)}function c(e,i){return{viewState:(a,s)=>t((t=>({view:t,isLastCard:a,kind:"alertCard",visibleViewportHeight:e(s)})),(t=>({view:t,isLastCard:a,kind:"alertsBundle",visibleViewportHeight:e(s)})),(e=>({view:e,kind:"checklistItemEmpty"})),(t=>({view:t,kind:"checklistItemWithAlerts",isLastCard:a,visibleViewportHeight:e(s)})),(e=>({density:i()===Q.R.SpecialId.AllAlerts?"normal":"compact",view:e,kind:"readersAttentionItem"})))}}e.isSelectableWithAlertItem=(0,pe.Kg)(i,n,oe.d.isChecklistItemWithAlerts),e.getActiveItemWithAlert=de.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.getActiveAlignableItem=de.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.getActiveFocusableItem=de.In.getActiveItemOfType(e.isSelectableWithAlertItem),e.checksFeedItemsMapper=t,e.isAlertCard=i,e.isAlertsBundle=n,e.isEthicalAIAlertCard=o,e.isEthicalAIAlertsBundle=l,e.defaultOrd=(0,s.fold)(ge.getMonoid())([(0,r.pipe)(ge.ordBoolean,ge.contramap((0,pe.ff)(o))),(0,r.pipe)(ge.ordBoolean,ge.contramap(U.m)),ge.fromCompare(((e,t)=>i(e)&&i(t)?_.X.ord.compare(e,t):0))]),e.bundlesOrd=(0,s.fold)(ge.getMonoid())([(0,r.pipe)(ge.ordBoolean,ge.contramap((0,pe.ff)(l))),(0,r.pipe)(ge.ordBoolean,ge.contramap(U.m)),ge.fromCompare(((e,t)=>n(e)&&n(t)?ae.R.ord.compare(e,t):0))]),e.item=e=>ve.UI.Union.make("kind",{alertCard:$.p.Card(e),alertsBundle:J.Q.Card(e),checklistItemEmpty:ee.z.Card(e),checklistItemWithAlerts:te.fw.Card(e),readersAttentionItem:G.Card}),e.viewState=c,e.createCardListFlow=e=>(0,Y.sJ)((t=>(0,r.pipe)(e,me.bw((e=>e.actions.next(t.action)))))),e.listItemOrd=e=>ge.contramap((e=>e.cell.item.view))(e).compare;const d={equals:(e,t)=>e.kind===t.kind&&q.s.eqById.equals(e,t)},u=(e,t,i,a,s)=>({equals:(r,n)=>{const o={[_.X.Kind]:e,[ae.R.Kind]:t,[le.X.kind]:i,[ce.J.kind]:a,[U.g.kind]:s};return d.equals(r,n)&&function(e,t){return(i,a)=>t[e(i)].equals(i,a)}((e=>e.kind),o)(r,n)}}),p=(0,s.fold)(he.uZ())([z.o.eq,q.s.verticalPositionEq,d]);function m(e,i){const a=_.X.Capabilities.getChangePosition(e);return{changePosition:e=>t(a.changePosition(e),ae.R.changePosition(e),le.X.changePositionState(e),i.changePositionState(e),K(e))}}function g(e,i,a){const s=_.X.Capabilities.getAnimatable(e),r=ae.R.Capabilities.getAnimatable(a);return{completeTransition:e=>{return t(s.completeTransition(e),r.completeTransition(e),le.X.completeTransition(e),i.completeTransition(e),(a=e,e=>({...e,visualState:z.o.VisualState.complete(e.visualState,a)})));var a},transitionTo:e=>t(s.transitionTo(e),r.transitionTo(e),le.X.transitionTo(e),i.transitionTo(e),(e=>t=>({...t,visualState:z.o.VisualState.to(t.visualState,e)}))(e)),changeVisualState:e=>t(s.changeVisualState(e),r.changeVisualState(e),le.X.changeVisualState(e),i.changeVisualState(e),Z(e))}}function v(e,i,s,n,o){const l=ae.R.getCardHydrator(o),c=ae.R.getSelect(s,n,l),d=ae.R.getSelectByAlert(s,n,l),u=_.X.Capabilities.getSelect(e);return{select:(e,s,n)=>t(u.select(e,s,n),c(e,s),le.X.select(e),i.selectFirstAlert((0,a.MZ)(e),s),function(e,t){return i=>{const s=(0,r.pipe)(e,h.map((e=>t.compare(i,e)>0)),h.getOrElse(a.W8)),n=(0,r.pipe)(e,h.exists((e=>e.id===i.id))),o=n&&_.X.isCardOpen(i.visualState)?"expanded":"focused",l=(0,r.pipe)(e,h.fold((()=>z.o.VisualState.initial({type:o,clockwise:s})),(e=>z.o.VisualState.to(i.visualState,{type:o,clockwise:s}))));return(0,r.pipe)(i,n?a.yR:K(q.s.PositionState.invalidateHeight(i.positionState)),Z(l))}}(e,s)),selectByAlert:(e,s,r,n)=>t(u.selectByAlert(e,s,r,n),d(s,e,r),le.X.select(e),i.selectByAlert(s,(0,a.MZ)(e),r),a.yR),unselect:(e,s)=>t(u.unselect((0,a.MZ)(e),s),ae.R.unselect((0,a.MZ)(e),s),le.X.unselect(e),i.unselect((0,a.MZ)(e),s),function(e,t){return i=>{const s=(0,r.pipe)(e,h.map((e=>t.compare(i,e)>0)),h.getOrElse(a.W8)),n=(0,r.pipe)(e,h.exists((e=>e.id===i.id)));return(0,r.pipe)(i,n?a.yR:K(q.s.PositionState.invalidateHeight(i.positionState)),z.o.isHidden(i)?a.yR:Z(z.o.VisualState.to(i.visualState,{type:"rendered",clockwise:s})))}}(e,s))}}function f(e,s,r,o,l,c){return{removeAlertFromItem:(d,u)=>t((t=>_.X.Capabilities.getRemoveAlerts(e,u.itemsOrd)(d,de.In.getActiveItemOfType(i)(u))(t)),(e=>ae.R.Capabilities.getRemoveAlertsCapability(o,l,c,u.itemsOrd)(d,de.In.getActiveItemOfType(n)(u))(e)),a.yR,(e=>re.G.getRemoveAlert(s,r,o).removeAlertFromItem(d,u)(e)),a.yR)}}function w(e,i,s,r){const n=_.X.Capabilities.getRemove(e);return{remove:(e,o)=>t(n.remove(e,o),(t=>e(t)?ae.R.Capabilities.getRemove(s,r)([t.activeAlert],o(t))(t):t),a.yR,(t=>e(t)?i.removeAlerts(t.alerts,o(t))(t):t),a.yR)}}function b(e,i,s,r){const n=_.X.Capabilities.getUpdateWithAlert(e),o=ae.R.Capabilities.getUpdatableWithAlertsCapability(i,r);return{updateWithAlerts:e=>t(n.updateWithAlerts(e),o(e),a.yR,s.updateWith(e),a.yR)}}e.equatable={structEq:u(_.X.eq,ae.R.eq,le.X.eq,ce.J.eq,U.g.eq),idEq:u(d,d,d,d,d),visualStateEq:u(p,p,p,p,p)},e.changePosition=m,e.disposable={isScheduledToDispose:t((e=>ne.C.willBeDisposed(e,e.removedAlertsIds)),(e=>ne.C.willBeDisposed(e,e.removedAlertsIds)),a.jv,(e=>ne.C.willBeDisposed(e,e.removedAlertsIds)),a.jv)},e.hidable={isHidden:t(z.o.isHidden,z.o.isHidden,z.o.isHidden,z.o.isHidden,z.o.isHidden)},e.animatableItem=g,e.hasAlertsQueries={isSelectableByAlert:e=>t(ne.C.hasAlert(e.alert.id),ne.C.hasAlert(e.alert.id),a.jv,ne.C.hasAlert(e.alert.id),a.jv),hasAlert:e=>t(ne.C.hasAlert(e),ne.C.hasAlert(e),a.jv,ne.C.hasAlert(e),a.jv),hasActiveAlert:t(ne.C.hasActiveAlert,ne.C.hasActiveAlert,(()=>h.none),ne.C.hasActiveAlert,(()=>h.none))},e.changePositionStrategyQueries={useReferenceHeightOnRemove:t(a.jv,a.jv,a.jv,a.W8,a.jv)},e.select=v,e.removeAlert=f,e.remove=w,e.updateWithAlert=b,e.releaseAlert=(t,i,a,s,r,n)=>ue.v.Capabilities.getAlertReleaser({...f(t,i,a,s,r,n),...e.disposable}),e.unselectable=(e,t,i,a,s)=>ue.v.Capabilities.getUnselectable(de.In.getActiveItem,v(e,t,i,a,s)),e.selectableByAlert=(t,i,a,s,r)=>ue.v.Capabilities.getSelectableByAlert(de.In.getActiveItem,{...e.hasAlertsQueries,...v(t,i,a,s,r),...ue.v.Capabilities.getHasChecksFeed()}),e.selectableById=(e,t,i,a,s)=>ue.v.Capabilities.getSelectableById(de.In.getActiveItem,v(e,t,i,a,s)),e.updateMeta=()=>({updateMeta:ue.v.Capabilities.getMetaUpdatable().updateMeta}),e.animatableFeed=(e,t,i,a,s,r)=>ue.v.Capabilities.getAnimatable(e,{...f(e,t,i,a,s,r),...g(e,t,r),...ue.v.Capabilities.getHasChecksFeed()}),e.hasPriorityToggle=(t,i,a)=>ue.v.WithPriority.getHasPriorityToggle({...g(t,i,a),...e.hasAlertsQueries,...e.disposable});const S=t=>["focused","expanded"].includes(t.visualState.transition.type)&&!e.disposable.isScheduledToDispose(t);function y(e,i){const a=se.Mq.getCardSelections(i);return{nextAlert:t(a.nextAlert,a.nextAlert,(()=>h.none),e.nextAlert,(()=>h.none)),prevAlert:t(a.prevAlert,a.prevAlert,(()=>h.none),e.prevAlert,(()=>h.none))}}function k(){return{updateUserInput:e=>t(_.X.updateUserInput(e),ae.R.changeUserInput(e),a.yR,a.yR,a.yR)}}e.alignable={isValidToAlign:t(S,S,a.jv,S,a.jv)},e.alertIterator=y,e.itemReleaser=(e,t,i)=>re.G.getItemReleaser(e,t,i,ue.v.Capabilities.getItemReleaser()),e.hasAlerts=ue.v.Capabilities.getHasAlerts,e.getDefaultNextAlertItemFilter=t=>(0,pe.W9)(e.isSelectableWithAlertItem,(i=>!e.disposable.isScheduledToDispose(i)&&(0,r.pipe)(i,e.hasAlertsQueries.hasActiveAlert,h.map((e=>t.isRegistered(e.alert.id))),h.getOrElse(a.jv)))),e.hasUserInput=k,e.priorityTest=(0,pe.W9)(i,(e=>ie.$.isPriority(e.activeAlert))),e.verifiable=()=>ue.v.Capabilities.getVerifiable(e.disposable),e.cloneable=()=>{const e=q.s.Capabilities.getPojoCloneable().clone;return{clone:t(_.X.Capabilities.getCloneable().clone,e,e,e,e)}},e.getCapabilities=function(t,i,s,r,n,o,l,d=(0,a.a9)(h.none),u=se.IG.Default){return{...c(d,l),...e.disposable,...e.hidable,...e.equatable,...k(),...e.cloneable(),...m(t,s),...g(t,s,n),...v(t,s,r,u,n),...w(t,s,u,n),...f(t,s,o,r,u,n),...b(t,i,s,n),...e.hasAlertsQueries,...e.changePositionStrategyQueries,...e.alignable,...e.releaseAlert(t,s,o,r,u,n),...e.unselectable(t,s,r,u,n),...e.selectableByAlert(t,s,r,u,n),...e.selectableById(t,s,r,u,n),...e.updateMeta(t),...e.animatableFeed(t,s,o,r,u,n),...e.hasPriorityToggle(t,s,n),...e.itemReleaser(s,o,r),...e.verifiable(),...e.cloneable(),...e.hasAlerts(y(s,r),r,(()=>e.isSelectableWithAlertItem),{...e.hasAlertsQueries,...e.disposable})}}}(X||(X={}))},5178:(e,t,i)=>{i.d(t,{Q:()=>a,_:()=>n});var a,s=i(75003),r=i(53844);!function(e){e.readersAttention="readers_attention",e.settings="settings"}(a||(a={}));class n{constructor(e,t,i){this._assistantLayoutViewModel=e,this._domain=t,this._gnar=i,this._entryPoint=void 0}getDomain(){return this._domain}openFeedback(e){this._entryPoint=e,this._gnar.assistantFeedbackButtonClick(this._entryPoint),this._assistantLayoutViewModel.pushActiveView({type:s.aH.Type.feedback})}submitFeedback(e){this._entryPoint&&this._gnar.assistantFeedbackSubmitButtonClick(this._entryPoint,e.domain,e.text,(0,r.dK)(e)?e.score:void 0)}}},19654:(e,t,i)=>{i.d(t,{B:()=>a});var a,s=i(92783),r=i(85395);!function(e){e.shouldShow=e=>{var t;return!!(null===(t=e.institutionInfo)||void 0===t?void 0:t.voxEnabled)};const t=e=>({onShow:t=>e.gbPromptFormShow(t),onAccept:t=>e.gbPromptAcceptClick(t),onDismiss:t=>e.gbPromptDismissClick(t)});e.getCardsViewModelSendToURLExperiment=(e,i)=>({handleGbPrompt:r.sU.Experiments.handleGbPrompt(e,{account:{styleGuide:(0,s.Um)().styleGuideSettings,writingStyle:(0,s.Um)().writingStyleSettings}},t(i))})}(a||(a={}))},75003:(e,t,i)=>{i.d(t,{aH:()=>a,D$:()=>d,_z:()=>u});var a,s=i(7309),r=i(90361),n=i(14601),o=i(78674),l=i(85985),c=i(38983);!function(e){let t,i,a;!function(e){e.default="default",e.emogenie="emogenie",e.readersAttention="readersAttention",e.readersAttentionHelp="readersAttentionHelp",e.feedback="feedback",e.settings="settings",e.proofitRequest="proofitRequest",e.proofitReview="proofitReview",e.popup="popup",e.startupPlaceholder="startupPlaceholder"}(t=e.Type||(e.Type={})),function(e){let t;!function(e){let t;!function(e){e.predictionWidget="predictionWidget",e.navigation="navigation",e.readersAttentionItem="readersAttentionItem"}(t=e.Type||(e.Type={}))}(t=e.Caller||(e.Caller={}))}(i=e.ReadersAttention||(e.ReadersAttention={})),function(e){let t;!function(e){e.none="none"}(t=e.Type||(e.Type={}))}(a=e.Popup||(e.Popup={})),e.isDefault=function(t){return t.type===e.Type.default},e.isEmogenie=function(t){return t.type===e.Type.emogenie},e.isReadersAttention=function(t){return t.type===e.Type.readersAttention},e.isReadersAttentionHelp=function(t){return t.type===e.Type.readersAttentionHelp},e.isFeedback=function(t){return t.type===e.Type.feedback},e.isSettings=function(t){return t.type===e.Type.settings},e.isProofitRequest=function(t){return t.type===e.Type.proofitRequest},e.isProofitReview=function(t){return t.type===e.Type.proofitReview},e.isPopup=function(t){return t.type===e.Type.popup}}(a||(a={}));class d{constructor(e,t,i,a,s,d,u){this._defaultView=i,this.browser=d,this.layout=u,this._sub=new n.w,this.viewHistory=[],this._activeView=c.h.create(a),this._sub.add(e.subscribe((e=>{if(e.length>0)for(;!this.activeViewHasAlerts();)this.popActiveView()}))),s&&this._sub.add(t.pipe(o.b(100),l.h(r.fQ)).subscribe((()=>{if(s.has(this._activeView.get().type))for(;this._activeView.get().type!==this._defaultView.type;)this.popActiveView()})))}activeViewHasAlerts(){return!1}get activeView(){return this._activeView.view()}get lastView(){return this.viewHistory[this.viewHistory.length-1]||this._defaultView}pushActiveView(e){const t=this._activeView.get();e.type!==t.type&&(this.viewHistory.push(t),this._activeView.set(e))}popActiveView(){const e=this.viewHistory.pop()||this._defaultView;this._activeView.set(e)}replaceActiveView(e){e.type!==this._activeView.get().type&&this._activeView.set(e)}dispose(){this._sub.unsubscribe()}}class u extends d{constructor(e,t,i,r,n=s.V.classicAssistantLayout){super(t,i,{type:a.Type.default},{type:a.Type.startupPlaceholder},new Set([a.Type.readersAttention,a.Type.emogenie]),r,n),this.isHeaderNavigationEnabled=this._activeView.view((e=>e.type!==a.Type.feedback)),this._sub.add(this._activeView.subscribe((t=>{switch(t.type){case a.Type.settings:return void e.assistantSettingsShow();case a.Type.proofitRequest:return void e.proofitRequestFormShow();default:return}})))}activeViewHasAlerts(){switch(this._activeView.get().type){case a.Type.default:case a.Type.emogenie:case a.Type.readersAttention:return!0;default:return!1}}pushActiveView(e){const t=this._activeView.get();e.type!==t.type&&(t.type!==a.Type.startupPlaceholder&&this.viewHistory.push(t),this._activeView.set(e))}popActiveView(){const e=this.viewHistory.pop()||this._defaultView;e.type===a.Type.readersAttention?this._activeView.set({...e,caller:{type:a.ReadersAttention.Caller.Type.navigation}}):this._activeView.set(e)}}},59456:(e,t,i)=>{i.d(t,{W:()=>s});var a=i(63919);const s=e=>{const t=e.initialPositionOffset.get();return{initialPositionOffset:t,onDrag:i=>{e.updateInitialPositionOffset(a.E9.plus(t,a.E9.fromCartesian(i.translate)))}}}},41354:(e,t,i)=>{i.d(t,{d:()=>S,X:()=>W});var a=i(17771),s=i(57050),r=i(26328),n=i(40327),o=i(75003),l=i(40018),c=i(4390),d=i(93508),u=i(16118),p=i(77176),m=i(85985),h=i(66310),g=i(12126),v=i(40151),f=i(92843),w=i(5114),b=i(71249);var S,y=i(90361),_=i(66896),k=i(98403),A=i(19751),C=i(14601),E=i(28043),I=i(34383),M=i(15215),T=i(35416),x=i(83078),R=i(73975),L=i(38983),F=i(17889),P=i(32243),V=i(86718);function B(e,t){return L.h.combine(e.panelInfo.view(w.map((e=>({items:e.checklist,wordsCount:e.wordsCount})))),t,((e,t)=>{const i=c.p.reduce(new Map,((e,t)=>{return(0,s.zG)((i=t,(0,s.zG)(i.alert.extraProperties.takeawayBundleId,w.map(I.T.Id.create))),w.fold((()=>e),(i=>e.set(i,(e.get(i)||[]).concat([t])))));var i}))(t);return(0,s.zG)(e,w.fold((()=>new Map),(e=>new Map(P.AO(e.items).map((([t,a])=>[I.T.Id.create(t),N(a,e.wordsCount,i)]))))))}))}function O(e){return l.bZ.isTakeaway(e)&&e.takeawayIsLikelyToBeRead&&x.FX(l.TO.correctlyDetected)(e.takeawayFeedback)}function N(e,t,i){const a=I.T.Id.create(e.id),r=(i.get(a)||[]).map((e=>e.alert)),n=(0,s.zG)(r,b.hX((e=>!l.bZ.isTakeaway(e)||w.isNone(e.takeawayFeedback)||x.FX(l.TO.correctlyDetected)(e.takeawayFeedback))),(e=>e.every(O)?[]:e),F.nI);return{id:a,rank:e.rank,suggestionsView:(0,s.zG)(e.suggestionsCard,w.chain((e=>(0,s.zG)(n,w.map((t=>({title:e.title,miniTitle:e.miniTitle,miniLabel:w.none,alertIds:(0,s.zG)(t,(0,F.UI)((e=>e.id)))}))))))),emptyView:{checked:e.defaultCard.checked,title:e.defaultCard.title,miniTitle:e.defaultCard.miniTitle,miniLabel:"textLength"===e.defaultCard.kind?w.some(`${t} words`):w.none,card:H(e,t)}}}function H(e,t){const i="simple"===e.defaultCard.kind?V.f.Kind.simple:"textLength"===e.defaultCard.kind?V.f.Kind.textLength:(0,y.vE)(e.defaultCard.kind);return i===V.f.Kind.simple?{kind:i,explanation:e.defaultCard.description,details:e.defaultCard.details}:{kind:i,explanation:e.defaultCard.description,details:e.defaultCard.details,wordCount:t}}function U(e){return w.isNone(e.suggestionsView)&&e.emptyView.checked}function D(e){return o.aH.isReadersAttention(e)||o.aH.isReadersAttentionHelp(e)}!function(e){e.ok="ok",e.warning="warning",e.feedback="feedback"}(S||(S={}));class W{constructor(e,t,i,o,y){this._readersAttentionFeature=e,this._assistantLayoutVM=t,this._alertsCollection=i,this._alertsReader=o,this._assistantLensState=y,this._subs=new C.w,this._checklist=L.h.create(I.D.empty()),this.checklist=this._checklist.view(),this.panelState=(0,n.pipe)(this._readersAttentionFeature,w.fold((()=>L.h.create(w.none)),(e=>L.h.combine(e.panelInfo,this._checklist,((e,t)=>(0,n.pipe)(e,w.map((e=>({attentionScore:e.attentionScore,attentionScoreDescription:e.attentionScoreDescription,headerMessage:e.headerMessage,numChecklistItemsChecked:Array.from(t.values()).reduce(((e,t)=>U(t)?e+1:e),0),numChecklistItems:t.size}))))))))),this.predictionCardState=(0,n.pipe)(this._readersAttentionFeature,w.fold((()=>L.h.create(w.none)),(e=>function(e,t,i){return L.h.combine(e.panelInfo,t,((e,t)=>(0,n.pipe)(e,w.map((e=>({message:e.predictionMessage,icon:Array.from(t.values()).every(U)?S.ok:Array.from(t.values()).every((e=>(0,n.pipe)(e.suggestionsView,w.map(function(e){return t=>(0,n.pipe)(t.alertIds,(0,r.UI)((0,s.ls)(e.getById,w.filter((e=>l.bZ.isTakeaway(e)&&e.takeawayIsLikelyToBeRead&&w.isNone(e.takeawayFeedback))))),b.yW(w.isSome))}(i)),w.getOrElse((()=>e.emptyView.checked)))))?S.feedback:S.warning,alertsCount:z(t)}))))))}(e,this._checklist,this._alertsReader)))),this._subs.add(this._handleHeatmapVisibilityAndNavigationTracking()),this._subs.add(this._trackChecklistItemExpand()),(0,n.pipe)(this._readersAttentionFeature,x.bw((e=>{var t;this._subs.add((t=this._alertsCollection,t.pipe(d.O(c.p.empty),u.G(),p.U((([e,t])=>(0,n.pipe)(c.p.diff(e,t),c.p.Diff.filter((e=>l.bZ.isTakeaway(e.alert)))))),m.h((0,s.ff)(f.v.isEmpty)),p.U((e=>(0,n.pipe)(e,f.v.reduce(new Map,((e,t)=>e),((e,t,i)=>l.bZ.isTakeaway(i.alert)?e.set(i.alert.id,i.alert):e),((e,t)=>l.bZ.isTakeaway(t.alert)?e.set(t.alert.id,t.alert):e))))),h.w((e=>(0,n.pipe)(Array.from(e.values()),b.UI((e=>(0,n.pipe)(a.Y(w.option)({rawId:(0,n.pipe)(e,l.bZ.getRawId),feedback:e.takeawayFeedback}),w.map((e=>({rawId:e.rawId,feedback:e.feedback})))))),b.oA,(e=>e.length>0?g.D(e):v.E)))))).subscribe((t=>{e.takeawaysFeedbackStore.registerFeedback(t.rawId,t.feedback)}))),this._subs.add(B(e,this._alertsCollection).subscribe(k.wW(this._checklist)))})))}openPanel(e){this._assistantLayoutVM.pushActiveView({type:o.aH.Type.readersAttention,caller:e})}showHelp(){this._assistantLayoutVM.pushActiveView({type:o.aH.Type.readersAttentionHelp}),this._trackOnShowHelp()}dispose(){D(this._assistantLayoutVM.activeView.get())&&((0,n.pipe)(this._readersAttentionFeature,x.bw((e=>e.heatmap.visible.set(!1)))),this._trackOnReadersAttentionHide()),this._subs.unsubscribe()}_handleHeatmapVisibilityAndNavigationTracking(){return this._assistantLayoutVM.activeView.pipe(E.x(((e,t)=>e.type===t.type)),d.O(null),u.G()).subscribe((([e,t])=>{(0,n.pipe)(this._readersAttentionFeature,x.bw((i=>{D(t)&&!i.heatmap.visible.get()?i.heatmap.visible.set(!0):e&&D(e)&&!D(t)&&i.heatmap.visible.get()&&i.heatmap.visible.set(!1)}))),!o.aH.isReadersAttention(t)||e&&o.aH.isReadersAttentionHelp(e)?!D(t)&&e&&D(e)&&this._trackOnReadersAttentionHide():this._trackOnReadersAttentionShow(t.caller)}))}_trackChecklistItemExpand(){return this._assistantLensState.pipe(p.U((e=>(0,n.pipe)(w.fromPredicate(T.nL.hasItems)(e),w.map(T.nL.Prism.getLens().get),w.filter((e=>e.id===_.R.SpecialId.PredictionTakeaways)),w.chain(T.In.getActiveItemOfType(M.d.isChecklistItem)),w.map((e=>{return{id:(t=e.id,i=_.R.SpecialId.PredictionTakeaways,I.T.Id.create(t.substr(i.length+1)||t)),title:(0,n.pipe)(e.itemMeta.miniTitle,w.getOrElse((()=>e.itemMeta.title))),checked:j(e),numAlerts:M.d.isChecklistItemWithAlerts(e)?e.alerts.length:0};var t,i}))))),A.skipBy(w.getEq(R.Uz((e=>e.id))(R.yv))),p.U(w.getOrElse(s.gn)),m.h(y.fQ)).subscribe((e=>(0,n.pipe)(this._readersAttentionFeature,x.bw((t=>t.tracking.onChecklistItemExpand(e))))))}_trackOnReadersAttentionShow(e){(0,n.pipe)(this._readersAttentionFeature,w.chain((e=>(0,n.pipe)(a.g(w.option)(e.panelInfo.get(),G(this._checklist.get())),w.map((t=>({feature:e,predictionMessage:t[0].predictionMessage,checklistInfo:t[1]})))))),x.bw((({feature:t,predictionMessage:i,checklistInfo:a})=>{t.tracking.onOpen(a,i,this._getNumAlerts(),e)})))}_trackOnReadersAttentionHide(){(0,n.pipe)(this._readersAttentionFeature,w.chain((e=>(0,n.pipe)(G(this._checklist.get()),w.map((t=>({feature:e,checklistInfo:t})))))),x.bw((({feature:e,checklistInfo:t})=>{e.tracking.onClose(t,this._getNumAlerts())})))}_trackOnShowHelp(){(0,n.pipe)(this._readersAttentionFeature,x.bw((e=>{e.tracking.onHelpScreenShow()})))}_getNumAlerts(){return(0,n.pipe)(this._alertsCollection.get(),c.p.reduce({takeaway:0,nonTakeaway:0},((e,t)=>{const i=l.bZ.isTakeaway(t.alert),a=l.bZ.belongsToPredictionTakeaways(t.alert)&&!i;return{takeaway:e.takeaway+(i?1:0),nonTakeaway:e.nonTakeaway+(a?1:0)}})))}}function j(e){return M.d.isChecklistItemEmpty(e)&&e.itemMeta.checked}function G(e){const t=Array.from(e.values()).sort(((e,t)=>e.rank-t.rank));return(0,n.pipe)(t.map((e=>({checked:U(e),message:(0,n.pipe)(e.suggestionsView,w.map((e=>(0,n.pipe)(e.miniTitle,w.getOrElse((()=>e.title))))),w.getOrElse((()=>(0,n.pipe)(e.emptyView.miniTitle,w.getOrElse((()=>e.emptyView.title))))))}))),r.nI)}function z(e){return(0,n.pipe)(Array.from(e.values()),b.u4(0,((e,t)=>e+(0,n.pipe)(t.suggestionsView,w.map((e=>e.alertIds.length)),w.getOrElse((()=>0))))))}},31536:(e,t,i)=>{i.d(t,{X:()=>a});class a{constructor(e,t,i){this._contentScriptState=e,this._contentScriptActions=t,this.domain=i,this.state=this._contentScriptState.view((e=>({user:e.user,commonSettings:e.page,dynamicConfig:e.dynamicConfig}))),this.actions={toggleSite:(e,t)=>this._contentScriptActions.toggleSite({enabled:e,domain:t}),toggleDefs:this._contentScriptActions.toggleDefs,toggleAutocomplete:this._contentScriptActions.toggleAutocomplete,toggleAutocorrect:this._contentScriptActions.toggleAutocorrect,toggleReader:this._contentScriptActions.toggleReader,changeStrongDialect:this._contentScriptActions.changeStrongDialect,setDesktopIntegration:this._contentScriptActions.setDesktopIntegration}}}},68654:(e,t,i)=>{i.d(t,{fM:()=>E,_2:()=>I,yS:()=>M,qS:()=>T});var a=i(57050),s=i(40327),r=i(51972),n=i(16868),o=i(66896),l=i(40018),c=i(15646),d=i(35416),u=i(74364),p=i(66310),m=i(91402),h=i(40151),g=i(76974),v=i(77176),f=i(85985),w=i(78674),b=i(60797),S=i(28043),y=i(41398),_=i(22232),k=i(5114),A=i(83078),C=i(95195);function E(e,t,i,a,r){return{id:"changeAlertEffect",when:o.R.isWithAlertsId,what:d.nL.Effect.SwitchAlert.create(e.actionEvents.pipe(p.w((e=>{const n=t.get();if(!d.nL.hasCards(n))return m._(new _.ej("Cannot update state without cards"));switch(e.type){case c.lY.Type.alertMinicardButtonClick:return(0,s.pipe)(i.getRegistered(e.alertHighlight.alert.id),k.fold((()=>(r.warn("somehow we got click on non registered alert",e.alertHighlight.alert),h.E)),(()=>g.of(e.alertHighlight))));case c.lY.Type.cardMatchesNavigationButtonClick:const t=e.transitionTo;switch(t.kind){case"anotherAlert":return(0,s.pipe)("right"===e.direction?a.nextAlert(t.card):(0,s.pipe)(a.prevAlert(t.card),A.vx(a.anyRegisteredAlert(t.card))),k.fold((()=>h.E),(e=>g.of({alert:e,highlightIndex:0}))));case"sameAlert":return(0,s.pipe)(i.getRegistered(t.card.activeAlert.id),k.fold((()=>h.E),(()=>g.of({alert:t.card.activeAlert,highlightIndex:t.highlightIndex}))));default:return(0,_.vE)(t)}default:return h.E}})),v.U((e=>({alertHighlight:e,alertSource:l.l$.sidebar,options:{order:"lensOrder"}})))))}}function I(e,t,i){const a=e.pipe(f.h(d.nL.hasCards),w.b(0),v.U((e=>e)),f.h((e=>e.currentLens.items.size>0&&k.isNone(d.In.getActiveItem(e.currentLens))&&i.get())),v.U((e=>(0,s.pipe)(e.currentLens.items.getAt(0),k.chain(r.O.checksFeedItemsMapper((e=>k.some(e.activeAlert)),(e=>k.some(e.activeAlert)),(()=>k.none),(()=>k.none),(()=>k.none))),A.bw((()=>t.set(k.some(n.CV.skip))))))),b.oA,f.h((e=>e.state.type===l.bZ.State.Type.REGISTERED)),S.x());return{id:"focusFirstCardSideEffect",when:e=>e!==o.R.SpecialId.PredictionTakeaways&&e!==o.R.SpecialId.PredictionEmogenie,what:d.nL.Effect.SwitchLens.create(a.pipe(y.M(e),v.U((([e,t])=>({lensId:t.currentLens.id,alertSource:l.l$.text,options:{order:"lensOrder",toFocus:d.nL.Effect.FocusBehavior.focusAlert({alert:e,highlightIndex:0})}})))))}}function M(e,t,i){const r=e.pipe(v.U((e=>a=>e.type===u.ay.Type.AppliedAlertAnimationFinished&&a.currentLens.meta.filter(e.alert)&&d.nL.hasItems(a)?a.patch({currentLens:(0,s.pipe)(C.Y3((()=>l.bZ.isApplicableAlert(e.alert)?t.finishApplyAnimation([e.alert])(a.currentLens):a.currentLens),(e=>i.error("could not update lens state on applied animation finish",e))),C.fS((()=>a.currentLens))),alertSource:e.alert.state.source}):a)));return{id:"onAlertApply",when:a.W8,what:d.nL.Effect.Applicator.create(r)}}function T(e,t){return{id:"lensChangeEffect",when:a.W8,what:d.nL.Effect.SwitchLens.create(e.pipe(y.M(t),f.h((([e,t])=>e.lensId!==t)),v.U((([e])=>({lensId:e.lensId,alertSource:l.l$.sidebar,options:{order:"lensOrder",toFocus:e.focusFirstCard?d.nL.Effect.FocusBehavior.focusFirst:d.nL.Effect.FocusBehavior.noFocus}})))))}}},40033:(e,t,i)=>{i.d(t,{fA:()=>u,pL:()=>_});var a=i(40327),s=i(27378),r=i(41354),n=i(79921),o=i(19217);const l=({message:e,emoji:t,emojiId:i,icon:a,iconPartName:r})=>s.createElement("div",{className:o.insight},t&&i&&s.createElement("div",{className:o.insight__inline_icon},s.createElement(n.dy,{unicodeHexArray:[i],unicodeLiteral:t})),a&&s.createElement("div",{className:o.insight__inline_icon,"data-grammarly-part":r},a),s.createElement("div",{className:o.insight__inline_text},e));var c=i(53112);const d=()=>s.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16Z",fill:c.Z.red50}),s.createElement("path",{d:"M8.94827 4H7.05196L7.22242 10.1108H8.78208L8.94827 4ZM8.00225 12.8381C8.5477 12.8381 9.02071 12.3821 9.02498 11.8153C9.02071 11.2571 8.5477 10.8011 8.00225 10.8011C7.43975 10.8011 6.97526 11.2571 6.97952 11.8153C6.97526 12.3821 7.43975 12.8381 8.00225 12.8381Z",fill:c.Z.neutral0}));var u,p=i(46547),m=i(88326),h=i(90361),g=i(61922),v=i(3656),f=i(77176),w=i(18208),b=i(5739),S=i(31881),y=i(98029);!function(e){e.hidden="hidden",e.zero="zero",e.visible="visible"}(u||(u={}));const _=({predictionsVM:e})=>S.UI.mount(M,e.previewFlow),k=S.UI.Grid.make((({slots:e})=>s.createElement("div",{className:y.predictions},s.createElement("div",{className:y.predictions__header},"Predictions"),e.children))),A=({children:e,count:t,dataPartName:i})=>s.createElement(p.Z,{kind:"assistant-priority-lens",dataPartName:i,marginBottom:"12px"},s.createElement("div",{className:y.predictions__card},e,t>0&&s.createElement("div",{className:y.counterContainer},s.createElement(v.CL,null,t)))),C=S.UI.Node.make((({state:e,notify:t})=>s.createElement(m.M,{clickHandler:t("select")},s.createElement(b.F.Fragment,null,e.pipe(f.U((e=>s.createElement(A,{count:e.alertsCount,dataPartName:"emogenie-prediction-card"},s.createElement(l,{key:"tone",message:"off"===e.emotion.brandToneLabel?s.createElement(s.Fragment,null,"May sound ",s.createElement("span",{className:y.predictions__off_brand},"off-brand")):`Sounds ${e.emotion.name}`,emoji:e.emotion.emoji,emojiId:e.emotion.emojiId}))))))))),E=S.UI.Node.make((({state:e,notify:t})=>s.createElement(m.M,{clickHandler:t("select")},s.createElement(b.F.Fragment,null,e.pipe(f.U((e=>s.createElement(A,{count:e.alertsCount,dataPartName:"readers-attention-prediction-card"},s.createElement(l,{key:"readersAttention",message:w.kC(e.message),icon:e.icon===r.d.ok?s.createElement(g.JO.ValidationOk,{width:16}):e.icon===r.d.warning?s.createElement(d,null):e.icon===r.d.feedback?s.createElement(g.JO.Megaphone,{width:16}):(0,h.vE)(e.icon),iconPartName:e.icon===r.d.ok?"icon-ok":e.icon===r.d.warning?"icon-warning":e.icon===r.d.feedback?"icon-feedback":(0,h.vE)(e.icon)}))))))))),I=S.UI.Group.make({tone:T(C),readersAttention:T(E)}),M=S.UI.Union.make("kind",{[u.hidden]:S.UI.Node.empty,[u.zero]:S.UI.Node.empty,[u.visible]:S.UI.Composite.make(k,I)});function T(e){return{tag:"_tag",members:{Some:(0,a.pipe)(e,S.UI.contramapState((e=>e.value))),None:S.UI.Node.empty}}}},15090:(e,t,i)=>{i.d(t,{g:()=>a});var a,s=i(40327),r=i(85985),n=i(15646),o=i(83078);!function(e){e.createSubscription=function(e,t,i){return e.pipe(r.h(n.lY.isAlertApplyAction)).subscribe((e=>(0,s.pipe)(i(e.alertId),o.bw((e=>{"unlocked"===o.Fc(e.extraProperties.freePremium)&&t.freePremiumSuggestionAcceptButtonClick("assistant")})))))}}(a||(a={}))},45662:(e,t,i)=>{i.d(t,{c:()=>s});var a=i(41186);class s{constructor(e){this._highlights=e}addHighlight(e,t,i){return this._highlights.addHighlight(e,t,i)}updateHighlight(e,t,i){return this._highlights.updateHighlight(e,t,i)}removeHighlights(e){return this._highlights.removeHighlights(e)}recalculateHighlight(e){return this._highlights.recalculateHighlight(e)}recalculateAllHighlights(){return this._highlights.recalculateAllHighlights()}maintainConsistency(e,t=(e=>e),i=!1){return this._highlights.maintainConsistency(e,t,i)}hasHighlight(e){return this._highlights.hasHighlight(e)}getSelectedHighlightsTracker(e){return(0,a.H)({...e,highlights:this._highlights})}getGeometryByHighlightId(e){return this._highlights.geometry.get().get(e)}}},65060:(e,t,i)=>{i.d(t,{g:()=>a,m:()=>p});var a,s=i(57050),r=i(48439),n=i(36156),o=i(16892),l=i(48521),c=i(4890),d=i(73975),u=i(5114);function p(e){return e.id===a.id}!function(e){e.id="ReadersAttentionItemId",e.kind="ReadersAttentionItem",e.eq=d.f7(((e,t)=>e.hashCode()===t.hashCode()&&o.s.PositionState.eq.equals(e.positionState,t.positionState)&&l.o.VisualState.eq.equals(e.visualState,t.visualState))),e.hashCodeOwnFields=e=>(0,n.NO)({title:e.title,description:e.description,details:(0,s.zG)(e.details,u.fold((()=>"none"),(e=>`some(${e})`))),attentionScore:r.T.prism.reverseGet(e.attentionScore)}),e.hashCode=e.hashCodeOwnFields,e.create=function(t,i,a){return{id:e.id,kind:e.kind,renderOptions:{...c.j.defaultOptions,layoutDensity:c.j.Density.minimal},positionState:i,visualState:a,title:t.title,description:t.description,details:t.details,attentionScore:t.attentionScore,equals(t){return e.eq.equals(this,t)},hashCode(){return e.hashCode(this)}}}}(a||(a={}))},16314:(e,t,i)=>{var a;function s(e){return e.type===a.miniCardClick}function r(e){return e.type===a.ignoreButtonClick}function n(e){return e.type===a.viewMoreButtonClick}function o(e){return e.type===a.feedbackButtonClick}i.d(t,{Dy:()=>a,Vl:()=>s,l9:()=>r,Q:()=>n,RJ:()=>o}),function(e){e.miniCardClick="readersAttentionItemMiniCardClick",e.ignoreButtonClick="readersAttentionItemIgnoreButtonClick",e.viewMoreButtonClick="readersAttentionItemViewMoreButtonClick",e.feedbackButtonClick="readersAttentionItemFeedbackButtonClick"}(a||(a={}))},35501:(e,t,i)=>{i.d(t,{h:()=>h,r:()=>g});var a=i(27378),s=i(76457),r=i(3656),n=i(77176),o=i(48439),l=i(8125),c=i(5739),d=i(12187),u=i(16027),p=i(35630);const m=({progress:e})=>a.createElement(c.F.Fragment,null,e.pipe(n.U((e=>a.createElement(s.P,{percentage:o.g.prism.reverseGet(e),colorType:s.P.ColorType.neoBlue,iconSize:s.P.IconSize.extraSmall,theme:{radialProgressBar:p.circleProgress,radialProgressText:p.circleText}}))))),h=e=>u.UI.Node.make((({view:t})=>a.createElement(c.F.div,{...(0,d.Sh)(p.header,t("density").pipe(n.U((e=>"normal"===e)),n.U((0,l.RN)(p.normal,p.compact))))},a.createElement("div",{className:p.progressIcon},a.createElement(m,{progress:t("attentionScore").pipe(n.U(o.g.fromRatio))})),a.createElement(r.XY,{...(0,d.Sh)(p.title,"full"===e?p.full:void 0)},t("title"))))),g=u.UI.Node.make((({view:e})=>a.createElement(a.Fragment,null,a.createElement("div",{className:p.progressContainer,"data-name":"attention-score-progress-bar"},a.createElement(c.F.div,{className:p.progressBar,style:{width:e("attentionScore").pipe(n.U(o.g.fromRatio),n.U(o.g.prism.reverseGet),n.U((e=>`${e}%`)))}},a.createElement(r.XY,{className:p.progressValue,"data-name":"attention-score-progress-value"},e("attentionScore").pipe(n.U(o.g.fromRatio),n.U(o.g.prism.reverseGet),n.U((e=>`${e}%`)))))),a.createElement(r.XY,{className:p.description},e("attentionScoreDescription")))))},86620:(e,t,i)=>{i.d(t,{U:()=>a,C:()=>c});var a,s=i(27378),r=i(29511),n=i(33678),o=i(88056),l=i(95574);!function(e){let t;!function(e){e.isAppleSystem="isAppleSystem"}(t=e.SidebarFlag||(e.SidebarFlag={})),e.Flag={...t,...n.a.Flag},e.Context=s.createContext(o.Y.invariantContent("Environment"))}(a||(a={}));class c{constructor(e=(0,r.O)()){this._flags=new Set,this.actions={openUrl:e=>l.vM((()=>{document.location.href=e.toString()})),openPopup:e=>l.vM((()=>{const t=self.open(e.toString(),void 0,"noreferrer");t&&(t.opener=null)}))},e.config.systemInfo.os.isMac&&this._flags.add(a.Flag.isAppleSystem),this._flags.add(a.Flag.supportsSVGDominantBaseline),this._flags.add(a.Flag.onlyTrustedEvents)}has(e){return this._flags.has(e)}}},90989:(e,t,i)=>{i.d(t,{S:()=>a,I:()=>c});var a,s=i(27378),r=i(41572),n=i(88056),o=i(19429),l=i(35407);!function(e){e.Context=s.createContext(n.Y.invariantContent("SidebarTextResources")),e.holder=o.VF((()=>({logoText:"GRAMMARLY",plagiarismTooltip:"Scan for plagiarism",setGoalsTooltip:"Adjust goals",statisticsTooltip:"See performance"})))}(a||(a={}));const c=l.GG({denali:r.m.holder,sidebar:a.holder})},25575:(e,t,i)=>{i.d(t,{o:()=>d});var a=i(27378);if(3075==i.j)var s=i(53112);if(3075==i.j)var r=i(24606);if(3075==i.j)var n=i(3656);var o=i(96807);const l=({gnar:e,onSignIn:t,showSignInReminder:i})=>a.createElement(a.Fragment,null,a.createElement(n.CL,{className:o.cardText,color:s.Z.neutral90},i?"Sign back in to use Grammarly with ease and get access to key Grammarly features.":"To continue to apply Grammarly suggestions by simply clicking on them, you’ll need to create an account. Don’t worry, it’s free."),a.createElement(r.z,{kind:"success",size:"small",onClick:()=>{e.anonymousGDocsSidebarSignInCardButtonClick("gdocsSidebar"),t()}},"Sign in")),c=({gnar:e,onCreateAccount:t})=>a.createElement(a.Fragment,null,a.createElement(n.CL,{className:o.cardText,color:s.Z.neutral90},"To continue to apply Grammarly suggestions by simply clicking on them, you'll need to sign into your account."),a.createElement(r.z,{kind:"success",size:"small",onClick:()=>{e.anonymousGDocsSidebarSignUpCardButtonClick("gdocsSidebar"),t()}},"Create account")),d=({gnar:e,isUserLoggedOut:t,showSignInReminder:i,onSignIn:s,onCreateAccount:r})=>a.createElement("div",{className:o.cardContainer},a.createElement(n.H4,null,"Better Writing in Google Docs"),t?a.createElement(l,{gnar:e,onSignIn:s,showSignInReminder:i}):a.createElement(c,{gnar:e,onCreateAccount:r}))},10720:(e,t,i)=>{i.d(t,{US:()=>W,hz:()=>j,ux:()=>G});var a=i(57050),s=i(27378),r=i(51972),n=i(2027),o=i(66896),l=i(89894),c=i(68579),d=i(36156),u=i(71841),p=i(74238),m=i(99116),h=i(35416),g=i(18955),v=i(77176),f=i(98403),w=i(32952),b=i(93508),S=i(76974),y=i(2844),_=i(60797),k=i(24209),A=i(18625),C=i(66310),E=i(40151),I=i(85089),M=i(2834),T=i(95093),x=i(24713),R=i(85985),L=i(49708),F=i(17343),P=i(19751),V=i(5114),B=i(19962),O=i(5739),N=i(81531),H=i(31881),U=i(47476);const D=H.UI.Grid.make((({slots:e,view:t})=>s.createElement(O.F.div,{style:{marginBottom:t("spacing").pipe(v.U(l.ux.rem))}},e.children)));function W(e){switch(e){case o.R.SpecialId.PredictionTakeaways:case o.R.SpecialId.Priority:return.75;default:return 1}}const j=s.forwardRef((({state:e,cardsViewModel:t,cardsListScrollManager:i,connectorElements:o,header:l,footer:p,capabilities:m,comparator:v,readersAttentionItemViewModel:y},_)=>{const k=f.jw((e=>{let t=7;return t=31*t+(0,d.AC)(e.currentLens.id),t=31*t+(h.nL.hasItems(e)?1231:1237),t}),e).view((e=>h.nL.hasItems(e.get())?e.view(h.nL.Prism.getLens()):null)).view((e=>e?{state:e,spacing:W(e.get().id)}:null)),A=s.useContext(n.Dg).state;return s.createElement(g.d,{className:S.of(""),name:"cardlist",stateSyncListener:z(i,o,A),height:G(e,i,m),isMaster:!0},s.createElement(s.Fragment,null,l?s.createElement(O.F.div,{className:U.headerOrFooterWrapper,mount:e=>o.lens("title").set(V.fromNullable(e))},l):null,s.createElement(O.F.div,{mount:_},k.view((e=>{return e?H.UI.mount((s=e.spacing,(0,a.zG)(c.A.cardList(r.O.item(t.actionEvents)),H.UI.patch("content","cell","item")((e=>(0,a.zG)(H.UI.Knot.make(D,{children:e.child}),H.UI.squash,H.UI.contramapState((e=>({children:e,root:{spacing:s}}))),H.UI.mapAction((e=>e.action))))))),(e=>(0,a.zG)(r.O.createCardListFlow(y)(t,e,new w.xQ,u.i$(i).pipe(b.O(!1)),m,v)))(e.state)):null;var s}))),p?s.createElement(O.F.div,{className:U.headerOrFooterWrapper},p):null))})),G=(e,t,i)=>{const a=(0,m.Sd)(i)(e.view(h.nL.mapper((({currentLens:e,alertSource:t})=>V.some({currentLens:e,alertSource:t})))));return y.aj([a.pipe(_.oA,v.U((({currentLens:e})=>e.cardsHeight)),b.O(0)),t.paddingTop]).pipe(v.U((([e,t])=>e+t)))},z=(e,t,i)=>{const a=N.C8.Logging.getLogger("view_models");return k.T(A.P((()=>{e.paddingTop.set(0)})),t.view("viewport").pipe(C.w(V.fold((()=>E.E),(e=>I.YC(e).pipe(M.b((()=>a.debug("update card list viewport due to viewport resize event"))),T.T(i.pipe(x.j("dragging"),R.h((e=>!e)),C.w(f.b2.rafScheduler),M.b((()=>a.debug("update card list viewport due to drag end event"))))),v.U((()=>e.getBoundingClientRect())),v.U((e=>({top:p.r.FromWindowTop.ISO.wrap(e.top),height:e.height}))))))),M.b(f.wW(e.viewport))),t.view("scrollProvider").pipe(C.w(V.fold((()=>E.E),(t=>L.R(t,"scroll").pipe(v.U((()=>t.scrollTop)),b.O(t.scrollTop),M.b(f.wW(e.scrollTop)),F.h(f.PU)))))),t.view("title").pipe(C.w(V.fold((()=>S.of(B.UL.empty)),(e=>I.YC(e)))),v.U((e=>e.height)),P.shareReplay({bufferSize:1,refCount:!0}),M.b(f.wW(e.paddingTop))),t.view("scrollConsumer").pipe(C.w(V.fold((()=>E.E),(t=>e.scrollOffset.pipe(M.b((e=>{t.scrollTop+=e})))))))).pipe(F.h(void 0))}},68340:(e,t,i)=>{i.d(t,{C:()=>F,S:()=>L});var a=i(40327),s=i(18756),r=i(27378),n=i(51972),o=i(10720),l=i(101),c=i(66896),d=i(40489),u=i(25975),p=i(18955),m=i(98403),h=i(60797),g=i(77176),v=i(19962),f=i(5114),w=i(5739),b=i(31881),S=i(74880),y=i(57050),_=i(73582),k=i(38819),A=i(19106),C=i(30509);const E=({upgradeViewModel:e})=>{const t=e.advancedAlerts.pipe(g.U((0,y.ls)(f.map((e=>({count:e.count,alerts:e.alerts()}))))));return r.createElement(w.F.div,{className:C.premiumLens},b.UI.mount(k.r,b.Z.fromSideEffect((t=>{"upgrade"===t.action.action.action.kind&&(A.J.getPremiumButtonClick("gDocsSidebarAssistantSuccessView","GoPremium"),e.openUpgradeUrl(_.L.Place.gdocsSidebarSuccessView))}),t)))};var I=i(41572),M=i(89379),T=i(28378),x=i(879);const R=({successLensViewModel:e})=>{const t=(0,M.hM)((0,M.wK)(e.successState.view("type"),r.useContext(I.m.Context)));return r.createElement(w.F.div,{className:x.successLens},b.UI.mount(T.q,t))},L=r.forwardRef((({state:e,cardsViewModel:t,upgradeViewModel:i,cardsListScrollManager:a,capabilities:l,upgradeHookFlow:p,...h},g)=>{const v=m.jw((e=>{let t=7;return t=31*t+(0,s.AC)(e.currentLens.id),t=31*t+(u.v.WithSuccess.State.isInSuccess(l)(e)?1231:1237),t}),e);return r.createElement(F,{ref:g},(e=>r.createElement(w.F.Fragment,null,v.view((s=>{const m=s.get();return m.currentLens.id===c.R.SpecialId.Premium?r.createElement(E,{upgradeViewModel:i}):u.v.WithSuccess.State.isInSuccess(l)(m)?r.createElement(R,{successLensViewModel:h.successLensViewModel}):r.createElement("div",null,r.createElement(o.hz,{state:s,cardsViewModel:t,cardsListScrollManager:a,connectorElements:e,header:b.UI.mount(d.n.TogglablePanel,p),comparator:n.O.listItemOrd,capabilities:l,readersAttentionItemViewModel:f.none}))})))))})),F=r.forwardRef((({children:e,onClick:t,className:i=S.cardList,footer:s},n)=>{const o=p.d.Elements.create(),c=(0,a.pipe)(o.view("viewport"),h.oA,g.U(v.UL.fromEl));return r.createElement("div",{onClick:t,className:i,ref:e=>{"function"==typeof n?n(e):n&&(n.current=e);const t=f.fromNullable(e);o.lens("scrollConsumer").set(t),o.lens("scrollProvider").set(t),o.lens("viewport").set(t)}},r.createElement(l.l.RootVirtualContainer,{name:"cardListConnector",viewport:c},e(o)),s)}))},1309:(e,t,i)=>{i.d(t,{Z:()=>c});var a=i(27378);if(3075==i.j)var s=i(62295);if(3075==i.j)var r=i(61922);if(3075==i.j)var n=i(66896);if(3075==i.j)var o=i(5739);var l=i(57731);const c=({lensPreviewViewModel:e})=>{const t=e.getLens(n.R.SpecialId.AllAlerts).view((e=>e.count));return a.createElement(o.F.div,{className:l.footer},a.createElement(d,{activeAlerts:t}))},d=({activeAlerts:e})=>a.createElement(o.F.Fragment,null,e.view((e=>e>0?a.createElement(s.x.OutcomeCounter,{count:e,theme:{counterWrapper:l.counterWrapper,counterContent:l.counter}}):a.createElement(r.JO.CheckmarkOutcomes,{className:l.counterCheckmarkIcon}))))},74928:(e,t,i)=>{i.d(t,{$l:()=>I});var a=i(27378);if(3075==i.j)var s=i(77394);if(3075==i.j)var r=i(90989);if(3075==i.j)var n=i(22667);if(3075==i.j)var o=i(64757);if(3075==i.j)var l=i(61922);if(3075==i.j)var c=i(81301);if(3075==i.j)var d=i(3656);if(3075==i.j)var u=i(66896);if(3075==i.j)var p=i(40018);if(3075==i.j)var m=i(40743);if(3075==i.j)var h=i(87667);if(3075==i.j)var g=i(92644);if(3075==i.j)var v=i(15774);if(3075==i.j)var f=i(89186);if(3075==i.j)var w=i(84317);if(3075==i.j)var b=i(77176);if(3075==i.j)var S=i(85985);if(3075==i.j)var y=i(22232);if(3075==i.j)var _=i(8125);if(3075==i.j)var k=i(5114);if(3075==i.j)var A=i(12187);var C=i(31881),E=i(21831);const I=({state:e,navigationViewModel:t,modalManager:i,lensPreviewViewModel:r,features:n})=>{switch(n.priorityLens.kind){case s.h.Kind.dropdown:return a.createElement(M,{state:e,navigationViewModel:t,modalManager:i,lensPreviewViewModel:r});case s.h.Kind.priorityToggle:return a.createElement(T,{state:e,navigationViewModel:t,modalManager:i,lensPreviewViewModel:r,defaultMode:n.priorityLens.defaultMode});case s.h.Kind.none:return a.createElement(x,{navigationViewModel:t,modalManager:i});default:(0,y.vE)(n.priorityLens)}},M=({state:e,navigationViewModel:t,modalManager:i,lensPreviewViewModel:s})=>a.createElement("div",{className:E.priorityLensHeader},a.createElement(R,{navigationViewModel:t,modalManager:i}),a.createElement("div",{className:E.prioritySwitchWrapper},C.UI.mount(h.n.Switch,(0,g.i)(s,t,e.pipe(b.U((e=>e.currentLens.id))))))),T=({state:e,navigationViewModel:t,modalManager:i,lensPreviewViewModel:s,defaultMode:r})=>a.createElement("div",{className:E.priorityLensHeader},a.createElement(R,{navigationViewModel:t,modalManager:i}),a.createElement("div",{className:E.prioritySwitchFlatWrapper},C.UI.mount(f.B.DefaultHeader,(0,w.HP)(t,e.pipe(b.U((e=>e.currentLens.id)),S.h((0,_.Kg)(u.R.isPriority,u.R.isAllAlerts))),"priority"===r?v.H.LensMode.priority:v.H.LensMode.all,"compact",s,10)))),x=({navigationViewModel:e,modalManager:t})=>a.createElement("div",{className:E.defaultHeader},a.createElement(R,{navigationViewModel:e,modalManager:t}),a.createElement("div",{...(0,A.Sh)(E.lensNavigation,E.disabledLensNavigation)},C.UI.mount(m.C,C.Z.fromSideEffect((t=>{e.events.next({type:"switchToLens",id:t.lens.id,focusFirst:!1,actionSource:p.l$.sidebar})}),{activeLensId:k.none,previews:Object.values(e.lensPreviews.get()).filter((e=>e.id!==u.R.SpecialId.Vox)),disabled:!1})))),R=({navigationViewModel:e,modalManager:t})=>{const i=a.useContext(r.S.Context),s=t.state.view(k.exists((e=>e.instance.type===c.dC.SetGoals)));return a.createElement("div",{className:E.head},a.createElement("div",{className:E.headerGroup},a.createElement(n.K,{className:E.logoIcon,size:18}),a.createElement(d.H5,{className:E.logoText},i.logoText)),a.createElement(o.zx.Flat,{name:"setGoals",className:E.setGoalsButton,title:i.setGoalsTooltip,titleAlign:"bottomCenter",active:s,disabled:s,onClick:()=>e.events.next({type:"setGoals"})},a.createElement(l.JO.GoalsEmpty,{width:24})),a.createElement("div",{className:E.headerGroup},a.createElement("div",{className:E.divider}),a.createElement(o.zx.Flat,{name:"closeSidebar",onClick:()=>e.events.next({type:"toggleSidebar",actionSource:p.l$.sidebar})},a.createElement(l.JO.Close,{width:16}))))}},1473:(e,t,i)=>{i.d(t,{R:()=>c});var a=i(27378);if(3075==i.j)var s=i(22667);if(3075==i.j)var r=i(3656);if(3075==i.j)var n=i(40018);var o=i(44617);const l=()=>a.createElement("svg",{width:"11",height:"11",viewBox:"0 0 12 13",fill:"none"},a.createElement("path",{d:"M0.5 1L6 6.5M11.5 12L6 6.5M6 6.5L11.5 1M6 6.5L0.5 12",strokeLinecap:"round",strokeWidth:"1.5"})),c=({navigationViewModel:e})=>a.createElement("div",{className:o.header},a.createElement("div",{className:o.headerGroup},a.createElement("div",{className:o.logoIcon},a.createElement(s.K,null)),a.createElement(r.H5,null,"Grammarly")),a.createElement("div",{className:o.headerGroup},a.createElement("div",{className:o.closeButton,onClick:()=>{e.events.next({type:"toggleSidebar",actionSource:n.l$.sidebar})},role:"button"},a.createElement(l,null))))},80550:(e,t,i)=>{i.d(t,{L:()=>o});var a=i(57050),s=i(27378),r=i(5114),n=i(5739);const o=({modalManager:e})=>s.createElement(n.F.Fragment,null,e.state.view((0,a.ls)(r.map((({component:e})=>e)),r.toNullable)))},11177:(e,t,i)=>{i.d(t,{P:()=>o});var a=i(27378),s=i(50790),r=i(30543),n=i(32380);const o={unauthorizedError:(e,t)=>a.createElement(r.s.UnauthorizedError,{action:t("gotoLogin")}),offline:()=>a.createElement(l,null),alertUndo:(e,t)=>a.createElement(n.A.Standard,{action:t("undo"),params:e.args.params})},l=()=>a.createElement(s.DI.TitledContent,{title:"Lost Connection"},"Your Internet session was interrupted.")},92132:(e,t,i)=>{i.d(t,{Q:()=>l});var a=i(27378),s=i(15073),r=i(60797),n=i(95300),o=i(5114);const l=({children:e,remSize:t,setter:i})=>(c+=1,a.useEffect((()=>{const e=t.subscribe((e=>{d.next(o.some(e)),i(o.some(e))}));return()=>{e.unsubscribe(),c-=1,0===c&&(d.next(o.none),i(o.none))}}),[t]),a.createElement(s.u.Context.Provider,{value:d.pipe(r.oA)},e));let c=0;const d=new n.X(o.none)},9025:(e,t,i)=>{i.d(t,{_:()=>r});var a=i(27378);if(3075==i.j)var s=i(94071);const r=({children:e,className:t})=>a.createElement("div",{className:t,style:{position:"fixed",right:"0px",top:"0px",bottom:"0px",width:s.xK,zIndex:1e3,background:"white",display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100vh"}},e)},94071:(e,t,i)=>{i.d(t,{iB:()=>a,xK:()=>s,H2:()=>r,kl:()=>n});const a=".docs-companion-sidebar",s="300px";var r;!function(e){e.selector=".companion-guest-app-switcher .app-switcher-button",e.selectedClass="app-switcher-button-selected",e.selectedSelector=`.${e.selectedClass}`,e.activeClass="app-switcher-button-active",e.hoverClass="app-switcher-button-hover",e.disabledClass="app-switcher-button-disabled"}(r||(r={}));const n=".companion-about-panel-button"},94663:(e,t,i)=>{i.d(t,{I:()=>n});var a=i(5802),s=i(41966);const r={priority:a.P.Priority.highest,timeout:a.P.TimeoutDisabled,position:a.P.Position.top,viewType:a.P.ViewType.standard};var n;!function(e){e.createFactory=function(){return{alertUndo:s.r.createBuilder().build({priority:a.P.Priority.low,timeout:a.P.DefaultTimeout,position:a.P.Position.bottomRight,viewType:a.P.ViewType.standard}),unauthorizedError:s.r.createBuilder().build(r),offline:s.r.createBuilder().build(r)}}}(n||(n={}))},70091:(e,t,i)=>{if(i.d(t,{U9:()=>F,jv:()=>V}),3075==i.j)var a=i(32138);var s=i(27378);if(3075==i.j)var r=i(3295);if(3075==i.j)var n=i(86620);if(3075==i.j)var o=i(90989);if(3075==i.j)var l=i(25575);if(3075==i.j)var c=i(68340);if(3075==i.j)var d=i(1309);if(3075==i.j)var u=i(74928);if(3075==i.j)var p=i(1473);if(3075==i.j)var m=i(80550);if(3075==i.j)var h=i(11177);if(3075==i.j)var g=i(92132);if(3075==i.j)var v=i(9025);if(3075==i.j)var f=i(50981);var w=i(48189),b=i(49468);if(3075==i.j)var S=i(64078);if(3075==i.j)var y=i(42103);if(3075==i.j)var _=i(33678);if(3075==i.j)var k=i(15073);if(3075==i.j)var A=i(41572);if(3075==i.j)var C=i(47861);if(3075==i.j)var E=i(90845);if(3075==i.j)var I=i(76974);if(3075==i.j)var M=i(8313);var T=i(79850),x=i(75259),R=i(67129);const L=({state:e,gnar:t,user:i,anonymousFrictionGDocsService:n,cardsViewModel:o,navigationViewModel:m,successLensViewModel:g,upgradeViewModel:f,cardsListScrollManager:w,notificationManager:b,lensPreviewViewModel:S,modalManager:y,features:_,capabilities:k,upgradeHookFlow:A})=>{const[E,I]=s.useState(i.view("anonymous").get());return s.useEffect((()=>{const e=i.view("anonymous").subscribe((e=>{I(e)}));return()=>e.unsubscribe()}),[]),E&&n.peekTreatment()?s.createElement(v._,{className:R.sidebarContainer},s.createElement(p.R,{navigationViewModel:m}),s.createElement("section",{className:R.sidebarContent},s.createElement(l.o,{gnar:t,showSignInReminder:n.isInTreatmentWithOneLockedSuggestion,isUserLoggedOut:n.anonymousUserType===r.q.LoggedOut,onCreateAccount:()=>{self.open((0,a.Xc)("signupHook","gdocsSidebarAnonymousCard"))},onSignIn:()=>{self.open((0,a.s7)())}}))):s.createElement(v._,{className:R.sidebarContainer},s.createElement(u.$l,{state:e,navigationViewModel:m,modalManager:y,lensPreviewViewModel:S,features:_}),s.createElement(c.S,{cardsViewModel:o,state:e,successLensViewModel:g,upgradeViewModel:f,cardsListScrollManager:w,capabilities:k,upgradeHookFlow:A}),"none"!==_.priorityLens.kind?null:s.createElement(d.Z,{lensPreviewViewModel:S}),s.createElement(C.i,{key:"notificationCenter",manager:b,views:h.P,theme:{grid:{container:x.container,bottomLeft:x.bottomLeft,bottomRight:x.bottomRight,top:x.top},view:{wrapper:x.notificationWrapper}}}))};function F(e){return({integration:t,sidebarReady:i,shortenItFeature:a,ethicalAIFeature:r,cardEvents:o,user:l,anonymousFrictionGDocsService:c})=>()=>{const d=t.engine,u=new n.C,{lensState:p,cardsViewModel:h,navigationViewModel:g,successLensViewModel:v,upgradeViewModel:w,dispose:b,cardsListScrollManager:y,notificationManager:_,lensPreviewViewModel:k,modalManager:A,capabilities:C,upgradeHookFlow:I}=(0,f.G)(d,t.denaliViewAdapter,e,t.connectionState,t.gnar,t.user,l,t.document.settings.lens("selectedLens"),t.features,i,a,r,o,t.experimentClient);return E.P.useEffectOnWillUnmount((()=>{d.shutdown(),b()})),s.createElement(P,{environment:u},s.createElement(L,{anonymousFrictionGDocsService:c,user:l,gnar:t.gnar,state:p,cardsViewModel:h,navigationViewModel:g,successLensViewModel:v,upgradeViewModel:w,cardsListScrollManager:y,notificationManager:_,lensPreviewViewModel:k,modalManager:A,features:t.features,capabilities:C,upgradeHookFlow:I}),s.createElement(m.L,{modalManager:A}),s.createElement(S.X,null))}}const P=({environment:e,children:t})=>{const i=s.useRef((0,o.I)(A.m.getConfig(e.has(n.U.Flag.isAppleSystem)?"mac":"windows")));return s.createElement(g.Q,{remSize:I.of(16),setter:e=>k.u.setRootCssVar(document.documentElement,e)},s.createElement(n.U.Context.Provider,{value:e},s.createElement(_.a.Context.Provider,{value:e},s.createElement(o.S.Context.Provider,{value:i.current.sidebar},s.createElement(A.m.Context.Provider,{value:i.current.denali},s.createElement(M.TG.ContextMock,null,s.createElement(y.G.DefaultProvider,null,s.createElement(V,null,t))))))))},V=({children:e})=>s.createElement(s.Fragment,null,s.createElement(b.o,{"data-grammarly-part":"gdocs-sidebar",className:T.wrapper},e),s.createElement(w.p,{thin:!0,thinItalic:!0,regular:!0,italic:!0,bold:!0,boldItalic:!0,semiBold:!0}))},16868:(e,t,i)=>{i.d(t,{hp:()=>O,CV:()=>N,k9:()=>H});var a=i(57050),s=i(40327),r=i(74850),n=i(59443),o=i(40018),l=i(66896),c=i(18625),d=i(60797),u=i(77176),p=i(66310),m=i(17343),h=i(98403),g=i(91224),v=i(40151),f=i(38194),w=i(76974),b=i(24209),S=i(93508),y=i(16118),_=i(85985),k=i(28043),A=i(41398),C=i(83401),E=i(598),I=i(25980),M=i(58562),T=i(74238),x=i(99116),R=i(4890),L=i(35416),F=i(5114),P=i(83078),V=i(38983);class B{constructor(e,t){this._cardPositions=e,this._markPositions=t,this._log=r.Y.create(B.name)}alignCardToMark({id:e,renderOptions:{features:t},activeAlert:i,activeHighlightIndex:a},r){return c.P((()=>this._markPositions.getMarkAlertPosition({alert:i,highlightIndex:a}))).pipe(d.oA,u.U((i=>(0,s.pipe)(this._cardPositions.getCardSuggestedPositionInViewport(e,t.has(R.j.Features.showLabel),F.some(i),"cardContentTop"),F.fromEither))),d.oA,p.w((i=>this._cardPositions.setCardPosition(e,t.has(R.j.Features.showLabel),!0,i.top))),m.h(h.PU),g.K((e=>(this._log.error("Cannot align card to mark",e),v.E))),f.B())}alignMarkTo(e,t,i,a){return c.P((()=>w.of((0,s.pipe)(this._cardPositions.getCardSuggestedPositionInViewport(e.id,e.renderOptions.features.has(R.j.Features.showLabel),F.some(i),"cardContentTop"),F.fromEither)).pipe(d.oA))).pipe(p.w((i=>b.T(this._markPositions.moveAlertHighlightInViewport(t,T.r.FromWindowTop.ISO.modify(T.L.concatC(i.contentOffset))(i.top),n.uq.initial),this._cardPositions.setCardPosition(e.id,e.renderOptions.features.has(R.j.Features.showLabel),!0,i.top)))),m.h(h.PU),g.K((e=>(this._log.error("Cannot align mark to suggested position",e),v.E))),f.B())}alignMarkToCard({id:e,renderOptions:{features:t},activeHighlightIndex:i,activeAlert:a},r,o=F.none){return c.P((()=>w.of((0,s.pipe)(this._cardPositions.getCardSuggestedPositionInViewport(e,t.has(R.j.Features.showLabel),o,"cardContentTop"),F.fromEither)).pipe(d.oA))).pipe(p.w((s=>b.T(this._markPositions.moveAlertHighlightInViewport({alert:a,highlightIndex:i},T.r.FromWindowTop.ISO.modify(T.L.concatC(s.contentOffset))(s.top),n.uq.initial),this._cardPositions.setCardPosition(e,t.has(R.j.Features.showLabel),!0,s.top)))),m.h(h.PU),g.K((e=>(this._log.error("Cannot align mark to card",e),v.E))),f.B())}alignCardTo(e,t,i){const a=i!==I.v.Animation.NO_ANIMATION;return c.P((()=>w.of((0,s.pipe)(this._cardPositions.getCardSuggestedPosition(e.id,e.renderOptions.features.has(R.j.Features.showLabel),F.some(t),"cardTop"),F.fromEither)).pipe(d.oA))).pipe(p.w((t=>this._cardPositions.setCardPosition(e.id,e.renderOptions.features.has(R.j.Features.showLabel),a,t.top))),m.h(h.PU),g.K((e=>(this._log.error("Cannot align card to required top",e),v.E))),f.B())}}const O=(e,t,i,a,s,r)=>new B(M.eZ.getSuperScrollMapper(e,a,V.h.create(16)),M.UC.getMapper(t,s,r));var N;!function(e){e.skip="skip"}(N||(N={}));const H=(e,t,i,r,n,c=h.b2.rafScheduler)=>{const d=(e,i,a,s)=>{if(a===o.l$.text)return t.alignCardToMark(e,i?I.v.Animation.ANIMATE_ALL:I.v.Animation.NO_ANIMATION,!0);if(a===L.h8.forceText)return t.alignCardToMark(e,I.v.Animation.NO_ANIMATION,!1);{const r=a===o.l$.sidebar;return t.alignMarkToCard(e,r?i?I.v.Animation.ANIMATE_ALL:I.v.Animation.ANIMATE_MARK:I.v.Animation.NO_ANIMATION,s)}},g=b.T(e.view(L.nL.mapper((({currentLens:e,alertSource:t})=>F.some({currentLens:e,alertSource:t})))).pipe(S.O(F.none),u.U(F.map((e=>e.currentLens.id))),y.G(),_.h((([e,t])=>(0,s.pipe)(P.vB(((e,t)=>e!==t))(e,t),F.exists(a.yR)))),m.h(F.none)),e.view(L.nL.mapper((({currentLens:e,alertSource:t})=>F.some({currentLens:e,alertSource:t})))).pipe(_.h(F.exists((({currentLens:e})=>(0,x.Bk)(n)(e)))),u.U(F.chain((({currentLens:e,alertSource:t})=>(0,s.pipe)(r(e),F.filter(n.isValidToAlign),F.map((i=>({item:i,source:t,lensId:e.id}))))))))).pipe(k.x((0,a.ls)(P.vB(((e,t)=>e.lensId===t.lensId&&e.item.activeAlert.id===t.item.activeAlert.id&&e.item.visualState.transition.type===t.item.visualState.transition.type&&e.item.activeHighlightIndex===t.item.activeHighlightIndex)),F.exists(a.yR))),S.O(F.none),y.G(),u.U((([e,t])=>(0,s.pipe)(t,F.map((i=>({item:i.item,source:i.source,animate:(0,s.pipe)(e,P.wo((({lensId:e})=>e===i.lensId))),suggestedPosition:(0,s.pipe)(e,F.filter((e=>!n.isScheduledToDispose(e.item))),F.chain((e=>(0,s.pipe)(t,F.map((t=>[e.item,t.item]))))),F.filter((([e,t])=>t.lensId===e.lensId&&t.positionState.absTop>e.positionState.absTop)),F.map((([e,t])=>T.r.FromWindowTop.ISO.wrap(t.positionState.absTop))))})))))),p.w(F.fold((()=>v.E),c)),A.M(i),p.w((([{item:e,source:t,animate:a,suggestedPosition:r},n])=>(0,s.pipe)(n,F.fold((()=>d(e,a,t,r)),(t=>(i.set(F.none),t===N.skip?C.C:d(e,a,t,r))))))));return{id:"alignmentSideEffect",when:l.R.isWithAlertsId,what:L.nL.Effect.Applicator.create(g.pipe(E.c(C.C)))}}},93829:(e,t,i)=>{if(i.d(t,{C:()=>n}),3075==i.j)var a=i(9671);if(3075==i.j)var s=i(15090);if(3075==i.j)var r=i(9922);class n{constructor(e,t,i){this._cardsViewModel=e,this._gnar=t,this._getAlertById=i,this._subs=new r.w.Keeper,this.subscribeToSidebarCardActions()}subscribeToSidebarCardActions(){this._subs.push(s.g.createSubscription(this._cardsViewModel.actionEvents,this._gnar,this._getAlertById),(0,a.t)(this._cardsViewModel.actionEvents,this._gnar,"gdocs"))}dispose(){this._subs.dispose()}}},51540:(e,t,i)=>{i.d(t,{A7:()=>A,uo:()=>C,Ng:()=>E,CH:()=>I});var a=i(57050),s=i(66896),r=i(40018),n=i(55935),o=i(66310),l=i(40151),c=i(76974),d=i(85985),u=i(41398),p=i(77176);if(3075==i.j)var m=i(28043);if(3075==i.j)var h=i(598);if(3075==i.j)var g=i(83401);if(3075==i.j)var v=i(13444);if(3075==i.j)var f=i(57091);if(3075==i.j)var w=i(16118);var b=i(35416);if(3075==i.j)var S=i(25975);var y=i(5114);if(3075==i.j)var _=i(83078);if(3075==i.j)var k=i(38983);function A(e,t,i){return{id:"alertSwitchingByClickSideEffect",when:a.W8,what:b.nL.Effect.SwitchAlert.create(e.alertClicked.pipe(n.T(1),o.w(y.fold((()=>l.E),c.of)),d.h((e=>!i||e.alert.lensId!==s.R.SpecialId.Premium)),u.M(t.pipe(d.h(b.nL.hasCards),p.U((e=>e.currentLens.id))),((e,t)=>({...e,lensId:t}))),p.U((({alert:e,highlightIndex:t,lensId:i})=>({alertHighlight:{alert:e,highlightIndex:t},alertSource:r.l$.text,options:{lensId:i,order:"textOrder"}})))))}}function C(e,t){return{id:"connectionManager",when:()=>!0,what:b.nL.Effect.SwitchAlert.create(e.pipe(p.U((e=>e.online)),m.x(),o.w((e=>e?l.E:t.enqueue("offline",{reconnectTime:k.h.create(10)}))),h.c(g.C)))}}function E(e,t,i){const a=e.getLens(s.R.SpecialId.Premium).pipe(p.U((e=>e.count>0)),m.x());return{id:"autoSwitchToPremiumLensSideEffect",when:e=>e===s.R.SpecialId.AllAlerts||e===s.R.SpecialId.Priority,what:b.nL.Effect.SwitchLens.create(t.pipe(p.U(S.v.WithSuccess.State.isInSuccess(i)),m.x(),v.g(1),f.a(a),d.h((([e,t])=>e&&t)),p.U((()=>({lensId:s.R.SpecialId.Premium,alertSource:r.l$.sidebar,options:{toFocus:b.nL.Effect.FocusBehavior.noFocus}})))))}}function I(e,t){const i=e.getLens(s.R.SpecialId.AllAlerts).pipe(p.U((e=>e.count>0)),m.x()),n=e.getLens(s.R.SpecialId.Priority).pipe(p.U((e=>e.count>0)),m.x());return{id:"autoSwitchFromPremiumLensSideEffect",when:a.W8,what:b.nL.Effect.SwitchLens.create(t.pipe(p.U((e=>e.currentLens.id)),m.x(),w.G(),d.h((([e,t])=>t===s.R.SpecialId.Premium)),p.U((([e,t])=>e)),f.a(i,n),p.U((([e,t,i])=>e===s.R.SpecialId.Priority&&i?y.some(s.R.SpecialId.Priority):e===s.R.SpecialId.AllAlerts&&t?y.some(s.R.SpecialId.AllAlerts):y.none)),d.h(y.isSome),p.U(_.MH),p.U((e=>({lensId:e,alertSource:r.l$.sidebar,options:{toFocus:b.nL.Effect.FocusBehavior.noFocus}})))))}}},7680:(e,t,i)=>{i.d(t,{D:()=>a});var a,s=i(40327),r=i(73353),n=i(5114),o=i(55415);!function(e){e.updateCitationStyle=(e,t)=>i=>{const a=(0,s.pipe)(e.defaultContext.get(),n.getOrElse((()=>r.R$.defaultContextFallback))),l=(0,s.pipe)(e.context.get(),r.R$.OutcomeContext.withCitationStyle(i));(0,s.pipe)(l,e.updateContext)&&t.goalsFormSuccess((0,s.pipe)(l.domain,n.getOrElse((()=>a.domain))),(0,s.pipe)(l.goals,n.getOrElse((()=>a.goals)),(e=>Array.from(e))),"essayDetectionCard",(0,s.pipe)(l.outcomeContext,n.map(o.ei("type")),n.toUndefined),void 0,(0,s.pipe)(l.outcomeContext,n.map(o.ei("citation")),n.toUndefined),void 0)}}(a||(a={}))},50981:(e,t,i)=>{if(i.d(t,{G:()=>ve}),3075==i.j)var a=i(57050);if(3075==i.j)var s=i(40327);if(3075==i.j)var r=i(50622);if(3075==i.j)var n=i(58809);if(3075==i.j)var o=i(32154);if(3075==i.j)var l=i(51972);if(3075==i.j)var c=i(10299);if(3075==i.j)var d=i(77394);if(3075==i.j)var u=i(86620);if(3075==i.j)var p=i(94663);if(3075==i.j)var m=i(93829);if(3075==i.j)var h=i(62346);if(3075==i.j)var g=i(7680);if(3075==i.j)var v=i(37290);if(3075==i.j)var f=i(73582);if(3075==i.j)var w=i(33953);if(3075==i.j)var b=i(88661);if(3075==i.j)var S=i(92783);if(3075==i.j)var y=i(44618);if(3075==i.j)var _=i(90361);if(3075==i.j)var k=i(81301);if(3075==i.j)var A=i(61813);if(3075==i.j)var C=i(66896);if(3075==i.j)var E=i(13313);if(3075==i.j)var I=i(70023);if(3075==i.j)var M=i(40489);if(3075==i.j)var T=i(98403);if(3075==i.j)var x=i(76974);if(3075==i.j)var R=i(77176);if(3075==i.j)var L=i(85985);if(3075==i.j)var F=i(2834);if(3075==i.j)var P=i(17343);if(3075==i.j)var V=i(28043);if(3075==i.j)var B=i(66310);if(3075==i.j)var O=i(40151);if(3075==i.j)var N=i(21619);if(3075==i.j)var H=i(54216);if(3075==i.j)var U=i(85395);if(3075==i.j)var D=i(48052);if(3075==i.j)var W=i(91549);if(3075==i.j)var j=i(4330);if(3075==i.j)var G=i(20594);if(3075==i.j)var z=i(35607);if(3075==i.j)var q=i(20291);if(3075==i.j)var K=i(34383);if(3075==i.j)var Z=i(11245);if(3075==i.j)var X=i(4890);if(3075==i.j)var Q=i(35416);if(3075==i.j)var $=i(25975);if(3075==i.j)var Y=i(73841);if(3075==i.j)var J=i(89770);if(3075==i.j)var ee=i(39920);if(3075==i.j)var te=i(17372);if(3075==i.j)var ie=i(74364);if(3075==i.j)var ae=i(27125);if(3075==i.j)var se=i(5114);if(3075==i.j)var re=i(83078);if(3075==i.j)var ne=i(95195);if(3075==i.j)var oe=i(8125);if(3075==i.j)var le=i(95574);if(3075==i.j)var ce=i(38983);if(3075==i.j)var de=i(81531);var ue=i(16027);if(3075==i.j)var pe=i(16868);if(3075==i.j)var me=i(51540);if(3075==i.j)var he=i(40081);if(3075==i.j)var ge=i(780);const ve=(e,t,i,ve,fe,we,be,Se,ye,_e,ke,Ae,Ce,Ee)=>{var Ie;const Me=de.C8.Logging.getLogger("view_models"),Te=ce.h.create(E.A.defaultState),xe=ce.h.create(!1),Re=H.t.create(H.t.defaultLensFilters,H.t.defaultTextFilters),Le=e.alertsList.state.pipe((t=>E.A.get(t,e.alertsList.lensesScores,Re))).subscribe(T.wW(Te)),Fe=new he.t(Te.view("lenses"),Re,e.sessionModel.scoreStatus),Pe=(0,D.$y)((0,y.a)(t).getContents),Ve={features:(()=>{const e=new Set;return e.add(G.IG.Features.showCardLabelInOutcomes),e})(),cardLayoutDensityMode:X.j.Density.compact,shouldAnimateAlertApply:a.jv,cardVisualMode:ce.h.create(X.j.CardVisualMode.RegularLightMode)},Be=(0,G.Ls)(Pe,e.alertsReader,Ve,(()=>x.of(se.none)),e.mutingAlertsReader),Oe=W.R.ItemFactory.create(Pe,e.mutingAlertsReader,Ve,(()=>x.of(se.none))),Ne=(0,Z.U)(Pe,e.alertsReader,Ve,K.T.ordAlert),He=l.O.getCapabilities(Be,Oe,Ne,e.alertsReader,Pe,ce.h.create(K.D.empty()),(()=>We.get().currentLens.id)),Ue=new J.oq(e.alertsList.state,e.alertsReader,Te.view("lenses"),e.positionManager,Fe,new ee.gi(l.O.equatable.structEq,l.O.defaultOrd),(0,ee.is)(Be,He),He,Re),De=(null===(Ie=we.experiments)||void 0===Ie?void 0:Ie.disablePriorityLens)?C.R.SpecialId.AllAlerts:((e,t)=>{switch(e.kind){case d.h.Kind.dropdown:return t.get();case d.h.Kind.priorityToggle:return"priority"===e.defaultMode?C.R.SpecialId.Priority:C.R.SpecialId.AllAlerts;case d.h.Kind.none:return C.R.SpecialId.AllAlerts;default:(0,_.vE)(e)}})(ye.priorityLens,Se);i.next({kind:d.R.ChangeLens,selectedLens:De===C.R.SpecialId.Priority?"priority":"all"});const We=ce.h.create(Ue.emptyState(De)),je=We.pipe(R.U((e=>e.currentLens.id)),L.h(n.U.SelectedLens.filter)).subscribe((e=>Se.set(e))),Ge=(0,j.u0)((()=>t.getCursor().index),Ue),ze=new f.x(e.alertsList,We,5),qe=new w.r(e.alertsList,We),Ke=new k.EQ(new ge.o(e.sessionModel,ze,we.isPremium,fe,Ee.isGateEnabled(b.K.StudentsOFEGdocs)||Ee.isGateEnabled(b.K.StudentsOFEInternal))),Ze=new v.$(We,Fe,i,Ke,t,ye,fe,te.z.all),Xe=new U.Xx({flush:()=>t.flushChanges()},Ze.events,Be,e.alertsService,se.none,(()=>Promise.resolve()),(()=>Promise.resolve()),(0,s.pipe)(e.mutedAlertsCategoriesModel,se.map((e=>({model:e,openSuggestionsManagement:()=>self.open((0,S.Um)().suggestionsSettings)})))),se.none,(()=>!1),l.O.getActiveItemWithAlert,He,We,new u.C,{bufferTransitions:!0,showGbPrompt:!1},se.none,g.D.updateCitationStyle(e.sessionModel,fe)),Qe=new m.C(Xe,fe,e.alertsReader.getById),$e=(0,c.z)(be.get(),Ee),Ye=(0,s.pipe)((0,I.d)(ze.advancedAlerts),ue.Z.extendActions(F.b((e=>{e.key===M.n.State.minimized&&"onClick"===e.action.action&&$e&&xe.set(!0),e.key===M.n.State.expanded&&"collapse"===e.action.kind&&xe.set(!1),e.key===M.n.State.expanded&&"upgrade"===e.action.kind&&(fe.getPremiumButtonClick("gDocsSideBarAssistantList","SeeWhatsInPremium"),ze.openUpgradeUrl(f.L.Place.gdocsSidebarCardList))})))),Je=xe.pipe(P.h(T.PU)),et=qe.freeAlerts.pipe(R.U((e=>{var t;return!(null===(t=(0,s.pipe)(e,re.Fc))||void 0===t?void 0:t.count)&&$e})),V.x()).subscribe(T.wW(xe)),tt=(0,h.xl)(We,Re,Je,xe),it=new h.o$(e.alertsList,e.alertsReader,e.positionManager,e.alertsService,t,We,tt,l.O.getActiveItemWithAlert,_e,!1,xe),at=new z.o((()=>ne.F2(void 0))),st=(0,pe.hp)(We,it,ce.h.create(16),at,t,Me),rt=new N.mN(t,We,it,e.alertsReader,l.O.getActiveItemWithAlert),nt=new A.y(ce.h.create([]),p.I.createFactory(),3,5e3),ot=[U.dv.changeAlertEffect(We,Xe,Be,l.O.getActiveItemWithAlert,e.alertsReader,se.some(st),Ge,Me.getLogger("CardsViewModelEffects.changeAlertEffect")),...Xe.getApplicatorEffects(),q.R7(We,at,He,(0,a.MZ)(Xe.actionEvents),{cardsAroundActive:25,cardsBeyondViewport:25}),me.A7(rt,We),(0,pe.k9)(We,st,ce.h.create(se.none),l.O.getActiveAlignableItem,He),q.XU(We,at,He),ie.EQ.focusMarkByActiveAlert(We,it,e.alertsReader,l.O.getActiveFocusableItem,Me.getLogger("MarksEffects.focusMarkByActiveAlert")),me.uo(ve,nt),U.dv.createSendActiveAlertFeedbacksEffect(We,l.O.getActiveItemWithAlert,e.alertsService,e.alertsReader,Me.getLogger("CardsViewModelEffects.createSendActiveAlertFeedbacksEffect")),me.Ng(Fe,We,He),me.CH(Fe,We),Ze.lensChangeEffect],lt="none"!==ye.priorityLens.kind?Ze.lensMode.view(te.K.isPriorityMode).view((0,oe.RN)(C.R.SpecialId.Priority,C.R.SpecialId.AllAlerts)):ce.h.create(C.R.SpecialId.AllAlerts),ct=(0,j.VC)(Ue,Ge,lt,He),dt=ce.h.create(!0),ut=j.Py.getStateTransformer(j.Py.getDefaultBehavior(l.O.getActiveItemWithAlert,He),ct,e.alertsReader,He,(e=>dt.get()&&"text"!==e.alertSource),a.Q1,lt),pt=$.v.Items.getItemsPositionsUpdateTransformer(He),mt=(0,a.ls)(ut,le.L9(pt)),ht=new Y.l(We,Ue,e.alertsReader,e.alertsService,ot,l.O.getActiveItemWithAlert,mt),gt=new ae.L(We,e.sessionModel,a.Q1,He,se.none,se.none,(e=>Q.nL.isWithPriorityList(e)&&$.v.WithPriority.onlyNonPriorityAlertsLeft(e.currentLens,l.O.priorityTest,He)),$.v.WithPriority.isInSuccess(l.O.priorityTest,He),ce.h.create(!1)),vt=ke.pipe(B.w(se.fold((()=>O.E),(t=>t.initAssistantSession(Xe.actionEvents,e.alertsReader,We,e.alertsService,e.alertsList.state))))).subscribe(),ft=Ae.pipe(B.w(se.fold((()=>O.E),(t=>t.initCardActionsProcessing(Xe.actionEvents,e.alertsReader,(0,o.aU)(We),(0,o.X5)(rt,We),We))))).subscribe(),wt=Xe.actionEvents.subscribe((0,a.ls)((0,r.JH)(e.alertsReader,r.SV.Source.sidebar),re.bw((e=>Ce.next(e)))));return{lensState:We,lensStateManager:ht,cardsViewModel:Xe,marksViewModel:it,navigationViewModel:Ze,successLensViewModel:gt,alignmentViewModel:st,lensPreviewViewModel:Fe,cardsListScrollManager:at,notificationManager:nt,upgradeViewModel:ze,modalManager:Ke,capabilities:He,upgradeHookFlow:Ye,dispose:()=>{wt.unsubscribe(),it.dispose(),je.unsubscribe(),Le.unsubscribe(),Qe.dispose(),vt.unsubscribe(),ft.unsubscribe(),et.unsubscribe(),qe.dispose()}}}},40081:(e,t,i)=>{i.d(t,{t:()=>f});var a=i(71249),s=i(57050),r=i(40327),n=i(45614),o=i(32426),l=i(80800),c=i(66896),d=i(48439),u=i(64992),p=i(8125),m=i(22232),h=i(5114),g=i(50147),v=i(38983);class f{constructor(e,t,i){this._lensesList=e,this._alertsFilterService=t,this._scoreStatus=i,this.getLens=(0,p.HP)((function(e){switch(e){case c.R.SpecialId.AllAlerts:return this._lensesList.view(w(c.R.Info.allAlerts,c.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(c.R.SpecialId.AllAlerts)));case c.R.SpecialId.Priority:return this._lensesList.view(w(c.R.Info.priority,c.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(c.R.SpecialId.Priority)));case c.R.SpecialId.PredictionTakeaways:return this._lensesList.view(w(c.R.Info.predictionTakeaways,c.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(c.R.SpecialId.PredictionTakeaways)));case c.R.SpecialId.PredictionEmogenie:return this._lensesList.view(w(c.R.Info.predictionEmogenie,c.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(c.R.SpecialId.PredictionEmogenie)));case c.R.SpecialId.RealTimeProofit:return this._lensesList.view(w(c.R.Info.realTimeProofit,c.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(c.R.SpecialId.RealTimeProofit)));case c.R.SpecialId.Plagiarism:return this._lensesList.view(this._getPlagiarismLens);case c.R.SpecialId.Premium:return this._lensesList.view(w(c.R.Info.premium,c.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(c.R.SpecialId.Premium)));case c.R.SpecialId.FreePremiumAlerts:return this._lensesList.view(w(c.R.Info.freePremium,c.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(c.R.SpecialId.FreePremiumAlerts)));case c.R.SpecialId.Correctness:case c.R.SpecialId.Clarity:case c.R.SpecialId.Engagement:case c.R.SpecialId.Delivery:case c.R.SpecialId.Vox:case c.R.SpecialId.CorrectnessPriority:case c.R.SpecialId.ClarityPriority:case c.R.SpecialId.EngagementPriority:case c.R.SpecialId.DeliveryPriority:case c.R.SpecialId.VoxPriority:return this._lensesList.view(w(c.R.Info.createOutcome(e),c.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(e)));case c.R.SpecialId.RealTimeProofit:return this._lensesList.view(w(c.R.Info.realTimeProofit,c.R.Meta.group.empty,this._alertsFilterService.getLensesFilter(e)));default:return(0,m.vE)(e)}})),this._outcomes=[c.R.SpecialId.Correctness,c.R.SpecialId.Clarity,c.R.SpecialId.Engagement,c.R.SpecialId.Delivery],this._previews=(0,p.HP)((()=>n.uX((0,o.getFirstSemigroup)(),a.IX)(this._outcomes,(e=>[e,this._getPreview(e)])))),this._isDocumentEmpty=v.h.create(!1),this._isFree=v.h.create(!1),this._outcomeStatusMask=v.h.combine(this._isDocumentEmpty,this._isFree,((e,t)=>{let i=0;return e&&(i|=u.x.IsDocumentEmpty),t&&(i|=u.x.IsFreeUser),i})),this._getPlagiarismLens=(0,s.ls)(w(c.R.Info.plagiarism,{...c.R.Meta.group.empty,percentile:d.T.MAX},this._alertsFilterService.getLensesFilter(c.R.SpecialId.Plagiarism)),c.R.WithAlerts.modifyMeta((e=>({...e,percentile:d.T.groupSum.concat(d.T.MAX,d.T.groupSum.inverse(e.percentile))}))))}findLens(e){return(0,r.pipe)(h.fromNullable([this.getLens(c.R.SpecialId.AllAlerts),this.getLens(c.R.SpecialId.Premium)].find((t=>e(t.get())))),h.map((e=>e.get().id)))}_getPreview(e){return{...c.R.Info.base,logo:h.none,...this._getOutcomeButtonData(e)}}get lensPreviews(){return this._previews()}_getOutcomeButtonData(e){const t=this.getLens(e),i=t.get().title,a=this._isFree.view((t=>t&&(e===c.R.SpecialId.Engagement||e===c.R.SpecialId.Delivery))),n=v.h.combine(t.view("count").view((e=>0===e)),a,((e,t)=>e&&!t)),{description:o,stateMessage:p}=(0,u.O)(e),m=v.h.combine(this._isDocumentEmpty,n,t.view("percentile"),((e,t,i)=>e?d.T.MIN:t?d.T.MAX:i)).view(d.g.fromRatio),g=v.h.create(!1),f=v.h.combine(this._scoreStatus.view((e=>(0,r.pipe)(e,h.map((e=>e===l.v0.ScoresStatus.SENSITIVE)),h.getOrElse(s.jv)))),t,m,this._outcomeStatusMask,g,p);return{id:e,title:i,description:o,status:f,progress:m,isUnavailable:a}}get nonEmptyLensId(){return(0,r.pipe)(h.fromNullable([this.getLens(c.R.SpecialId.AllAlerts),this.getLens(c.R.SpecialId.Premium)].find((e=>e.get().count>0))),h.map((e=>e.get().id)))}}function w(e,t,i){return a=>{return new c.R.LensImpl(e,(s=e.id,n=t,e=>(0,r.pipe)(g.P5(c.R.Id.ord)(s,e),h.getOrElse((()=>n))))(a),i);var s,n}}},62346:(e,t,i)=>{i.d(t,{xl:()=>G,o$:()=>z});var a,s=i(57050),r=i(40327),n=i(33381),o=i(51972),l=i(95572),c=i(95384),d=i(5817),u=i(66896),p=i(40018),m=i(51374),h=i(4390),g=i(9922),v=i(98403),f=i(59368),w=i(16746),b=i(17594),S=i(35416),y=i(25975),_=i(74364),k=i(24209),A=i(85985),C=i(28043),E=i(41398),I=i(77176),M=i(76974),T=i(32952),x=i(16118),R=i(40151),L=i(60797),F=i(24713),P=i(8125),V=i(5114),B=i(92843),O=i(95195),N=i(83078),H=i(71249),U=i(55415),D=i(22232),W=i(38983),j=i(81531);!function(e){e.create=(e,t,i,a,s,r)=>(n,o)=>{const l=o.to.visualState===f.Bd.highlighted;return c.sO.Change.getCreateAction({range:n,capiAlertId:e,visualState:l?{type:c.sO.Change.VisualState.Type.highlighted,source:t()}:{type:c.sO.Change.VisualState.Type.visible},highlightColor:i,highlightDisplayFormat:a(n(),l),highlightDisappearOnHoverDelay:s,order:r})},e.update=(e,t,i,a,s,r)=>(n,o)=>{const l=o.to.visualState===f.Bd.highlighted;return c.sO.Change.getUpdateAction({range:n,capiAlertId:e,visualState:l?{type:c.sO.Change.VisualState.Type.highlighted,source:t()}:{type:c.sO.Change.VisualState.Type.visible},highlightColor:i,highlightDisplayFormat:a(n(),l),highlightDisappearOnHoverDelay:s,order:r})},e.remove=e=>t=>c.sO.Change.getRemoveAction({range:t,capiAlertId:e})}(a||(a={}));const G=(e,t,i,a=W.h.create(!1))=>k.T(e.pipe(A.h((e=>e.currentLens.id!==u.R.SpecialId.Premium)),C.x(((e,t)=>!(e.currentLens.id!==t.currentLens.id||S.nL.isWithPriorityList(e)&&S.nL.isWithPriorityList(t)&&y.v.WithPriority.isNonPriorityListOpened(e.currentLens)!==y.v.WithPriority.isNonPriorityListOpened(t.currentLens)))),C.x()),i.pipe(E.M(e),I.U((([e,t])=>t)))).pipe(E.M(a),I.U((([e,i])=>i?(0,P.W9)(p.bZ.isPremium,p.bZ.isHidden):t.alertVisibleInText(e.currentLens.id,y.v.WithPriority.nonPriorityAlertsVisible(e)))));class z{constructor(e,t,i,d,v,y,k,C,E=M.of(void 0),L=!1,F=W.h.create(!1)){this._alertList=e,this._alertsReader=t,this._positionManager=i,this._alertsService=d,this._ded=v,this._lensState=y,this._filterChanges=k,this._getActiveItemWithAlert=C,this._readyObs=E,this._emulateAppliedAlertAnimation=L,this._showYellowUnderlines=F,this._highlightedAlert=V.none,this._focusedAlert=V.none,this._marksMap=new Map,this._subs=new g.w.Keeper,this.events=new T.xQ,this._alertStateDiff=this._alertList.state.pipe(x.G(),I.U((([e,t])=>h.p.diff(e,t))),A.h((0,P.ff)(B.v.isEmpty))),this._alertsFilter=W.h.create(s.jv),this._filteredAlerts=W.h.create(V.none),this._ready=!1,this._log=j.C8.Logging.getLogger("marks_view_model"),this.getMarkByAlert=e=>(0,r.pipe)(this._marksMap.get(e.alert.id),V.fromNullable,V.chain((t=>t.markByIndex(e.highlightIndex)))),this.getAlertByMark=e=>(0,r.pipe)(this._alertsReader.getRegistered(m.P.fromRangeIdToAlertId(e.id)),V.chain((t=>(0,r.pipe)(_.$A.getHighlightIndex(t,e.range()),O.UI((e=>({alert:b.$.fromModel(t),highlightIndex:e}))),V.fromEither)))),this.ensureAlertHighlightInViewport=(e,t,i)=>(0,r.pipe)(this.getMarkByAlert(e),V.fold((()=>R.E),(e=>this._ded.scrollToMark(e.id,{animate:i,paddingTop:t})))),this._createMA=(e,t)=>{const i=t&&p.bZ.isPremium(e)&&p.bZ.isHidden(e),d=N.MH(e.rawId),{impact:h,cardLayout:{outcome:g},extra_properties:v}=e.toRawAlert(),y=n.M.getHighlightColor(l.DD.createOutcomeType(g),h,v,i),k=this._lensState.view(S.nL.getActiveItem(o.O.getActiveItemWithAlert)).view((0,s.ls)(V.filter((t=>t.activeAlert.id===e.id)),V.map((e=>e.activeHighlightIndex)),V.getOrElse((()=>0)))),A=e=>(t,i)=>{const a=m.x.isEnclosingView(t),s=e.getHighlightRanges().some(m.x.isEnclosingView),o=m.x.isMainView(t),l=m.x.isMainStartView(t),c=e.getHighlightRanges(),d=(0,r.pipe)(c,H.cx((e=>e.start===t.start&&e.end===t.end)),V.getOrElse((()=>0)))===k.get(),u=p.bZ.isSuperAlert(e);return n.M.getHighlightDisplayFormat({isEnclosing:a,isEnclosed:s,isMain:o,isMainStart:l,isActive:d,belongsToActiveAlert:i,belongsToSuperAlert:u})},C=u.R.getSortOrder(e.lensType),E=new w.v((t=>(0,r.pipe)(this._alertsReader.getById(e.id),V.alt((()=>(t&&this._log.warn("Could not find alert for provided MarkAlert",{alert:e,source:t}),V.some(e)))),V.map(b.$.fromModel),N.MH)),this._alertsService,this._alertsService,(e=>this._ded.changeMarks(e)),a.create(d,(()=>c.sO.Change.VisualState.Source.api),y,A(e),null,C),a.update(d,(()=>q.getAlertSource(e,this._lensState.get(),this._getActiveItemWithAlert)),y,A(e),null,C),a.remove(d),(t=>{t.to.visualState===f.Bd.applied&&(this.events.next({type:_.ay.Type.AppliedAlertAnimationFinished,alert:e}),this._handleRemovedAlerts([e]).forEach((e=>e.apply())))}));return this._marksMap.set(e.id,E),E},this._handleRemovedAlerts=e=>e.map((({id:e})=>{const t=this._marksMap.get(e);return this._marksMap.delete(e),t.scheduleApply(f.Bd.disposed),t})),this._handleAlertUpdate=(e,t)=>e.map((e=>p.bZ.isRegistered(e)&&!p.bZ.isMuted(e)?(0,r.pipe)(V.fromNullable(this._marksMap.get(e.id)),V.fold((()=>this._alertsFilter.get()(e)?this._createMA(e,t):null),(e=>(e.scheduleUpdate(),f.Oe.isOrWillBe(f.Bd.success)(e)&&e.scheduleApply(f.Bd.highlighted),e)))):(0,r.pipe)(V.fromNullable(this._marksMap.get(e.id)),V.fold((()=>{}),(t=>(e.allowUpdate&&p.bZ.isCapiDone(e)&&p.bZ.isRated(e)&&f.Oe.isOrWillBe(f.Bd.highlighted)(t)?(t.scheduleUpdate(),t.scheduleApply(f.Bd.success)):(t.scheduleApply(f.Bd.disposed),this._marksMap.delete(t.alert.id)),t)))))).filter((e=>Boolean(e))),this._subs.push(this._readyObs.subscribe((()=>{this._subs.push(this._listenAlertsUpdates(),this._listenRangesUpdates(),this._listenFilterChange(),this._listenFilteredAlerts()),this._ready=!0})))}focusAlertHighlight(e){return this._ready?(0,r.pipe)(this._marksMap.get(e.alert.id),V.fromNullable,V.map((t=>{this._focusedAlert=V.some(e.alert.id),t.scheduleApply(f.Bd.highlighted),t.scheduleForceUpdate(),t.apply()})),O.Yo((()=>new Error("Unknown alert"))),O.UI((()=>({dispose:()=>{V.exists((t=>t===e.alert.id))(this._focusedAlert)&&(this._highlightedAlert=V.none),(0,r.pipe)(this._marksMap.get(e.alert.id),V.fromNullable,V.filter((()=>!(0,r.pipe)(this._highlightedAlert,V.exists((t=>t===e.alert.id))))),V.map((e=>{e.scheduleApply(f.Bd.visible),e.apply()})))}})))):O.t$(new Error("marks view model is not ready yet"))}highlightAlertHighlight(e){return this._ready?(0,r.pipe)(this._marksMap.get(e.id),V.fromNullable,V.map((t=>{this._highlightedAlert=V.some(e.id),t.scheduleApply(f.Bd.highlighted),t.apply()})),O.Yo((()=>new Error("Unknown alert"))),O.UI((()=>({dispose:()=>{V.exists((t=>t===e.id))(this._highlightedAlert)&&(this._highlightedAlert=V.none),(0,r.pipe)(this._marksMap.get(e.id),V.fromNullable,V.filter((()=>!(0,r.pipe)(this._focusedAlert,V.exists((t=>t===e.id))))),V.map((e=>{e.scheduleApply(f.Bd.visible),e.apply()})))}})))):O.t$(new Error("marks view model is not ready yet"))}moveCursorToHighlight(e,t){return this._ready?(0,r.pipe)(this._marksMap.get(e.alert.id),V.fromNullable,V.chain((t=>t.markByIndex(e.highlightIndex))),V.chain((e=>V.fromEither(e.range()))),V.fold((()=>O.t$(new Error("Cannot find mark for given range"))),(e=>{const{index:i,length:a}=this._ded.getCursor();if(0===a&&(i<e.start||i>e.end)){const i=Math.min(e[t],this._ded.getLastPossibleCursorPosition());return(0,r.pipe)(this._ded.setCursor(i,0),O.vx(O.t$))}return O.F2(void 0)}))):O.t$(new Error("marks view model is not ready yet"))}dispose(){this._subs.dispose()}_listenAlertsUpdates(){const e=e=>({activeAlerts:[],updatedAlerts:[],removedAlerts:[],acceptedAlerts:[],hiddenMarkAlerts:[],...e});return k.T(this._filteredAlerts.pipe(L.cp((({visible:t,hidden:i})=>M.of(e({activeAlerts:U.qo(t),removedAlerts:U.qo(i)}))))),this._alertStateDiff.pipe(E.M(this._alertsFilter),I.U((([t,i])=>(0,r.pipe)(t,B.v.reduce(e({}),((e,t)=>(this._marksMap.has(t.alert.id)&&e.removedAlerts.push(t.alert),e)),((e,t,i)=>(p.bZ.isAccepted(i.alert)?e.acceptedAlerts.push(i.alert):e.updatedAlerts.push(i.alert),e)),((e,t)=>(i(t.alert)&&e.activeAlerts.push(t.alert),e)))))))).pipe(E.M(this._showYellowUnderlines),I.U((([{activeAlerts:e,removedAlerts:t,updatedAlerts:i,acceptedAlerts:a},s])=>{let r=[];return r=r.concat(e.filter((0,P.W9)((0,P.Kg)((e=>s&&p.bZ.isPremium(e)&&p.bZ.isHidden(e)),(0,P.ff)(p.bZ.isPremium)),(e=>V.isSome(e.rawId)))).map((e=>{const t=this._marksMap.get(e.id);return void 0!==t?(t.scheduleForceUpdate(),t):this._createMA(e,s)}))),this._emulateAppliedAlertAnimation&&setTimeout((()=>{a.forEach((e=>{this.events.next({type:_.ay.Type.AppliedAlertAnimationFinished,alert:e})}))}),3*(0,d.Xd)(20)),r=r.concat(this._handleRemovedAlerts(t.concat(a).filter((e=>this._marksMap.has(e.id))))),r=r.concat(this._handleAlertUpdate(i,s)),r}))).subscribe((e=>{if(e.length>0){const[t,...i]=e;t.applyWith(i)}}))}_listenRangesUpdates(){return this._positionManager.rangeChanged.pipe(F.j("changed"),I.U((e=>e.filter((e=>m.P.is(e)&&m.x.isVisible(e)&&this._marksMap.has(e.meta.alertId))))),A.h((e=>e.length>0))).subscribe((e=>{const t=Array.from(e.values()).reduce(((e,t)=>(0,r.pipe)(this._alertsReader.getById(t.meta.alertId),V.chain((e=>this._alertsReader.getRegistered(e.id))),V.chain((e=>V.fromNullable(this._marksMap.get(e.id)))),N.bw((t=>e.set(t.alert.id,t))),(0,s.a9)(e))),new Map),i=Array.from(t.values());if(i.forEach((e=>{e.scheduleForceUpdate()})),i.length>0){const[e,...t]=i;e.applyWith(t)}}))}_listenFilterChange(){return this._filterChanges.subscribe((e=>{v.wW(this._alertsFilter)(e)}))}_listenFilteredAlerts(){return this._alertsFilter.pipe(E.M(this._alertList.state),I.U((([e,t])=>(0,r.pipe)(t,h.p.reduce({visible:{},hidden:{}},((t,i)=>(e(i.alert)&&p.bZ.isRegistered(i.alert)?t.visible[i.alert.id]=i.alert:t.hidden[i.alert.id]=i.alert,t))),(e=>V.some(e)))))).subscribe(v.wW(this._filteredAlerts))}}var q;!function(e){e.toSidebarFluidMarkSource=e=>{switch(e){case p.l$.text:case S.h8.forceText:return c.sO.Change.VisualState.Source.text;case p.l$.sidebar:case S.h8.forceSidebar:return c.sO.Change.VisualState.Source.sidebar;case p.l$.api:return c.sO.Change.VisualState.Source.api;default:return(0,D.vE)(e)}},e.getAlertSource=(t,i,a)=>S.nL.hasCards(i)?(0,r.pipe)(a(i.currentLens),V.fold((()=>c.sO.Change.VisualState.Source.api),(a=>a.activeAlert.id===t.id?e.toSidebarFluidMarkSource(i.alertSource):c.sO.Change.VisualState.Source.api))):c.sO.Change.VisualState.Source.api}(q||(q={}))},780:(e,t,i)=>{i.d(t,{o:()=>L});var a=i(57050),s=i(40327),r=i(73582),n=i(73353),o=i(54286),l=i(22621),c=i(83078),d=i(8125),u=i(22232),p=i(5114),m=i(38983),h=i(16027);var g=i(98403),v=i(18625),f=i(57091),w=i(66310),b=i(76974),S=i(13444),y=i(93508),_=i(48403),k=i(95343),A=i(25970),C=i(95195),E=i(81531);class I{constructor(e,t){this._documentModel=e,this._modalOperations=t,this.reportViewModel=p.none,this.state=v.P((()=>g.GQ((()=>this._documentModel.calculateStats())))).pipe(f.a(this._documentModel.checkingState,((e,t)=>(0,s.pipe)(e,p.filter((()=>"idle"===t))))),w.w(p.fold((()=>b.of({type:A.g.State.Type.LOADING}).pipe(S.g(150))),C.g_((e=>(E.C8.Logging.getLogger("editor.toolbar").error("Error on requesting document stats",e),this.onModalClose(),b.of({type:A.g.State.Type.ERROR}))),(e=>m.h.combine(this._documentModel.score,this._documentModel.counters,this._documentModel.documentLength.view("trimmed"),((t,i,a)=>(0,s.pipe)(t,p.fold((()=>({type:A.g.State.Type.SHORT_CONTENT})),(t=>({type:A.g.State.Type.READY,documentIsEmpty:0===a,score:t,counters:i,stats:e})))))))))),y.O({type:A.g.State.Type.EMPTY}),_._(1),k.x()),this.onModalClose=()=>{this._modalOperations.onClose()}}}var M=i(81301),T=i(9690),x=i(77176),R=i(31881);class L{constructor(e,t,i,a,s=!1){this._documentModel=e,this._upgradeViewModel=t,this._isPremiumUser=i,this._gnar=a,this._isStudentsOFE=s}load(e){switch(e.type){case M.dC.SetGoals:return this._loadSetGoals(e.source);case M.dC.Performance:return this._loadPerformance();default:return(0,u.vE)(e)}}_loadSetGoals(e){return Promise.resolve((t=>{const i=function({documentModel:e,features:t,gnar:i,modalOperations:g,upgradeVM:v,source:f}){const w=o._.create(e.context.get(),(0,s.pipe)(e.defaultContext.get(),p.fold((()=>n.R$.defaultContextFallback),a.yR)),t,!1),b=m.h.combine(w.showSetGoalsLoader,w.localContext,((e,i)=>({blocks:w.blocks,context:i,showOnLoad:e,features:{...t,defaultAudience:"knowledgeable"},source:f})));return h.Z.fromSideEffect((a=>{switch(a.kind){case l.R.ActionsKind.open:i.goalsPopupShow(a.source);break;case l.R.ActionsKind.upgrade:v.openUpgradeUrl(r.L.Place.gdocsGoals),i.getPremiumButtonClick("assistantGoals","GoPremium");break;case l.R.ActionsKind.close:g.onClose();const o=()=>c.FX("academic")(a.context.domain)&&t.isStudentsOFE,m=o()&&p.isNone(a.context.outcomeContext)?{...a.context,outcomeContext:p.some(n.R$.OutcomeContext.defaultAcademic)}:a.context;if(e.updateContext(m)){const t=(0,s.pipe)(e.defaultContext.get(),p.getOrElse((()=>n.R$.defaultContextFallback)));i.goalsFormSuccess((0,s.pipe)(m.domain,p.getOrElse((()=>t.domain))),(0,s.pipe)(m.goals,p.map((e=>o()?[]:e)),p.getOrElse((()=>t.goals)),(e=>Array.from(e))),f,(0,s.pipe)(m.outcomeContext,p.filter(o),p.map((e=>e.type)),p.toUndefined),(0,s.pipe)(m.audience,p.filter((0,d.ff)(o)),p.toUndefined),(0,s.pipe)(m.outcomeContext,p.filter(o),p.map((e=>e.citation)),p.toUndefined),(0,s.pipe)(m.style,p.filter((0,d.ff)(o)),p.toUndefined))}break;case l.R.ActionsKind.reset:w.localContext.set(n.R$.unset);break;case l.R.ActionsKind.showOnLoadChanged:w.showSetGoalsLoader.set(a.value);break;default:(0,u.vE)(a)}}),b)}({features:{demoMode:!1,isRedesign:!1,isFree:!this._isPremiumUser,isStudentsOFE:this._isStudentsOFE},documentModel:this._documentModel,upgradeVM:this._upgradeViewModel,source:e,modalOperations:t,gnar:this._gnar});return{instance:{type:M.dC.SetGoals,source:e},component:R.UI.mount(l.R.Modal,i)}}))}_loadPerformance(){return Promise.resolve((e=>{const t=new I(this._documentModel,e),i=R.UI.Knot.make(T.q.ModalView,{downloadButton:R.UI.Node.empty}),a=R.Z.fromSideEffect((t=>{switch(t.action.kind){case T.q.ActionsKind.close:e.onClose();break;default:(0,u.vE)(t.action.kind)}}),t.state.pipe(x.U((e=>({root:e})))));return{instance:{type:M.dC.Performance},component:R.UI.mount(i,a)}}))}}},37290:(e,t,i)=>{if(i.d(t,{$:()=>y}),3075==i.j)var a=i(57050);if(3075==i.j)var s=i(77394);if(3075==i.j)var r=i(81301);if(3075==i.j)var n=i(40018);if(3075==i.j)var o=i(66896);if(3075==i.j)var l=i(32952);if(3075==i.j)var c=i(9922);if(3075==i.j)var d=i(41398);if(3075==i.j)var u=i(77176);if(3075==i.j)var p=i(85985);if(3075==i.j)var m=i(66310);if(3075==i.j)var h=i(40151);if(3075==i.j)var g=i(4890);if(3075==i.j)var v=i(35416);if(3075==i.j)var f=i(43637);if(3075==i.j)var w=i(5114);if(3075==i.j)var b=i(22232);if(3075==i.j)var S=i(38983);class y{constructor(e,t,i,s,r,m,h,b){this._state=e,this._lensPreviewVM=t,this._sidebarEvents=i,this._modalManager=s,this._ded=r,this._features=m,this._gnar=h,this._defaultLensMode=b,this.isUphooksRedesign=!1,this.popover=S.h.create(w.none),this.events=new l.xQ,this.activeLensId=this._state.view("currentLens","id"),this.documentActions=S.h.create({proofit:f.Bo.proofitDisabled(f.TV.NotAvailable),plagiarism:f.Bo.plagiarismDisabled(f.eh.NotAvailable)}),this.showMuteControl=S.h.create(!1),this._subs=new c.w.Keeper,this._lensSwitch=new l.xQ,this.lensMode=S.h.create(this._defaultLensMode),this.lensTitleType="none"!==this._features.priorityLens.kind?f.Bo.LensTitleType.priority:f.Bo.LensTitleType.default,this.lensChangeEffect={id:"lensChangeEffect",when:a.W8,what:v.nL.Effect.SwitchLens.create(this._lensSwitch.pipe(d.M(this._state.pipe(u.U((e=>e.currentLens.id)))),p.h((([{lensId:e},t])=>e!==t)),u.U((([{lensId:e,focusFirst:t}])=>({lensId:e,alertSource:n.l$.sidebar,options:{order:"lensOrder",toFocus:t?v.nL.Effect.FocusBehavior.focusFirst:v.nL.Effect.FocusBehavior.noFocus}})))))},this.cardVisualMode=S.h.create(g.j.CardVisualMode.RegularLightMode),this._listenNavigationEvent();const y=[o.R.SpecialId.Correctness,o.R.SpecialId.Clarity,o.R.SpecialId.Engagement,o.R.SpecialId.Delivery].reduce(((e,t)=>(e[t]=this._lensPreviewVM.lensPreviews[t],e)),{});this.lensPreviews=S.h.create(y),this.a11yContrast=!1}dispose(){this._subs.dispose()}_listenNavigationEvent(){this._subs.push(this.events.pipe(m.w((e=>{switch(e.type){case"toggleSidebar":return this._sidebarEvents.next({kind:s.R.Close}),h.E;case"switchToLens":if("none"!==this._features.priorityLens.kind){const t=e.id===o.R.SpecialId.Priority?"priority":"all";this._sidebarEvents.next({kind:s.R.ChangeLens,selectedLens:t}),this._lensSwitch.next({lensId:e.id,focusFirst:e.focusFirst}),this._gnar.gdocsSidebarChangeLensButtonClick(t,this._lensPreviewVM.getLens(o.R.SpecialId.AllAlerts).get().count,this._ded.getTextLength(),this._lensPreviewVM.getLens(o.R.SpecialId.Priority).get().count,"dropdown"===this._features.priorityLens.kind?"dropdown":"priorityToggle")}else this._gnar.gdocsSidebarOpenLensButtonClick(e.id);return h.E;case"setGoals":return this._modalManager.show(r.Iy.setGoals("user"));case"performance":return this._modalManager.show(r.Iy.performance);case"switchToCritical":case"switchToAdvanced":case"preferences":case"switchToAll":return h.E;default:return(0,b.vE)(e)}}))).subscribe())}}},73582:(e,t,i)=>{i.d(t,{L:()=>a,x:()=>S});var a,s=i(40327),r=i(65421),n=i(39354),o=i(66896),l=i(40018),c=i(6782),d=i(4390),u=i(2844),p=i(77176),m=i(98403),h=i(5114),g=i(8125),v=i(95574),f=i(95195),w=i(38983),b=i(81531);!function(e){let t;!function(e){e.gdocsSidebarCardList="gdocsSidebarCardList",e.gdocsSidebarSuccessView="gdocsSidebarSuccessView",e.gdocsGoals="gdocsGoals",e.gdocsSidebarAnonymousCard="gdocsSidebarAnonymousCard",e.assistantCardList="assistantCardList",e.extensionSettingsAssistant="extensionSettingsAssistant",e.toneSuggestion="toneSuggestion"}(t=e.Place||(e.Place={}))}(a||(a={}));class S{constructor(e,t,i){this._alertsList=e,this._lensState=t,this._maxAlertCategories=i,this._log=b.C8.Logging.getLogger("UpgradeViewModel"),this._advancedAlerts=w.h.create([]),this.advancedAlerts=this._advancedAlerts.view((e=>e.length>0?h.some({count:e.length,alerts:()=>this._formatLiteAlerts(S._getGroupedLiteAlerts(e))}):h.none)),this._formatLiteAlerts=e=>{const t=e.slice(0,this._maxAlertCategories),i=e.slice(this._maxAlertCategories).map((e=>e.count)).reduce(g.Sm,0);return i>0?[...t,{group:"",category:"",categoryHuman:"more...",count:i,lensName:"",bundleInfo:h.none}]:t},u.aj([this._lensState.view("currentLens").view("id").view(o.R.isPriority).view((e=>e?e=>l.bZ.isRegistered(e)&&l.bZ.isPremium(e)&&l.bZ.isPriority(e):e=>l.bZ.isRegistered(e)&&l.bZ.isPremium(e))),this._alertsList.state]).pipe(p.U((([e,t])=>d.p.reduce([],((t,{alert:i})=>(e(i)&&t.push(i),t)))(t)))).subscribe(m.wW(this._advancedAlerts))}openUpgradeUrl(e){(0,s.pipe)(v.vM((()=>{(0,n.P4)().openSubscriptionDialog({currentAlerts:this._getCapiAlerts(),isAnonymousUser:!1,isFromEmail:!1,forceUtmCampaign:e})})),f.fS((e=>this._log.fatal("unexpected error on open upgrade page",e))))}_getCapiAlerts(){return this._advancedAlerts.get().map((e=>(0,r.IM)(S._toRawAlertWithPossibleWrongId(e),"sidebar")))}static _getGroupedLiteAlerts(e){return c.Q.group(e.map((e=>e.toLiteAlert())))}static _toRawAlertWithPossibleWrongId(e){return{...e.toRawAlert(),id:(0,s.pipe)(e.rawId,h.getOrElse((()=>e.id)))}}}},33953:(e,t,i)=>{if(i.d(t,{r:()=>p}),3075==i.j)var a=i(6782);if(3075==i.j)var s=i(40018);if(3075==i.j)var r=i(4390);if(3075==i.j)var n=i(14601);if(3075==i.j)var o=i(2844);if(3075==i.j)var l=i(77176);if(3075==i.j)var c=i(28043);if(3075==i.j)var d=i(5114);if(3075==i.j)var u=i(38983);class p{constructor(e,t){this._alertsList=e,this._lensState=t,this._sub=new n.w,this._freeAlerts=u.h.create([]),this.freeAlerts=this._freeAlerts.view((e=>e.length>0?d.some({count:e.length,alerts:()=>function(e){return a.Q.group(e.map((e=>e.toLiteAlert())))}(e)}):d.none)),this._sub.add(o.aj([this._lensState.view("currentLens").view("id").view((()=>e=>s.bZ.isRegistered(e)&&!s.bZ.isHidden(e)&&!s.bZ.isPremium(e))),this._alertsList.state]).pipe(l.U((([e,t])=>r.p.reduce([],((t,{alert:i})=>(e(i)&&t.push(i),t)))(t))),c.x()).subscribe((e=>{this._freeAlerts.set(e)})))}dispose(){this._sub.unsubscribe()}}},86705:(e,t,i)=>{i.d(t,{v:()=>r});var a=i(27378),s=i(80895);const r=({browser:e,className:t})=>"safari"!==e?a.createElement(s.C,{title:"BETA",className:t}):null},31944:(e,t,i)=>{i.d(t,{J:()=>o});var a=i(57050),s=i(27378),r=i(12187),n=i(22536);const o=({onChange:e,labelId:t,className:i,checkboxClassName:o,labelClassName:l,checked:c,children:d,disabled:u,dataGrammarlyPart:p="ui-kit-checkbox"})=>{const[m,h]=s.useState(null!=c&&c);s.useEffect((()=>{h(Boolean(c))}),[c]);const g=t=>{t.preventDefault(),t.stopPropagation(),h(!m),null==e||e(!m)};return s.createElement("div",{"data-grammarly-part":p,...(0,r.Sh)(n.checkboxContainer,i)},s.createElement("div",{...(0,r.Sh)(n.checkbox,o,m?n.checkboxChecked:null),role:"checkbox","aria-checked":m,tabIndex:0,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&g(e)},onClick:u?a.Q1:g},m?s.createElement("div",{className:n.checkboxCheckmark}):null),s.createElement("label",{id:t,onClick:g,className:l},d))}},84488:(e,t,i)=>{i.d(t,{G:()=>r});var a=i(27378),s=i(31542);const r=({children:e,style:t,dataGrammarlyPart:i="ui-kit-iframe",...r})=>{const[n,o]=a.useState(null),l=a.useCallback((e=>{var t,i;let a=null;"contentDocument"in e.target&&(a=null!==(i=null===(t=e.target.contentDocument)||void 0===t?void 0:t.body)&&void 0!==i?i:null),o(a),a&&(a.style.margin="0",a.style.height="100vh")}),[]);return a.createElement("iframe",{...r,style:{border:"none",...t},onLoad:l,srcDoc:"<html><body></body></html>","data-grammarly-part":i},n&&(0,s.createPortal)(e,n))}},47422:(e,t,i)=>{i.d(t,{z:()=>l});var a=i(27378),s=i(84488),r=i(68370),n=i(51897),o=i.n(n);const l=({placeholder:e,onChange:t,ariaLabel:i,className:n})=>{const[l,c]=a.useState("");return a.useEffect((()=>{t(l)}),[l]),a.createElement(s.G,{dataGrammarlyPart:"ui-kit-textbox",className:n,style:{width:"100%",height:"100%"}},a.createElement(r.b,null,o().__css),a.createElement("div",{role:"textbox",className:o().textBox,contentEditable:!0,onInput:e=>c(e.target.innerText),"data-placeholder":e,"aria-placeholder":e,"aria-label":i}))}},81108:(e,t,i)=>{i.d(t,{Q:()=>o});var a=i(27378),s=i(90361),r=i(10247);const n=e=>{if(e.reason===r.rS.NO_FREE_TRIALS_LEFT){const t="No email reviews left this month";let i;if(e.meta.quotaResetDate){const t=Intl.DateTimeFormat([],{month:"short",day:"numeric"}).format(new Date(Date.parse(e.meta.quotaResetDate)));i=`You will get ${r.SR} free reviews again next month (${t}). You can also use paid expert writing help in Grammarly's web editor anytime.`}else i=`You will get ${r.SR} free reviews again next month. You can also use paid expert writing help in Grammarly's web editor anytime.`;return{title:t,message:i}}return e.reason===r.rS.NOT_ENOUGH_WORDS?{message:`Your email must be at least ${r.fy} words (currently ${e.meta.wordsCount}).`}:e.reason===r.rS.TOO_MANY_WORDS?{message:`Your email must be under ${r.Vw} words (currently ${e.meta.wordsCount}).`}:(e=>{switch(e){case r.rS.NOT_AVAILABLE:return{message:"Our experts are currently working on other text. Please try again later."};case r.rS.NOT_AVAILABLE_QUOTA_ERROR:return{title:"Something went wrong",message:"We couldn't determine how many requests you have left. Please try again later."};case r.rS.CONFLICTING_REQUEST:return{title:"Separate request in progress",message:"You can submit this request once the experts are finished with the one you already submitted."};case r.rS.CHECKING_INITIAL_AVAILABILITY:return{message:"Checking for available experts..."};case r.rS.UNSUPPORTED_LANGUAGE:return{message:"Our writing experts can only help with emails written in English."};default:(0,s.vE)(e)}})(e.reason)},o=({info:e,includeTitle:t})=>{const i=n(e);return a.createElement(a.Fragment,null,t?a.createElement(a.Fragment,null,i.title?a.createElement("b",null,i.title):a.createElement("b",null,"Get expert writing help"),a.createElement("br",null)):null,i.message)};o.defaultProps={includeTitle:!1}},53844:(e,t,i)=>{i.d(t,{q5:()=>h,dK:()=>m});var a=i(27378),s=i(12187),r=i(21420);const n=({options:e,onChange:t=(()=>null),ariaLabel:i,className:n})=>{const o=[],[l,c]=a.useState(null);a.useEffect((()=>{var i;null!==l&&(null===(i=o[l])||void 0===i||i.focus()),t(null!==l?e[l].value:null)}),[l]);const d=null!==l?e[l]:null;return a.createElement("div",{"data-grammarly-part":"ui-kit-radio-group",className:n},a.createElement("div",{className:r.radioGroup,role:"radiogroup","aria-label":i,onKeyDown:t=>{if(" "!==t.key||d){if("ArrowRight"===t.key||"ArrowDown"===t.key){t.preventDefault(),t.stopPropagation();c(((l||0)+1)%e.length)}else if("ArrowLeft"===t.key||"ArrowUp"===t.key){t.preventDefault(),t.stopPropagation();const i=(l||0)-1;c(i<0?e.length-1:i)}}else t.preventDefault(),t.stopPropagation(),c(0)}},e.map(((e,t)=>{const i=(null==d?void 0:d.value)===e.value,n=0===t;return a.createElement("div",{key:e.value,...(0,s.Sh)(r.radioGroupOption,i?r.radioGroupOptionSelected:null),role:"radio",tabIndex:i||n&&!d?0:-1,"aria-checked":i,onClick:e=>{e.preventDefault(),e.stopPropagation(),c(t)},ref:e=>o.push(e)},e.render())}))))};var o,l=i(24606),c=i(47422),d=i(31944),u=i(51217),p=i(44544);function m(e){return"score"in e}!function(e){e.bad="bad",e.ok="ok",e.good="good"}(o||(o={}));const h=({hideLogo:e=!1,align:t="center",fixSubmitButtonOverflowBottomPadding:i=!1,...r})=>{var m;const h=[o.bad,o.ok,o.good],[g,v]=a.useState(null),[f,w]=a.useState(""),[b,S]=a.useState(!1),[y,_]=a.useState(!1);let k;return k=y&&!1!==r.showPostSubmitScreen?a.createElement("div",{"data-grammarly-part":"surveys-feedback-form-thank-you",...(0,s.Sh)(u.feedbackFormContainer,u.feedbackFormContainerAlignCenter)},a.createElement("div",{className:u.feedbackFormSuccessMessageTextContainer},a.createElement("div",{className:u.feedbackFormSuccessMessageIcon}),a.createElement("div",{className:u.feedbackFormSuccessMessageTitle},"Thank you!"),a.createElement("div",{className:u.feedbackFormSuccessMessageSubtitle},"Your feedback helps us improve.")),a.createElement(l.z,{className:u.feedbackFormSubmitButton,kind:"success",type:"submit",onClick:r.onClose},"Done"),i?a.createElement("div",{className:u.feedbackFormSubmitButtonFixOverflowBottomPadding},a.createElement("div",{className:u.feedbackFormSubmitButtonFixOverflowBottomPaddingChild})):null):a.createElement("div",{"data-grammarly-part":"surveys-feedback-form-fields",...(0,s.Sh)(u.feedbackFormContainer,"center"===t?u.feedbackFormContainerAlignCenter:null)},a.createElement("div",{className:u.feedbackFormFields},e?null:a.createElement("div",{className:u.feedbackFormLogo}),r.hideTitle?null:a.createElement("div",{...(0,s.Sh)(u.feedbackFormTitle,r.compactDisplay?u.compact:null)},r.title||a.createElement("span",null,"How do you like ",a.createElement("br",null)," Grammarly?")),r.withScore?a.createElement(a.Fragment,null,a.createElement(n,{ariaLabel:"Feedback Score",options:h.map((e=>({value:e,render(){let t,i;return e===o.bad?(t=p.feedbackFormOptionIconDisheartening,i="I dislike it"):e===o.ok?(t=p.feedbackFormOptionIconNeutral,i="It’s OK"):(t=t=p.feedbackFormOptionIconSmiling,i="I like it"),a.createElement("div",{className:p.feedbackFormOption},a.createElement("div",{...(0,s.Sh)(p.feedbackFormOptionIcon,t)}),a.createElement("div",null,i))}}))),onChange:v,...(0,s.Sh)(u.feedbackFormScore,r.compactDisplay?u.compact:null)}),r.hideTextBoxTitle?null:a.createElement("div",{className:u.feedbackFormTextBoxTitle},"Anything we can improve?")):null,a.createElement(c.z,{onChange:w,placeholder:r.placeholderText||"Your thoughts here",ariaLabel:"Feedback Text",...(0,s.Sh)(u.feedbackFormTextBox,r.compactDisplay?u.compact:null)}),r.domain?a.createElement(a.Fragment,null,r.hideDomainHelpText?null:a.createElement("div",{className:u.feedbackFormShareDomainTitle},"Help improve Grammarly by sharing the domain you’re on:"),a.createElement(d.J,{labelId:"feedback-form-share-domain-checkbox",onChange:S,className:u.feedbackFormShareDomainCheckbox},"Include the domain ",a.createElement("b",null,r.domain)," with my feedback")):null),a.createElement(l.z,{className:u.feedbackFormSubmitButton,kind:null!==(m=r.submitButtonKind)&&void 0!==m?m:"success",type:"submit",disabled:r.withScore?!g:!f,onClick:()=>{var e,t;r.withScore&&g?(null===(e=r.onSubmit)||void 0===e||e.call(r,{score:g,text:f,domain:b?r.domain:void 0}),_(!0)):!r.withScore&&f&&(null===(t=r.onSubmit)||void 0===t||t.call(r,{text:f,domain:b?r.domain:void 0}),_(!0))}},"Submit"),i?a.createElement("div",{className:u.feedbackFormSubmitButtonFixOverflowBottomPadding},a.createElement("div",{className:u.feedbackFormSubmitButtonFixOverflowBottomPaddingChild})):null),a.createElement("div",{style:r.style,"data-grammarly-part":"surveys-feedback-form"},k)}},24372:(e,t,i)=>{i.d(t,{J:()=>s});var a=i(64408);const s=new Proxy({},{get:(e,t)=>(...e)=>a.emitBackground("gnar-track",{method:t,props:e})})},25682:(e,t,i)=>{var a=i(93476)((function(e){return e[1]}));a.push([e.id,"._380Y1-textBox{font-family:grInter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;background:#f9faff;border:1px solid #e7e9f5;box-sizing:border-box;border-radius:4px;padding:10px 8px;overflow-y:auto;cursor:text;width:100%;height:100%;}._380Y1-textBox:empty:before{font-feature-settings:'ss03' on;font-family:grInter,sans-serif;font-style:normal;font-weight:normal;color:#6d758d;font-size:14px;line-height:21px;content:attr(data-placeholder)}",""]),a.locals={textBox:"_380Y1-textBox"},e.exports=a},33751:e=>{e.exports={cardList:"_1Eape",cardListFooterDynamic:"Inkbe",cardListFooterStatic:"_7OpWh",cardListFooterAnimate:"_29PbU",upgradeHookWrapper:"_9GpAY",assistant:"AnaVG",dragging:"_1XWvb",mainView:"_38aRY"}},57556:e=>{e.exports={emogenieViewOverlayHeader:"_2Xrrv",emogenieViewOverlayHeaderBetaBadge:"qG0e8"}},90282:e=>{e.exports={footerButton:"_2rtYm",feedbackButton:"ywPnS"}},78846:e=>{e.exports={actions_hovered:"Xf2Pk",header:"_3p6xo",draggableWrapper:"_2_Oau",draggable:"_1m9e2",headerActions:"_2asjJ",headerActionBtnProofitIcon:"_1GEsJ",headerActionBtnGoalsIcon:"_1ZjAn",logoscore_fadein:"xzxut",fadein:"_30rWn",logoscore_fadeout:"_1DBSi",fadeout:"_24pVK",logo_score:"_6nCpo",spin:"_2gcAi"}},19217:e=>{e.exports={insight:"_3o8h_",insight__inline_icon:"svSbC",insight__inline_text:"_3Uft0"}},75039:e=>{e.exports={lens_switch:"_3zrPc"}},98029:e=>{e.exports={predictions:"_3feHG",predictions__header:"_35Gcg",predictions__card:"_2xc9F",counterContainer:"_2co0s",predictions__zero_text:"_25oPK",predictions__off_brand:"_1sCHK"}},40145:e=>{e.exports={relatedSuggestionsTitle:"_3lmjh"}},55364:e=>{e.exports={viewOverlay:"_3iGYO",content:"_2sw8A",footer:"_3kpn-",viewOverlayGoBack:"_2Z1Xu",defaultViewOverlayPanel:"jqEio",gradientViewOverlayPanel:"_3Qgxa",proofitViewOverlayPanel:"_9lDqb",defaultViewOverlayHeader:"_1GTGF",defaultViewOverlayContent:"nXzeg",gradientViewOverlayContent:"_2hao0",proofitViewOverlayContent:"_2XeMU",logo:"xQSpk",proofitViewOverlayHeader:"_3dGrl",proofitViewOverlayHeaderBetaBadge:"_2wTGA"}},44715:e=>{e.exports={viewOverlay:"_2Unkh",content:"_2jpRZ",footer:"_24flt",viewOverlayGoBack:"a19pK",defaultViewOverlayPanel:"KLJW2",gradientViewOverlayPanel:"_2_U8f",helpPanel:"_1PEah",defaultViewOverlayHeader:"_2_b0R",defaultViewOverlayContent:"_1PG6A",gradientViewOverlayContent:"_21gzK",logo:"_3JvmB",helpPanelContent:"_7zg7r",helpBanner:"_3zyoV",helpBannerImage:"_3bc5C",helpHeader:"_1vP1w",helpBannerMessage:"uCPe4",helpContent:"FQviE",heatmap:"BPLCG"}},82318:e=>{e.exports={viewOverlay:"_24v8y",content:"_1GUCQ",footer:"_VXnz",viewOverlayGoBack:"_2vYal",defaultViewOverlayPanel:"_181-n",gradientViewOverlayPanel:"_30LCU",defaultViewOverlayHeader:"_2YCIK",defaultViewOverlayContent:"_1T1GW",gradientViewOverlayContent:"_2hMw0",logo:"_1wpBP",cardList:"_2M4t-",headerGroup:"Qwt6V",questionMarkButton:"_2U3v1",questionMarkIcon:"_3hiB8",summaryWrapper:"_3f-rw",message:"_2UO09",relatedSuggestionsTitle:"_3oKNQ"}},91574:e=>{e.exports={viewOverlay:"_1xfDY",content:"BafXy",footer:"_3RySl",viewOverlayGoBack:"_1pPp-",defaultViewOverlayPanel:"_3M2J1",gradientViewOverlayPanel:"noaan",settingsViewOverlayPanel:"_3tn7z",defaultViewOverlayHeader:"_2Z-Ec",defaultViewOverlayContent:"_3lDk7",gradientViewOverlayContent:"_1ac5g",settingsViewOverlayContent:"_3krsk",logo:"_1VqGG",settingsViewDoneButton:"_2gIUv"}},40656:e=>{e.exports={singleCardAssistant:"_12876",singleCardAssistantSettingsDoneButton:"_1VLcx",singleCardAssistantEmogenieReportHeader:"E4mwo",singleCardAssistantEmogenieReportHeaderBetaBadge:"_1OT9f",singleCardAssistantEmogenieReportHeaderBrandTones:"ktqOZ",singleCardAssistantEmogenieReportHeaderBrandTonesLogo:"_3WgYO",singleCardAssistantChecksFeed:"_3ZDvz",singleCardAssistantChecksFeedWithToneSuggestions:"_1lsHb","purple-box-shadow-first-pulse":"_3OtIZ","purple-box-shadow-pulse":"_3Zzb-","purple-box-shadow-permanent":"MtN1q"}},35327:e=>{e.exports={summary_heading:"_28Zxw",summary_wrapper:"_3qF24",summary_fadein:"_1OTrB",fadein:"_1ETLE",summary_fadeout:"GJSzn",fadeout:"YHKQy"}},73008:e=>{e.exports={viewOverlay:"_8FYR8",content:"D8x8A",footer:"_1oEdF",viewOverlayGoBack:"_2IRn0",defaultViewOverlayPanel:"_3wpsL",gradientViewOverlayPanel:"_2zadI",defaultViewOverlayHeader:"_3Y5Ie",defaultViewOverlayContent:"_1FPwk",gradientViewOverlayContent:"_2WqSK",logo:"oiRsy"}},62513:e=>{e.exports={compactSuccessLens:"_1G56p",compactSuccessLensContainer:"_1cOu3"}},35630:e=>{e.exports={circleProgress:"_1npo5",circleText:"_3muDd",card:"AAT_T",header:"_3k6P5",compact:"_1Efs0",normal:"_2_T8O",progressIcon:"_3lupT",title:"_1U6tn",full:"_24i7N",progressContainer:"TH-Um",progressBar:"_1Tzvc",progressValue:"_1Ck8G",description:"_4m_YN"}},32585:e=>{e.exports={cardBody:"_1qMrW",description:"_3g_X-",actions:"G0xen",lessIcon:"_3HhMd",minimalDescription:"srN6O",actionsFooter:"_11uNl",feedbackFooter:"_2PAOt",viewMoreButton:"_1CGEL"}},11510:e=>{e.exports={miniCard:"_2FMyP"}},96807:e=>{e.exports={cardContainer:"_3o7T2",cardText:"_1phHb"}},47476:e=>{e.exports={headerOrFooterWrapper:"_1snlI"}},74880:e=>{e.exports={cardList:"_2bCPN"}},30509:e=>{e.exports={premiumLens:"_2XK23"}},879:e=>{e.exports={successLens:"_1mbLA"}},57731:e=>{e.exports={footer:"_3W9PJ",plagiarismButton:"_1nouH",counterWrapper:"GHbf1",counter:"_2h93m",counterCheckmarkIcon:"_2-1xd"}},21831:e=>{e.exports={defaultHeader:"ghh6_",priorityLensHeader:"_2xf6x",head:"_1uTIv",headerGroup:"_1oce-",logoIcon:"_3Ey-O",logoText:"_1hTkC",headerButton:"_2HD8-",setGoalsButton:"_1EomQ",divider:"_2ku5Y",lensNavigation:"_1d7rU",disabledLensNavigation:"NFW3f",prioritySwitchWrapper:"EIY83",prioritySwitchFlatWrapper:"_3ujn6"}},44617:e=>{e.exports={header:"_2Yfwp",headerGroup:"_3Sxnx",logoIcon:"_3ijAI",closeButton:"LbVuE"}},79850:e=>{e.exports={wrapper:"_2PLre"}},75259:e=>{e.exports={container:"_2D4XC",baseGrid:"_2pCwn",bottomLeft:"_3_LGs",bottomRight:"_2tHhO",top:"_2Qg0A",notificationWrapper:"_3waR1"}},67129:e=>{e.exports={sidebarContainer:"_1_f6i",sidebarContent:"_3QlJG"}},7538:e=>{e.exports={learnMore:"_20Tq4",learnMoreExample:"_1k4BW",learnMoreExampleIconAndTitle:"_3wg3T",learnMoreExampleIcon:"_1DRAV",learnMoreExampleCorrectIcon:"_3LNkD",learnMoreExampleIncorrectIcon:"_1A-P-",learnMoreExampleTitle:"_2vWyx",learnMoreExampleTextItalic:"_2Apwj",learnMoreExampleTextMarginLeft:"_30FxK",spin:"_2QPBm"}},12267:e=>{e.exports={singleCardAssistant:"_29x5a",singleCardAssistantFooter:"_23i2M",singleCardAssistantFooterText:"mTIL9",singleCardAssistantHeader:"eFwvd",singleCardAssistantHeaderWithOverlappingContent:"EKs5v",singleCardAssistantHeaderDraggable:"_3wYqZ",singleCardAssistantHeaderWithoutOverlappingContent:"c2-ry",singleCardAssistantHeaderWithButtonHovered:"GL12R",singleCardAssistantHeaderContent:"_17X-B",singleCardAssistantHeaderDraggableIcon:"_1bSo7",singleCardAssistantHeaderBackButton:"_3anZx",singleCardAssistantHeaderBackButtonIcon:"_3Zzy6",singleCardAssistantHeaderContentInner:"_1KwfK",singleCardAssistantHeaderButtons:"jHXUY",singleCardAssistantHeaderDraggableHoveredBackground:"_85ToU",singleCardAssistantContent:"_1r3xI",singleCardAssistantContentWithPadding:"Jgq6x",singleCardAssistantContentWithOverlappingHeader:"_3qJuR",singleCardAssistantContentScrolled:"_2jcEB",spin:"_2z-hC"}},17208:e=>{e.exports={successReport:"_2zWCa",successReportIcon:"_3aU35",successReportTitle:"_2C75-",successReportSubtitle:"_6-_6x",spin:"_3dWuJ"}},12266:e=>{e.exports={emogenieReport:"SoJtK",emogenieReportHeader:"wVkE-",emogenieReportHeaderTitle:"_1ARH3",emogenieReportHeaderSubTitle:"_3Jo1r",emogenieReportHeaderBrandOffSubTitle:"_1FbkK",emogenieReportItems:"_18u69",emogenieReportCheckbox:"_1mxcw",emogenieReportToneSuggestionInfo:"_3uoiv",emogenieReportToneSuggestionInfoEmojiAndTitle:"_1lwtc",emogenieReportToneSuggestionInfoEmoji:"_1aDI9",emogenieReportToneSuggestionInfoButton:"_7IMZu"}},8471:e=>{e.exports={emogenieReportItem:"_2VgP1",emogenieReportItemBrandTone:"os2BZ",emogenieReportItemFeedback:"_3Po2q",emogenieReportItemFeedbackIcon:"_3jxVn",emogenieReportItemFeedbackText:"_3sBTt",emogenieReportItemEmotion:"_2pWWy",emogenieReportItemEmotionEmojiAndName:"_3Z3wv",emogenieReportItemEmotionEmoji:"_2cinA",emogenieReportItemEmotionName:"GSyum",emogenieReportItemEmotionIntensity:"_3oWFN",emogenieReportItemEmotionIntensityDot:"_2wQcZ",emogenieReportItemEmotionIntensityDotActive:"_9zOn8",emogenieReportItemEmotionVoteNoIncorrect:"_2LXXo",emogenieReportItemEmotionVoteNoOffensive:"jEzKP",emogenieReportItemDescription:"_1A3aU",spin:"_1g4LL"}},75100:e=>{e.exports={settingsButton:"RuCYy",spin:"_2dlxE"}},22536:e=>{e.exports={checkboxContainer:"_3bj_g",checkbox:"xrB8R",checkboxChecked:"Uhddy",checkboxCheckmark:"_1qI2g",spin:"_3S_a3"}},21420:e=>{e.exports={radioGroup:"_3jZFB",radioGroupOption:"_1Boe7",radioGroupOptionSelected:"_37tnK"}},59e3:e=>{e.exports={proofitRequestFormBtnLoadingSpinner:"_1dhPr",spin:"_34iE-"}},41063:e=>{e.exports={proofitHowItWorksSteps:"_29Vif",proofitHowItWorksStep:"M3Zas",proofitHowItWorksStepNumberContainer:"oAgaO",proofitHowItWorksStepNumber:"_1ZCJT",proofitHowItWorksStepOne:"_1jzAP",proofitHowItWorksStepOneNumberContainer:"_3zIlJ",proofitHowItWorksStepTwo:"TNSEJ",proofitHowItWorksStepTwoNumberContainer:"_2B7-Z",proofitHowItWorksStepThree:"_3G_IW",proofitHowItWorksStepThreeNumberContainer:"_1xWbH"}},17487:e=>{e.exports={proofitRequestForm:"_16jRB",proofitRequestFormImg:"L3ge0",proofitRequestFormTitle:"_2AohE",proofitRequestFormDescription:"_1-l2N",proofitRequestFormCostAndTime:"_1fthW",proofitRequestFormTime:"XwGo8",proofitRequestFormCostAndTimeTitle:"kTnKg",proofitRequestFormCostAndTimeSubtitle:"_12FlO",proofitRequestFormRequestBtn:"_3Iaok",proofitRequestFormUnavailableMsg:"_1hKiE",proofitRequestFormFootnote:"_3_jiZ",proofitRequestFormFootnoteFreeTrial:"IrTLS",proofitRequestFormFootnoteHowItWorksDontShowAgainCheckbox:"canRi",proofitRequestFormPrivacyInfoTitle:"_2YkLm",proofitRequestFormPrivacyInfoDescription:"_23aSV",proofitRequestFormPrivacyInfoDescriptionItem:"_31giz",proofitRequestFormPrivacyInfoDescriptionItemBulletPoint:"_3vURB"}},8400:e=>{e.exports={proofitReviewForm:"_1_T1p",proofitReviewFormTitle:"_1VtIM",proofitReviewFormDescription:"gQQZe",proofitFeedbackForm:"_tV9e",proofitDoneButton:"W2xwF"}},57398:e=>{e.exports={scoreRing:"_1V95O",loading:"_3_fuY",rotation:"_3cevg",scoreText:"_3MN4B"}},51217:e=>{e.exports={feedbackFormContainer:"_1M-GI",feedbackFormContainerAlignCenter:"_3QNrK",feedbackFormFields:"Jg_OY",feedbackFormTitle:"nPjzw",feedbackFormTextBoxTitle:"_2yUbL",feedbackFormLogo:"_2C-d7",compact:"_1wDKK",feedbackFormScore:"_3AmBq",feedbackFormTextBox:"FO2oU",feedbackFormShareDomainTitle:"_2UXTO",feedbackFormShareDomainCheckbox:"_3mSXM",feedbackFormSubmitButton:"_32xYR",feedbackFormSubmitButtonFixOverflowBottomPadding:"IJDSA",feedbackFormSubmitButtonFixOverflowBottomPaddingChild:"_3d5Tf",feedbackFormSuccessMessageTextContainer:"_2JO6Z",feedbackFormSuccessMessageIcon:"oVxds",feedbackFormSuccessMessageTitle:"_1MdvM",feedbackFormSuccessMessageSubtitle:"_1EKkw",spin:"_2ycFE"}},44544:e=>{e.exports={feedbackFormOption:"_9K_Q8",feedbackFormOptionIcon:"_259oL",feedbackFormOptionIconDisheartening:"_3NJTM",feedbackFormOptionIconNeutral:"i-5N8",feedbackFormOptionIconSmiling:"_1Dxi9",spin:"_2elyX"}},71527:e=>{e.exports={selected:"_3Ibej",label:"EKNV1",option:"ygVjN"}},66402:e=>{e.exports={american:"pyFmV",australian:"_2WGo3",british:"_1nkJZ",canadian:"_35Lt7"}},68089:e=>{e.exports={hover_blocker:"_1b9OS"}},56542:e=>{e.exports={settingsContent:"_2LPPC",fullWidth:"_1c69A",heading:"uyO-m",allSettings:"_3yj-F",separator:"_2LaDH",settingsLink:"_1DiWR"}},1005:e=>{e.exports={heading:"LLSOT"}},26485:e=>{e.exports={select_checkbox:"_3jXk9",centered:"_2GfZn",select_children:"nYWGL",beta:"_2D7H7",new:"_3Lqg-",alpha:"_3GrtL",checkbox:"_2nj-e",checkbox_check:"_28S0f",on:"UigB5",off:"_30ryz",checkbox_check_round:"_1PwEM",checkbox_control_wrapper:"_1KIp6",grayOut:"ZleQc",on_off:"_3mcZ6",disabled:"_1Sp_7",setting_item:"_3JLH2"}},6304:e=>{e.exports={line:"_2vgUt",disabled:"_3kA-F",dialectPicker:"_2v6OJ"}},47740:e=>{e.exports={container:"_1eoMt",containerWithBackground:"_12wVe",content:"Z9SrV",title:"_3hI6a",button:"_1LGnG"}},17324:e=>{e.exports={windows:"_2wKpF",setting_item:"_6eFop",fixing:"_3sQF9",thin_text:"_2m369",footer:"AIrzw",gr_popup_settings:"_18flg",iOS:"_2Y-35",footer_btn:"_16bxQ",short_border:"FqAkb",top:"_2N9kH",upgraded:"_1D3x1",content:"_36NTm",since:"dfV8r",business:"Nb2Rp",edu:"_3Q9EY",my_grammarly:"_1NXBN",new_document:"bpEGW",unsupported_site:"iBAYN",unsupported_item:"_13zLn",unsupported_title:"_3rfYX",domain:"_1tlAE",domain_in_details:"_2z4_y",unsupported_temporary:"Xw4Jp",unsupported_permanently:"_27hK2",unsupported_grammarly:"_2xTYa",diamond:"p3X6p",userPanel:"_3cZ8t",email:"bBX3_",link:"_3ko8g",blue:"b4yKe",edc_stripe:"_1wkrp",line:"_2_8JS",not_supported:"kU9B_",site_switcher:"_2KZQq",upgrade:"_1zI1G",def_switcher:"_29_cp",on:"_2JO5i",off:"_3f4Zs",favicon:"sjSDn",centered:"taU_8",summary:"_1cNov",upgrade_title:"_3aOe6",settingsContent:"_2BkNA",withBackground:"pNvqp",llamaTitle:"h5j0H",llamaDescription:"mHaqr"}},23345:e=>{e.exports={line:"NMkwQ",content:"lWYTI",upgrade:"_2GRJe"}}}]);