!function(t){function e(e){for(var i,n,o=e[0],h=e[1],c=e[2],l=0,u=[];l<o.length;l++)n=o[l],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&u.push(r[n][0]),r[n]=0;for(i in h)Object.prototype.hasOwnProperty.call(h,i)&&(t[i]=h[i]);for(d&&d(e);u.length;)u.shift()();return a.push.apply(a,c||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],i=!0,o=1;o<s.length;o++){var h=s[o];0!==r[h]&&(i=!1)}i&&(a.splice(e--,1),t=n(n.s=s[0]))}return t}var i={},r={2:0},a=[];function n(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=i,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="./";var o=window.webpackJsonp=window.webpackJsonp||[],h=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var d=h;a.push([236,0]),s()}({236:function(t,e,s){s(70),t.exports=s(534)},534:function(t,e,s){"use strict";s.r(e);var i=s(49),r=s(31),a=s.n(r),n=s(3),o=s(22),h=s(10),c=s(8),d=s(20),l=s.n(d),u=s(63),m=s.n(u),g=s(222),b=s.n(g);l.a.extend(m.a),l.a.extend(b.a);var p=l.a,f=s(14),_=s(48),v=s(102);var y=class{constructor(t,e){this.storage={},this._defaults=e,this._storeKeyName=t}init(){return this._load().then(t=>this._mixDefaults(t)).then(()=>this.storage)}_mixDefaults(t){return this.storage=Object.assign(this._getDefaults(),t),Promise.resolve()}get(t){return this.storage[t]}set(t){let e=!1;return Object.keys(t).forEach(s=>{let i=this._defaults[s];if(!i)return;i=i[0];const r=t[s];i&&typeof r===i?(this.storage[s]=r,e=!0):console.warn(`Wrong value type. Key: ${s}, Type: ${i}, Value: ${r} [${typeof r}]`)}),this._commit().then(()=>(e&&this.emitUpdate(),e))}getAll(){return Object.assign({},this.storage)}emitUpdate(){}_load(){return new Promise(t=>{chrome.storage.local.get(this._storeKeyName,e=>{t(e&&e[this._storeKeyName]?e[this._storeKeyName]:{})})})}_getDefaults(){return Object.keys(this._defaults).reduce((t,e)=>(t[e]=this._defaults[e][1],t),{})}_commit(){return new Promise(t=>{chrome.storage.local.set({[this._storeKeyName]:this.storage},t)})}},P=s(33);var w=class extends y{constructor(){super("settings",{appEnabled:["boolean",!0],isTimeLimited:["boolean",!1],isItemsLimited:["boolean",!1],isCharsLimited:["boolean",!1],timeCount:["number",1],timePeriod:["string","w"],itemsLimit:["number",150],charsLimit:["number",5e3],sortMethod:["string","dateLastCopied"],guid:["string",""],loadOnScroll:["boolean",!0],showBadgeCount:["boolean",!0],contextMenuMode:["string","smart"],defaultViewMode:["string",c.a.ALL],defaultMergeChar:["string","newline"],copyFreshlyMerged:["boolean",!1],selectedTextAction:["string","auto"],theme:["string","auto"],autoSyncCloudPro:["boolean",!1],syncItemsDeletion:["boolean",!1],paymentsProvider:["string",h.i.PADDLE],pageWidgetContext:["boolean",!0],itemViewBreakText:["boolean",!0],itemViewFontSizePx:["number",14],itemViewMetaHidden:["boolean",!1],itemViewShowWhitespaces:["boolean",!1],pageWidgetX:["number",20],pageWidgetY:["number",20],pageWidgetWidth:["number",180],pageWidgetHeight:["number",200],lockEnabled:["boolean",!1],lockButtonHidden:["boolean",!1],lockSet:["boolean",!1],lockCodeHash:["string",""],lockTimer:["string",P.a.OFF],lockChangeBadge:["boolean",!0],isCloudProTimeLimited:["boolean",!1],cloudProTimeCount:["number",1],cloudProTimePeriod:["string","w"],isCloudProItemsLimited:["boolean",!1],cloudProItemsLimit:["number",150]}),this._localStorageSettingsKeys=["appEnabled","charsLimit","contextMenuMode","defaultMergeChar","defaultViewMode","guid","isCharsLimited","isItemsLimited","isTimeLimited","itemsLimit","loadOnScroll","oldCloudMigrated","showBadgeCount","sortMethod","timeCount","timePeriod"],this._themeProvider=new _.a}init(){return Promise.all([this._load(),this._checkMigration()]).then(([t,e])=>this._mixDefaults(t,e)).then(()=>this._commit())}set(t){return this._processLsSettings(t),super.set(t)}_processLsSettings(t){Object.keys(t).forEach(e=>{"theme"===e&&this._themeProvider.set(t[e])})}resetAll(){return new Promise((t,e)=>{chrome.storage.local.clear(()=>{chrome.runtime.lastError||(localStorage.clear(),t(),Object(v.a)())})})}_checkMigration(){return new Promise(t=>{chrome.storage.local.get("settings_migrated",e=>{if(e&&!0===e.settings_migrated)return void t({});const s=this._getLocalStorageSettings();t(s)})})}_getLocalStorageSettings(){return this._localStorageSettingsKeys.reduce((t,e)=>{if(void 0!==localStorage[e]){let s=localStorage[e];["true","false"].includes(s)&&(s="true"===s),t[e]=s}return t},{})}_removeLocalStorageSettings(){this._localStorageSettingsKeys.forEach(t=>localStorage.removeItem(t))}_mixDefaults(t,e={}){const s=Object.assign(this._getDefaults(),t,e);return"string"==typeof s.guid&&s.guid||(s.guid=Object(f.c)()),"-id"===s.sortMethod&&(s.sortMethod="dateAdded"),"-date"===s.sortMethod&&(s.sortMethod="dateLastCopied"),this.storage=s,Object.keys(e).length?new Promise(t=>{chrome.storage.local.set({settings_migrated:!0},()=>{chrome.runtime.lastError||this._removeLocalStorageSettings(),t()})}):Promise.resolve()}};var C=class{constructor(t){this.onChange=t||(()=>{throw new Error("onChangeHandler did not set")}),this.pasteElement=document.getElementById("paste-field"),this.currentTimer=null,this.enabled=null,this.notATextDetected=!1,this._pasteLoop=this._pasteLoop.bind(this)}start(){if(!this.pasteElement)throw new Error("No paste element found");this.enabled=!0,this.pasteElement.focus(),null===this.currentTimer&&(this.currentTimer=setTimeout(this._pasteLoop,1200))}stop(){clearTimeout(this.currentTimer),this.currentTimer=null,this.enabled=!1}_pasteLoop(){const t=this.pasteElement.value;this.pasteElement.value="",document.execCommand("paste");const e=this.pasteElement.value;e?e!==t&&(this.notATextDetected=!1,this.enabled&&this.onChange({isText:!0,value:e})):this.notATextDetected||(this.notATextDetected=!0,this.onChange({isText:!1,value:e})),clearTimeout(this.currentTimer),this.currentTimer=null,this.enabled&&(this.currentTimer=setTimeout(this._pasteLoop,1200))}},A=s(142),S=s(76),x=s.n(S);const I=/^\[(.+)\]$/;function M(t,e){let s=e.toLowerCase();const i=s.match(I);s=i&&i.length?i[1]:s;return i&&s?t.filter(t=>(t=>t.tags&&t.tags.some(t=>t.toLowerCase()===s))(t)):t.filter(t=>(t=>t.text.toLowerCase().includes(s))(t)||(t=>t.tags&&t.tags.some(t=>t.toLowerCase().includes(s)))(t))}function T({text:t,hash:e},s){const i=Date.now();return e||(e=a.a.hash(t)),{text:t,hash:e,dateAdded:i,dateLastCopied:i,length:t.length,shortText:t.slice(0,h.n),tags:[],sourceUrl:null,isFavorite:!1,isMerged:!1,isEdited:!1,isFromCloudPro:!1,...s}}function L(t){if("string"!=typeof(t=function(t){const e={full:"text",date:"dateAdded",favorite:"isFavorite",fromSync:"isFromSync",merged:"isMerged",sourceURL:"sourceUrl",tags:"tags"},s=Object.assign({},t);return Object.keys(e).forEach(i=>{const r=e[i];void 0!==t[i]&&void 0===s[r]&&(s[r]=t[i],delete s[i]),"tags"===i&&Array.isArray(t[i])&&(s[r]=t[i].map(t=>"object"==typeof t&&t.text?t.text:"string"==typeof t?t:void 0))}),s}(t)).text&&(t.text=""+t.text),!t.text)return null;const e=T({text:t.text}),s=Object.keys(e),i=["text"];return Object.keys(t).forEach(r=>{s.includes(r)&&!i.includes(r)&&(e[r]=t[r])}),e.dateAdded&&(e.dateAdded=new Date(e.dateAdded).getTime()),e.dateLastCopied=e.dateAdded,e.isFavorite&&void 0!==t.order&&(e.order=t.order),e}function k(t,e){return t.sort((t,s)=>void 0!==t.order&&void 0!==s.order?t.order-s.order:void 0!==t.order?-1:void 0!==t[e]&&void 0!==s[e]?s[e]-t[e]:0)}class O{constructor(t){this.dbInstance=null,this.table=null,this.onChange=t,this.hashCache=new Set,this.favoritesCount=null,this.fillHashCash=this.fillHashCash.bind(this)}init(){return new Promise(t=>{this.dbInstance=new A.a("clipboard-history"),this.dbInstance.version(.1).stores({history:"++id"}),this.dbInstance.version(1).stores({historyV2:"&hash, dateAdded, dateLastCopied"}).upgrade(this._migration),this.table=this.dbInstance.historyV2,t()}).then(this.fillHashCash).then(this.countFavorites.bind(this))}_migration(t){return t.table("history").toArray().then(t=>t.map(L)).then(e=>t.table("historyV2").bulkAdd(e)).then(()=>{0})}fillHashCash(){return this.table.toCollection().keys().then(t=>{const e=t.length;this.hashCache.clear();for(let s=0;s<e;s++)this.hashCache.add(t[s]);return this.emmitChange("cache_filled"),Promise.resolve({cacheSize:this.size})})}emmitChange(t,e={}){return new Promise(s=>{const i={type:t,...e};setTimeout(()=>{this.onChange(i)},0),s()})}isNew(t){return!this.hashCache.has(t)}getAll(){return this.table.orderBy("dateAdded").reverse().toArray().then(t=>({items:t}))}getItemByHash(t){return this.table.where({hash:t}).first().then(t=>({item:t}))}getItemsByHash(t,e){return this.table.where("hash").anyOf(e).reverse().sortBy(t).then(t=>({items:t}))}async getItems(t="dateLastCopied",e=0,s,i=""){const r=s===c.a.FAV,a=e*h.f,n=h.f,o=r?t=>t.isFavorite:()=>!0;let d,l=this.table.orderBy(t).filter(o),u=l,m=this.size;if(i&&"string"==typeof i){const t=M(l,i);m=t.toArray().then(t=>t.length),u=t}if(r){d=k(await u.toArray(),t).slice(a,a+n)}else d=u.reverse().offset(a).limit(n).toArray();return r&&(m=this.favSize),Promise.all([d,m]).then(([t,e])=>[t.map(t=>{const e={...t};return delete e.text,e}),e])}async getFavorites(t="dateLastCopied"){return k(await this.table.orderBy(t).reverse().filter(t=>t.isFavorite).toArray(),t)}getLatestItems(t="dateLastCopied",e){return this.table.orderBy(t).reverse().toArray().then(t=>t.slice(0,e))}add({hash:t,text:e},s){const i=T({text:e,hash:t},s);return this.table.add(i).then(()=>(this.hashCache.add(i.hash),this.emmitChange("added",{hash:i.hash}),{hash:i.hash}))}editText(t,e,s){const i={isEdited:!0};return t.tags&&(i.tags=[...t.tags]),i.sourceUrl=t.sourceUrl,i.isFavorite=t.isFavorite,s||(i.dateAdded=t.dateAdded,i.dateLastCopied=t.dateLastCopied),this.add({text:e},{...i}).then(e=>s?e:this.deleteItems([t.hash],!1).then(()=>e))}updateCopyDate(t,e=Date.now()){if("number"!=typeof e)throw new Error("Copy date is not number");return this.table.where({hash:t}).modify({dateLastCopied:e}).then(()=>this.emmitChange("updated_copy_date",{hash:t})).then(()=>({dateLastCopied:e}))}deleteItems(t,e=!0){Array.isArray(t)||(t=[t]);const s=e?t=>!t.isFavorite:()=>!0;return this.table.where("hash").anyOf(t).filter(s).delete().then(t=>{if(t)return this.emmitChange("item_deleted").then(this.fillHashCash)})}deleteAll(t){return this.table.filter(e=>!e.isFavorite&&e.hash!==t).delete().then(t=>{if(t)return this.emmitChange("items_deleted").then(this.fillHashCash)})}limitItemsCount(t="dateLastCopied",e,s){return this.table.count().then(i=>{const r=i-e;return this.table.orderBy(t).filter(t=>!t.isFavorite&&t.hash!==s).limit(r).delete()}).then(t=>t?this.emmitChange("items_deleted").then(this.fillHashCash):Promise.resolve()).catch(O._handleException)}deleteOutdated(t,e,s){this.table.where(t).below(e).filter(t=>t.hash!==s&&!t.isFavorite).delete().then(t=>t?this.emmitChange("items_deleted").then(this.fillHashCash):Promise.resolve()).catch(O._handleException)}setFavorite(t,e){if("boolean"!=typeof e)throw new Error("Favorite state is not boolean");return Array.isArray(t)||(t=[t]),this.table.where("hash").anyOf(t).modify(t=>{t.isFavorite=e,e||delete t.order}).then(()=>this.emmitChange("item_changed")).then(()=>{if(1!==t.length)return this.countFavorites();this.favoritesCount+=e?1:-1,this.favoritesCount<0&&(this.favoritesCount=0)})}setSourceUrl(t,e){if("string"!=typeof e)throw new Error("Source URL is no a string");return this.table.where({hash:t}).modify({sourceUrl:e}).then(()=>this.emmitChange("item_changed"))}setTags(t,e){const s=e.filter(t=>"string"==typeof t);return this.table.where({hash:t}).modify({tags:s}).then(()=>this.emmitChange("item_changed"))}getAllTags(){return this.table.filter(t=>t.tags&&t.tags.length).toArray().then(t=>{const e=t.reduce((t,e)=>(e.tags.forEach(e=>t.add(e)),t),new Set);return Array.from(e)}).then(t=>({allTags:t}))}addMerged(t,e){let s={newline:"\n",comma:",",semicolon:";",space:" ",tab:"\t",empty:""}[e];return void 0===s&&(s="\n"),this.table.where("hash").anyOf(t).toArray().then(e=>e.sort((e,s)=>t.indexOf(e.hash)-t.indexOf(s.hash)).map(t=>t.text).join(s)).then(t=>{const e=a.a.hash(t);return this.add({hash:e,text:t},{isMerged:!0})})}addCloudPro(t){return Array.isArray(t)||(t=[t]),this.addRemote(t,"isFromCloudPro","items_cloud_pro")}addRemote(t,e,s){const i=t.map(t=>{if(this.isNew(t.hash)){const s={[e]:!0,...t};return delete s.dateLastCopied,delete s.dateAdded,T({text:t.text,hash:t.hash},{...s})}}).filter(Boolean);return i&&i.length?this.bulkAdd(i,s):Promise.resolve()}importItems(t){const e=t.map(L).filter(Boolean);return e&&e.length?this.bulkAdd(e,"items_imported"):Promise.resolve()}bulkAdd(t,e){return this.table.bulkAdd(t).catch(A.a.BulkError,t=>(console.warn(t),Promise.resolve())).then(()=>this.emmitChange(e)).then(()=>this.fillHashCash()).then(()=>this.countFavorites())}countFavorites(){return this.table.filter(t=>t.isFavorite).count().then(t=>{this.favoritesCount=t>=0?t:0}).then(()=>this.emmitChange("fav_counted"))}async setOrder(t,e,s){const i=await this.getFavorites(),r=x()(i,e,s).map(t=>null==t?void 0:t.hash).filter(Boolean);return this.table.where("hash").anyOf(r).modify(t=>{const e=r.indexOf(t.hash);-1!==e&&t.order!==e&&(t.order=e)}).then(()=>this.emmitChange("item_changed"))}get favSize(){return this.favoritesCount}get size(){return this.hashCache.size}static _handleException(t){o.a(t)}}var D=O;const j=chrome.i18n.getMessage,F=()=>{};class E{constructor({getFavoritesItems:t,getLatestItems:e,runPageWidget:s=F,processSelectedText:i=F,isLockedFn:r=F}){this.dbProvider={getFavoritesItems:t,getLatestItems:e},this.runPageWidget=s,this.processSelectedText=i,this.isLockedFn=r,this.lastType=null,this.lastSortMethod=null,this.lastSelectedTextAction=!1,this._createLocked=!1,this._updateAfterLock=!1,this.create=Object(f.b)(this.create,100),this.update=Object(f.b)(this.update,100)}removeAll(){return new Promise(t=>{chrome.contextMenus.removeAll(t)})}create({type:t=this.lastType,sortMethod:e=this.lastSortMethod,createWidgetMenu:s=this.lastShouldCreateWidgetMenu,selectedTextAction:i=this.lastSelectedTextAction}){this._createLocked?this._updateAfterLock=!0:(this._createLocked=!0,this.removeAll().then(()=>this._createPageMenu(t,e)).then(()=>this._createSelectionMenu(i)).then(()=>this._tryCreatePageWidgetMenu(s)).then(()=>{this._createLocked=!1,this._updateAfterLock&&(this._updateAfterLock=!1,this.update())}).catch(t=>{this._createLocked=!1,this._updateAfterLock=!1}))}update(){this.lastType&&"string"==typeof this.lastType&&this.create(this.lastType)}_createPageMenu(t,e){if(this.lastType=t,this.lastSortMethod=e,this.isLockedFn())return Promise.resolve();switch(t){case"smart":return Promise.all([this.dbProvider.getFavoritesItems(e),this.dbProvider.getLatestItems(e,7)]).then(this._createSmartMenu.bind(this));case"favorites":return this.dbProvider.getFavoritesItems(e).then(this._createSimpleMenu.bind(this));case"recent":return this.dbProvider.getLatestItems(e,7).then(this._createSimpleMenu.bind(this));case"both":return Promise.all([this.dbProvider.getFavoritesItems(e),this.dbProvider.getLatestItems(e,7)]).then(this._createFullMenu.bind(this))}return Promise.resolve()}_createSelectionMenu(t){if(this.lastSelectedTextAction=t,!t||"none"===t)return Promise.resolve();let e;switch(t){case"save":e=j("context_save_selected");break;case"send":e=j("context_send_selected");break;case"fav":e=j("context_fav_selected")}return new Promise(t=>{chrome.contextMenus.create({type:"normal",contexts:["selection"],title:e,onclick:t=>{t.selectionText&&(this.processSelectedText(t.selectionText,t.pageUrl),Object(n.a)("Context","SendSelected"))}},t)})}_tryCreatePageWidgetMenu(t){const e="Run Clipboard Widget";if(this.lastShouldCreateWidgetMenu=t,!t)return Promise.resolve();const s=new Promise(t=>{chrome.contextMenus.create({title:e,contexts:["page","frame","image"],onclick:()=>{this.runPageWidget(),Object(n.a)("Context","PageWidget","contextMenu")}},t)}),i=new Promise(t=>{chrome.contextMenus.create({title:e,contexts:["browser_action"],onclick:()=>{this.runPageWidget(),Object(n.a)("Context","PageWidget","browserAction")}},t)});return Promise.all([s,i])}_createSimpleMenu(t){if(t.length){let e=this._createMainMenu();return this._insertMenuItems(e,t)}}_createSmartMenu(t,e){let s=t[0]||[],i=t[1]||[];if(s.length||i.length){let t=this._createMainMenu();if(e||s.length){let e=this._createSubMenu(j("context_menu_recent"),t),r=this._createSubMenu(j("context_menu_favorites"),t);return Promise.resolve([this._insertMenuItems(e,i),this._insertMenuItems(r,s)])}return this._insertMenuItems(t,i)}}_createFullMenu(t){return this._createSmartMenu(t,!0)}_createMainMenu(){return chrome.contextMenus.create({type:"normal",contexts:["editable"],title:j("context_menu_title")})}_createSubMenu(t,e){return chrome.contextMenus.create({parentId:e,type:"normal",contexts:["editable"],title:t})}_insertMenuItems(t,e){return new Promise(s=>{e.length?e.forEach(e=>{var i;let r=e.text;if(null!==(i=e.tags)&&void 0!==i&&i.length){const t=e.tags[0];r=`[[${t.length<=5?t:t.slice(0,5)+"..."}]] ${r}`}r=e.text.length<50?E._simplifyText(r):E._trimText(r)+"...",r&&chrome.contextMenus.create({type:"normal",contexts:["editable"],title:r,parentId:t,onclick:(t,s)=>{this._runPaste(e,s)}},s)}):chrome.contextMenus.create({type:"normal",contexts:["editable"],title:j("context_menu_empty"),parentId:t,enabled:!1},s)})}_runPaste(t,e){null!=e&&e.id&&-1!==e.id&&this._performPaste(e.id,t.text).then(()=>{}).catch(()=>this._attemptToInjectCS(e.id).then(()=>this._performPaste(e.id,t.text))).catch(t=>{t&&o.a(t)})}_performPaste(t,e){return new Promise((s,i)=>{chrome.tabs.sendMessage(t,{action:"context_menu_paste",text:e},t=>{chrome.runtime.lastError||!t?i():t.paste?s():i()})})}_attemptToInjectCS(t){return new Promise((e,s)=>{chrome.tabs.executeScript(t,{file:"/content-script/content-script.js",runAt:"document_idle"},(function(){chrome.runtime.lastError?s():e()}))})}static _trimText(t){return E._simplifyText(t).substring(0,50)}static _simplifyText(t){return t.trim().replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")}}var W=E,H=s(38);var U=function(t){return new Promise(e=>{chrome.windows.getLastFocused(s=>{chrome.runtime.lastError&&e(null),s&&s.focused?chrome.tabs.query({active:!0,windowId:s.id},s=>{s&&s.length&&s[0].url?e({url:s[0].url,hash:t}):e(null)}):e(null)})})};let B=null;chrome.runtime.onInstalled.addListener(({reason:t,previousVersion:e})=>{B={reason:t,previousVersion:e}});var R=class extends y{constructor(){super("promos",{optimize:["boolean",!0],optimizeCloudPro:["boolean",!0],updateModal:["boolean",!1],updateNotification:["boolean",!1],subsCounter:["number",0],redDot:["boolean",!0],welcome:["boolean",!1],surveyAsk:["boolean",!1],actionRequired:["boolean",!1]}),this._currentVersion="",this._previousVersion="",this._hasSubs=null,this._isInited=!1}init(t){super.init().then(()=>{this._hasSubs=t,this._currentVersion=chrome.runtime.getManifest().version,this._processLastEvent(),this._isInited=!0})}_processLastEvent(){if(B&&B.reason){const{reason:t,previousVersion:e}=B;"update"===t?(this._previousVersion=e,this._handleUpdate()):"install"===t&&this._handleInstall(),B=null}}_isPrevVer(t){if(t&&this._previousVersion)return this._previousVersion.startsWith(t)}_isCurVer(t){if(t&&this._currentVersion)return this._currentVersion.startsWith(t)}_handleUpdate(){this._previousVersion!==this._currentVersion&&this._isCurVer("3.11")}_handleInstall(){this.set({welcome:!0,redDot:!0})}_isInit(){return this._isInited}processShow(t){const e={};return this.storage.optimize&&t>h.e?e.optimize=!0:this.storage.subsCounter>=15?(this.set({subsCounter:0}),e.subsCounter=!0):this.set({subsCounter:this.storage.subsCounter+1}),this.storage.optimizeCloudPro&&(e.optimizeCloudPro=!0),this.storage.redDot&&(e.redDot=!0),this.storage.updateModal&&(e.updateModal=!0),this.storage.welcome&&(e.welcome=!0),this.storage.updateNotification&&(e.updateNotification=!0),this.storage.surveyAsk&&(e.surveyAsk=!0),this.storage.actionRequired&&(e.actionRequired=!0),e}completePromo(t){this.set({[t]:!1})}};var N=class{constructor(){this._tabsWithWidget=new Set,this._inited=!1}init(){this._startCleanupHandlers(),this._inited=!0}isInit(){return this._inited}_startCleanupHandlers(){chrome.tabs.onRemoved.addListener(t=>{this._tabsWithWidget.delete(t)}),chrome.tabs.onUpdated.addListener((t,e)=>{"loading"===e.status&&this._tabsWithWidget.delete(t)})}runOnCurrentTab(){return new Promise(t=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(!e||!e.length)return void t();const s=e[0].id;s===chrome.tabs.TAB_ID_NONE||e[0].url.includes("chrome://")?t():t(this.run(s))})})}run(t){return new Promise(e=>{this._tabsWithWidget.has(t)?e(this.show(t)):chrome.tabs.executeScript(t,{file:"page-widget/page-widget.js"},()=>{e(),chrome.runtime.lastError?console.warn(chrome.runtime.lastError.message):(this._tabsWithWidget.add(t),Object(n.e)("PageWidget"))})})}show(t){return new Promise(e=>{chrome.tabs.sendMessage(t,{action:"showPageWidget"},()=>{chrome.runtime.lastError&&console.warn(chrome.runtime.lastError.message),e()})})}updateAll(){this._tabsWithWidget.forEach(t=>{chrome.tabs.sendMessage(t,{action:"updatePageWidget"},()=>{chrome.runtime.lastError&&console.warn(chrome.runtime.lastError.message)})})}updateActiveHash(t){this._tabsWithWidget.forEach(e=>{chrome.tabs.sendMessage(e,{action:"updateActiveHash",activeHash:t},()=>{chrome.runtime.lastError&&console.warn(chrome.runtime.lastError.message)})})}},V=s(143);class z{constructor(){this._screenshots=[]}init(){chrome.runtime.onMessage.addListener((t,e,s)=>{if("_makeCapture"===t.action)return this._capture(t,s),!0})}_initScrolling(t,e){chrome.tabs.sendMessage(t.id,{msg:"scrollPage"},(function(){e()}))}_makeCapture(){return new Promise(t=>{chrome.tabs.captureVisibleTab(null,{format:"png",quality:100},e=>{t(e)})})}async _capture(t,e){const s=await this._makeCapture();if(s){let i=new Image;i.onload=()=>{if(t.image={width:i.width,height:i.height},t.windowWidth!==i.width){let e=i.width/t.windowWidth;t.x*=e,t.y*=e,t.totalWidth*=e,t.totalHeight*=e}this._screenshots.length||Array.prototype.push.apply(this._screenshots,this._initScreenshots(t.totalWidth,t.totalHeight)),this._filterScreenshots(t.x,t.y,i.width,i.height,this._screenshots).forEach((function(e){e.ctx.drawImage(i,t.x-e.left,t.y-e.top)})),e(!0)},i.src=s}}_initScreenshots(t,e){let s,i,r,a,n,o=e>3e4||t>3e4||e*t>24e7,h=t>e,c=o?h?3e4:8e3:t,d=o?h?8e3:3e4:e,l=Math.ceil(t/c),u=Math.ceil(e/d),m=0,g=[];for(s=0;s<u;s++)for(i=0;i<l;i++)r=document.createElement("canvas"),r.width=i===l-1&&t%c||c,r.height=s===u-1&&e%d||d,a=i*c,n=s*d,g.push({canvas:r,ctx:r.getContext("2d"),index:m,left:a,right:a+r.width,top:n,bottom:n+r.height}),m++;return g}_filterScreenshots(t,e,s,i,r){let a=t+s,n=e+i;return r.filter((function(s){return t<s.right&&a>s.left&&e<s.bottom&&n>s.top}))}static _dataURItoBlob(t){let e=atob(t.split(",")[1]),s=t.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(e.length),r=new Uint8Array(i);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return new Blob([i],{type:s})}_getBlobs(t){return t.map(t=>{let e=t.canvas.toDataURL();return z._dataURItoBlob(e)})}_captureToBlobs(t){return new Promise((e,s)=>{let i=!1,r=!1;const a=()=>{this._initScrolling(t,()=>{e(this._getBlobs(this._screenshots))})};this._screenshots=[];const n=t.id;chrome.tabs.sendMessage(n,{action:"ping"},t=>{chrome.runtime.lastError||!t||"pong"!==t.action?chrome.tabs.executeScript(n,{file:"content-script/capture-page.js"},()=>{chrome.runtime.lastError?s(chrome.runtime.lastError.message):r?s("Timed out too early while waiting for executeScript"):(i=!0,a())}):a()}),window.setTimeout((function(){i||(r=!0,s("Execute timeout for capture"))}),3e3)})}static getDateFileName(){return l()().format("DD-MMM-YYYY_HH-mm-ss")}captureFullActiveTab(){return new Promise((t,e)=>{chrome.tabs.query({active:!0,currentWindow:!0},async s=>{try{(await this._captureToBlobs(s[0])).forEach(t=>{Object(V.saveAs)(t,`page_full_${z.getDateFileName()}.png`)}),t()}catch(t){e(t)}})})}async captureActiveTab(){const t=await this._makeCapture();Object(V.saveAs)(z._dataURItoBlob(t),`page_${z.getDateFileName()}.png`)}}var $=z;let q=null;async function K(t){if(!t())return Promise.reject("no_subs");if(q){return!!await new Promise(t=>{chrome.windows.get(q,e=>{!chrome.runtime.lastError&&e||t(!1),chrome.windows.update(q,{focused:!0},()=>{chrome.runtime.lastError?t(!1):t(!0)})})})||G()}return G()}function G(){return new Promise(t=>{chrome.windows.create({url:"popup.html",width:630,height:500,type:"popup",focused:!0},e=>{t(),e&&e.tabs&&e.tabs.length&&(q=e.id)})})}var Y=s(50),J=s(25);s(238),s(240),s(538);const Q={apiKey:"AIzaSyDw1aayLI6NJQiVGMZ2QwL6TSF6UzZoOiA",databaseURL:"https://clipboard-history-pro-249808.firebaseio.com",storageBucket:"clipboard-history-pro-249808.appspot.com",authDomain:"auth.clipboardextension.com"};var Z=s(223);const X=s.n(Z)()(()=>{const t=h.l.join(",");return fetch("https://us-central1-clipboard-history-pro-249808.cloudfunctions.net/getPrice?product_ids="+t).then(t=>t.json())},{maxAge:432e5,promise:!0});function tt(t){return!!t&&p().isSameOrBefore(t,"day")}const et={LIMIT:"limit_count",OUTDATED:"outdated"},st=Object.values(et);class it extends y{constructor({onProStatusConfirmed:t}){super("fbdb",{hadPaymentsData:["boolean",!1]}),this._userData=null,this._userId=null,this._itemsRefStr=null,this._paymentRefStr=null,this._paymentData=null,this._sortMethod=null,this._instanceInited=!1,this._authListenerInit=!1,this._dbListenerInit=!1,this._delayedClean={},this._onProStatusConfirmed=t}initStorable(){return super.init()}init(t="dateLastCopied"){this.isInit()||(this._sortMethod=t,J.a.initializeApp(Q),this.functions=J.a.functions(),this.db=J.a.database(),this._startAuthHandler(),this._instanceInited=!0)}isInit(){return this._instanceInited}hasAuth(){return Boolean(this._userData&&this._userId)}addItems(t){if(!t||!t.length)return void 0;if(!this._itemsRefStr)return void 0;t=(t=t.filter(t=>t.text&&t.hash)).map(t=>(t.sourceDevice="extension_edge",t.dateAdded=Date.now(),t.dateLastCopied=Date.now(),t));const e=J.a.database().ref(this._itemsRefStr),s=t.map(t=>e.child(t.hash).set(t));return Promise.all(s)}getAll(t=0,e){if(!this._itemsRefStr)return Promise.resolve([]);const s=J.a.database().ref(this._itemsRefStr);return this._ensureFirstLoad().then(()=>s.orderByChild(this._sortMethod).once("value").then(s=>{let i=[];s.forEach(t=>{i.push(t.val())}),i=i.reverse().filter(t=>t.text&&t.hash).map(({text:t,hash:e,...s})=>T({text:t,hash:e},s)),e&&(i=M(i,e));const r=i.length;return i=i.slice(t*h.f,(t+1)*h.f),this._dbListenerInit||this._ensureFirstLoad(),[i,r]}))}getItem(t){if(!t)return Promise.reject("No hash");if(!this._itemsRefStr)return Promise.reject("No user auth");return J.a.database().ref(this._itemsRefStr+"/"+t).once("value").then(t=>{const e=t.val();if(!e.hash||!e.text)return Promise.reject("Bad item");return{item:T({text:e.text,hash:e.hash},{...e})}})}getPaymentData(t=!1){if(!this._itemsRefStr)return null;if(!t)return this._paymentData;return J.a.database().ref(this._paymentRefStr).once("value").then(t=>(this._paymentData=t.val(),this._paymentData))}deleteItems(t){if(!this._itemsRefStr)return Promise.reject("No user auth");const e=t.reduce((t,e)=>(t[e]=null,t),{});return J.a.database().ref(this._itemsRefStr).update({...e})}deleteAll(){if(!this._itemsRefStr)return Promise.reject("No user auth");return J.a.database().ref(this._itemsRefStr).set(null)}limitItemsCount(t){return this._autoClean(et.LIMIT,{limit:t})}deleteOutdated(t,e){return this._autoClean(et.OUTDATED,{outdatedTimestamp:e})}async _autoClean(t,e){if(!this._itemsRefStr)return this.get("hadPaymentsData")&&(this._delayedClean={[t]:e},console.debug(`%cFB: setup delayed clean "${t}"`,"color:dimgray")),Promise.resolve([]);const s=J.a.database().ref(this._itemsRefStr);let i=s.orderByChild(this._sortMethod);return t===et.OUTDATED&&(i=i.endAt(e.outdatedTimestamp)),i.once("value").then(i=>{const r=i.val();let a=!1;if(r){const i=Object.values(r);if(t===et.LIMIT&&e.limit){i.sort((t,e)=>e[this._sortMethod]-t[this._sortMethod]).slice(e.limit).forEach(t=>{s.child(t.hash).set(null)}),a=!0}t===et.OUTDATED&&(i.forEach(t=>{s.child(t.hash).set(null)}),a=!0)}else a=!0;this._delayedClean[t]&&a&&(delete this._delayedClean[t],console.debug(`%cFB: remove delayed clean "${t}"`,"color:dimgray"))}).catch(t=>{o.a(t)})}async setTags(t,e){if(!t)return Promise.reject("No hash");if(!this._itemsRefStr)return Promise.reject("No user auth");if(!Array.isArray(e))return Promise.reject("Tags is not an array");const{item:s}=await this.getItem(t);s.tags=e;return J.a.database().ref(this._itemsRefStr+"/"+t).set(s)}getAuthInfo(){if(!this._userData)return null;const{uid:t,email:e,photoURL:s,displayName:i,providerData:r}=this._userData;return{uid:t,email:e,photoURL:s,displayName:i,providerData:r}}signOut(){return J.a.auth().signOut().then(()=>this.set({hadPaymentsData:!1})).then(()=>{this._userData=null,this._userId=null,this._itemsRefStr=null,this._paymentData=null}).catch(t=>{o.a(t)})}authUser(t){return new Promise((e,s)=>{let i;switch(t){case h.b.GOOGLE:i=new J.a.auth.GoogleAuthProvider;break;case h.b.FACEBOOK:i=new J.a.auth.FacebookAuthProvider;break;default:i=new J.a.auth.GoogleAuthProvider}J.a.auth().signInWithPopup(i).then(e).catch(s)})}_startAuthHandler(){J.a.auth().onAuthStateChanged(t=>{t&&(this._userData=t,this._userId=t.uid,this._itemsRefStr=`users/${this._userId}/items`,this._paymentRefStr=`users/${this._userId}/paymentData`,this._startChangesListener(),this._runDelayedClean()),Object(Y.a)("updateFbAuthStatus",{hasCloudProAuth:this.hasAuth()})})}_ensureFirstLoad(){return this._dbListenerInit?Promise.resolve():new Promise(t=>{J.a.database().ref(this._itemsRefStr).on("value",()=>{t()}),this._dbListenerInit=!0})}_startChangesListener(){this._authListenerInit||(J.a.database().ref(this._paymentRefStr).on("value",t=>{var e,s;this._paymentData=t.val();const i=Boolean(this._paymentData&&(Object(f.d)(null===(e=this._paymentData)||void 0===e?void 0:e.status)||tt(null===(s=this._paymentData)||void 0===s?void 0:s.cancellation_effective_date)));this.set({hadPaymentsData:i});const r=this.hasSubs();"function"==typeof this._onProStatusConfirmed?r&&this._onProStatusConfirmed():console.error("_handleUpdateAuthState is not a function"),Object(Y.a)("updatePaymentData",{hasSubs:r,paymentData:this._paymentData})}),this._authListenerInit=!0)}_runDelayedClean(){st.forEach(async t=>{this._delayedClean[t]&&(console.debug(`%cFB: run delayed clean "${t}"`,"color:dimgray"),await this._autoClean(t,this._delayedClean[t]))})}hasSubs(){var t,e;return this._paymentRefStr&&this._paymentData?Object(f.d)(null===(t=this._paymentData)||void 0===t?void 0:t.status)||tt(null===(e=this._paymentData)||void 0===e?void 0:e.cancellation_effective_date):!0===this.get("hadPaymentsData")}getPrice(t){return X(t)}}var rt=class{constructor(){this._permissions={},this._optionalPermissions=["tabs"]}async init(){await this._updatePermissions()}async _updatePermissions(){this._permissions=await this._checkPermission(this._optionalPermissions)}_checkPermission(t){return new Promise(e=>{chrome.permissions.getAll(({permissions:s=[]})=>{const i=t.reduce((t,e)=>(t[e]=s.includes(e),t),{});e(i)})})}_requestPermission(t){return new Promise(e=>{chrome.permissions.request({permissions:t},e)})}_removePermission(t){return new Promise(e=>{chrome.permissions.remove({permissions:t},e)})}async requestPermission(t){const e=await this._requestPermission([t]);return this._permissions[t]=e,Object(n.a)("Permissions","Enable",t),{[t]:e}}async removedPermission(t){const e=await this._removePermission([t]);return this._permissions[t]=!e,Object(n.a)("Permissions","Disable",t),{[t]:e}}getAll(){return this._permissions}};var at=async function({db:t,hasSubs:e,command:s,contextMenu:i}){if(!e)return;const r=parseInt(s[s.length-1]),a=await t.getFavorites();null!=a&&a.length&&a[r]&&chrome.tabs.query({active:!0,currentWindow:!0},t=>{if(null!=t&&t.length){const e=a[r],s=t[0];i._runPaste(e,s)}})};try{Object(n.e)("Background")}catch(t){0}var nt=class{constructor(){this.settings=new w,this.db=new D(this.onDbChange.bind(this)),this.clipMon=new C(this.onTextChange.bind(this)),this.widgetManager=new N,this.fb=new it({onProStatusConfirmed:this.checkProProFeatures.bind(this)}),this.promos=new R,this.capture=new $,this.perm=new rt,this.contextMenu=new W({getFavoritesItems:this.db.getFavorites.bind(this.db),getLatestItems:this.db.getLatestItems.bind(this.db),runPageWidget:this.runPageWidgetCurrentTab.bind(this),processSelectedText:this.processSelectedTextAction.bind(this),isLockedFn:()=>this.settings.get("lockEnabled")}),this.currentActiveHash=null,this.lastUpdatedHash=null,this.firstTimeTextChange=!0,this._isProInit=!1}start(){Object(H.b)(),this.settings.init().then(()=>this.db.init()).then(async()=>{await this.fb.initStorable(),await this.perm.init()}).then(()=>{this.onAppStateChanged(),this.startMessageHandler()}).then(()=>{this.controlLimit(),this.startOutdatedChecker(),this.checkProProFeatures(),this.initPromos(),this.createContextMenu(),this.startCommandListener(),this.capture.init(),X(this.settings.get("guid"))}).then(()=>{Object(n.d)("Background","Init",Math.round(performance.now())),chrome.runtime.setUninstallURL(h.r)}).catch(t=>{o.a(t)})}onTextChange({isText:t,value:e}){if(this.firstTimeTextChange&&setTimeout(()=>{this.firstTimeTextChange=!1},0),!t||!e)return void this.resetActive();if(this.settings.get("isCharsLimited")&&e.length>this.settings.get("charsLimit"))return void this.resetActive();const s=a.a.hash(e);if(this.db.isNew(s))this.db.add({hash:s,text:e}).then(()=>this.setActive(s)).then(()=>this.autoSendToCloudPro(e,s)).catch(t=>{o.a(t),this.resetActive()});else{if(this.firstTimeTextChange)return void this.setActive(s);this.lastUpdatedHash!==s&&this.setActive(s).then(()=>this.db.updateCopyDate(s)).then(()=>this.lastUpdatedHash=s).catch(t=>{o.a(t),this.resetActive()})}}onDbChange(t){const{type:e,hash:s}=t;this.settings.get("showBadgeCount")&&Object(H.b)(this.db.size),"cache_filled"!==e&&this.contextMenu.update(),"added"===e&&(this.controlLimit(),this.detectSourceUrl(s),Object(Y.a)("reloadData")),"updated_copy_date"!==e?this.widgetManager.updateAll():(this.widgetManager.updateActiveHash(this.currentActiveHash),Object(Y.a)("updateActiveHash",{hash:this.currentActiveHash}))}onAppStateChanged(){const t=this.settings.get("appEnabled");t?this.clipMon.start():this.clipMon.stop(),Object(H.a)(t)}detectSourceUrl(t){t&&U(t).then(t=>{null!==t&&t.hash&&t.url&&this.db.setSourceUrl(t.hash,t.url)})}setActive(t){return this.currentActiveHash=t,Promise.resolve()}resetActive(){return this.currentActiveHash=null,Promise.resolve()}hasSubs(){return this.fb.hasSubs()}autoSendToCloudPro(t,e){return this.settings.get("autoSyncCloudPro")&&this.hasSubs()?this.fb.addItems([{text:t,hash:e}]):Promise.resolve()}_getSelectedTextRealAction(){let t=this.settings.get("selectedTextAction");return"auto"===t&&(t=this.hasSubs()?"send":"save"),t}processSelectedTextAction(t,e=null){const s=a.a.hash(t),i={hash:s,text:t};e&&(i.sourceUrl=e);const r=this._getSelectedTextRealAction();if("send"===r)this.fb.addItems([i]).catch(t=>{o.a(t)});else if("save"===r||"fav"===r){if(!this.db.isNew(s))return;this.db.add(i,{isFavorite:Boolean("fav"===r)}).catch(t=>{o.a(t)})}}controlLimit(){this.settings.get("isItemsLimited")&&this.db.limitItemsCount(this.settings.get("sortMethod"),this.settings.get("itemsLimit"),this.currentActiveHash)}controlFbLimit(){this.settings.get("isCloudProItemsLimited")&&this.fb.limitItemsCount(this.settings.get("cloudProItemsLimit"))}createContextMenu(){const t=this.hasSubs()&&this.settings.get("pageWidgetContext");this.contextMenu.create({type:this.settings.get("contextMenuMode"),sortMethod:this.settings.get("sortMethod"),createWidgetMenu:t,selectedTextAction:this._getSelectedTextRealAction()})}importItems(t){let e=Promise.resolve(!1);const s={isItemsLimited:!1,isTimeLimited:!1},i=Object.keys(s);i.some(t=>this.settings.get(t))&&(e=this.settings.set(s));const r=this.db.importItems(t);return Promise.all([e,r]).then(([t])=>({settingsDisabled:t?i:[]}))}startOutdatedChecker(){(this.settings.get("isTimeLimited")||this.settings.get("isCloudProTimeLimited"))&&(this.checkOutdated(),setInterval(()=>this.checkOutdated(),6e4))}checkOutdated(){if(this.settings.get("isTimeLimited")){0;const t=this.settings.get("timeCount"),e=this.settings.get("timePeriod"),s=p().subtract(t,e).valueOf();this.db.deleteOutdated(this.settings.get("sortMethod"),s,this.currentActiveHash)}if(this.settings.get("isCloudProTimeLimited")){0;const t=this.settings.get("cloudProTimeCount"),e=this.settings.get("cloudProTimePeriod"),s=p().subtract(t,e).valueOf();this.fb.deleteOutdated(this.settings.get("sortMethod"),s)}}checkProProFeatures(){this.hasSubs()&&!this._isProInit&&this.initProFeatures()}initProFeatures(){this.initFb(),this.initWidgetManager(),this.handleLockStart(),this.controlFbLimit(),this._isProInit=!0}initPromos(){this.promos._isInit()||this.promos.init(this.hasSubs())}startCommandListener(){chrome.commands.onCommand.addListener(t=>{try{switch(t){case"runPageWidget":this.runPageWidgetCurrentTab();break;case"lockNow":Object(P.c)(this.hasSubs.bind(this),this.settings);break;case"floatingMode":K(this.hasSubs.bind(this)).catch(t=>{console.error(t)});break;case"pasteFav0":case"pasteFav1":case"pasteFav2":at({command:t,hasSubs:this.hasSubs(),db:this.db,contextMenu:this.contextMenu})}Object(n.c)("Command",t,this.hasSubs())}catch(t){console.error(t)}})}initWidgetManager(){this.hasSubs()&&!this.widgetManager.isInit()&&this.widgetManager.init()}initFb(){this.hasSubs()&&this.fb.init(this.settings.get("sortMethod"))}runPageWidgetCurrentTab(){return this.hasSubs()?this.widgetManager.runOnCurrentTab():Promise.resolve()}handleLockStart(){this.settings.get("lockEnabled")&&(this.settings.set({lockSet:!0}),this.hasSubs()&&Object(H.c)(!0,this.settings))}async getUserProData(t=!1,e=h.b.GOOGLE){this.fb.isInit()||this.fb.init(this.settings.get("sortMethod"));try{t&&await this.fb.authUser(e);const s=await this.fb.getPaymentData(t);return{userAuthData:this.fb.getAuthInfo(),paymentData:s||null}}catch(t){return Promise.reject(t)}}startMessageHandler(){chrome.runtime.onMessage.addListener(this.handleApiCall.bind(this))}getLockStatus(){return this.hasSubs()&&this.settings.get("lockSet")&&this.settings.get("lockEnabled")}collectDebugInfo(){return function({settings:t,db:e}){return Promise.all([chrome.runtime.getManifest().version,window.navigator.userAgent,t.getAll(),e.size]).then(([t,e,s,i])=>({debugInfo:{appVersion:t,userAgent:e,settings:s,dbSize:i}})).catch(t=>Promise.resolve({debugInfo:"error: "+t}))}({settings:this.settings,db:this.db})}cloudProSendItem(t){return this.db.getItemsByHash(this.settings.get("sortMethod"),t.hashArr).then(({items:t})=>this.fb.addItems(t)).then(()=>this.controlFbLimit())}handleApiCall(t,e,s){if(!t||!t.action||"string"!=typeof t.action)return void 0;if(t.action.startsWith("_"))return;let i;switch(t.action){case"getAll":i=this.db.getAll().then(t=>({...t,activeHash:this.currentActiveHash}));break;case"getItem":i=Object(c.c)(t.viewMode)?this.fb.getItem(t.hash):this.db.getItemByHash(t.hash);break;case"getItemsByHash":i=this.db.getItemsByHash(this.settings.get("sortMethod"),t.hashArr);break;case"getItems":i=t.type===c.a.CLOUD_PRO?this.hasSubs()?this.fb.getAll(t.page,t.search).then(([t,e])=>({items:t,activeHash:this.currentActiveHash,totalCount:e})):{}:this.db.getItems(this.settings.get("sortMethod"),t.page,t.type,t.search).then(([t,e])=>({items:t,activeHash:this.currentActiveHash,totalCount:e}));break;case"getActiveHash":i={activeHash:this.currentActiveHash};break;case"setFavorite":i=this.db.setFavorite(t.hashArr,t.state);break;case"setTags":i=Object(c.c)(t.viewMode)?this.fb.setTags(t.hash,t.tags):this.db.setTags(t.hash,t.tags);break;case"getAllTags":i=this.db.getAllTags();break;case"addMerged":i=this.db.addMerged(t.hashArr,t.delimiterName);break;case"deleteItems":Object(c.c)(t.viewMode)?(i=this.fb.deleteItems(t.hashArr),this.settings.get("syncItemsDeletion")&&this.db.deleteItems(t.hashArr)):(i=this.db.deleteItems(t.hashArr),this.settings.get("syncItemsDeletion")&&this.fb.deleteItems(t.hashArr));break;case"deleteAll":i=Object(c.c)(t.viewMode)?this.fb.deleteAll():this.db.deleteAll(this.currentActiveHash);break;case"getSettings":i={settings:this.settings.getAll()};break;case"initData":i={settings:this.settings.getAll(),hasSubs:this.hasSubs(),locked:this.getLockStatus(),hasCloudProAuth:this.fb.hasAuth(),promos:this.promos.processShow(this.db.size),permissions:this.perm.getAll(),paymentData:this.fb.getPaymentData()};break;case"setSettings":i=this.settings.set(t.settings),void 0!==t.settings.appEnabled&&this.onAppStateChanged();break;case"resetSettings":i=this.settings.resetAll();break;case"importItems":i=this.importItems(t.items);break;case"setActive":i=Object(c.c)(t.viewMode)?this.fb.getItem(t.hash).then(({item:t})=>this.db.addCloudPro(t)).then(()=>this.setActive(t.hash)).then(()=>this.lastUpdatedHash=t.hash).then(()=>this.db.updateCopyDate(t.hash)):this.setActive(t.hash).then(()=>this.lastUpdatedHash=t.hash).then(()=>this.db.updateCopyDate(t.hash));break;case"editText":i=this.db.editText(t.item,t.newText,t.isNew);break;case"addUserText":i=Object(c.c)(t.saveTo)?this.hasSubs()&&this.fb.hasAuth()?this.fb.addItems([{text:t.userText,hash:a.a.hash(t.userText)}]):Promise.reject("no subscription or auth"):this.db.add({text:t.userText},{isUserAdded:!0,isFavorite:Object(c.d)(t.saveTo)});break;case"runPageWidget":i=this.runPageWidgetCurrentTab();break;case"gaProxy":i=Object(n.a)(t.gaCategory,t.gaAction,t.gaLabel);break;case"setLock":i=Object(P.b)(this.hasSubs.bind(this),this.settings);break;case"unlock":i=Object(P.d)(t.code,this.settings);break;case"debugInfo":i=this.collectDebugInfo();break;case"capturePage":i=t.isFull?this.capture.captureFullActiveTab():this.capture.captureActiveTab();break;case"runFloatingMode":i=K(this.hasSubs.bind(this));break;case"cloudProSendItem":i=this.hasSubs()&&this.fb.hasAuth()?this.cloudProSendItem(t):Promise.reject("no subscription or fb auth");break;case"cloudProGetItem":i=this.fb.getItem(t.hash).then(({item:t})=>this.db.addCloudPro(t));break;case"cloudProSignOut":i=this.fb.signOut();break;case"cloudProGetAuthInfo":i=this.fb.getAuthInfo();break;case"completePromo":i=this.promos.completePromo(t.promoName);break;case"requestPermission":i=this.perm.requestPermission(t.permission);break;case"removePermission":i=this.perm.removedPermission(t.permission);break;case"getUserProData":i=this.getUserProData(t.forcedRequest,t.authProvider);break;case"getPaddlePrice":i=this.fb.getPrice(this.settings.get("guid"));break;case"setItemOrder":i=this.db.setOrder(t.hash,t.oldIndex,t.newIndex);break;default:return void s({status:"error",err:`Unsupported action received: "${t.action}"`})}if(i&&"function"==typeof i.then)return i.then(t=>{s({status:"success",...t})}).catch(t=>{s({status:"error",err:t}),o.a(t)}),!0;s({status:"success",...i})}};Object(i.a)();(new nt).start()}});